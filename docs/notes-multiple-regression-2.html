<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.517">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Regression - 6&nbsp; Multiple regression 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./notes-multiple-regression-1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2-mlr.html">Multiple linear regression</a></li><li class="breadcrumb-item"><a href="./notes-multiple-regression-2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple regression 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2-mlr.html">Multiple linear regression</a></li><li class="breadcrumb-item"><a href="./notes-multiple-regression-2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple regression 2</span></a></li></ol></nav><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple regression 2</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part1-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-diagnostics-and-remedial-measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diagnostics and remedial measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-matrix-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Matrix approach to SLR</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part2-mlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-multiple-regression-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple regression 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-multiple-regression-2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple regression 2</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#extra-sums-of-squares" id="toc-extra-sums-of-squares" class="nav-link active" data-scroll-target="#extra-sums-of-squares"><span class="header-section-number">6.1</span> Extra sums of squares</a>
  <ul class="collapse">
<li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">6.1.1</span> Overview</a></li>
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions"><span class="header-section-number">6.1.2</span> Definitions</a></li>
  <li><a href="#decomposition-of-ssr-into-extra-sums-of-squares" id="toc-decomposition-of-ssr-into-extra-sums-of-squares" class="nav-link" data-scroll-target="#decomposition-of-ssr-into-extra-sums-of-squares"><span class="header-section-number">6.1.3</span> Decomposition of <span class="math inline">\(SSR\)</span> into extra sums of squares</a></li>
  <li><a href="#anova-table-containing-decomposition-of-ssr" id="toc-anova-table-containing-decomposition-of-ssr" class="nav-link" data-scroll-target="#anova-table-containing-decomposition-of-ssr"><span class="header-section-number">6.1.4</span> ANOVA table containing decomposition of <span class="math inline">\(SSR\)</span></a></li>
  </ul>
</li>
  <li><a href="#use-of-extra-sums-of-squares-in-tests-for-regression-coefficients" id="toc-use-of-extra-sums-of-squares-in-tests-for-regression-coefficients" class="nav-link" data-scroll-target="#use-of-extra-sums-of-squares-in-tests-for-regression-coefficients"><span class="header-section-number">6.2</span> Use of extra sums of squares in tests for regression coefficients</a></li>
  <li><a href="#summary-of-tests-concerning-regression-coefficients" id="toc-summary-of-tests-concerning-regression-coefficients" class="nav-link" data-scroll-target="#summary-of-tests-concerning-regression-coefficients"><span class="header-section-number">6.3</span> Summary of tests concerning regression coefficients</a></li>
  <li><a href="#coefficient-of-partial-determination" id="toc-coefficient-of-partial-determination" class="nav-link" data-scroll-target="#coefficient-of-partial-determination"><span class="header-section-number">6.4</span> Coefficient of partial determination</a></li>
  <li>
<a href="#sec-standardized-reg-model" id="toc-sec-standardized-reg-model" class="nav-link" data-scroll-target="#sec-standardized-reg-model"><span class="header-section-number">6.5</span> Standardized regression model</a>
  <ul class="collapse">
<li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1"><span class="header-section-number">6.5.1</span> Overview</a></li>
  </ul>
</li>
  <li>
<a href="#multicollinearity-and-its-effects" id="toc-multicollinearity-and-its-effects" class="nav-link" data-scroll-target="#multicollinearity-and-its-effects"><span class="header-section-number">6.6</span> Multicollinearity and its effects</a>
  <ul class="collapse">
<li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">6.6.1</span> Setup</a></li>
  <li><a href="#uncorrelated-predictor-variables" id="toc-uncorrelated-predictor-variables" class="nav-link" data-scroll-target="#uncorrelated-predictor-variables"><span class="header-section-number">6.6.2</span> Uncorrelated predictor variables</a></li>
  <li><a href="#perfectly-correlated-predictors" id="toc-perfectly-correlated-predictors" class="nav-link" data-scroll-target="#perfectly-correlated-predictors"><span class="header-section-number">6.6.3</span> Perfectly correlated predictors</a></li>
  <li><a href="#effects-of-multicollinearity" id="toc-effects-of-multicollinearity" class="nav-link" data-scroll-target="#effects-of-multicollinearity"><span class="header-section-number">6.6.4</span> Effects of multicollinearity</a></li>
  <li><a href="#need-for-more-powerful-diagnostics-for-multicollinearity" id="toc-need-for-more-powerful-diagnostics-for-multicollinearity" class="nav-link" data-scroll-target="#need-for-more-powerful-diagnostics-for-multicollinearity"><span class="header-section-number">6.6.5</span> Need for more powerful diagnostics for multicollinearity</a></li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation"><span class="header-section-number">6.6.6</span> Simulation</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!-- % define LaTeX macros (/shortcuts) --><!-- % define vector (without parentheses, so when writing out in like a definition) of the form X_1, ..., X_n, where X and n are variable. NOTE: to call use $\vecn{X}{n}$ --><!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --><!-- % (followsp is short for 'follow special') shortcut that can be used for iid or ind ~ 'Named dist ' in normal font with space before parameters would go --><!-- % define independence symbol (it basically makes two orthogonal symbols very close to each other. The number of \! controls the space between each of the orthogonal symbols) --><!-- % shortcut for Cov(X,Y) with formatting for Cov --><!-- % shortcut for Corr(X,Y) with formatting for Corr --><!-- % shortcut for non-italic e in math mode --><!-- % shortcut for matrix notation --><section id="extra-sums-of-squares" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="extra-sums-of-squares">
<span class="header-section-number">6.1</span> Extra sums of squares</h2>
<section id="overview" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="overview">
<span class="header-section-number">6.1.1</span> Overview</h3>
<p>Basic idea</p>
<ul>
<li>
<p>An extra sum of squares measures the marginal reduction in the error sum of squares when one or several predictor variables are added to the regression model, given that other predictor variables are already in the model.</p>
<ul>
<li>So it is the difference in <span class="math inline">\(SSE\)</span> with the original variables in the model compared to when additional ones are added (remember <span class="math inline">\(SSE\)</span> always decreases when more variables are added to the model).</li>
</ul>
</li>
<li><p>Equivalently, one can view an extra sum of squares as measuring the marginal increase in the regression sum of squares when one or several predictor variables are added to the regression model (likewise, <span class="math inline">\(SSR\)</span> always increases with additional terms).</p></li>
</ul></section><section id="definitions" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="definitions">
<span class="header-section-number">6.1.2</span> Definitions</h3>
<p>Using both perspectives, we can define</p>
<p><span class="math display">\[SSR(X_2 \mid X_1) \hspace{10pt} = \hspace{10pt} SSE(X_1) - SSE(X_1, X_2)  \hspace{10pt} = \hspace{10pt} SSR(X_1, X_2) - SSR(X_1)\]</span></p>
<p>Extensions for three or more variables are straightforward.</p>
<p><span class="math display">\[SSR(X_3 \mid X_1, X_2) \hspace{10pt} = \hspace{10pt} SSE(X_1, X_2) - SSE(X_1, X_2, X_3)  \hspace{10pt} = \hspace{10pt} SSR(X_1, X_2, X_3) - SSR(X_1, X_2)\]</span></p>
<p>Note that we can also switch the order, say if <span class="math inline">\(X_2\)</span> enters the model first, then <span class="math inline">\(X_1\)</span>.</p>
</section><section id="decomposition-of-ssr-into-extra-sums-of-squares" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="decomposition-of-ssr-into-extra-sums-of-squares">
<span class="header-section-number">6.1.3</span> Decomposition of <span class="math inline">\(SSR\)</span> into extra sums of squares</h3>
<p>In multiple regression, unlike simple linear regression, we can obtain a variety of decompositions of the regression sum of squares <span class="math inline">\(SSR\)</span> into extra sums of squares.</p>
<p><img src="files/images/ssr-decomposition-formulas.png" class="img-fluid" style="width:80.0%"></p>
<p><img src="files/images/ssr-decomposition-visualized.png" class="img-fluid" style="width:80.0%"></p>
<p><img src="files/images/ssr-many-decompositions.png" class="img-fluid" style="width:80.0%"></p>
<p>It is obvious that the number of possible decompositions becomes vast as the number of <span class="math inline">\(X\)</span> variables in the regression model increases.</p>
</section><section id="anova-table-containing-decomposition-of-ssr" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="anova-table-containing-decomposition-of-ssr">
<span class="header-section-number">6.1.4</span> ANOVA table containing decomposition of <span class="math inline">\(SSR\)</span>
</h3>
<p>ANOVA tables can be constructed containing decompositions of the regression sum of squares into extra sums of squares.</p>
<p><img src="files/images/ssr-decomposition-anova-table.png" class="img-fluid" style="width:80.0%"></p>
<p>Note that each extra sum of squares involving a single extra <span class="math inline">\(X\)</span> variable has associated with it one degree of freedom. The resulting mean squares are constructed as usual.</p>
<p><span class="math display">\[MSR(X_2 \mid X_1) = \frac{SSR(X_2 \mid X_1)}{1}\]</span></p>
<p>Extra sums of squares involving two extra <span class="math inline">\(X\)</span> variables, such as <span class="math inline">\(SSR(X_2, X_3 \mid X_1)\)</span>, have two degrees of freedom associated with them. This follows because we can express such an extra sum of squares as a sum of two extra sums of squares, each associated with one df. For example, by definition of the extra sums of squares, we have</p>
<p><span class="math display">\[SSR(X_2, X_3 \mid X_1) = SSR(X_2 \mid X_1) + SSR(X_3 \mid X_1, X_2)\]</span></p>
<p>The mean square is therefore obtained as follows:</p>
<p><span class="math display">\[MSR(X_2, X_3 \mid X_1) = \frac{SSR(X_2, X_3 \mid X_1)}{2}\]</span></p>
<p>Many computer regression packages provide decompositions of <span class="math inline">\(SSR\)</span> into single-degree-of-freedom extra sums of squares, usually in the order in which the <span class="math inline">\(X\)</span> variables are entered into the model. Thus, if the <span class="math inline">\(X\)</span> variables are entered in the order <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>, <span class="math inline">\(X_3\)</span>, the extra Sums of squares given in the output are:</p>
<p><span class="math display">\[
\begin{align*}
&amp;SSR(X_1)\\
&amp;SSR(X_2 \mid X_1)\\
&amp;SSR(X_3 \mid X_1, X_2)\\
\end{align*}
\]</span></p>
<p>If an extra sum of squares involving several extra <span class="math inline">\(X\)</span> variables is desired, it can be obtained by summing appropriate single-degree-of-freedom extra sums of squares.</p>
<p>The reason why extra sums of squares are of interest is that they occur in a variety of tests about regression coefficients where the question of concern is whether certain <span class="math inline">\(X\)</span> variables can be dropped from the regression model.</p>
<p>Demo</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NOTE: generating a single dataset to use for many of the following examples</span></span>
<span></span>
<span><span class="co"># generate predictor data</span></span>
<span><span class="co"># -&gt; num_x number of base predictors (assumed known; generated from same dist)</span></span>
<span><span class="co"># -&gt; num_noise unimportant predictors (placed at end)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">num_x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">num_noise</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">num_x</span><span class="op">+</span><span class="va">num_noise</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">num_x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_noise</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate mean response and add random error</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verify the <span class="math inline">\(SS\)</span> given in <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> are conditional.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># combine data</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num_x</span>, <span class="va">num_noise</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit models</span></span>
<span><span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="va">mod_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="va">mod_123</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get anova table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_123</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">tidy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  term         df    sumsq   meansq statistic   p.value
  &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 X1            1 1504.    1504.     118.      2.71e-14
2 X2            1 1460.    1460.     115.      4.45e-14
3 X3            1    0.566    0.566    0.0445  8.34e- 1
4 Residuals    46  586.      12.7     NA      NA       </code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># verify conditional sum of squares</span></span>
<span></span>
<span><span class="co"># -&gt; just X1 in the model</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_123</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_1</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_123 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(sumsq)`
[1] 1503.859

$`mod_1 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(sumsq)`
[1] 1503.859</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># X2 in the model after X1 already in model</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_123</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_123 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(sumsq)`
[1] 1459.657

$`mod_12 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(sumsq)`
[1] 1459.657</code></pre>
</div>
</div>
</section></section><section id="use-of-extra-sums-of-squares-in-tests-for-regression-coefficients" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="use-of-extra-sums-of-squares-in-tests-for-regression-coefficients">
<span class="header-section-number">6.2</span> Use of extra sums of squares in tests for regression coefficients</h2>
<p><img src="files/images/test-betak-ss.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li>The <span class="math inline">\(F^*\)</span> test statistic here to test whether or not <span class="math inline">\(\beta_k = 0\)</span> is called a <em>partial F test statistic </em>to distinguish it from the <em>overall</em> <span class="math inline">\(F^*\)</span> <em>statistic</em> that <a href="notes-multiple-regression-1.html#sec-f-test-overall" class="quarto-xref"><span>Section&nbsp;5.3.3</span></a> for testing whether <em>all</em> <span class="math inline">\(\beta_k = 0\)</span>.</li>
</ul>
<p><img src="files/images/test-several-betak-ss.png" class="img-fluid" style="width:80.0%"></p>
<p>Note</p>
<ul>
<li><p>For testing whether a single <span class="math inline">\(\beta_k\)</span> equals zero, two equivalent test statistics are available: the <span class="math inline">\(t^*\)</span> test statistic and the <span class="math inline">\(F^*\)</span> general linear test statistic.</p></li>
<li><p>When testing whether several <span class="math inline">\(\beta_k\)</span> equal zero, only the general linear test statistic <span class="math inline">\(F^*\)</span> is available.</p></li>
</ul>
<p>Demo</p>
<ul>
<li>Verify <span class="math inline">\((t^*)^2 = F^*\)</span>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># verify t-stat^2 = F-stat for SAME order of model</span></span>
<span><span class="va">t_stat</span> <span class="op">&lt;-</span> <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span> <span class="co"># middle step cause compare() being weird</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">t_stat</span> <span class="op">%&gt;%</span> <span class="fu">raise_to_power</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`t_stat %&gt;% raise_to_power(2)`
[1] 116.9972

$`mod_12 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(statistic)`
[1] 116.9972</code></pre>
</div>
</div>
</section><section id="summary-of-tests-concerning-regression-coefficients" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="summary-of-tests-concerning-regression-coefficients">
<span class="header-section-number">6.3</span> Summary of tests concerning regression coefficients</h2>
<p><img src="files/images/summary-tests-reg-coefs.png" class="img-fluid" style="width:80.0%"></p>
<p>Verify order doesn’t matter for estimates / t-tests, but order (in the sense of what is already included in the model does matter).</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># verify order doesn't matter for t-tests</span></span>
<span></span>
<span><span class="co"># fit model in different order</span></span>
<span><span class="va">mod_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># same estimate and t-test statistic</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">term</span><span class="op">)</span>, <span class="va">mod_21</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">term</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_12 %&gt;% tidy %&gt;% arrange(term)`
# A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     1.38     0.500      2.77 8.00e- 3
2 X1              2.04     0.178     11.4  3.51e-15
3 X2              1.99     0.184     10.8  2.39e-14

$`mod_21 %&gt;% tidy %&gt;% arrange(term)`
# A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     1.38     0.500      2.77 8.00e- 3
2 X1              2.04     0.178     11.4  3.51e-15
3 X2              1.99     0.184     10.8  2.39e-14</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># just different decomposition of SS</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">term</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_21</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">term</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
$comparison$result
[1] FALSE

$comparison$description
[1] "Component \"sumsq\": Mean relative difference: 0.08681264"    
[2] "Component \"meansq\": Mean relative difference: 0.08681264"   
[3] "Component \"statistic\": Mean relative difference: 0.08681264"

$comparison$`element-wise`
     term   df sumsq meansq statistic p.value
[1,] TRUE TRUE  TRUE   TRUE        NA      NA
[2,] TRUE TRUE FALSE  FALSE     FALSE    TRUE
[3,] TRUE TRUE FALSE  FALSE     FALSE    TRUE


$`mod_12 %&gt;% anova %&gt;% tidy %&gt;% arrange(term)`
# A tibble: 3 × 6
  term         df sumsq meansq statistic   p.value
  &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Residuals    47  586.   12.5       NA  NA       
2 X1            1 1504. 1504.       121.  1.44e-14
3 X2            1 1460. 1460.       117.  2.39e-14

$`mod_21 %&gt;% anova %&gt;% tidy %&gt;% arrange(term)`
# A tibble: 3 × 6
  term         df sumsq meansq statistic   p.value
  &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Residuals    47  586.   12.5       NA  NA       
2 X1            1 1632. 1632.       131.  3.51e-15
3 X2            1 1331. 1331.       107.  1.12e-13</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># verify what is included previpously in model matters for F tests</span></span>
<span></span>
<span><span class="co"># -&gt; same order model is necessary because F-test is different for X2 | X1 (second) vs X2 (first) --&gt; should be different</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_21</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
$comparison$result
[1] FALSE

$comparison$description
[1] "Mean relative difference: 0.08812708"

$comparison$`element-wise`
[1] FALSE


$`mod_12 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(statistic)`
[1] 116.9972

$`mod_21 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(statistic)`
[1] 106.6866</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># but X3 | X1, X2 should be same as X3 | X2, X1</span></span>
<span><span class="va">mod_213</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X3</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_123</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X3"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_213</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X3"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_123 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X3") %&gt;% pull(statistic)`
[1] 0.04448291

$`mod_213 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X3") %&gt;% pull(statistic)`
[1] 0.04448291</code></pre>
</div>
</div>
</section><section id="coefficient-of-partial-determination" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="coefficient-of-partial-determination">
<span class="header-section-number">6.4</span> Coefficient of partial determination</h2>
<p>The coefficient of multiple determination, <span class="math inline">\(R^2\)</span>, measures the proportionate reduction in the variation of <span class="math inline">\(Y\)</span> achieved by the introduction of the entire set of <span class="math inline">\(X\)</span> variables considered in the model.</p>
<p>A coefficient of partial determination, in contrast, measures the marginal contribution of one <span class="math inline">\(X\)</span> variable when all others are already included in the model.</p>
<p><img src="files/images/coef-partial-det.png" class="img-fluid" style="width:80.0%"></p>
<p>Demo</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model with just X1</span></span>
<span><span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use model with X1 and X2 (already fit from above)</span></span>
<span></span>
<span><span class="co"># calculate R^2_{Y2|1} = SSR(X2|X1) / SSE(X1)</span></span>
<span><span class="co"># -&gt; reduction in SSE when X2 is added to the model relative to when only X1 in the model (just numerator in regression sum of squares perspective)</span></span>
<span><span class="va">SSR_X2_given_X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_12</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span> </span>
<span><span class="va">SSE_X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Residuals"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># another way to calculate (from the comments)</span></span>
<span><span class="co"># -&gt; adjust X2 and Y for the linear relationship to X1 to just get the added affect of X2</span></span>
<span></span>
<span><span class="co"># use mod_1</span></span>
<span></span>
<span><span class="co"># regress X2 on X1</span></span>
<span><span class="va">mod_X2X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">X2</span> <span class="op">~</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regress residuals on each other</span></span>
<span><span class="va">mod_resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_X2X1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract R^2</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">SSR_X2_given_X1</span> <span class="op">/</span> <span class="va">SSE_X1</span>, <span class="va">mod_resids</span> <span class="op">%&gt;%</span> <span class="va">glance</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`SSR_X2_given_X1/SSE_X1`
[1] 0.7134097

$`mod_resids %&gt;% glance %&gt;% pull(r.squared)`
[1] 0.7134097</code></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># show added variable plot -&gt; strong linear relationship is evident after adjusting for X1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_X2X1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-multiple-regression-2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="sec-standardized-reg-model" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="sec-standardized-reg-model">
<span class="header-section-number">6.5</span> Standardized regression model</h2>
<p>NOTE: Writing notes here just to be aware of it, but not going to demo it cause doesn’t seem to be standard practice in R.</p>
<section id="overview-1" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="overview-1">
<span class="header-section-number">6.5.1</span> Overview</h3>
<p>A standardized form of the general multiple regression model <span class="citation" data-cites="ge-lin-mod">@ge-lin-mod</span> is employed to control roundoff errors in normal equations calculations and to permit comparisons ofthe estimated regression coefficients in common units.</p>
<p>Roundoff errors</p>
<ul>
<li><p>Roundoff errors tend to enter normal equations calculations primarily when the inverse of <span class="math inline">\(\boldsymbol{X'X}\)</span>is taken. These are magnified when calculating <span class="math inline">\(\boldsymbol{\beta}\)</span> and other statistics.</p></li>
<li><p>The danger of serious roundoff errors in <span class="math inline">\(\boldsymbol{(X'X)}^{-1}\)</span> is particularly great when (1) <span class="math inline">\(\boldsymbol{X'X}\)</span> has a determinant that is close to zero and/or (2) the elements of <span class="math inline">\(\boldsymbol{X'X}\)</span> differ substantially in order of magnitude (say 10 and 10^6.</p></li>
<li><p>The transformation to obtain the standardized regression model, called the <em>correlation transformation</em>, makes all entries in the <span class="math inline">\(\boldsymbol{X'X}\)</span> matrix for the transformed variablesf all between -1 and 1 inclusive, so that the calculation of the inverse matrix becomes much less subject to roundoff errors due to dissimilar orders of magnitudes than with the original variables.</p></li>
<li><p>Although, in order to avoid the computational difficulties inherent in inverting the <span class="math inline">\(\boldsymbol{X'X}\)</span> matrix, many statistical packages use an entirely different computational approach that involves decomposing the <span class="math inline">\(\boldsymbol{X}\)</span> matrix into a product of several matrices with special properties.</p></li>
</ul>
<p><mark><strong>Programming note → Beautiful sites (<a href="https://genomicsclass.github.io/book/pages/qr_and_regression.html">(1)</a> and <a href="https://machinelearningmastery.com/solve-linear-regression-using-linear-algebra/#:~:text=The%20QR%20decomposition%20is%20an,down%20into%20its%20constituent%20elements.&amp;text=Where%20A%20is%20the%20matrix,the%20linear%20least%20squares%20equation.">(2)</a>) explaining QR decomposition and how it relates to LSE; must go through and recreate at some point.</strong></mark></p>
<p>Lack of comparability of regression coefficients</p>
<ul>
<li>A second difficulty with the nonstandardized multiple model is that ordinarily regression coefficients cannot be compared because of differences in the units involved. For example if <span class="math inline">\(X_1\)</span> is in dollars and <span class="math inline">\(X_2\)</span> is in thousands of dollars, simply comparing the relative magnitudes of <span class="math inline">\(\hat{\beta_1}\)</span> and <span class="math inline">\(\hat{\beta}_2\)</span> to get an idea of importance can be misleading.</li>
</ul>
<p>Correlation transformation</p>
<p><img src="files/images/correlation-transformation.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li>Use of the standardized variables above (the typical standardization process) without the correlation transformation modification above will lead to the same standardized regression coefficients resulting from the correlation-transformed variables. However, the elements of the <span class="math inline">\(\boldsymbol{X'X}\)</span> matrix will not then be bounded between -1 and 1.</li>
</ul>
<p>Standardized regression model</p>
<p><img src="files/images/standardized-reg-mod.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>Some more results about what the <span class="math inline">\(\boldsymbol{\beta}\)</span> is and some intermediate calculations.</li>
</ul></section></section><section id="multicollinearity-and-its-effects" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="multicollinearity-and-its-effects">
<span class="header-section-number">6.6</span> Multicollinearity and its effects</h2>
<section id="setup" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="setup">
<span class="header-section-number">6.6.1</span> Setup</h3>
<p>In multiple regression analysis, the nature and significance of the relations between the predictor or explanatory variables and the response variable are often of particular interest Some questions frequently asked are:</p>
<ol type="1">
<li><p>What is the relative importance of the effects of the different predictor variables?</p></li>
<li><p>What is the magnitude of the effect of a given predictor variable on the response variable?</p></li>
<li><p>Can any predictor variable be dropped from the model because it has little or no effect on the response variable?</p></li>
<li><p>Should any predictor variables not yet included in the model be considered for possible inclusion?</p></li>
</ol>
<p>If the predictor variables included in the model are (l) uncorrelated among themselves and (2) uncorrelated with any other predictor variables that are related to the response variable but are omitted from the model, relatively simple answers can be given to these questions. Unfortunately in non-experimental studies this is often not the case.</p>
<p>When the predictor variables are correlated among themselves, <em>multicollinearity</em> among them is said to exist. This creates a variety of problems, but we will first explore the uncorrelated case first.</p>
</section><section id="uncorrelated-predictor-variables" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="uncorrelated-predictor-variables">
<span class="header-section-number">6.6.2</span> Uncorrelated predictor variables</h3>
<p>Suppose we have two predictor variables, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, which are uncorrelated.</p>
<p>Observation and results</p>
<ul>
<li>
<p>Observation: Estimated coefficient <span class="math inline">\(\hat{\beta}_1\)</span> will be the same REGARDLESS of whether <span class="math inline">\(X_2\)</span> is included in the model (in any order). Same for <span class="math inline">\(\hat{\beta}_2\)</span> and <span class="math inline">\(X_1\)</span>.</p>
<ul>
<li><p><em>Generalized result: When the predictor variables are uncorrelated, the effects ascribed to them by a first-order regression model are the same no matter which other of these predictor variables are included in the model.</em></p></li>
<li><p>This is a strong argument for controlled experiments whenever possible, since experimental control permits choosing the levels of the predictor variables so as to make these variables uncorrelated.</p></li>
</ul>
</li>
<li>
<p>Observation: The extra sum of squares <span class="math inline">\(SSR(X_2 \mid X_1)\)</span> equals the regression sum of squares <span class="math inline">\(SSR(X_2)\)</span> when only <span class="math inline">\(X_2\)</span> is in the regression model. Same for <span class="math inline">\(X_1\)</span>.</p>
<ul>
<li><p><em>Generalized result: When two or more predictor variables are uncorrelated, the marginal contribution of one predictor variable in reducing the error sum of squares when the other predictor variables are in the model is exactly the same as when this predictor variable is in the model alone.</em></p></li>
<li><p>Note that this can be seen in the formulas for the <span class="math inline">\(\hat{\beta}_i\)</span>s.</p></li>
</ul>
</li>
</ul>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Perfectly uncorrelated</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Practically uncorrelated</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># perfectly uncorrelated</span></span>
<span></span>
<span><span class="co"># not sure how to generate or transform to perfectly uncorrelated predictor variables</span></span>
<span></span>
<span><span class="co"># so using this found dataset (https://online.stat.psu.edu/stat501/lesson/12/12.2)</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">X1</span>,  <span class="op">~</span><span class="va">X2</span>, <span class="op">~</span><span class="va">Y</span>,</span>
<span>  <span class="op">-</span><span class="fl">1</span>,   <span class="fl">1</span>,  <span class="fl">91</span>,</span>
<span>  <span class="op">-</span><span class="fl">1</span>,   <span class="fl">2</span>,  <span class="fl">107</span>,</span>
<span>  <span class="op">-</span><span class="fl">1</span>,   <span class="fl">3</span>,  <span class="fl">101</span>,</span>
<span>  <span class="op">-</span><span class="fl">1</span>,   <span class="fl">4</span>,  <span class="fl">121</span>,</span>
<span>  <span class="op">-</span><span class="fl">1</span>,   <span class="fl">5</span>,  <span class="fl">95</span>,</span>
<span>  <span class="fl">0</span>,    <span class="fl">7</span>,  <span class="fl">84</span>,</span>
<span>  <span class="fl">0</span>,    <span class="fl">8</span>,  <span class="fl">108</span>,</span>
<span>  <span class="fl">0</span>,    <span class="fl">9</span>,  <span class="fl">102</span>,</span>
<span>  <span class="fl">0</span>,    <span class="fl">10</span>, <span class="fl">98</span>,</span>
<span>  <span class="fl">1</span>,    <span class="fl">1</span>,  <span class="fl">73</span>,</span>
<span>  <span class="fl">1</span>,    <span class="fl">2</span>,  <span class="fl">75</span>,</span>
<span>  <span class="fl">1</span>,    <span class="fl">3</span>,  <span class="fl">102</span>,</span>
<span>  <span class="fl">1</span>,    <span class="fl">4</span>,  <span class="fl">94</span>,</span>
<span>  <span class="fl">1</span>,    <span class="fl">5</span>,  <span class="fl">113</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data_sample</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">cor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   X1 X2
X1  1  0
X2  0  1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit models and compare coefficients</span></span>
<span><span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="va">mod_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="va">mod_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_1</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_1 %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(estimate)`
[1] -5.8

$`mod_12 %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(estimate)`
[1] -5.8</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_2</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_2 %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(estimate)`
[1] 1.360256

$`mod_12 %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(estimate)`
[1] 1.360256</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compare extra sum of squares when variable included previously</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_2</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">anova</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`mod_2 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(sumsq)`
[1] 206.176

$`mod_12 %&gt;% anova %&gt;% tidy %&gt;% filter(term == "X2") %&gt;% pull(sumsq)`
[1] 206.176</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># practically uncorrelated</span></span>
<span></span>
<span><span class="co"># try to generate uncorrelated predictor variables</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]
[1,] 1.0000000 0.1989148
[2,] 0.1989148 1.0000000</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate mean response and add random error</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># combine data</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit models and compare coefficients</span></span>
<span><span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="va">mod_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="va">mod_1</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>        <span class="va">mod_12</span> <span class="op">%&gt;%</span> <span class="va">tidy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
$comparison$result
[1] FALSE

$comparison$description
[1] "Mean relative difference: 0.1650338"

$comparison$`element-wise`
[1] FALSE


$`mod_1 %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(estimate)`
[1] 2.496922

$`mod_12 %&gt;% tidy %&gt;% filter(term == "X1") %&gt;% pull(estimate)`
[1] 2.084846</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="perfectly-correlated-predictors" class="level3" data-number="6.6.3"><h3 data-number="6.6.3" class="anchored" data-anchor-id="perfectly-correlated-predictors">
<span class="header-section-number">6.6.3</span> Perfectly correlated predictors</h3>
<p>Results of trivial example from book:</p>
<ul>
<li>For a model with two predictors, there is an infinite set of response functions (surfaces) that generate the same set of fitted values where they intersect, but totally different ones when not.</li>
</ul>
<p>Two implications of above example:</p>
<ol type="1">
<li><p>The perfect relation between <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> did not inhibit our ability to obtain a good fit to the data.</p></li>
<li><p>Since many different response functions provide the same good fit, we cannot interpret anyone set of regression coefficients as reflecting the effects of the different predictor variables 9in terms of magnitude and direction).</p></li>
</ol>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Perfectly correlated</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Practically super correlated</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate a single vector and transform</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>X2 <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">X1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   X1 X2
X1  1  1
X2  1  1</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate mean response and add random error</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># combine data</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model with both variables</span></span>
<span><span class="va">mod_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Y ~ X1 + X2, data = data_sample)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.4700 -1.8303  0.0001  1.7359  4.6915 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)   2.3225     0.3428   6.776         0.0000000162 ***
X1            8.2263     0.1077  76.381 &lt; 0.0000000000000002 ***
X2                NA         NA      NA                   NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.415 on 48 degrees of freedom
Multiple R-squared:  0.9918,    Adjusted R-squared:  0.9917 
F-statistic:  5834 on 1 and 48 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Second coefficient doesn’t even get estimated.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate a single vector and transform + slight noise</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>X2 <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">X1</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">$</span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">$</span><span class="va">X2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X1        X2
X1 1.0000000 0.9999993
X2 0.9999993 1.0000000</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate mean response and add random error</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># combine data</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model with both variables</span></span>
<span><span class="va">mod_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Y ~ X1 + X2, data = data_sample)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.1910 -1.7589  0.0796  1.7460  4.5867 

Coefficients:
             Estimate Std. Error t value    Pr(&gt;|t|)    
(Intercept)    2.2210     0.3563   6.233 0.000000119 ***
X1          -199.7742    97.4480  -2.050      0.0460 *  
X2            69.1590    32.4847   2.129      0.0385 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.443 on 47 degrees of freedom
Multiple R-squared:  0.9896,    Adjusted R-squared:  0.9892 
F-statistic:  2235 on 2 and 47 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Super inflated standard errors and wildly different estimates than the <span class="math inline">\(\beta\)</span>s.</p>
</div>
</div>
</div>
</section><section id="effects-of-multicollinearity" class="level3" data-number="6.6.4"><h3 data-number="6.6.4" class="anchored" data-anchor-id="effects-of-multicollinearity">
<span class="header-section-number">6.6.4</span> Effects of multicollinearity</h3>
<p>Summary of related effects of multicollinearity</p>
<ol type="1">
<li>Multicollinearity doesn’t affect prediction.</li>
</ol>
<ul>
<li><p>The fact that some or all predictor variables are correlated among themselves does not, in general, inhibit our ability to obtain a good fit nor does it tend to affect inferences about mean responses or predictions of new observations, provided these inferences are made within the region of observations.</p></li>
<li><p><span class="math inline">\(MSE\)</span> still gets steadily reduced as more variables are added.</p></li>
</ul>
<p><img src="files/images/mse-highly-correlated.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>
<p>And the precision of fitted values within the range of the observations on the predictor variables does not worsen with the addition of correlated predictor variables into the regression model (even despite the inflated standard errors of the <span class="math inline">\(\beta\)</span>s).</p>
<ul>
<li>The essential reason for the stability is that the covariance between <span class="math inline">\(\hat{\beta}_1\)</span> and <span class="math inline">\(\hat{\beta}_2\)</span> is negative, which plays a strong counteracting influence to the increase in <span class="math inline">\(s^2(\hat{\beta}_1)\)</span>, in determining the value of <span class="math inline">\(s^2(\hat{Y}_h)\)</span> as given below:</li>
</ul>
</li>
</ul>
<p><img src="files/images/algebra-variance-estimated-mean.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="1">
<li>Large standard errors in estimated regression coefficients.</li>
</ol>
<ul>
<li>Estimated regression coefficients tend to have large sampling variability when the predictor variables are highly correlated <span class="math inline">\(\Longrightarrow\)</span> tend to vary widely from one sample to the next <span class="math inline">\(\Longrightarrow\)</span> only imprecise information may be available about the individual true regression coefficients.</li>
</ul>
<p><img src="files/images/st-errors-correlated-preds.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>Indeed, many of the estimated regression coefficients <em>individually</em> may be statistically not significant even though a definite statistical relation exists between the response variable and <em>the set of predictor variables</em>.</li>
</ul>
<ol start="3" type="1">
<li>Cannot interpret estimated regression coefficients.</li>
</ol>
<ul>
<li><p>The common interpretation of a regression coefficient as measuring the change in the expected value of the response variable when the given predictor variable is increased by one unit while all other predictor variables are held constant (aka the marginal effect) is not fully applicable when multicollinearity exists.</p></li>
<li><p>It may be conceptually feasible to think of varying one predictor variable and the others constant, but it may not be possible in practice to do so for predictor variables that are highly correlated. For example, in a regression model for predicting crop yield from amount of rainfall and hours of sunshine, the relation between the two predictor variables makes it unrealistic to consider varying one while holding the other constant.</p></li>
</ul>
<ol start="4" type="1">
<li>Magnitude (and sign) of estimated coefficients are conditional based on what is already in model.</li>
</ol>
<ul>
<li>When predictor variables are correlated, the regression coefficient of anyone variable depends on which other predictor variables are included in the model and which ones are left out.</li>
</ul>
<p><img src="files/images/correlated-predictors-coefs.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li><p>Thus, a regression coefficient does not reflect any inherent effect of the particular predictor variable on the response variable but only a marginal or partial effect, <em>given</em> whatever other correlated predictor variables are included in the model.</p></li>
<li><p>Even have to be weary of predictors that are highly correlated with each other, even if some are omitted from the model.</p></li>
</ul>
<ol start="4" type="1">
<li>Effects of variables are conditional based on what is already in model.</li>
</ol>
<ul>
<li><p>When predictor variables are correlated, the marginal contribution of anyone predictor variable in reducing the error sum of squares varies, depending on which other variables are already in the regression model, just as for regression coefficients.</p></li>
<li>
<p>For example, supppose <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are highly correlated and <span class="math inline">\(SSR(X_1) &gt;&gt; SSR(X_1 \mid X_2)\)</span>. The reason why <span class="math inline">\(SSR(X_1 \mid X_2)\)</span> is so small compared with <span class="math inline">\(SSR(X1)\)</span> is that <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are highly correlated with each other and with the response variable. Thus, when <span class="math inline">\(X_2\)</span> is already in the regression model, the marginal contribution of <span class="math inline">\(X_1\)</span> in reducing the error sum of squares is comparatively small because <span class="math inline">\(X_2\)</span> contains much of the same information as <span class="math inline">\(X_1\)</span>.</p>
<ul>
<li>This can also be seen in the coefficient of partial determinations, which also behave erratically sample-to-sample when multiollinearity is present.</li>
</ul>
</li>
</ul>
<p><img src="files/images/coefs-partial-det-correlated.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>When predictor variables are correlated, there is no unique sum of squares that can be ascribed to anyone predictor variable as reflecting its effect in reducing the total variation in <span class="math inline">\(Y\)</span>.</li>
</ul>
<ol start="5" type="1">
<li>Mismatching results from simulataneuous inferences vs overall inference on coefficients.</li>
</ol>
<p><img src="files/images/effects-on-simulataneous-inference.png" class="img-fluid" style="width:80.0%"></p>
<ol start="6" type="1">
<li>Unstable model fitting.</li>
</ol>
<ul>
<li>As mentioned in {#sec-standardized-reg-model}, a near-zero determinant of <span class="math inline">\(\boldsymbol{X'X}\)</span> is a potential source of serious roundoff errors in normal equations calculations. Severe has the of making this determimant come close to zero.</li>
<li>Thus, under severe multicollineanty, the regression coefficients may be subject to large roundoff errors as well as large sampling variances <span class="math inline">\(\Longrightarrow\)</span> Should use correlation transformation or something akin.</li>
</ul></section><section id="need-for-more-powerful-diagnostics-for-multicollinearity" class="level3" data-number="6.6.5"><h3 data-number="6.6.5" class="anchored" data-anchor-id="need-for-more-powerful-diagnostics-for-multicollinearity">
<span class="header-section-number">6.6.5</span> Need for more powerful diagnostics for multicollinearity</h3>
<ul>
<li><p>As we have seen, multicollinearity among the predictor variables can have important consequences for interpreting and using a fitted regression model.</p></li>
<li><p>The diagnostic tool considered here for identifying multicollinearity was the pairwise coefficients of simple correlation between the predictor variables; this is frequently helpful.</p></li>
<li><p>Often, however, serious multicollinearity exists without being disclosed by the pairwise correlation coefficients. Later, we present a more powerful tool for identifying the existence of serious multicollinearity. Some remedial measures for lessening the effects of multicollinearity will be considered as well.</p></li>
</ul></section><section id="simulation" class="level3" data-number="6.6.6"><h3 data-number="6.6.6" class="anchored" data-anchor-id="simulation">
<span class="header-section-number">6.6.6</span> Simulation</h3>
<p>Simualtion to demo the affects of varying levels of multicollinearity.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize simulation settings</span></span>
<span><span class="co"># -&gt; first the parameters of interest (that are variable)</span></span>
<span><span class="co"># -&gt; create all combos</span></span>
<span><span class="co"># -&gt; add in the constant settings</span></span>
<span><span class="co"># -&gt; arrange in a good order</span></span>
<span><span class="co"># -&gt; add simulation id column</span></span>
<span><span class="co"># -&gt; set row names equal to id (helps keep track of results later)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>rho_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span>,</span>
<span>         sigma_x <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         beta_0 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         beta_1 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         beta_2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         sigma <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">rho_x</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sim"</span>, <span class="va">params</span><span class="op">$</span><span class="va">sim_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define function to run on each unique simulation setting</span></span>
<span><span class="va">run_trial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span>, <span class="va">vec_names</span>, <span class="va">m</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># redefine arguments for easier reference</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">=</span> <span class="va">vec_names</span></span>
<span>  <span class="va">rho_x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"rho_x"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"n"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sigma_x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"sigma_x"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_0"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_1"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_2"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"sigma"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sim_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"sim_id"</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># initialize results vectors</span></span>
<span>  <span class="va">beta0_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta1_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta2_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">se_beta1_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">se_beta2_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta1_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta2_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">MSE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">R2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">R2_adj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># loop to simulate m models and extract summaries</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># generate X predictors according to specified correlation structure</span></span>
<span>    <span class="va">Sigma</span> <span class="op">=</span> <span class="va">sigma_x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">rho_x</span>,<span class="va">rho_x</span>,<span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">X</span> <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>    <span class="va">X</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># generate mean response and add random error</span></span>
<span>    <span class="va">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">beta_0</span>, <span class="va">beta_1</span>, <span class="va">beta_2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># combine data</span></span>
<span>    <span class="va">data_sample</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="va">data.frame</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># fit model with both variables</span></span>
<span>    <span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, <span class="va">data_sample</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># get summaries</span></span>
<span>    <span class="va">mod_summ</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span>    <span class="va">mod_stats</span> <span class="op">=</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span>    <span class="va">beta0_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span>    <span class="va">beta1_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span>    <span class="va">beta2_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span>    <span class="va">se_beta1_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">std.error</span><span class="op">)</span></span>
<span>    <span class="va">se_beta2_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">std.error</span><span class="op">)</span></span>
<span>    <span class="va">beta1_t</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span></span>
<span>    <span class="va">beta2_t</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_summ</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span></span>
<span>    <span class="va">MSE</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_stats</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">R2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_stats</span><span class="op">$</span><span class="va">r.squared</span></span>
<span>    <span class="va">R2_adj</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mod_stats</span><span class="op">$</span><span class="va">adj.r.squared</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">beta0_hat</span>, <span class="va">beta1_hat</span>, <span class="va">beta2_hat</span>, <span class="va">se_beta1_hat</span>, <span class="va">se_beta2_hat</span>, <span class="va">beta1_t</span>, <span class="va">beta2_t</span>, <span class="va">MSE</span>, <span class="va">R2</span>, <span class="va">R2_adj</span>, sim_id <span class="op">=</span> <span class="va">sim_id</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># define function to run simulation and format results</span></span>
<span><span class="va">simulation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">sim_function</span>, <span class="va">iterations</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">format_results</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># run simulation for each parameter settings</span></span>
<span>  <span class="co"># -&gt; have to transpose so that now each column is a parameter settings and convert to dataframe so can pass to map(), which needs a list</span></span>
<span>  <span class="va">results_raw</span> <span class="op">=</span> <span class="va">params</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="va">t</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="va">data.frame</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="fu">sim_function</span><span class="op">(</span><span class="va">vec</span>, vec_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, m <span class="op">=</span> <span class="va">iterations</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">format_results</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results_raw</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># reformat results</span></span>
<span>    <span class="co"># -&gt; convert each results matrix to a dataframe, then combine</span></span>
<span>    <span class="co"># -&gt; attach the simulation settings to the results</span></span>
<span>    <span class="co"># -&gt; pivot longer to have one column for the name of the summary measure and one for its value</span></span>
<span>    <span class="co"># -&gt; convert parameters to factors for plot</span></span>
<span>    <span class="va">results</span> <span class="op">=</span> <span class="va">results_raw</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">reduce</span><span class="op">(</span><span class="va">bind_rows</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">left_join</span><span class="op">(</span><span class="va">params</span>, by <span class="op">=</span> <span class="st">"sim_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">results_raw</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                   names_to <span class="op">=</span> <span class="st">"statistic"</span>,</span>
<span>                   values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define function to plot standard results</span></span>
<span><span class="va">plot_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">stats</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">statistic</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">stats</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>,</span>
<span>               group <span class="op">=</span> <span class="va">rho_x</span>,</span>
<span>               color <span class="op">=</span> <span class="va">rho_x</span>,</span>
<span>               fill <span class="op">=</span> <span class="va">rho_x</span><span class="op">)</span>,</span>
<span>           data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>               scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run simulation</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">simulation</span><span class="op">(</span>params <span class="op">=</span> <span class="va">params</span>, sim_function <span class="op">=</span> <span class="va">run_trial</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, format_results <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  sim_id rho_x n     sigma_x beta_0 beta_1 beta_2 sigma statistic    value
  &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt; &lt;chr&gt;        &lt;dbl&gt;
1 1      0     50    3       2      2      2      5     beta0_hat    3.24 
2 1      0     50    3       2      2      2      5     beta1_hat    2.63 
3 1      0     50    3       2      2      2      5     beta2_hat    2.24 
4 1      0     50    3       2      2      2      5     se_beta1_hat 0.434
5 1      0     50    3       2      2      2      5     se_beta2_hat 0.423
6 1      0     50    3       2      2      2      5     beta1_t      6.05 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view results</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span><span class="va">results</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta0_hat"</span>, <span class="st">"beta1_hat"</span>, <span class="st">"beta2_hat"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-multiple-regression-2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>All point estimates are unbiased.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view results</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span><span class="va">results</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"se_beta1_hat"</span>, <span class="st">"se_beta2_hat"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-multiple-regression-2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Lots more variable in standard errors of estimated coefficients for highly correlated predictors.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view results</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span><span class="va">results</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta1_t"</span>, <span class="st">"beta2_t"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-multiple-regression-2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Much less likely to reject marginal tests when there is multicollinearity.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view results</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span><span class="va">results</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MSE"</span>, <span class="st">"R2"</span>, <span class="st">"R2_adj"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-multiple-regression-2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Multicollinearity doesn’t affect <span class="math inline">\(MSE\)</span>.</p></li>
<li><p>Multicollinearity does cause an inflation of <span class="math inline">\(R^2\)</span> and <span class="math inline">\(R^2_{adj}\)</span>.</p></li>
</ul>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./notes-multiple-regression-1.html" class="pagination-link  aria-label=" regression="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple regression 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multiple regression 2</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-prereqs</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr options</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define LaTeX macros (/shortcuts) --&gt;</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define vector (without parentheses, so when writing out in like a definition) of the form X_1, ..., X_n, where X and n are variable. </span><span class="al">NOTE</span><span class="co">: to call use $\vecn{X}{n}$ --&gt;</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>\newcommand{\vecn}<span class="co">[</span><span class="ot">2</span><span class="co">]</span>{#1_1, \ldots, #1_{#2}}</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --&gt;</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>\newcommand{\follow}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\sim \text{#1}\,}</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % (followsp is short for 'follow special') shortcut that can be used for iid or ind ~ 'Named dist ' in normal font with space before parameters would go --&gt;</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>\newcommand{\followsp}<span class="co">[</span><span class="ot">2</span><span class="co">]</span>{\overset{#1}\sim \text{#2}\,}</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define independence symbol (it basically makes two orthogonal symbols very close to each other. The number of \! controls the space between each of the orthogonal symbols) --&gt;</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>\newcommand{\ind}{\perp <span class="sc">\!\!\!</span> \perp}</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for Cov(X,Y) with formatting for Cov --&gt;</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>\newcommand{\cov}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\mathrm{Cov}(#1)}</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for Corr(X,Y) with formatting for Corr --&gt;</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>\newcommand{\corr}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\mathrm{Corr}(#1)}</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for non-italic e in math mode --&gt;</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>\newcommand{\e}{\mathrm{e}}</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for matrix notation --&gt;</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>\newcommand{\mat}<span class="co">[</span><span class="ot">3</span><span class="co">]</span>{\underset{#2 \times #3}{\boldsymbol{#1}}}</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extra sums of squares</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview</span></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>Basic idea</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An extra sum of squares measures the marginal reduction in the error sum of squares when one or several predictor variables are added to the regression model, given that other predictor variables are already in the model.</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So it is the difference in $SSE$ with the original variables in the model compared to when additional ones are added (remember $SSE$ always decreases when more variables are added to the model).</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Equivalently, one can view an extra sum of squares as measuring the marginal increase in the regression sum of squares when one or several predictor variables are added to the regression model (likewise, $SSR$ always increases with additional terms).</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Definitions</span></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>Using both perspectives, we can define</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>$$SSR(X_2 \mid X_1) \hspace{10pt} = \hspace{10pt} SSE(X_1) - SSE(X_1, X_2)  \hspace{10pt} = \hspace{10pt} SSR(X_1, X_2) - SSR(X_1)$$</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>Extensions for three or more variables are straightforward. </span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>$$SSR(X_3 \mid X_1, X_2) \hspace{10pt} = \hspace{10pt} SSE(X_1, X_2) - SSE(X_1, X_2, X_3)  \hspace{10pt} = \hspace{10pt} SSR(X_1, X_2, X_3) - SSR(X_1, X_2)$$</span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>Note that we can also switch the order, say if $X_2$ enters the model first, then $X_1$.</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Decomposition of $SSR$ into extra sums of squares</span></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>In multiple regression, unlike simple linear regression, we can obtain a variety of decompositions of the regression sum of squares $SSR$ into extra sums of squares.</span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/ssr-decomposition-formulas.png)</span>{width="80%"}</span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/ssr-decomposition-visualized.png)</span>{width="80%"}</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/ssr-many-decompositions.png)</span>{width="80%"}</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>It is obvious that the number of possible decompositions becomes vast as the number of $X$ variables in the regression model increases.</span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### ANOVA table containing decomposition of $SSR$</span></span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>ANOVA tables can be constructed containing decompositions of the regression sum of squares into extra sums of squares.</span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/ssr-decomposition-anova-table.png)</span>{width="80%"}</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>Note that each extra sum of squares involving a single extra $X$ variable has associated with it one degree of freedom. The resulting mean squares are constructed as usual.</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>$$MSR(X_2 \mid X_1) = \frac{SSR(X_2 \mid X_1)}{1}$$</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a>Extra sums of squares involving two extra $X$ variables, such as $SSR(X_2, X_3 \mid X_1)$, have two degrees of freedom associated with them. This follows because we can express such an extra sum of squares as a sum of two extra sums of squares, each associated with one df. For example, by definition of the extra sums of squares, we have</span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>$$SSR(X_2, X_3 \mid X_1) = SSR(X_2 \mid X_1) + SSR(X_3 \mid X_1, X_2)$$</span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a>The mean square is therefore obtained as follows:</span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a>$$MSR(X_2, X_3 \mid X_1) = \frac{SSR(X_2, X_3 \mid X_1)}{2}$$</span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>Many computer regression packages provide decompositions of $SSR$ into single-degree-of-freedom extra sums of squares, usually in the order in which the $X$ variables are entered into the model. Thus, if the $X$ variables are entered in the order $X_1$, $X_2$, $X_3$, the extra Sums of squares given in the output are:</span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a>&amp;SSR(X_1)<span class="sc">\\</span></span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a>&amp;SSR(X_2 \mid X_1)<span class="sc">\\</span></span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a>&amp;SSR(X_3 \mid X_1, X_2)<span class="sc">\\</span></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a>If an extra sum of squares involving several extra $X$ variables is desired, it can be obtained by summing appropriate single-degree-of-freedom extra sums of squares.</span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a>The reason why extra sums of squares are of interest is that they occur in a variety of tests about regression coefficients where the question of concern is whether certain $X$ variables can be dropped from the regression model.</span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: generating a single dataset to use for many of the following examples</span></span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="co"># generate predictor data</span></span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; num_x number of base predictors (assumed known; generated from same dist)</span></span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; num_noise unimportant predictors (placed at end)</span></span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a>num_x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a>num_noise <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>(num_x<span class="sc">+</span>num_noise), <span class="cf">function</span>(i) {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), .)</span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">2</span>, num_x), <span class="fu">rep</span>(<span class="dv">0</span>, num_noise))</span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a><span class="co"># generate mean response and add random error</span></span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> betas <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a>Verify the $SS$ given in <span class="in">`anova()`</span> are conditional.</span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data</span></span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, X[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a>  data.frame</span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Y"</span>, <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">sum</span>(num_x, num_noise)))</span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-152"><a href="#cb51-152" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models</span></span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1, data_sample)</span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a>mod_12 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a>mod_123 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 <span class="sc">+</span> X3, data_sample)</span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a><span class="co"># get anova table</span></span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_123) <span class="sc">%&gt;%</span> tidy</span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a><span class="co"># verify conditional sum of squares</span></span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; just X1 in the model</span></span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_123 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq),</span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a>        mod_1 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq))</span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a><span class="co"># X2 in the model after X1 already in model</span></span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_123 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq),</span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq))</span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use of extra sums of squares in tests for regression coefficients</span></span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/test-betak-ss.png)</span>{width="80%"}</span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The $F^*$ test statistic here to test whether or not $\beta_k = 0$ is called a *partial F test statistic *to distinguish it from the *overall* $F^*$ *statistic* that @sec-f-test-overall for testing whether *all* $\beta_k = 0$.</span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/test-several-betak-ss.png)</span>{width="80%"}</span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a>Note</span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-182"><a href="#cb51-182" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For testing whether a single $\beta_k$ equals zero, two equivalent test statistics are available: the $t^*$ test statistic and the $F^*$ general linear test statistic.</span>
<span id="cb51-183"><a href="#cb51-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When testing whether several $\beta_k$ equal zero, only the general linear test statistic $F^*$ is available.</span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verify $(t^*)^2 = F^*$</span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-193"><a href="#cb51-193" aria-hidden="true" tabindex="-1"></a><span class="co"># verify t-stat^2 = F-stat for SAME order of model</span></span>
<span id="cb51-194"><a href="#cb51-194" aria-hidden="true" tabindex="-1"></a>t_stat <span class="ot">&lt;-</span> mod_12 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic) <span class="co"># middle step cause compare() being weird</span></span>
<span id="cb51-195"><a href="#cb51-195" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(t_stat <span class="sc">%&gt;%</span> <span class="fu">raise_to_power</span>(<span class="dv">2</span>),</span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic))</span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-198"><a href="#cb51-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-199"><a href="#cb51-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of tests concerning regression coefficients</span></span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/summary-tests-reg-coefs.png)</span>{width="80%"}</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a>Verify order doesn't matter for estimates / t-tests, but order (in the sense of what is already included in the model does matter).</span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a><span class="co"># verify order doesn't matter for t-tests</span></span>
<span id="cb51-210"><a href="#cb51-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-211"><a href="#cb51-211" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model in different order</span></span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a>mod_21 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X2 <span class="sc">+</span> X1, data_sample)</span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a><span class="co"># same estimate and t-test statistic</span></span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_12 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(term), mod_21 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(term))</span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a><span class="co"># just different decomposition of SS</span></span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_12 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(term),</span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a>        mod_21 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(term))</span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-221"><a href="#cb51-221" aria-hidden="true" tabindex="-1"></a><span class="co"># verify what is included previpously in model matters for F tests</span></span>
<span id="cb51-222"><a href="#cb51-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; same order model is necessary because F-test is different for X2 | X1 (second) vs X2 (first) --&gt; should be different</span></span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_12 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic),</span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a>        mod_21 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic))</span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-227"><a href="#cb51-227" aria-hidden="true" tabindex="-1"></a><span class="co"># but X3 | X1, X2 should be same as X3 | X2, X1</span></span>
<span id="cb51-228"><a href="#cb51-228" aria-hidden="true" tabindex="-1"></a>mod_213 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X2 <span class="sc">+</span> X1 <span class="sc">+</span> X3, data_sample)</span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_123 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X3"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic),</span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a>        mod_213 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X3"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic))</span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coefficient of partial determination</span></span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a>The coefficient of multiple determination, $R^2$, measures the proportionate reduction in the variation of $Y$ achieved by the introduction of the entire set of $X$ variables considered in the model.</span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-239"><a href="#cb51-239" aria-hidden="true" tabindex="-1"></a>A coefficient of partial determination, in contrast, measures the marginal contribution of one $X$ variable when all others are already included in the model.</span>
<span id="cb51-240"><a href="#cb51-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/coef-partial-det.png)</span>{width="80%"}</span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a>Demo </span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with just X1</span></span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1, data_sample)</span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a><span class="co"># use model with X1 and X2 (already fit from above)</span></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate R^2_{Y2|1} = SSR(X2|X1) / SSE(X1)</span></span>
<span id="cb51-254"><a href="#cb51-254" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; reduction in SSE when X2 is added to the model relative to when only X1 in the model (just numerator in regression sum of squares perspective)</span></span>
<span id="cb51-255"><a href="#cb51-255" aria-hidden="true" tabindex="-1"></a>SSR_X2_given_X1 <span class="ot">&lt;-</span> <span class="fu">anova</span>(mod_12) <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq) </span>
<span id="cb51-256"><a href="#cb51-256" aria-hidden="true" tabindex="-1"></a>SSE_X1 <span class="ot">&lt;-</span> <span class="fu">anova</span>(mod_1) <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"Residuals"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq) </span>
<span id="cb51-257"><a href="#cb51-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a><span class="co"># another way to calculate (from the comments)</span></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; adjust X2 and Y for the linear relationship to X1 to just get the added affect of X2</span></span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a><span class="co"># use mod_1</span></span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a><span class="co"># regress X2 on X1</span></span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a>mod_X2X1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(X2 <span class="sc">~</span> X1, data_sample)</span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a><span class="co"># regress residuals on each other</span></span>
<span id="cb51-267"><a href="#cb51-267" aria-hidden="true" tabindex="-1"></a>mod_resids <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">resid</span>(mod_1) <span class="sc">~</span> <span class="fu">resid</span>(mod_X2X1))</span>
<span id="cb51-268"><a href="#cb51-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a><span class="co"># extract R^2</span></span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(SSR_X2_given_X1 <span class="sc">/</span> SSE_X1, mod_resids <span class="sc">%&gt;%</span> glance <span class="sc">%&gt;%</span> <span class="fu">pull</span>(r.squared))</span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a><span class="co"># show added variable plot -&gt; strong linear relationship is evident after adjusting for X1</span></span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">resid</span>(mod_1), <span class="at">y =</span> <span class="fu">resid</span>(mod_X2X1))</span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-276"><a href="#cb51-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-277"><a href="#cb51-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## Standardized regression model {#sec-standardized-reg-model}</span></span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a>NOTE: Writing notes here just to be aware of it, but not going to demo it cause doesn't seem to be standard practice in R.</span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview </span></span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a>A standardized form of the general multiple regression model @ge-lin-mod is employed to control roundoff errors in normal equations calculations and to permit comparisons ofthe estimated regression coefficients in common units.</span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-285"><a href="#cb51-285" aria-hidden="true" tabindex="-1"></a>Roundoff errors</span>
<span id="cb51-286"><a href="#cb51-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Roundoff errors tend to enter normal equations calculations primarily when the inverse of $\boldsymbol{X'X}$is taken. These are magnified when calculating $\boldsymbol{\beta}$ and other statistics.</span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-289"><a href="#cb51-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The danger of serious roundoff errors in $\boldsymbol{(X'X)}^{-1}$ is particularly great when (1) $\boldsymbol{X'X}$ has a determinant that is close to zero and/or (2) the elements of $\boldsymbol{X'X}$ differ substantially in order of magnitude (say 10 and 10^6.</span>
<span id="cb51-290"><a href="#cb51-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-291"><a href="#cb51-291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The transformation to obtain the standardized regression model, called the *correlation transformation*, makes all entries in the $\boldsymbol{X'X}$ matrix for the transformed variablesf all between -1 and 1 inclusive, so that the calculation of the inverse matrix becomes much less subject to roundoff errors due to dissimilar orders of magnitudes than with the original variables.</span>
<span id="cb51-292"><a href="#cb51-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Although, in order to avoid the computational difficulties inherent in inverting the $\boldsymbol{X'X}$ matrix, many statistical packages use an entirely different computational approach that involves decomposing the $\boldsymbol{X}$ matrix into a product of several matrices with special properties.</span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a>&lt;mark&gt;**Programming note → Beautiful sites ([(1)](https://genomicsclass.github.io/book/pages/qr_and_regression.html) and [(2)](https://machinelearningmastery.com/solve-linear-regression-using-linear-algebra/#:~:text=The%20QR%20decomposition%20is%20an,down%20into%20its%20constituent%20elements.&amp;text=Where%20A%20is%20the%20matrix,the%20linear%20least%20squares%20equation.)) explaining QR decomposition and how it relates to LSE; must go through and recreate at some point.**&lt;/mark&gt;</span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>Lack of comparability of regression coefficients</span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-299"><a href="#cb51-299" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A second difficulty with the nonstandardized multiple model is that ordinarily regression coefficients cannot be compared because of differences in the units involved. For example if $X_1$ is in dollars and $X_2$ is in thousands of dollars, simply comparing the relative magnitudes of $\hat{\beta_1}$ and $\hat{\beta}_2$ to get an idea of importance can be misleading.</span>
<span id="cb51-300"><a href="#cb51-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a>Correlation transformation</span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/correlation-transformation.png)</span>{width="80%"}</span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use of the standardized variables above (the typical standardization process) without the correlation transformation modification above will lead to the same standardized regression coefficients resulting from the correlation-transformed variables. However, the elements of the $\boldsymbol{X'X}$ matrix will not then be bounded between -1 and 1.</span>
<span id="cb51-306"><a href="#cb51-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-307"><a href="#cb51-307" aria-hidden="true" tabindex="-1"></a>Standardized regression model</span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-309"><a href="#cb51-309" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/standardized-reg-mod.png)</span>{width="50%"}</span>
<span id="cb51-310"><a href="#cb51-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some more results about what the $\boldsymbol{\beta}$ is and some intermediate calculations.</span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multicollinearity and its effects</span></span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-315"><a href="#cb51-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup</span></span>
<span id="cb51-316"><a href="#cb51-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a>In multiple regression analysis, the nature and significance of the relations between the predictor or explanatory variables and the response variable are often of particular interest Some questions frequently asked are:</span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>What is the relative importance of the effects of the different predictor variables?</span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>What is the magnitude of the effect of a given predictor variable on the response variable?</span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Can any predictor variable be dropped from the model because it has little or no effect on the response variable?</span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Should any predictor variables not yet included in the model be considered for possible inclusion?</span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-327"><a href="#cb51-327" aria-hidden="true" tabindex="-1"></a>If the predictor variables included in the model are (l) uncorrelated among themselves and (2) uncorrelated with any other predictor variables that are related to the response variable but are omitted from the model, relatively simple answers can be given to these questions. Unfortunately in non-experimental studies this is often not the case.</span>
<span id="cb51-328"><a href="#cb51-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a>When the predictor variables are correlated among themselves, *multicollinearity* among them is said to exist. This creates a variety of problems, but we will first explore the uncorrelated case first.</span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Uncorrelated predictor variables</span></span>
<span id="cb51-332"><a href="#cb51-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-333"><a href="#cb51-333" aria-hidden="true" tabindex="-1"></a>Suppose we have two predictor variables, $X_1$ and $X_2$, which are uncorrelated.</span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a>Observation and results</span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Observation: Estimated coefficient $\hat{\beta}_1$ will be the same REGARDLESS of whether $X_2$ is included in the model (in any order). Same for $\hat{\beta}_2$ and $X_1$.</span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*Generalized result: When the predictor variables are uncorrelated, the effects ascribed to them by a first-order regression model are the same no matter which other of these predictor variables are included in the model.*</span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This is a strong argument for controlled experiments whenever possible, since experimental control permits choosing the levels of the predictor variables so as to make these variables uncorrelated.</span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Observation: The extra sum of squares $SSR(X_2 \mid X_1)$ equals the regression sum of squares $SSR(X_2)$ when only $X_2$ is in the regression model. Same for $X_1$.</span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*Generalized result: When two or more predictor variables are uncorrelated, the marginal contribution of one predictor variable in reducing the error sum of squares when the other predictor variables are in the model is exactly the same as when this predictor variable is in the model alone.*</span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Note that this can be seen in the formulas for the $\hat{\beta}_i$s.</span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb51-349"><a href="#cb51-349" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb51-350"><a href="#cb51-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Perfectly uncorrelated</span></span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a><span class="co"># perfectly uncorrelated</span></span>
<span id="cb51-359"><a href="#cb51-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-360"><a href="#cb51-360" aria-hidden="true" tabindex="-1"></a><span class="co"># not sure how to generate or transform to perfectly uncorrelated predictor variables</span></span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a><span class="co"># so using this found dataset (https://online.stat.psu.edu/stat501/lesson/12/12.2)</span></span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>X1,  <span class="sc">~</span>X2, <span class="sc">~</span>Y,</span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,   <span class="dv">1</span>,  <span class="dv">91</span>,</span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,   <span class="dv">2</span>,  <span class="dv">107</span>,</span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,   <span class="dv">3</span>,  <span class="dv">101</span>,</span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,   <span class="dv">4</span>,  <span class="dv">121</span>,</span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,   <span class="dv">5</span>,  <span class="dv">95</span>,</span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,    <span class="dv">7</span>,  <span class="dv">84</span>,</span>
<span id="cb51-371"><a href="#cb51-371" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,    <span class="dv">8</span>,  <span class="dv">108</span>,</span>
<span id="cb51-372"><a href="#cb51-372" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,    <span class="dv">9</span>,  <span class="dv">102</span>,</span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,    <span class="dv">10</span>, <span class="dv">98</span>,</span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,    <span class="dv">1</span>,  <span class="dv">73</span>,</span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,    <span class="dv">2</span>,  <span class="dv">75</span>,</span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,    <span class="dv">3</span>,  <span class="dv">102</span>,</span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,    <span class="dv">4</span>,  <span class="dv">94</span>,</span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,    <span class="dv">5</span>,  <span class="dv">113</span></span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a>data_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"X"</span>)) <span class="sc">%&gt;%</span> cor</span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models and compare coefficients</span></span>
<span id="cb51-388"><a href="#cb51-388" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1, data_sample)</span>
<span id="cb51-389"><a href="#cb51-389" aria-hidden="true" tabindex="-1"></a>mod_12 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a>mod_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X2, data_sample)</span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_1 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate),</span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate))</span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_2 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate),</span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate))</span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a><span class="co"># compare extra sum of squares when variable included previously</span></span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_2 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq),</span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> anova <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sumsq))</span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-403"><a href="#cb51-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-404"><a href="#cb51-404" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Practically uncorrelated</span></span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a><span class="co"># practically uncorrelated</span></span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a><span class="co"># try to generate uncorrelated predictor variables</span></span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> mu, <span class="at">Sigma =</span> sigma)</span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(X)</span>
<span id="cb51-417"><a href="#cb51-417" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%&lt;&gt;%</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), .)</span>
<span id="cb51-418"><a href="#cb51-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a><span class="co"># generate mean response and add random error</span></span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> betas <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb51-424"><a href="#cb51-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-425"><a href="#cb51-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data</span></span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, X[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a>  data.frame</span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Y"</span>, <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(betas)<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb51-434"><a href="#cb51-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-435"><a href="#cb51-435" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models and compare coefficients</span></span>
<span id="cb51-436"><a href="#cb51-436" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1, data_sample)</span>
<span id="cb51-437"><a href="#cb51-437" aria-hidden="true" tabindex="-1"></a>mod_12 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(mod_1 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate),</span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a>        mod_12 <span class="sc">%&gt;%</span> tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate))</span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-445"><a href="#cb51-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-446"><a href="#cb51-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Perfectly correlated predictors</span></span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a>Results of trivial example from book: </span>
<span id="cb51-449"><a href="#cb51-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-450"><a href="#cb51-450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For a model with two predictors, there is an infinite set of response functions (surfaces) that generate the same set of fitted values where they intersect, but totally different ones when not. </span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-452"><a href="#cb51-452" aria-hidden="true" tabindex="-1"></a>Two implications of above example:</span>
<span id="cb51-453"><a href="#cb51-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The perfect relation between $X_1$ and $X_2$ did not inhibit our ability to obtain a good fit to the data.</span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Since many different response functions provide the same good fit, we cannot interpret anyone set of regression coefficients as reflecting the effects of the different predictor variables 9in terms of magnitude and direction).</span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-460"><a href="#cb51-460" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb51-461"><a href="#cb51-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-462"><a href="#cb51-462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Perfectly correlated</span></span>
<span id="cb51-463"><a href="#cb51-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a single vector and transform</span></span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> .)</span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">X2 =</span> <span class="dv">3</span><span class="sc">*</span>X1)</span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(X)</span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%&lt;&gt;%</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), .)</span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a><span class="co"># generate mean response and add random error</span></span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X) <span class="sc">%*%</span> betas <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb51-479"><a href="#cb51-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-480"><a href="#cb51-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-481"><a href="#cb51-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data</span></span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, X[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a>  data.frame</span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Y"</span>, <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(betas)<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with both variables</span></span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a>mod_12 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_12)</span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-495"><a href="#cb51-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-496"><a href="#cb51-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a>Second coefficient doesn't even get estimated.</span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Practically super correlated</span></span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a single vector and transform + slight noise</span></span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> .)</span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">X2 =</span> <span class="dv">3</span><span class="sc">*</span>X1)</span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a>X<span class="sc">$</span>X2 <span class="ot">&lt;-</span> X<span class="sc">$</span>X2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.01</span>)</span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(X)</span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%&lt;&gt;%</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), .)</span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a><span class="co"># set betas according to which ones are noise (and intercept)</span></span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb51-514"><a href="#cb51-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-515"><a href="#cb51-515" aria-hidden="true" tabindex="-1"></a><span class="co"># generate mean response and add random error</span></span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X) <span class="sc">%*%</span> betas <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-523"><a href="#cb51-523" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data</span></span>
<span id="cb51-524"><a href="#cb51-524" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, X[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a>  data.frame</span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Y"</span>, <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(betas)<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb51-527"><a href="#cb51-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-528"><a href="#cb51-528" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with both variables</span></span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a>mod_12 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-530"><a href="#cb51-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-531"><a href="#cb51-531" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_12)</span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-535"><a href="#cb51-535" aria-hidden="true" tabindex="-1"></a>Super inflated standard errors and wildly different estimates than the $\beta$s.</span>
<span id="cb51-536"><a href="#cb51-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effects of multicollinearity</span></span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a>Summary of related effects of multicollinearity</span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Multicollinearity doesn't affect prediction.</span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The fact that some or all predictor variables are correlated among themselves does not, in general, inhibit our ability to obtain a good fit nor does it tend to affect inferences about mean responses or predictions of new observations, provided these inferences are made within the region of observations.</span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$MSE$ still gets steadily reduced as more variables are added.</span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/mse-highly-correlated.png)</span>{width="50%"}</span>
<span id="cb51-550"><a href="#cb51-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-551"><a href="#cb51-551" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>And the precision of fitted values within the range of the observations on the predictor variables does not worsen with the addition of correlated predictor variables into the regression model (even despite the inflated standard errors of the $\beta$s).</span>
<span id="cb51-552"><a href="#cb51-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The essential reason for the stability is that the covariance between $\hat{\beta}_1$ and $\hat{\beta}_2$ is negative, which plays a strong counteracting influence to the increase in $s^2(\hat{\beta}_1)$, in determining the value of $s^2(\hat{Y}_h)$ as given below:</span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/algebra-variance-estimated-mean.png)</span>{width="50%"}</span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Large standard errors in estimated regression coefficients.</span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Estimated regression coefficients tend to have large sampling variability when the predictor variables are highly correlated $\Longrightarrow$ tend to vary widely from one sample to the next $\Longrightarrow$ only imprecise information may be available about the individual true regression coefficients.</span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/st-errors-correlated-preds.png)</span>{width="50%"}</span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Indeed, many of the estimated regression coefficients *individually* may be statistically not significant even though a definite statistical relation exists between the response variable and *the set of predictor variables*.</span>
<span id="cb51-564"><a href="#cb51-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-565"><a href="#cb51-565" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Cannot interpret estimated regression coefficients.</span>
<span id="cb51-566"><a href="#cb51-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-567"><a href="#cb51-567" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The common interpretation of a regression coefficient as measuring the change in the expected value of the response variable when the given predictor variable is increased by one unit while all other predictor variables are held constant (aka the marginal effect) is not fully applicable when multicollinearity exists.</span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-569"><a href="#cb51-569" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It may be conceptually feasible to think of varying one predictor variable and the others constant, but it may not be possible in practice to do so for predictor variables that are highly correlated. For example, in a regression model for predicting crop yield from amount of rainfall and hours of sunshine, the relation between the two predictor variables makes it unrealistic to consider varying one while holding the other constant.</span>
<span id="cb51-570"><a href="#cb51-570" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Magnitude (and sign) of estimated coefficients are conditional based on what is already in model.</span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When predictor variables are correlated, the regression coefficient of anyone variable depends on which other predictor variables are included in the model and which ones are left out.</span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-575"><a href="#cb51-575" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/correlated-predictors-coefs.png)</span>{width="50%"}</span>
<span id="cb51-576"><a href="#cb51-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus, a regression coefficient does not reflect any inherent effect of the particular predictor variable on the response variable but only a marginal or partial effect, *given* whatever other correlated predictor variables are included in the model.</span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-580"><a href="#cb51-580" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Even have to be weary of predictors that are highly correlated with each other, even if some are omitted from the model.</span>
<span id="cb51-581"><a href="#cb51-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-582"><a href="#cb51-582" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Effects of variables are conditional based on what is already in model.</span>
<span id="cb51-583"><a href="#cb51-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-584"><a href="#cb51-584" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When predictor variables are correlated, the marginal contribution of anyone predictor variable in reducing the error sum of squares varies, depending on which other variables are already in the regression model, just as for regression coefficients.</span>
<span id="cb51-585"><a href="#cb51-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-586"><a href="#cb51-586" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For example, supppose $X_1$ and $X_2$ are highly correlated and $SSR(X_1) &gt;&gt; SSR(X_1 \mid X_2)$. The reason why $SSR(X_1 \mid X_2)$ is so small compared with $SSR(X1)$ is that $X_1$ and $X_2$ are highly correlated with each other and with the response variable. Thus, when $X_2$ is already in the regression model, the marginal contribution of $X_1$ in reducing the error sum of squares is comparatively small because $X_2$ contains much of the same information as $X_1$.</span>
<span id="cb51-587"><a href="#cb51-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-588"><a href="#cb51-588" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This can also be seen in the coefficient of partial determinations, which also behave erratically sample-to-sample when multiollinearity is present.</span>
<span id="cb51-589"><a href="#cb51-589" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-590"><a href="#cb51-590" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/coefs-partial-det-correlated.png)</span>{width="50%"}</span>
<span id="cb51-591"><a href="#cb51-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-592"><a href="#cb51-592" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When predictor variables are correlated, there is no unique sum of squares that can be ascribed to anyone predictor variable as reflecting its effect in reducing the total variation in $Y$. </span>
<span id="cb51-593"><a href="#cb51-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-594"><a href="#cb51-594" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Mismatching results from simulataneuous inferences vs overall inference on coefficients.</span>
<span id="cb51-595"><a href="#cb51-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-596"><a href="#cb51-596" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/effects-on-simulataneous-inference.png)</span>{width="80%"}</span>
<span id="cb51-597"><a href="#cb51-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-598"><a href="#cb51-598" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Unstable model fitting.</span>
<span id="cb51-599"><a href="#cb51-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-600"><a href="#cb51-600" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As mentioned in {#sec-standardized-reg-model}, a near-zero determinant of $\boldsymbol{X'X}$ is a potential source of serious roundoff errors in normal equations calculations. Severe has the of making this determimant come close to zero. </span>
<span id="cb51-601"><a href="#cb51-601" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus, under severe multicollineanty, the regression coefficients may be subject to large roundoff errors as well as large sampling variances $\Longrightarrow$ Should use correlation transformation or something akin.</span>
<span id="cb51-602"><a href="#cb51-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-603"><a href="#cb51-603" aria-hidden="true" tabindex="-1"></a><span class="fu">### Need for more powerful diagnostics for multicollinearity</span></span>
<span id="cb51-604"><a href="#cb51-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-605"><a href="#cb51-605" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As we have seen, multicollinearity among the predictor variables can have important consequences for interpreting and using a fitted regression model.</span>
<span id="cb51-606"><a href="#cb51-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-607"><a href="#cb51-607" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The diagnostic tool considered here for identifying multicollinearity was the pairwise coefficients of simple correlation between the predictor variables; this is frequently helpful.</span>
<span id="cb51-608"><a href="#cb51-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-609"><a href="#cb51-609" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Often, however, serious multicollinearity exists without being disclosed by the pairwise correlation coefficients. Later, we present a more powerful tool for identifying the existence of serious multicollinearity. Some remedial measures for lessening the effects of multicollinearity will be considered as well.</span>
<span id="cb51-610"><a href="#cb51-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-611"><a href="#cb51-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation</span></span>
<span id="cb51-612"><a href="#cb51-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-613"><a href="#cb51-613" aria-hidden="true" tabindex="-1"></a>Simualtion to demo the affects of varying levels of multicollinearity.</span>
<span id="cb51-614"><a href="#cb51-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-617"><a href="#cb51-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-618"><a href="#cb51-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb51-619"><a href="#cb51-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-620"><a href="#cb51-620" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize simulation settings</span></span>
<span id="cb51-621"><a href="#cb51-621" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; first the parameters of interest (that are variable)</span></span>
<span id="cb51-622"><a href="#cb51-622" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; create all combos</span></span>
<span id="cb51-623"><a href="#cb51-623" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add in the constant settings</span></span>
<span id="cb51-624"><a href="#cb51-624" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; arrange in a good order</span></span>
<span id="cb51-625"><a href="#cb51-625" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add simulation id column</span></span>
<span id="cb51-626"><a href="#cb51-626" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; set row names equal to id (helps keep track of results later)</span></span>
<span id="cb51-627"><a href="#cb51-627" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">rho_x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-628"><a href="#cb51-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb51-629"><a href="#cb51-629" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_x =</span> <span class="dv">3</span>,</span>
<span id="cb51-630"><a href="#cb51-630" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_0 =</span> <span class="dv">2</span>,</span>
<span id="cb51-631"><a href="#cb51-631" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_1 =</span> <span class="dv">2</span>,</span>
<span id="cb51-632"><a href="#cb51-632" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_2 =</span> <span class="dv">2</span>,</span>
<span id="cb51-633"><a href="#cb51-633" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-634"><a href="#cb51-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rho_x) <span class="sc">%&gt;%</span> </span>
<span id="cb51-635"><a href="#cb51-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(<span class="at">sim_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)))</span>
<span id="cb51-636"><a href="#cb51-636" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(params) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"sim"</span>, params<span class="sc">$</span>sim_id)</span>
<span id="cb51-637"><a href="#cb51-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-638"><a href="#cb51-638" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to run on each unique simulation setting</span></span>
<span id="cb51-639"><a href="#cb51-639" aria-hidden="true" tabindex="-1"></a>run_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, vec_names, <span class="at">m =</span> <span class="dv">1000</span>) {</span>
<span id="cb51-640"><a href="#cb51-640" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-641"><a href="#cb51-641" aria-hidden="true" tabindex="-1"></a>  <span class="co"># redefine arguments for easier reference</span></span>
<span id="cb51-642"><a href="#cb51-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(vec) <span class="ot">=</span> vec_names</span>
<span id="cb51-643"><a href="#cb51-643" aria-hidden="true" tabindex="-1"></a>  rho_x <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"rho_x"</span>])</span>
<span id="cb51-644"><a href="#cb51-644" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"n"</span>])</span>
<span id="cb51-645"><a href="#cb51-645" aria-hidden="true" tabindex="-1"></a>  sigma_x <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"sigma_x"</span>])</span>
<span id="cb51-646"><a href="#cb51-646" aria-hidden="true" tabindex="-1"></a>  beta_0 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_0"</span>])</span>
<span id="cb51-647"><a href="#cb51-647" aria-hidden="true" tabindex="-1"></a>  beta_1 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_1"</span>])</span>
<span id="cb51-648"><a href="#cb51-648" aria-hidden="true" tabindex="-1"></a>  beta_2 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_2"</span>])</span>
<span id="cb51-649"><a href="#cb51-649" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"sigma"</span>])</span>
<span id="cb51-650"><a href="#cb51-650" aria-hidden="true" tabindex="-1"></a>  sim_id <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"sim_id"</span>])</span>
<span id="cb51-651"><a href="#cb51-651" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-652"><a href="#cb51-652" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize results vectors</span></span>
<span id="cb51-653"><a href="#cb51-653" aria-hidden="true" tabindex="-1"></a>  beta0_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-654"><a href="#cb51-654" aria-hidden="true" tabindex="-1"></a>  beta1_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-655"><a href="#cb51-655" aria-hidden="true" tabindex="-1"></a>  beta2_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-656"><a href="#cb51-656" aria-hidden="true" tabindex="-1"></a>  se_beta1_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-657"><a href="#cb51-657" aria-hidden="true" tabindex="-1"></a>  se_beta2_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-658"><a href="#cb51-658" aria-hidden="true" tabindex="-1"></a>  beta1_t <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-659"><a href="#cb51-659" aria-hidden="true" tabindex="-1"></a>  beta2_t <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-660"><a href="#cb51-660" aria-hidden="true" tabindex="-1"></a>  MSE <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-661"><a href="#cb51-661" aria-hidden="true" tabindex="-1"></a>  R2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-662"><a href="#cb51-662" aria-hidden="true" tabindex="-1"></a>  R2_adj <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb51-663"><a href="#cb51-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-664"><a href="#cb51-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-665"><a href="#cb51-665" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop to simulate m models and extract summaries</span></span>
<span id="cb51-666"><a href="#cb51-666" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb51-667"><a href="#cb51-667" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-668"><a href="#cb51-668" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate X predictors according to specified correlation structure</span></span>
<span id="cb51-669"><a href="#cb51-669" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> sigma_x <span class="sc">*</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,rho_x,rho_x,<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb51-670"><a href="#cb51-670" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">=</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> Sigma)</span>
<span id="cb51-671"><a href="#cb51-671" aria-hidden="true" tabindex="-1"></a>    X <span class="sc">%&lt;&gt;%</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), .)</span>
<span id="cb51-672"><a href="#cb51-672" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-673"><a href="#cb51-673" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate mean response and add random error</span></span>
<span id="cb51-674"><a href="#cb51-674" aria-hidden="true" tabindex="-1"></a>    Y <span class="ot">=</span> <span class="fu">as.matrix</span>(X) <span class="sc">%*%</span> <span class="fu">c</span>(beta_0, beta_1, beta_2) <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb51-675"><a href="#cb51-675" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-676"><a href="#cb51-676" aria-hidden="true" tabindex="-1"></a>    <span class="co"># combine data</span></span>
<span id="cb51-677"><a href="#cb51-677" aria-hidden="true" tabindex="-1"></a>    data_sample <span class="ot">=</span> <span class="fu">cbind</span>(Y, X[, <span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb51-678"><a href="#cb51-678" aria-hidden="true" tabindex="-1"></a>      data.frame</span>
<span id="cb51-679"><a href="#cb51-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(data_sample) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Y"</span>, <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb51-680"><a href="#cb51-680" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-681"><a href="#cb51-681" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model with both variables</span></span>
<span id="cb51-682"><a href="#cb51-682" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">=</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, data_sample)</span>
<span id="cb51-683"><a href="#cb51-683" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-684"><a href="#cb51-684" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get summaries</span></span>
<span id="cb51-685"><a href="#cb51-685" aria-hidden="true" tabindex="-1"></a>    mod_summ <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(mod)</span>
<span id="cb51-686"><a href="#cb51-686" aria-hidden="true" tabindex="-1"></a>    mod_stats <span class="ot">=</span> broom<span class="sc">::</span><span class="fu">glance</span>(mod)</span>
<span id="cb51-687"><a href="#cb51-687" aria-hidden="true" tabindex="-1"></a>    beta0_hat[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb51-688"><a href="#cb51-688" aria-hidden="true" tabindex="-1"></a>    beta1_hat[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb51-689"><a href="#cb51-689" aria-hidden="true" tabindex="-1"></a>    beta2_hat[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb51-690"><a href="#cb51-690" aria-hidden="true" tabindex="-1"></a>    se_beta1_hat[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(std.error)</span>
<span id="cb51-691"><a href="#cb51-691" aria-hidden="true" tabindex="-1"></a>    se_beta2_hat[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(std.error)</span>
<span id="cb51-692"><a href="#cb51-692" aria-hidden="true" tabindex="-1"></a>    beta1_t[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X1"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic)</span>
<span id="cb51-693"><a href="#cb51-693" aria-hidden="true" tabindex="-1"></a>    beta2_t[i] <span class="ot">=</span> mod_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"X2"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(statistic)</span>
<span id="cb51-694"><a href="#cb51-694" aria-hidden="true" tabindex="-1"></a>    MSE[i] <span class="ot">=</span> mod_stats<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb51-695"><a href="#cb51-695" aria-hidden="true" tabindex="-1"></a>    R2[i] <span class="ot">=</span> mod_stats<span class="sc">$</span>r.squared</span>
<span id="cb51-696"><a href="#cb51-696" aria-hidden="true" tabindex="-1"></a>    R2_adj[i] <span class="ot">=</span> mod_stats<span class="sc">$</span>adj.r.squared</span>
<span id="cb51-697"><a href="#cb51-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-698"><a href="#cb51-698" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-699"><a href="#cb51-699" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-700"><a href="#cb51-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cbind</span>(beta0_hat, beta1_hat, beta2_hat, se_beta1_hat, se_beta2_hat, beta1_t, beta2_t, MSE, R2, R2_adj, <span class="at">sim_id =</span> sim_id))</span>
<span id="cb51-701"><a href="#cb51-701" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-702"><a href="#cb51-702" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-703"><a href="#cb51-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-704"><a href="#cb51-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-705"><a href="#cb51-705" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to run simulation and format results</span></span>
<span id="cb51-706"><a href="#cb51-706" aria-hidden="true" tabindex="-1"></a>simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(params, sim_function, <span class="at">iterations =</span> <span class="dv">100</span>, <span class="at">format_results =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb51-707"><a href="#cb51-707" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-708"><a href="#cb51-708" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run simulation for each parameter settings</span></span>
<span id="cb51-709"><a href="#cb51-709" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; have to transpose so that now each column is a parameter settings and convert to dataframe so can pass to map(), which needs a list</span></span>
<span id="cb51-710"><a href="#cb51-710" aria-hidden="true" tabindex="-1"></a>  results_raw <span class="ot">=</span> params <span class="sc">%&gt;%</span> </span>
<span id="cb51-711"><a href="#cb51-711" aria-hidden="true" tabindex="-1"></a>    t <span class="sc">%&gt;%</span> </span>
<span id="cb51-712"><a href="#cb51-712" aria-hidden="true" tabindex="-1"></a>    data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb51-713"><a href="#cb51-713" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(\(vec) <span class="fu">sim_function</span>(vec, <span class="at">vec_names =</span> <span class="fu">names</span>(params), <span class="at">m =</span> iterations), <span class="at">.progress =</span> T)</span>
<span id="cb51-714"><a href="#cb51-714" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-715"><a href="#cb51-715" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>format_results){</span>
<span id="cb51-716"><a href="#cb51-716" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-717"><a href="#cb51-717" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(results_raw)</span>
<span id="cb51-718"><a href="#cb51-718" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-719"><a href="#cb51-719" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb51-720"><a href="#cb51-720" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-721"><a href="#cb51-721" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reformat results</span></span>
<span id="cb51-722"><a href="#cb51-722" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; convert each results matrix to a dataframe, then combine</span></span>
<span id="cb51-723"><a href="#cb51-723" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; attach the simulation settings to the results</span></span>
<span id="cb51-724"><a href="#cb51-724" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; pivot longer to have one column for the name of the summary measure and one for its value</span></span>
<span id="cb51-725"><a href="#cb51-725" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; convert parameters to factors for plot</span></span>
<span id="cb51-726"><a href="#cb51-726" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">=</span> results_raw <span class="sc">%&gt;%</span> </span>
<span id="cb51-727"><a href="#cb51-727" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(\(x) <span class="fu">data.frame</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-728"><a href="#cb51-728" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reduce</span>(bind_rows) <span class="sc">%&gt;%</span> </span>
<span id="cb51-729"><a href="#cb51-729" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(params, <span class="at">by =</span> <span class="st">"sim_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-730"><a href="#cb51-730" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(results_raw[[<span class="dv">1</span>]])<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb51-731"><a href="#cb51-731" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">"statistic"</span>,</span>
<span id="cb51-732"><a href="#cb51-732" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-733"><a href="#cb51-733" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(params), as.factor))</span>
<span id="cb51-734"><a href="#cb51-734" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(results)</span>
<span id="cb51-735"><a href="#cb51-735" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-736"><a href="#cb51-736" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-737"><a href="#cb51-737" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-738"><a href="#cb51-738" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-739"><a href="#cb51-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-740"><a href="#cb51-740" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to plot standard results</span></span>
<span id="cb51-741"><a href="#cb51-741" aria-hidden="true" tabindex="-1"></a>plot_results <span class="ot">&lt;-</span> <span class="cf">function</span>(res, stats) {</span>
<span id="cb51-742"><a href="#cb51-742" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-743"><a href="#cb51-743" aria-hidden="true" tabindex="-1"></a>  res <span class="sc">%&gt;%</span> </span>
<span id="cb51-744"><a href="#cb51-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(statistic <span class="sc">%in%</span> stats) <span class="sc">%&gt;%</span> </span>
<span id="cb51-745"><a href="#cb51-745" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb51-746"><a href="#cb51-746" aria-hidden="true" tabindex="-1"></a>               <span class="at">group =</span> rho_x,</span>
<span id="cb51-747"><a href="#cb51-747" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> rho_x,</span>
<span id="cb51-748"><a href="#cb51-748" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> rho_x),</span>
<span id="cb51-749"><a href="#cb51-749" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb51-750"><a href="#cb51-750" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb51-751"><a href="#cb51-751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(statistic <span class="sc">~</span> .,</span>
<span id="cb51-752"><a href="#cb51-752" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">"free"</span>) </span>
<span id="cb51-753"><a href="#cb51-753" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-754"><a href="#cb51-754" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-755"><a href="#cb51-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-756"><a href="#cb51-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-757"><a href="#cb51-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-760"><a href="#cb51-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-761"><a href="#cb51-761" aria-hidden="true" tabindex="-1"></a><span class="co"># run simulation</span></span>
<span id="cb51-762"><a href="#cb51-762" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">simulation</span>(<span class="at">params =</span> params, <span class="at">sim_function =</span> run_trial, <span class="at">iterations =</span> <span class="dv">1000</span>, <span class="at">format_results =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-763"><a href="#cb51-763" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results)</span>
<span id="cb51-764"><a href="#cb51-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-765"><a href="#cb51-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-766"><a href="#cb51-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-769"><a href="#cb51-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-770"><a href="#cb51-770" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb51-771"><a href="#cb51-771" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(results, <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"beta0_hat"</span>, <span class="st">"beta1_hat"</span>, <span class="st">"beta2_hat"</span>))</span>
<span id="cb51-772"><a href="#cb51-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-773"><a href="#cb51-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-774"><a href="#cb51-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-775"><a href="#cb51-775" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All point estimates are unbiased.</span>
<span id="cb51-776"><a href="#cb51-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-779"><a href="#cb51-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-780"><a href="#cb51-780" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb51-781"><a href="#cb51-781" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(results, <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"se_beta1_hat"</span>, <span class="st">"se_beta2_hat"</span>))</span>
<span id="cb51-782"><a href="#cb51-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-783"><a href="#cb51-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-784"><a href="#cb51-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-785"><a href="#cb51-785" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lots more variable in standard errors of estimated coefficients for highly correlated predictors.</span>
<span id="cb51-786"><a href="#cb51-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-789"><a href="#cb51-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-790"><a href="#cb51-790" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb51-791"><a href="#cb51-791" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(results, <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"beta1_t"</span>, <span class="st">"beta2_t"</span>))</span>
<span id="cb51-792"><a href="#cb51-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-793"><a href="#cb51-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-794"><a href="#cb51-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-795"><a href="#cb51-795" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Much less likely to reject marginal tests when there is multicollinearity.</span>
<span id="cb51-796"><a href="#cb51-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-799"><a href="#cb51-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-800"><a href="#cb51-800" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb51-801"><a href="#cb51-801" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(results, <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"MSE"</span>, <span class="st">"R2"</span>, <span class="st">"R2_adj"</span>))</span>
<span id="cb51-802"><a href="#cb51-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-803"><a href="#cb51-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-804"><a href="#cb51-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-805"><a href="#cb51-805" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multicollinearity doesn't affect $MSE$.</span>
<span id="cb51-806"><a href="#cb51-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-807"><a href="#cb51-807" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multicollinearity does cause an inflation of $R^2$ and $R^2_{adj}$.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>