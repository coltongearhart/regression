<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.517">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Regression - 3&nbsp; Diagnostics and remedial measures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./notes-matrix-slr.html" rel="next">
<link href="./notes-inference.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part1-slr.html">Simple linear regression</a></li><li class="breadcrumb-item"><a href="./notes-diagnostics-and-remedial-measures.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diagnostics and remedial measures</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part1-slr.html">Simple linear regression</a></li><li class="breadcrumb-item"><a href="./notes-diagnostics-and-remedial-measures.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diagnostics and remedial measures</span></a></li></ol></nav><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><span id="sec-diag-remedial-measures" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diagnostics and remedial measures</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part1-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-diagnostics-and-remedial-measures.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diagnostics and remedial measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-matrix-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Matrix approach to SLR</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part2-mlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-multiple-regression-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple regression 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-multiple-regression-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple regression 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notes-reg-models-quan-and-qual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regression models for quanititative and qualitative predictors</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#diagnostics-for-predictor-variable" id="toc-diagnostics-for-predictor-variable" class="nav-link active" data-scroll-target="#diagnostics-for-predictor-variable"><span class="header-section-number">3.1</span> Diagnostics for predictor variable</a></li>
  <li>
<a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals"><span class="header-section-number">3.2</span> Residuals</a>
  <ul class="collapse">
<li><a href="#properites-of-residuals" id="toc-properites-of-residuals" class="nav-link" data-scroll-target="#properites-of-residuals"><span class="header-section-number">3.2.1</span> Properites of residuals</a></li>
  <li><a href="#semistudentized-residuals" id="toc-semistudentized-residuals" class="nav-link" data-scroll-target="#semistudentized-residuals"><span class="header-section-number">3.2.2</span> Semistudentized residuals</a></li>
  <li><a href="#departures-from-model-to-be-studied-by-residuals" id="toc-departures-from-model-to-be-studied-by-residuals" class="nav-link" data-scroll-target="#departures-from-model-to-be-studied-by-residuals"><span class="header-section-number">3.2.3</span> Departures from model to be studied by residuals</a></li>
  </ul>
</li>
  <li>
<a href="#diagnostics-for-residuals" id="toc-diagnostics-for-residuals" class="nav-link" data-scroll-target="#diagnostics-for-residuals"><span class="header-section-number">3.3</span> Diagnostics for residuals</a>
  <ul class="collapse">
<li><a href="#nonlinearity-of-regression-function" id="toc-nonlinearity-of-regression-function" class="nav-link" data-scroll-target="#nonlinearity-of-regression-function"><span class="header-section-number">3.3.1</span> Nonlinearity of regression function</a></li>
  <li><a href="#nonconstant-variance" id="toc-nonconstant-variance" class="nav-link" data-scroll-target="#nonconstant-variance"><span class="header-section-number">3.3.2</span> Nonconstant variance</a></li>
  <li><a href="#presence-of-unusual-observations" id="toc-presence-of-unusual-observations" class="nav-link" data-scroll-target="#presence-of-unusual-observations"><span class="header-section-number">3.3.3</span> Presence of unusual observations</a></li>
  <li><a href="#nonindependence-of-error-terms" id="toc-nonindependence-of-error-terms" class="nav-link" data-scroll-target="#nonindependence-of-error-terms"><span class="header-section-number">3.3.4</span> Nonindependence of error terms</a></li>
  <li><a href="#nonnormality-of-errors" id="toc-nonnormality-of-errors" class="nav-link" data-scroll-target="#nonnormality-of-errors"><span class="header-section-number">3.3.5</span> Nonnormality of errors</a></li>
  <li><a href="#omission-of-important-predictor-variables" id="toc-omission-of-important-predictor-variables" class="nav-link" data-scroll-target="#omission-of-important-predictor-variables"><span class="header-section-number">3.3.6</span> Omission of important predictor variables</a></li>
  </ul>
</li>
  <li>
<a href="#effects-of-departures" id="toc-effects-of-departures" class="nav-link" data-scroll-target="#effects-of-departures"><span class="header-section-number">3.4</span> Effects of departures</a>
  <ul class="collapse">
<li><a href="#setup-and-functions" id="toc-setup-and-functions" class="nav-link" data-scroll-target="#setup-and-functions"><span class="header-section-number">3.4.1</span> Setup and functions</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">3.4.2</span> Results</a></li>
  </ul>
</li>
  <li>
<a href="#tests" id="toc-tests" class="nav-link" data-scroll-target="#tests"><span class="header-section-number">3.5</span> Tests</a>
  <ul class="collapse">
<li><a href="#f-test-for-lack-of-fit" id="toc-f-test-for-lack-of-fit" class="nav-link" data-scroll-target="#f-test-for-lack-of-fit"><span class="header-section-number">3.5.1</span> <span class="math inline">\(F\)</span> test for lack of fit</a></li>
  </ul>
</li>
  <li><a href="#overview-of-remedial-measures" id="toc-overview-of-remedial-measures" class="nav-link" data-scroll-target="#overview-of-remedial-measures"><span class="header-section-number">3.6</span> Overview of remedial measures</a></li>
  <li>
<a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations"><span class="header-section-number">3.7</span> Transformations</a>
  <ul class="collapse">
<li><a href="#transformations-for-nonlinear-relation-only" id="toc-transformations-for-nonlinear-relation-only" class="nav-link" data-scroll-target="#transformations-for-nonlinear-relation-only"><span class="header-section-number">3.7.1</span> Transformations for nonlinear relation only</a></li>
  <li><a href="#transformations-for-nonnormality-and-unequal-error-variances" id="toc-transformations-for-nonnormality-and-unequal-error-variances" class="nav-link" data-scroll-target="#transformations-for-nonnormality-and-unequal-error-variances"><span class="header-section-number">3.7.2</span> Transformations for Nonnormality and Unequal Error Variances</a></li>
  <li><a href="#sec-box-cox" id="toc-sec-box-cox" class="nav-link" data-scroll-target="#sec-box-cox"><span class="header-section-number">3.7.3</span> Box-Cox transformations</a></li>
  </ul>
</li>
  <li>
<a href="#using-the-transformed-model" id="toc-using-the-transformed-model" class="nav-link" data-scroll-target="#using-the-transformed-model"><span class="header-section-number">3.8</span> Using the transformed model</a>
  <ul class="collapse">
<li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1"><span class="header-section-number">3.8.1</span> Overview</a></li>
  <li><a href="#interpreting-confidence-limits" id="toc-interpreting-confidence-limits" class="nav-link" data-scroll-target="#interpreting-confidence-limits"><span class="header-section-number">3.8.2</span> Interpreting confidence limits</a></li>
  </ul>
</li>
  <li><a href="#summary-of-remedial-measures" id="toc-summary-of-remedial-measures" class="nav-link" data-scroll-target="#summary-of-remedial-measures"><span class="header-section-number">3.9</span> Summary of remedial measures</a></li>
  <li>
<a href="#exploration-of-shape-regression-function" id="toc-exploration-of-shape-regression-function" class="nav-link" data-scroll-target="#exploration-of-shape-regression-function"><span class="header-section-number">3.10</span> Exploration of shape regression function</a>
  <ul class="collapse">
<li><a href="#lowess-method" id="toc-lowess-method" class="nav-link" data-scroll-target="#lowess-method"><span class="header-section-number">3.10.1</span> Lowess method</a></li>
  <li><a href="#use-of-smoothed-curves-to-confirm-the-fitted-regression-function" id="toc-use-of-smoothed-curves-to-confirm-the-fitted-regression-function" class="nav-link" data-scroll-target="#use-of-smoothed-curves-to-confirm-the-fitted-regression-function"><span class="header-section-number">3.10.2</span> Use of smoothed curves to confirm the fitted regression function</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!-- % define LaTeX macros (/shortcuts) --><!-- % define vector (without parentheses, so when writing out in like a definition) of the form X_1, ..., X_n, where X and n are variable. NOTE: to call use $\vecn{X}{n}$ --><!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --><!-- % (followsp is short for 'follow special') shortcut that can be used for iid or ind ~ 'Named dist ' in normal font with space before parameters would go --><!-- % define independence symbol (it basically makes two orthogonal symbols very close to each other. The number of \! controls the space between each of the orthogonal symbols) --><!-- % shortcut for Cov(X,Y) with formatting for Cov --><!-- % shortcut for Corr(X,Y) with formatting for Corr --><!-- % shortcut for non-italic e in math mode --><!-- % shortcut for null hypothesis formatted nicely --><!-- % shortcut for alternative hypothesis formatted nicely --><p>Two main ideas</p>
<ul>
<li>
<p>Diagnostics → Methods to check whether our model is reasonable for our data and representative of the system that we are studying.</p>
<ul>
<li>Some diagnostics check the <em>assumptions</em> of our model. Other diagnostics check the <em>influence</em> of different data points.</li>
</ul>
</li>
<li><p>Remedies → Analytic strategies used to fix problems identified by the diagnostics.</p></li>
</ul>
<p>Why do we need to check the model?</p>
<ul>
<li>
<p>The goal of building a model is to:</p>
<ul>
<li><p><em>Learn something</em> about the real world.</p></li>
<li><p><em>Predict outcomes</em> in the real world.</p></li>
</ul>
</li>
<li>
<p>To use a model successfully, we need to know its limitations:</p>
<ul>
<li><p>Does it adequately describe the functional relationship of interest?</p></li>
<li><p>Is there reason to worry that inferences about the parameters might be flawed?</p></li>
<li><p>Is the error distribution appropriate?</p></li>
</ul>
</li>
<li><p>All of these are checked via residual analysis.</p></li>
</ul>
<section id="diagnostics-for-predictor-variable" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="diagnostics-for-predictor-variable">
<span class="header-section-number">3.1</span> Diagnostics for predictor variable</h2>
<p>Overview</p>
<ul>
<li>
<p>We need diagnostic information about the predictor variable in order to:</p>
<ul>
<li><p>See if there are any outlying <span class="math inline">\(X\)</span> values that could influence the appropriateness of the fitted regression function or if the <span class="math inline">\(X\)</span> distribution is skewed, which can impact some aspects of the model behavior / performance.</p></li>
<li><p>Get info about the range and concentration of the <span class="math inline">\(X\)</span> levels in the study. This is useful for figuring out the range of validity of the regression analysis.</p></li>
<li><p>Can use simple graphical tools to help.</p></li>
</ul>
</li>
</ul>
<p>Plots</p>
<ul>
<li>
<p>Dot plot → Good when the sample size is not large.</p>
<ul>
<li>Can look at min and max; are observations spread throughout this interval? any far outlying observations? replication at different <span class="math inline">\(X\)</span> levels?.</li>
</ul>
</li>
<li>
<p>Sequence plot → Should be utilized whenever data are obtained in a sequence, such as over time or for adjacent geographic areas.</p>
<ul>
<li><p>Should look like a random walk (i.e.&nbsp;no obvious pattern).</p></li>
<li><p>For example, if one level of <span class="math inline">\(X\)</span> occurs way more frequently in the beginning and then another occurs way more at end, this info can be very helpful when looking at diagnostics later for how appropriate the model is.</p></li>
</ul>
</li>
<li>
<p>Box plots → Good when have a larger sample size.</p>
<ul>
<li>Can look at min and max, location of IQR, outliers, shape (skewness).</li>
</ul>
</li>
<li>
<p>Histograms → Good with really big sample sizes.</p>
<ul>
<li>Can look for same characteristics as boxplots, as well as modality.</li>
</ul>
</li>
</ul>
<p>Demo</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate several samples of X values</span></span>
<span><span class="va">x_1</span> <span class="op">&lt;-</span> <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/DiscreteUniform.html">rdunif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">15</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">x_2</span> <span class="op">&lt;-</span> <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/DiscreteUniform.html">rdunif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">x_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create simple plots for diagnostics of X variable</span></span>
<span><span class="co"># NOTE -&gt; just doing simple base R plots </span></span>
<span></span>
<span><span class="co"># dot plot for small samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/stripchart.html">stripchart</a></span><span class="op">(</span><span class="va">x_1</span>, method <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sequence plot for "sequential" data</span></span>
<span><span class="co"># -&gt; data is random, so will be a random walk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x_1</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># boxplot for larger samples</span></span>
<span><span class="co"># -&gt; add mark for mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">x_2</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x_2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram for really large sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x_3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-2-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="residuals" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="residuals">
<span class="header-section-number">3.2</span> Residuals</h2>
<p>Overview</p>
<ul>
<li><p>Goal of residual analysis → Assess the aptness of a statistical model.</p></li>
<li>
<p>Why use residuals</p>
<ul>
<li><p>Direct diagnostic plots for the response variable <span class="math inline">\(Y\)</span> are ordinarily not too useful in regression analysis because the response variable observations are a function of the level of predictor variable.</p></li>
<li><p>So, instead we look at diagnostics for <span class="math inline">\(Y\)</span> indirectly by examining the residuals.</p></li>
</ul>
</li>
<li>
<p>Residuals and model error</p>
<ul>
<li><p>Recall residual <span class="math inline">\(e_i = Y_i - \hat{Y_i}\)</span> is an estimate of the unobservable model error <span class="math inline">\(\epsilon = Y_i - E(Y_i)\)</span>.</p></li>
<li><p>** For our regression model, we assume <span class="math inline">\(\epsilon_i \overset{iid}\sim \text{Normal}\,\,(0, \sigma^2\)</span>). So if the model is appropriate for the data at hand, the residuals should reflect these properties.</p></li>
<li><p>This is the basic idea of a residual analysis, which is a highly useful way to check if a model is appropriate.</p></li>
</ul>
</li>
</ul>
<section id="properites-of-residuals" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="properites-of-residuals">
<span class="header-section-number">3.2.1</span> Properites of residuals</h3>
<ul>
<li>
<p>Mean</p>
<ul>
<li>
<p>The mean of the <span class="math inline">\(n\)</span> residuals for the SLR is shown below.</p>
<ul>
<li>Since this is always 0, it doesn’t give any info as to whether the true errors <span class="math inline">\(\epsilon_i\)</span> have expected value <span class="math inline">\(E(\epsilon_i) = 0\)</span>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
\bar{e} = \sum e_i = 0
\]</span></p>
<ul>
<li>
<p>Variance</p>
<ul>
<li>
<p>The variance of the <span class="math inline">\(n\)</span> residuals for the SLR is shown below.</p>
<ul>
<li>Again, if the model is appropriate <span class="math inline">\(MSE\)</span> is an unbiased estimator of the variance of the error terms <span class="math inline">\(\sigma^2\)</span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
S^2 = \frac{\sum (e_i - \bar{e})^2}{n - 2} = \frac{\sum e_i^2}{n - 2} = \frac{SSE}{n - 2} = MSE
\]</span></p>
<ul>
<li>
<p>Nonindependence</p>
<ul>
<li><p>The residuals <span class="math inline">\(e_i\)</span> are not independent random variables because they involve the fitted values <span class="math inline">\(\hat{Y_i}\)</span>, which are computed on the same <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>.</p></li>
<li><p>As a result, the residuals are subject to two constraints: <span class="math inline">\(\sum e_i = 0\)</span> and <span class="math inline">\(\sum X_i e_i = 0\)</span>.</p></li>
<li><p>However, when the sample size <span class="math inline">\(n\)</span> is much larger than the number of parameters <span class="math inline">\(p\)</span>, we can ignore the minor dependence.</p></li>
</ul>
</li>
</ul></section><section id="semistudentized-residuals" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="semistudentized-residuals">
<span class="header-section-number">3.2.2</span> Semistudentized residuals</h3>
<ul>
<li>At times, it is helpful to standardize the residuals for residual analysis. Since the standard deviation of the error terms <span class="math inline">\(\epsilon_i\)</span> is <span class="math inline">\(\sigma\)</span>, which is estimated by <span class="math inline">\(\sqrt{MSE}\)</span>, we can naturally standardize with</li>
</ul>
<p><span class="math display">\[
e_i^* = \frac{e_i - \bar{e}}{\sqrt{MSE}} = \frac{e_i}{\sqrt{MSE}}
\]</span></p>
<ul>
<li><p>Studentized → If <span class="math inline">\(\sqrt{MSE}\)</span> were an estimate of the standard deviation of the residual <span class="math inline">\(e_i\)</span>, we would call <span class="math inline">\(e_i^*\)</span> a studentized residual. But it is not…</p></li>
<li><p>Semistudentized → <span class="math inline">\(\sigma_{e_i}\)</span> is complex and varies for the different residuals <span class="math inline">\(e_i\)</span>, and <span class="math inline">\(\sqrt{MSE}\)</span> is only an approximation of the standard deviation of <span class="math inline">\(\sigma_{e_i}\)</span>. So, instead it is a semistudentized residual.</p></li>
</ul></section><section id="departures-from-model-to-be-studied-by-residuals" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="departures-from-model-to-be-studied-by-residuals">
<span class="header-section-number">3.2.3</span> Departures from model to be studied by residuals</h3>
<ul>
<li>
<p>We are going to use residuals to study the following departures from the SLR model with normal errors:</p>
<ol type="1">
<li><p>The regression function is not linear → Is the functional form of the model appropriate?</p></li>
<li><p>The error terms do not have constant variance.</p></li>
<li><p>The error terms are not independent.</p></li>
<li><p>The model fits all but one or a few outlier observations → Do any of the data points have a disproportionate influence on the parameter estimates?</p></li>
<li><p>The error terms are not normally distributed.</p></li>
<li><p>One or several important predictor variables have been omitted from the model.</p></li>
</ol>
</li>
</ul></section></section><section id="diagnostics-for-residuals" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="diagnostics-for-residuals">
<span class="header-section-number">3.3</span> Diagnostics for residuals</h2>
<p>Types of plots</p>
<ul>
<li>Here are the informal diagnostic plots of residuals we will use to see if any of the above 6 departures from the SLR model are present,</li>
</ul>
<ol type="1">
<li><p>Residuals against predictor variable.</p></li>
<li><p>Absolute or squared residuals against predictor variable.</p></li>
<li><p>Residuals against fitted values.</p></li>
<li><p>Residuals against time or other sequence.</p></li>
<li><p>Residuals against omitted predictor variables.</p></li>
<li><p>Boxplot of residuals.</p></li>
<li><p>Normal probability plot of residuals.</p></li>
</ol>
<p>Demo</p>
<ul>
<li>How to make plots and what they look like when assumptions are met.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view diagnostic plots (base R)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NOT RUN -&gt; note this works inline</span></span>
<span><span class="co"># view ggplot versions of diagnostic plots</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="files/images/autoplot-lm.png" class="img-fluid" style="width:50.0%"></p>
<p>Next section</p>
<ul>
<li><p>Now we will go through how to visually assess each assumption to see if it is met and diagnosis (identify) each violation if present.</p></li>
<li><p>At then end, we will discuss the impacts of each departure on things such as <span class="math inline">\(MSE\)</span>, slope standard errors, prediction accuracy, etc.</p></li>
</ul>
<section id="nonlinearity-of-regression-function" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="nonlinearity-of-regression-function">
<span class="header-section-number">3.3.1</span> Nonlinearity of regression function</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Overview</p>
<ul>
<li>We can look at the following plots to check if a linear regression function is appropriate:</li>
</ul>
<ol type="1">
<li>
<p><em>Residual plot against the fitted values</em> → This is the preferred plot for this assumption check.</p>
<ul>
<li><p>When a linear regression model is appropriate, the residuals then fall within a horizontal band centered around 0, displaying no systematic tendencies to be positive and negative (randomly scattered around 0).</p></li>
<li><p>When the linearity assumption is violated, there are systematic deviations.</p></li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-linearity.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="1">
<li>
<p><em>Residual plot against the predictor variable</em></p>
<ul>
<li><p>For <em>SLR only</em>, this shows the same info as the residuals vs fitted values because the <span class="math inline">\(\hat{Y_i}\)</span> are a linear function of the <span class="math inline">\(X_i\)</span>.</p></li>
<li><p>So the basic pattern of the plotted points is not affected whether the residual plot is against the <span class="math inline">\(X_i\)</span> or the <span class="math inline">\(\hat{Y_i}\)</span> (only the <span class="math inline">\(X\)</span> scale values are affected).</p></li>
<li><p>For curvilinear regression and multiple regression, separate plots of the residuals against the fitted values and against the predictor variable(s) are usually helpful.</p></li>
</ul>
</li>
<li><p><em>Scatterplot of</em> <span class="math inline">\(Y\)</span> vs <span class="math inline">\(X\)</span> → If the actual trend in the data in linear, then it makes sense to fit a straight-line model to the data.</p></li>
</ol>
<ul>
<li>But, not always as effective as the residual plots. Residual plots are preferred over scatteplot, because it has two advantages:</li>
</ul>
<p><img src="files/images/scatterplot-y-vs-x.png" class="img-fluid" style="width:50.0%"></p>
<ol type="1">
<li><p>Can also easily be used for checking other assumptions.</p></li>
<li><p>There are occasions when the scaling of the scatter plot places the <span class="math inline">\(Y_i\)</span> observations close to the fitted values <span class="math inline">\(\hat{Y_i}\)</span>, for instance, when there is a steep slope. It then becomes more difficult to study the appropriateness of a linear regression function from the scatterplot, while the residual plot can clearly show any systematic pattern in the deviations around the fitted regression line under these conditions.</p></li>
</ol>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_ideal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>R also adds a trend line, which we want to be approximately horizontal.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual vs fitted plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># verify smoothing line that plot.lm() performs (see discussion in nonconstant variance ideal section)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Residuals vs <span class="math inline">\(X\)</span> plot</p>
<ul>
<li>For SLR → Shows same pattern as above, different scale on <span class="math inline">\(X\)</span> axis.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create residuals vs X plot</span></span>
<span><span class="co"># -&gt; add smoothing line</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"residuals"</span>, main <span class="op">=</span> <span class="st">"Residuals vs X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Demo for difference when in MLR</p>
<ul>
<li>Results → Can see different pattern (even if only slightly based on values chosen) pattern in each.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize new items</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># generate new X sample</span></span>
<span><span class="va">x_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate new Y observations using same errors, but with both xs</span></span>
<span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x_2</span>  <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit new MLR model</span></span>
<span><span class="va">mod_mlr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y_2</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">x_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot residuals vs fitted, X and X2</span></span>
<span><span class="co"># -&gt; create dataset so can display all three plots</span></span>
<span><span class="co"># -&gt; also add smoothing line to make differences in patterns more noticeable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">x</span>,</span>
<span>           X2 <span class="op">=</span> <span class="va">x_2</span>,</span>
<span>           fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_mlr</span><span class="op">)</span>,</span>
<span>           residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">mod_mlr</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"X_axis"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>,</span>
<span>             y <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">X_axis</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Scatterplot</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Scatterplot of Y vs X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_ideal</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Polynomial</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Nonlinear regression model</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \beta_2 X_i^2 + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>Note that this is still a linear model (even though there is a higher order term), becuase the model in linear <em>in the parameters</em>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>;</span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>  <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span><span class="va">mod_squared_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Residuals vs fitted plot</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual vs fitted plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_squared_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Scatterplot</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Squared predictor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_squared_x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Demo to show how steep slope can hide lack of fit in scatterplot, but residual plot still picks it up.</p>
<ul>
<li>Results → For a true quadratic model, the scatterplot of <span class="math inline">\(Y\)</span> vs <span class="math inline">\(X\)</span> looks just linear (not noticeable curvature) when there is a large <span class="math inline">\(\beta_1\)</span> term (coefficient of linear term). But this is misleading, especially after seeing the residual plot which shows the missing evidence of curvature.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># SMALL slope of linear term</span></span>
<span><span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>  <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span><span class="va">mod_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span><span class="co"># -&gt; can see curvature</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Samll slope"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_squared</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residuals vs fitted plot</span></span>
<span><span class="co"># -&gt; curvature very obvious here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_squared</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># LARGE slope of linear term</span></span>
<span><span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>  <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span><span class="va">mod_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span><span class="co"># -&gt; curvature is hidden more, regression line looks okay</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Large slope"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_squared</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residuals vs fitted plot</span></span>
<span><span class="co"># -&gt; curvature still visible here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_squared</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 \, \mathrm{e}^{\beta_1 \, X_i} + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>Nonlinear because <span class="math inline">\(Y_i\)</span> cannot be expressed as a linear combination of the <span class="math inline">\(\beta_i\)</span>s.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Scattterplot of <span class="math inline">\(Y\)</span> vs <span class="math inline">\(X\)</span> and residual plot</p>
<ul>
<li>Can see obvious nonlinear pattern in scatterplot and systematic deviations in residual plot.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of y vs x with regression line</span></span>
<span><span class="co"># -&gt; obviously not a linear pattern</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Scatterplot of Y vs X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_nonlinear</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual vs fitted plot</span></span>
<span><span class="co"># -&gt; definite pattern to residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_nonlinear</span>, <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="nonconstant-variance" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="nonconstant-variance">
<span class="header-section-number">3.3.2</span> Nonconstant variance</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Overview</p>
<ul>
<li>We can look at the following plots to check if the error terms have constant variance:</li>
</ul>
<ol type="1">
<li>
<p><em>Residual plot against the fitted values</em></p>
<ul>
<li><p>Again for SLR, this shows the same info as residuals vs <span class="math inline">\(X\)</span> plot, but in MLR we want to use the fitted values.</p></li>
<li><p>When there is a constant error variance, points again should fall within a horizontal band. So there is a constant spread of the residuals as move across the scope of fitted (or <span class="math inline">\(X\)</span>) values.</p></li>
<li><p>“Tipped over tornado” effect of the points indicates a non-constant variance (i.e.&nbsp;as the fitted values increase, the residuals vary more, or vice versa). Reverse megaphone (decreasing variance with increasing levels of <span class="math inline">\(X\)</span> or <span class="math inline">\(\hat{Y}\)</span>) is possible as well or varying in some other complex fashion. A nonconstant variance in called <em>heteroscedasticity</em> (the assumption is a <em>homoscedastic</em> error variance).</p></li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-nonconstant-variance.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="1">
<li>
<p><em>Scale-location plot</em> → Refined version of above, preferred plot for this assumption.</p>
<ul>
<li><p>Plots standardized residuals against fitted values.</p></li>
<li><p>There are a few ways to transform the residuals for this type of plot, all of which get at the same purpose (options include: absolute value, square root of absolute value, squared, standardized (studentized, semistudentized), square root of standardized).</p></li>
<li><p>By doing this, it places all of the information on changing magnitudes of the residuals above the horizontal zero line, which makes it easier to see whether the magnitude of the residuals is changing with the level <span class="math inline">\(\hat{Y}\)</span> (<span class="math inline">\(\pm\)</span> is not important for this condition).</p></li>
<li><p>The scale-location plot specifically uses the standardized residuals (which have equal variance by assumption), and are given by <span class="math inline">\(e_i^* = \frac{e_i}{\sqrt{MSE (1 - h_{ii})}}\)</span>, where the leverages <span class="math inline">\(h_{ii}\)</span> are the diagonal entries of the hat matrix. It then takes the absolute value and square root <span class="math inline">\(\sqrt{\lvert e_i^* \rvert}\)</span> to diminish the skewness because under <span class="math inline">\(\text{Normal}(0, \sigma^2)\)</span>, <span class="math inline">\(\sqrt{\lvert e_i^* \rvert}\)</span> is much less skewed than <span class="math inline">\(\lvert e_i^* \rvert\)</span>.</p></li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-nonconstant-variance-scale-location.png" class="img-fluid" style="width:50.0%"></p>
<p><img src="files/images/diagnostics-scale-location-standardized-residuals.png" class="img-fluid" style="width:50.0%"></p>
<!-- not totally sure why we need residuals to not be skewed for scale-location plot though -->
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>Looking residuals to fall within horizontal bands on either side of 0.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># using ideal model from linearity assumption demo</span></span>
<span></span>
<span><span class="co"># again, same plot as to check linearity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Scale-location plot</p>
<ul>
<li>Now we want a flat trend line.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scale-location plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Demo of different ways to standardize residuals (including the scale-location plot)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scale-location plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># demo of the standardized residuals used above</span></span>
<span><span class="co"># -&gt; check help page for plot.lm() for more details on methods behind diagnostic plots</span></span>
<span></span>
<span><span class="co"># standardize the residuals</span></span>
<span><span class="co"># -&gt; manual calculation using the formula for e* or r functions</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">e_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">divide_by</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hatvalues</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">e_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view final transformation of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>e <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>, <span class="va">e_star</span>, f_e_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e_star</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">display_nice</span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Residuals e"</span>, <span class="st">"Standardized residuals e-star"</span>, <span class="st">"f(e-star ) = sqrt(abs(e-star))"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> Residuals e </th>
   <th style="text-align:right;"> Standardized residuals e-star </th>
   <th style="text-align:right;"> f(e-star ) = sqrt(abs(e-star)) </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 6.908 </td>
   <td style="text-align:right;"> 0.952 </td>
   <td style="text-align:right;"> 0.976 </td>
  </tr>
<tr>
<td style="text-align:right;"> -0.959 </td>
   <td style="text-align:right;"> 0.160 </td>
   <td style="text-align:right;"> 0.400 </td>
  </tr>
<tr>
<td style="text-align:right;"> 3.100 </td>
   <td style="text-align:right;"> 1.414 </td>
   <td style="text-align:right;"> 1.189 </td>
  </tr>
<tr>
<td style="text-align:right;"> 10.981 </td>
   <td style="text-align:right;"> -0.084 </td>
   <td style="text-align:right;"> 0.289 </td>
  </tr>
<tr>
<td style="text-align:right;"> -10.068 </td>
   <td style="text-align:right;"> 1.015 </td>
   <td style="text-align:right;"> 1.007 </td>
  </tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># overlay function of standardized residuals to scale-location plot to confirm they line up </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e_star</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># demo different residual plots AND different smoothers</span></span>
<span></span>
<span><span class="co"># create dataset of different standardized residuals so can display all</span></span>
<span><span class="co"># 0) residuals</span></span>
<span><span class="co"># 1) f(e*) from above (sqrt of abs of standardized residuals from scale-location)</span></span>
<span><span class="co"># 2) semistudentized residuals = e / sqrt(MSE)</span></span>
<span><span class="co"># 3) abs(residuals)</span></span>
<span><span class="co"># 4) sqrt(abs(residuals))</span></span>
<span><span class="co"># 5) residuals^2</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"fitted"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>,</span>
<span>                        <span class="va">e</span>,</span>
<span>                        f_e_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e_star</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        e_semi <span class="op">=</span> <span class="va">e</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span>,</span>
<span>                        e_abs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>,</span>
<span>                        e_abs_sqrt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        e_squared <span class="op">=</span> <span class="va">e</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"e"</span><span class="op">)</span>, <span class="st">"f_e_star"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"residuals"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataset for lowess smoothers of each residual type</span></span>
<span><span class="va">data_lowess</span> <span class="op">&lt;-</span> <span class="va">data_plot</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">map2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, \<span class="op">(</span><span class="va">df</span>, <span class="va">type</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">fitted</span>, y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">reduce</span><span class="op">(</span><span class="va">bind_rows</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set more informative labels for the facets</span></span>
<span><span class="va">labels_residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>e <span class="op">=</span> <span class="st">"residuals"</span>,</span>
<span>                      f_e_star <span class="op">=</span> <span class="st">"f(standardized residuals"</span>,</span>
<span>                      e_semi <span class="op">=</span> <span class="st">"residuals / sqrt(MSE)"</span>,</span>
<span>                      e_abs <span class="op">=</span> <span class="st">"abs(residuals)"</span>,</span>
<span>                      e_abs_sqrt <span class="op">=</span> <span class="st">"sqrt(abs(residuals))"</span>,</span>
<span>                      e_squared <span class="op">=</span> <span class="st">"residuals^2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then plot with different smoothing lines</span></span>
<span><span class="co"># smoothing line</span></span>
<span><span class="co"># -&gt; geom_smooth() default method is loess smoother, which is a local polynomial regression fit</span></span>
<span><span class="co"># -&gt; plot() uses lowess smoother, which uses locally-weighted polynomial regression </span></span>
<span><span class="co"># -&gt; summary -&gt; similar methods, slight difference</span></span>
<span><span class="co"># --&gt; lowess is for adding a smooth curve to a scatterplot, i.e., for univariate smoothing, while loess is for fitting a smooth surface to multivariate data</span></span>
<span><span class="va">data_plot</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted</span>,</span>
<span>           y <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span>,</span>
<span>       data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>,</span>
<span>                y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">data_lowess</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">type</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="va">labels_residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Increasing variance</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Complex variance</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2_i = 5 X_i)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify a vector of variances, which is a function of X</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">x</span></span>
<span></span>
<span><span class="co"># generate response Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_increasing_error_variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Scatterplot</p>
<ul>
<li>Can see more variation around ftted line as <span class="math inline">\(X\)</span> increases.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view scatterplot with regression line</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_increasing_error_variance</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>Looking for a pattern that doesn’t follow horizontal bands as move left to right, trend line may still be horizontal though.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_increasing_error_variance</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Scale-location plot</p>
<ul>
<li>Now trend line will not be horizontal after transforming residuals, should increase with an increasing variance.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scale-location plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_increasing_error_variance</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \text{ decreasing then increasing } \sigma^2_i)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># -&gt; specify a vector of variances instead so it sequentially increases</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="co"># -&gt; need pattern of variances to follow as X increases, so sort Xs after</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">sort</span></span>
<span></span>
<span><span class="co"># generate response Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_complex_error_variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view scatterplot with regression line</span></span>
<span><span class="co"># -&gt; now see values are closer to line in middle of plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_complex_error_variance</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual plot</span></span>
<span><span class="co"># -&gt; see ribbon-like pattern</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_complex_error_variance</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scale-location plot</span></span>
<span><span class="co"># -&gt; see U kinda pattern</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_complex_error_variance</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="presence-of-unusual-observations" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="presence-of-unusual-observations">
<span class="header-section-number">3.3.3</span> Presence of unusual observations</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>Overview</p>
<ul>
<li>
<p>Unusual observations can create much difficulty when fitting models. When present, they can lead to a misleading fit because the line was estimated by minimizing the squared deviations.</p>
<ul>
<li>Thus, a fitted line may be pulled disproportionately toward an unusual observation. Unusual observations far from <span class="math inline">\(\bar{X}\)</span> have a larger impact on the model and estimates than those near <span class="math inline">\(\bar{X}\)</span> (this is the idea of leverage / influence).</li>
</ul>
</li>
</ul>
<p><img src="files/images/outliers-relative-xbar.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>
<p>There are two types unusual observations and how we define them, check for them, and their impact is different.</p>
<ol type="1">
<li>
<strong>Outliers</strong> → Extreme values of the response (outliers in <span class="math inline">\(Y\)</span>).</li>
</ol>
<ul>
<li><p>A rough rule of thumb → When the sample size is large, semistudentized (or standardized) residuals with absolute value more than 3 or 4 can be considered outliers (i.e.&nbsp;outliers if <span class="math inline">\(\lvert \frac{e_i}{\sqrt{MSE}} \text{ or } e_i^* \rvert \ge 3 \text{ or } 4\)</span>).</p></li>
<li><p>We can look at the following plots to check if residual outliers are present:</p></li>
</ul>
<ol type="a">
<li>
<em>Residual plot against the fitted values (or</em> <span class="math inline">\(X\)</span>)</li>
</ol>
<ul>
<li><p>Just looking for points far away from the pattern of the rest. In SLR, can also look at the scatterplot of <span class="math inline">\(Y\)</span> vs <span class="math inline">\(X\)</span> for points far from overall pattern.</p></li>
<li><p>Plotting of semistudentized residuals is helpful for distinguishing outiers because it’s easy to identify residuals that lie many standard deviations from zero.</p></li>
</ul>
</li>
</ul>
<p><img src="files/images/diagnostics-outlier-y.png" class="img-fluid" style="width:30.0%"></p>
<p><img src="files/images/diagnostics-outlier-semistudentized.png" class="img-fluid" style="width:30.0%"></p>
<ol start="2" type="a">
<li>
<p><em>Boxplots, histograms, Normal QQ of the residuals (or standardized residuals)</em></p>
<ul>
<li>Can also look for outliers in the usual way based on these plots. Note that different visuals / rules will give more or less evidence for outliers.</li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-outliers-other-plots.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="1">
<li>
<p><strong>High leverage points</strong> → Observations whose predictor values are far from the center of the predictor space (extreme values (outliers) of <span class="math inline">\(X\)</span> or unusual combination of <span class="math inline">\(X\)</span>s).</p>
<ol start="3" type="a">
<li>Plots → <em>Residuals vs Leverage plot</em> (or Cook’s distance plot, Cook’s dist vs Leverage (1 - Leverage) plot) → These use measures not covered yet.</li>
</ol>
</li>
</ol>
<p>(3.) <strong>Influential points</strong> → High leverage points that actually <em>influence</em> the slope of the regression line (outlier in <span class="math inline">\(X\)</span> AND <span class="math inline">\(Y\)</span>).</p>
<ol start="4" type="a">
<li>Plots → In order to determine if a point is influential, visualize the regression line with and without the point. Does the slope of the line change considerably? If so, then the point is influential. If not, then it’s not an influential point.</li>
</ol>
<p><img src="files/images/diagnostics-high-leverage-influential.png" class="img-fluid" style="width:50.0%"></p>
<p>Removing unusual observations</p>
<ul>
<li><p>Because unusual observations can create lots of difficulty, when we find one, we initially think that the observation resulted from a mistake or some extraneous effect. So it should be removed.</p></li>
<li><p>On the other hand, unusual observations may convey significant information (such as if it occurs because of an interaction with another predictor variable omitted from the model).</p></li>
<li><p>A safe rule → Discard an unusual observation only if there is direct evidence that it represents an error in recording, a miscalculation, a malfunctioning of equipment, or a similar type of circumstance.</p></li>
</ul>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>Looking for observations with residuals far below or above 0.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># using ideal model from linearity assumption demo</span></span>
<span><span class="co"># -&gt; randomness may result in an outlier or two</span></span>
<span></span>
<span><span class="co"># again, same plot as to check linearity and nonconstant variance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># by default, on all the diagnostic plots R labels the 3 observations with the most extreme residuals </span></span>
<span><span class="co"># -&gt; this says nothing about being potential outliers, just the top three</span></span>
<span><span class="co"># -&gt; can change how many get labeled and what the label is (by default it is the observation number)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span>, id.n <span class="op">=</span> <span class="fl">10</span>, labels.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n y = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># could also add lines for 3 * sqrt(MSE) to get the same comparison as below, just in units of the original residuals</span></span>
<span><span class="co"># -&gt; NOTE: bounds are off plot cause not any outliers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span>, <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Standardized residuals vs fitted plot</p>
<ul>
<li><p>Looking for observations beyond with residuals 3 or 4 away from zero after standardizing.</p></li>
<li><p>Both ways of standardizing get essentially the same outcomes <span class="math inline">\(\Longrightarrow\)</span> An outlier in one will be an outlier in the other, so can just use the default R</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># show how to check the standardized residual plots and compare different versions</span></span>
<span></span>
<span><span class="co"># create dataset of two different standardized residuals for variation of residual plot</span></span>
<span><span class="co"># 1) semistudentized residuals</span></span>
<span><span class="co"># 2) e* from above (standardized residuals from scale-location)</span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"fitted"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>,</span>
<span>                        e_semi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span>,</span>
<span>                        e_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"e"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"residuals"</span><span class="op">)</span></span>
<span>               </span>
<span><span class="co"># create residual plot with smoothing line for both types of residuals</span></span>
<span><span class="co"># -&gt; add bands at +/- 3 "standardized units" from zero</span></span>
<span><span class="va">data_plot</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted</span>,</span>
<span>             y <span class="op">=</span> <span class="va">residuals</span>,</span>
<span>             color <span class="op">=</span> <span class="va">type</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">.</span>,</span>
<span>         alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              method <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>             col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"orange"</span>, <span class="st">"orange"</span><span class="op">)</span>,</span>
<span>             linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Type of residual"</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>e_semi <span class="op">=</span> <span class="st">"#F8766D"</span>, e_star <span class="op">=</span> <span class="st">"#00BFC4"</span><span class="op">)</span>, <span class="co"># use hexcode of default colors when two values</span></span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>e_semi <span class="op">=</span> <span class="st">"semistudentized"</span>, e_star <span class="op">=</span>  <span class="st">"standardized"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Boxplot, histogram and Normal QQ plot of residuals</p>
<ul>
<li>Should not see any observations far away from the general patterns.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,  main <span class="op">=</span> <span class="st">"Boxplot of residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Histogram  of residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># normal qq plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Residuals vs Leverage plot, Cook’s distance plot and Cook’s dist vs Leverage / (1 - Leverage) plot</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># diagnostic plots of: residuals vs lev, cooks dist, and cooks dist vs lev</span></span>
<span><span class="co"># NOT RUN -&gt; note works inline</span></span>
<span><span class="fu">autoplot</span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `autoplot()`:
! Objects of class &lt;lm&gt; are not supported by autoplot.
ℹ have you loaded the required package?</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residuals vs lev plot uses standardized residuals (and not transforming them with sqrt(abs(.)) like the scale-location plot)</span></span>
<span><span class="co"># -&gt; so could add the +/- 3 lines to this plot (and for now ignore the leverage lines)</span></span>
<span><span class="co"># note -&gt; lines are off plot cause no outliers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Outlier</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">High-leverage point</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Influential point</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0^* + \beta_1^* X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">4</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values and y values in a dataframe</span></span>
<span><span class="co"># (SIDENOTE -&gt; needs to be a separate mutate() statement so y uses the x's just generated and not ones from a previous vector)</span></span>
<span><span class="va">data_without</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># introduce outlier</span></span>
<span><span class="co"># -&gt; new point follows different population regression model, but with typical X value</span></span>
<span><span class="co"># --&gt; X ranges from 5 to 15 from above</span></span>
<span><span class="va">data_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">(</span><span class="va">beta_0</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta_1</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_outlier</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data_without</span>, <span class="va">data_new</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Diagnostic plots with outlier (typical <span class="math inline">\(X\)</span> but extreme <span class="math inline">\(Y\)</span> <span class="math inline">\(\Longrightarrow\)</span> Outlier in <span class="math inline">\(Y\)</span>)</p>
<ul>
<li>Can see a point with unusually large residuals (outlier in boxplot, way above / below in residual plot).</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of data with outlier</span></span>
<span><span class="va">data_outlier</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model with outlier</span></span>
<span><span class="va">mod_outlier</span> <span class="op">&lt;-</span> <span class="va">data_outlier</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_outlier</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>, main  <span class="op">=</span> <span class="st">"Boxplot of residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># if there is an outlier in the boxplot, can extract it</span></span>
<span><span class="co"># -&gt; then find the corresponding (x,y) pair</span></span>
<span><span class="op">(</span><span class="va">outlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_outlier</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">out</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-34-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      31 
38.61047 </code></pre>
</div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_outlier</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">mod_outlier</span><span class="op">$</span><span class="va">residuals</span> <span class="op">==</span> <span class="va">outlier</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">display_nice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">   </th>
   <th style="text-align:right;"> x </th>
   <th style="text-align:right;"> y </th>
  </tr></thead>
<tbody><tr>
<td style="text-align:left;"> 31 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 80.804 </td>
  </tr></tbody>
</table>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual vs fitted plot with reference lines to confirm outlier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_outlier</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_outlier</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span>, <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-34-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get standardized residual value of the identified outlier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">mod_outlier</span><span class="op">)</span><span class="op">[</span><span class="fl">31</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      31 
4.838793 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view regression lines with and without outlier</span></span>
<span><span class="va">data_outlier</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Outlier"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_outlier</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">data_outlier</span><span class="op">[</span><span class="op">-</span><span class="fl">31</span>,<span class="op">]</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0 + \beta_1 X_i^* + \text{Normal}(0, \sigma^2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># introduce high-leverage point</span></span>
<span><span class="co"># -&gt; new point follows same population regression model, just with extreme X value</span></span>
<span><span class="va">data_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_high_leverage</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data_without</span>, <span class="va">data_new</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Diagnostic plots with high-leverage point (extreme <span class="math inline">\(X\)</span> but follow pattern of <span class="math inline">\(Y\)</span> <span class="math inline">\(\Longrightarrow\)</span> Outlier in <span class="math inline">\(X\)</span>)</p>
<ul>
<li>Residual of high-leverage point will be typical, but far away horizontally from the rest of the points.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of data with high-leverage point</span></span>
<span><span class="va">data_high_leverage</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model with high-leverage point</span></span>
<span><span class="va">mod_high_leverage</span> <span class="op">&lt;-</span> <span class="va">data_high_leverage</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># residual vs leverage plot with reference lines to confirm high-leverage (outlier in X) and also outlier (in Y)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_high_leverage</span>, which <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view regression lines with and without outlier</span></span>
<span><span class="va">data_high_leverage</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"High-leverage point"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_high_leverage</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">data_high_leverage</span><span class="op">[</span><span class="op">-</span><span class="fl">31</span>,<span class="op">]</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0^* + \beta_1^* X_i^* + \text{Normal}(0, \sigma^2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># introduce influential point</span></span>
<span><span class="co"># -&gt; new point follows different population regression model AND extreme X value</span></span>
<span><span class="va">data_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">(</span><span class="va">beta_0</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta_1</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_influential</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data_without</span>, <span class="va">data_new</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Diagnostic plots with influential point (extreme <span class="math inline">\(X\)</span> and does NOT follow patter of <span class="math inline">\(Y\)</span> <span class="math inline">\(\Longrightarrow\)</span> Outlier in <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>)</p>
<ul>
<li>Residual of influential point will be extreme AND far away horizontally from the rest of the points.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of data with influential point</span></span>
<span><span class="va">data_influential</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Influential point"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model with influential point</span></span>
<span><span class="va">mod_influential</span> <span class="op">&lt;-</span> <span class="va">data_influential</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># residual vs leverage plot with reference lines to confirm high-leverage and not outlier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_influential</span>, which <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view regression lines with and without outlier</span></span>
<span><span class="va">data_influential</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Influential point"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_influential</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">data_influential</span><span class="op">[</span><span class="op">-</span><span class="fl">31</span>,<span class="op">]</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-40-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="nonindependence-of-error-terms" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="nonindependence-of-error-terms">
<span class="header-section-number">3.3.4</span> Nonindependence of error terms</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>Overview</p>
<ul>
<li><p>Ideally, any potential source of dependence is handled at the experimental design stage (or the sampling scheme), so that it is either eliminated by randomization or explicitly included in the data and we have one observation per subject.</p></li>
<li>
<p>Whenever data are obtained in a time sequence or some other type of sequence, such as for adjacent geographic areas, we can examine the potential dependence of error terms using a sequence plot of residuals.</p>
<ul>
<li>This is used to see if there is any correlation between error terms that are near each other in the sequence.</li>
</ul>
</li>
<li>
<p><em>Sequence plot of residuals</em></p>
<ul>
<li><p>We want to plot the residuals against <em>time, collection order, spatial coordinates, or some other indicator of the sequence that we think might affect the data</em>.</p></li>
<li><p>If errors are independent, residuals hould look like a random walk around the base line zero (i.e.&nbsp;no obvious pattern).</p></li>
<li><p>Dependence (lack of randomness) can appear as a trend or cyclical pattern</p></li>
</ul>
</li>
</ul>
<p><img src="files/images/diagnostics-sequence-plot-time.png" class="img-fluid" style="width:70.0%"></p>
<p>Modelling with nonindependence or apparent nonindependence</p>
<ul>
<li><p>It can be useful to view the problem of nonindependence of the error terms as one in which and important variable has been omitted from the model (whether it be time, observation number, etc.).</p></li>
<li><p>More subtle dependencies can be difficult to detect, especially if the information needed to detect them has not been included with the dataset.</p></li>
<li><p>When the residuals are plotted against <span class="math inline">\(X\)</span>, the plot may not appear to be random. But the basic problem could be from a poorly fitting regression function rather than a lack of independence of the error terms. Example, where a quadratic term should be included:</p></li>
</ul>
<p><img src="files/images/diagnostics-residual-plot-squared-missing.png" class="img-fluid" style="width:30.0%"></p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>
<p>Sequence plot of residuals vs observation number</p>
<ul>
<li>Looking for random walk.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># using ideal model from linearity assumption demo</span></span>
<span></span>
<span><span class="co"># sequence plot of residuals vs observation number</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">e</span>, type <span class="op">=</span> <span class="st">"b"</span>, main <span class="op">=</span> <span class="st">"Sequence plot of residuals vs collection order"</span>, xlab <span class="op">=</span> <span class="st">"obs #"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Dependent errors</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Linear trend effect</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Cyclical nonindependence</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\mu = \epsilon_{i - 1}, \sigma^2)\)</span></p>
<ul>
<li>Error terms are dependent now because the mean for <span class="math inline">\(\epsilon_i\)</span> mean is based (dependent) on the previous error term <span class="math inline">\(\epsilon_{i - 1}\)</span>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate dependent normal error terms</span></span>
<span><span class="co"># -&gt; setup to first generate the deviations from rnorm()</span></span>
<span><span class="co"># -&gt; the first deviation is from mean = 0, the second will now be from (centered on) the first deviation</span></span>
<span><span class="co"># --&gt; so just add the first deviation and the new second deviations together, which will give the effect of a new mean from which rnorm() generated the next deviation</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">cumsum</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_dependent_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scatterplot of y vs x with regression line</span></span>
<span><span class="co"># -&gt; nothing looks amiss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Scatterplot - Dependent errors"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_dependent_error</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual vs fitted plot</span></span>
<span><span class="co"># -&gt; again, seems fine</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_dependent_error</span>, <span class="fl">1</span>, <span class="st">"Residuals vs fitted - Dependent errors"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Sequence plot with dependent errors (<span class="math inline">\(\epsilon_i\)</span> are no longer <em>iid</em>).</p>
<ul>
<li>Now there is not a random walk around zero.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sequence plot of residuals vs observation number</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_dependent_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">e</span>, type <span class="op">=</span> <span class="st">"b"</span>, main <span class="op">=</span> <span class="st">"Dependent errors"</span>, xlab <span class="op">=</span> <span class="st">"obs #"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\text{increasing } \mu, \sigma^2)\)</span></p>
<ul>
<li>Dependent now because successive error terms are more likely to be greater.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate dependent normal error terms</span></span>
<span><span class="co"># -&gt; increasing means</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_linear_trend_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Sequence plot with linear trend effect (still dependent).</p>
<ul>
<li>Clear increase from in residuals with collection order → Early points more have negative residuals and later ones are positive.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sequence plot of residuals vs observation number</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_linear_trend_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">e</span>, type <span class="op">=</span> <span class="st">"b"</span>, main <span class="op">=</span> <span class="st">"Linear trend effect"</span>, xlab <span class="op">=</span> <span class="st">"obs #"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\text{cyclical } \mu, \sigma^2)\)</span></p>
<ul>
<li>Dependent now because adjacent errors are more likely to be closer to each other.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate dependent normal error terms</span></span>
<span><span class="co"># -&gt; cyclical (decreasing, then increasing, then decreasing, repeat) means</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, to <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_cyclical_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Sequence plot with cyclical pattern in errors (still dependent).</p>
<ul>
<li>Cyclical pattern in residuals against collection order.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sequence plot of residuals vs observation number</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_cyclical_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">e</span>, type <span class="op">=</span> <span class="st">"b"</span>, main <span class="op">=</span> <span class="st">"Cyclical nonindependence"</span>, xlab <span class="op">=</span> <span class="st">"obs #"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="nonnormality-of-errors" class="level3" data-number="3.3.5"><h3 data-number="3.3.5" class="anchored" data-anchor-id="nonnormality-of-errors">
<span class="header-section-number">3.3.5</span> Nonnormality of errors</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>Overview</p>
<ul>
<li><p>Small departures from normality do not create any serious problems, but major departures should be of concern.</p></li>
<li><p>We can check the normality of error terms in a variety of errors:</p></li>
</ul>
<ol type="1">
<li>
<p><em>Distribution plots of residuals</em> → This is one of the two preferred plots.</p>
<ul>
<li><p>Boxplots are helpful for seeing if residuals are symmetric and if there are any possible outliers.</p></li>
<li><p>Histograms can also be used for the same purpose, looking for roughly normal. But the sample size needs to be reasonably large for this plot to convey reliable information about the shape of the distribution of error terms (there can be lots of fluctuation in the shape with small samples) <span class="math inline">\(\Longrightarrow\)</span> Moderate departures from normality do not imply a serious violation of this assumption.</p></li>
<li><p>For both of these plots, as long as there is not severe departures, it is okay.</p></li>
</ul>
</li>
<li>
<p><em>Comparison of relative frequencies</em> → Use the empirical rule to compare observed relative frequencies to expected under normality.</p>
<ul>
<li>Using <span class="math inline">\(\sqrt{MSE}\)</span> as an estimate for <span class="math inline">\(\sigma\)</span>, for large sample size <span class="math inline">\(n\)</span> we expect approximately:</li>
</ul>
<ol type="1">
<li>68% of residuals to fall within <span class="math inline">\(\pm \sqrt{MSE}\)</span>.</li>
<li>95% of residuals to fall within <span class="math inline">\(\pm 2 \sqrt{MSE}\)</span>.</li>
<li>99.7% of residuals to fall within <span class="math inline">\(\pm 3 \sqrt{MSE}\)</span>.</li>
</ol>
<ul>
<li><p>If the sample size is moderately large, then we can the corresponding <span class="math inline">\(t_{n-1}\)</span> critical values (multipliers).</p></li>
<li><p>Just looking for relative consistency with these rules.</p></li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-normality-empirical-rule.png" class="img-fluid" style="width:50.0%"></p>
<ol start="3" type="1">
<li>
<p><em>Normal probability (QQ) plot of residuals</em> → This is the other preffered plot.</p>
<ul>
<li><p>Each standardized residual is plotted against its theoretical percentile (aka quantile, which gives us the expected value) under normality. Note that there are a few ways to make the QQ plots (different ways of standardizing residuals and different algorithms for theoretical quantiles), but none of these variations affect the nature of the plot.</p></li>
<li><p>A plot that is nearly linear suggests agreement with normality, whereas a plot that departs substantially from linearity suggests that the error distribution is not normal.</p></li>
<li><p>Again a moderate departure from normality is of little concern, only extreme departures are of note.</p></li>
</ul>
</li>
</ol>
<p><img src="files/images/diagnostics-qq-plots-histograms.png" class="img-fluid" style="width:80.0%"></p>
<p>Difficulties in assessing normality</p>
<ul>
<li>
<p>The analysis for model departures regarding normality is often more difficult than departures of other types because…</p>
<ul>
<li>
<p>Random variation can be particularly mischievous when studying the nature of a probability distribution unless the sample size is quite large.</p>
<ul>
<li><p>Even worse, other types of departures can and do affect the distribution of the residuals.</p></li>
<li><p>e.g.&nbsp;Residuals may appear to be not normally distributed because an inappropriate regression function is used or because the error variance is not constant.</p></li>
</ul>
</li>
<li><p>So, it is usually a good strategy to investigate these other types of departures first, before assessing the normality of the error terms.</p></li>
</ul>
</li>
</ul>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>
<p>Distribution plots</p>
<ul>
<li>Looking roughly symmetric boxplot and a roughly symmetric histogram, both with no extreme outliers.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># using ideal model from linearity assumption demo</span></span>
<span></span>
<span><span class="co"># again, same distribution plots used to check residuals for outliers</span></span>
<span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,  main <span class="op">=</span> <span class="st">"Boxplot of residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Histogram  of residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-49-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Comparison of relative frequencies of residuals</p>
<ul>
<li>Percentages should match the empirical rule.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create relative frequency table for interval probabilities of residuals</span></span>
<span><span class="co"># -&gt; assuming here 30 is large enough to use Z multipliers</span></span>
<span><span class="co"># -&gt; pass z multipliers to map() statement calculating proportion of abs value residuals less than multiplier * sqrt(MSE) -&gt; (gets interval rel freq because centered around zero)</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_ideal</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span>\<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ± sqrt(MSE) ± 2 sqrt(MSE) ± 3 sqrt(MSE) 
        0.667         0.967         1.000 </code></pre>
</div>
</div>
<ul>
<li>
<p>Normal QQ plot of residuals</p>
<ul>
<li>Want standard residuals to follow the trend line.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># normal qq plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ideal</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Skewed errors</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Light-tailed errors</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Heavy-tailed errors</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Exponential}(\lambda = 1/5)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate right-skewed error terms from exponential distribution</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_skewed_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- not sure if need to correct error terms to have mean zero; epsilon * = epsilon - mean(epsilon); (so satisfies BLUE assumptions)?? -->
<ul>
<li>
<p>Comparison of frequencies, distribution plots and QQ plot of residuals</p>
<ul>
<li>Can see relative frequencies don’t match the empirical rule; right skew in boxplot (with high outliers) and histogram; concave up pattern in qq plot.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># comparison of frequencies</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_skewed_error</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_skewed_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span>\<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ± sqrt(MSE) ± 2 sqrt(MSE) ± 3 sqrt(MSE) 
         0.76          0.96          1.00 </code></pre>
</div>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_skewed_error</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,  main <span class="op">=</span> <span class="st">"Right-skewed error"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_skewed_error</span><span class="op">)</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">"Right-skewed error"</span><span class="op">)</span></span>
<span><span class="va">x_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, to <span class="op">=</span> <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-53-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># normal qq plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_skewed_error</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-53-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{Uniform}(a = -2, b = 2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate light-tailed error terms from uniform distribution</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_light_tailed_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Same methods → Relative frequencies don’t line up; likely no outliers on boxplot; the histogram may show more data closer to the center; S-shape in QQ plot.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># comparison of frequencies</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_light_tailed_error</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_light_tailed_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span>\<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ± sqrt(MSE) ± 2 sqrt(MSE) ± 3 sqrt(MSE) 
         0.66          1.00          1.00 </code></pre>
</div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_light_tailed_error</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,  main <span class="op">=</span> <span class="st">"Light-tailed error"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram of standardized residuals (so can overlay Z density curve)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">mod_light_tailed_error</span><span class="op">)</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="fl">20</span>, main <span class="op">=</span> <span class="st">"Light-tailed error"</span><span class="op">)</span></span>
<span><span class="va">x_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, to <span class="op">=</span> <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-55-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># normal qq plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_light_tailed_error</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-55-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- is uniform light-tailed??? -->
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \text{t}_4\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate heavy-tailed error terms from t-distribution</span></span>
<span><span class="co"># -&gt; df = 4 so not the most extreme</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">rt</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, df <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod_heavy_tailed_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Same methods → Again, relative frequencies don’t line up; likely outliers on both sides of boxplot; the histogram will may show more data away from the center; flipped S-shape in QQ plot.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># comparison of frequencies</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_heavy_tailed_error</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_heavy_tailed_error</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">map_dbl</span><span class="op">(</span>\<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ± sqrt(MSE) ± 2 sqrt(MSE) ± 3 sqrt(MSE) 
         0.70          0.98          0.98 </code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># boxplot of residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_heavy_tailed_error</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,  main <span class="op">=</span> <span class="st">"Heavy-tailed error"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># histogram of standarized residuals (so can overlay Z density curve)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">mod_heavy_tailed_error</span><span class="op">)</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="fl">20</span>, main <span class="op">=</span> <span class="st">"Heavy-tailed error"</span><span class="op">)</span></span>
<span><span class="va">x_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, to <span class="op">=</span> <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_plot</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># normal qq plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_heavy_tailed_error</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-57-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="omission-of-important-predictor-variables" class="level3" data-number="3.3.6"><h3 data-number="3.3.6" class="anchored" data-anchor-id="omission-of-important-predictor-variables">
<span class="header-section-number">3.3.6</span> Omission of important predictor variables</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Content</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Ideal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p>Overview</p>
<ul>
<li>
<p>Residuals should also be plotted against variables omitted from the model that might have important effects on the response.</p>
<ul>
<li>Allows us to see whether or not the residuals tend to vary systematically with the level of the additional predictor variable (can be qualitative or quantitative).</li>
</ul>
<p><img src="files/images/diagnostics-residual-vs-omittted-x.png" class="img-fluid" style="width:50.0%"></p>
</li>
<li>
<p>Only a few of the factors operating on any response variable <span class="math inline">\(Y\)</span> in real-world situations can be included explicitly in a regression model (depends on what data was collected).</p>
<ul>
<li><p>So when using residual analysis to identify other important predictors, we are simply testing the adequacy of the model and seeing if it could be improved materially by adding one or more predictor variables.</p></li>
<li><p>In doing so, we can provide important additional descriptive and predictive power to the model.</p></li>
</ul>
</li>
</ul>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_{1,i} + 0 \, X_{2,i} + \text{Normal}(0, \sigma^2)\)</span></p>
<ul>
<li>Simplifies to: <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_{1,i} + \beta_2 X_{2,i} + \epsilon_i \hspace{20pt} \text{with unrelated } X_{2,i}\)</span>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">3</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># unimportant predictor</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># generate X samples</span></span>
<span><span class="va">x_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">x_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate Y observations using with both xs</span></span>
<span><span class="co"># -&gt; beta_2 = 0 cancels out x_2 terms</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x_1</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x_2</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit simplified (correct) model</span></span>
<span><span class="va">mod_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>Looks like random noise, no systematic deviations when residuals for correct model are plotted against unimportant (unrelated) omitted predictor.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual plot against unimportant predictor not included in model</span></span>
<span><span class="co"># -&gt; no systematic variation of residuals by additional predictor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Residuals vs unimportant predictor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Departures</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Missing important predictor</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<p>Model statement → <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_{1,i} + \beta_2 X_{2,i} + \text{Normal}(0, \sigma^2)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">3</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># important predictor</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X samples</span></span>
<span><span class="va">x_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">x_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate normal error terms</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate Y observations using with both xs</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x_1</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x_2</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># fit incorrect model (missing X2)</span></span>
<span><span class="va">mod_missing_important_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p>Residuals vs fitted plot</p>
<ul>
<li>Now there is a pattern in the residuals for the omitted important predictor.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># residual plot against important predictor not included in model</span></span>
<span><span class="co"># -&gt; now there is a clear pattern</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_missing_important_x</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Missing predictor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod_missing_important_x</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="effects-of-departures" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="effects-of-departures">
<span class="header-section-number">3.4</span> Effects of departures</h2>
<section id="setup-and-functions" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="setup-and-functions">
<span class="header-section-number">3.4.1</span> Setup and functions</h3>
<p>Simulation to determine the effect of various model departures on model performance.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialize simulation settings</span></span>
<span><span class="co"># -&gt; first the parameter(s) of interest (that are variable), excluding nonlinear cause scales are totally different</span></span>
<span><span class="co"># -&gt; create all combos</span></span>
<span><span class="co"># -&gt; add in the constant settings</span></span>
<span><span class="co"># -&gt; arrange in good order if necessary</span></span>
<span><span class="co"># -&gt; add simulation id column</span></span>
<span><span class="co"># -&gt; set row names equal to id (helps keep track of results later)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"squared x"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span>, <span class="st">"missing important x"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>,</span>
<span>         n <span class="op">=</span> <span class="fl">50</span>,</span>
<span>         beta_0 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         beta_1 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         beta_2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>         sigma <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sim_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sim"</span>, <span class="va">params</span><span class="op">$</span><span class="va">sim_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set beta2 for models that need it</span></span>
<span><span class="va">params</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">model</span> <span class="op">==</span> <span class="st">"squared x"</span><span class="op">)</span>, <span class="st">"beta_2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">params</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">model</span> <span class="op">==</span> <span class="st">"missing important x"</span><span class="op">)</span>, <span class="st">"beta_2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                         model  n beta_0 beta_1 beta_2 sigma sim_id
sim1                     ideal 50      2      2      0     5      1
sim2                  skewed x 50      2      2      0     5      2
sim3                 squared x 50      2      2      2     5      3
sim4 increasing error variance 50      2      2      0     5      4
sim5    complex error variance 50      2      2      0     5      5
sim6                   outlier 50      2      2      0     5      6</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define function to generate the model of interest</span></span>
<span><span class="co"># -&gt; conditionally generates X values, error terms and Y values, then fits model</span></span>
<span><span class="va">generate_mod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"squared x"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span>, <span class="st">"missing important x"</span><span class="op">)</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">30</span>, <span class="va">beta_0</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">beta_1</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">beta_2</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># set model type by matching argument</span></span>
<span>  <span class="co"># -&gt; if no model is specified, defaults to the first one</span></span>
<span>  <span class="co"># -&gt; partial string matches work</span></span>
<span>  <span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate X samples</span></span>
<span>  <span class="co"># -&gt; only model with specific x dist is skewed predictor</span></span>
<span>  <span class="co"># -&gt; need to sort x for complex error variance</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"skewed x"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu">truncdist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/truncdist/man/rtrunc.html">rtrunc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span>, spec <span class="op">=</span> <span class="st">"exp"</span>, a <span class="op">=</span> <span class="fl">5</span>, b <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"complex error variance"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">x_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate error terms</span></span>
<span>  <span class="va">epsilon</span> <span class="op">=</span> </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"increasing error variance"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"complex error variance"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span> , sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"linear trend error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"cyclical error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">20</span>, to <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"skewed error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"light tailed error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"heavy tailed error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">rt</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, df <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"dependent error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">epsilon</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">epsilon</span><span class="op">)</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># calculate Y observations using with both xs</span></span>
<span>  <span class="co"># -&gt; if X2 is not needed beta_2 = 0 cancels it out</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"squared x"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">epsilon</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span><span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x_2</span> <span class="op">+</span> <span class="va">epsilon</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># change last observation for unusual observations</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"outlier"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">8</span>, max <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>; <span class="va">y</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">(</span><span class="va">beta_0</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta_1</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"high leverage point"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">18</span>, max <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>; <span class="va">y</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">+</span> <span class="va">epsilon</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">}</span> <span class="co"># same regression function (use same error), extreme x value</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"influential point"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">18</span>, max <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>; <span class="va">y</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">(</span><span class="va">beta_0</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta_1</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># fit model</span></span>
<span>  <span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define function to run on each unique simulation setting</span></span>
<span><span class="va">run_trial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span>, <span class="va">vec_names</span>, <span class="va">m</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># redefine arguments for easier reference</span></span>
<span>  <span class="co"># -&gt; numeric values get coerced to character because of `model` data type</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">=</span> <span class="va">vec_names</span></span>
<span>  <span class="va">model</span> <span class="op">=</span> <span class="va">vec</span><span class="op">[</span><span class="st">"model"</span><span class="op">]</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"n"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_0"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_1"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"beta_2"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"sigma"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sim_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="st">"sim_id"</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># initialize vectors of quantities of interest</span></span>
<span>  <span class="va">beta0_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">beta1_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">se_beta1_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">t_star</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">mse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">r_squared</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to simulate m models and extract summaries</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># fit model</span></span>
<span>    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">generate_mod</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>, n <span class="op">=</span> <span class="va">n</span>, beta_0 <span class="op">=</span> <span class="va">beta_0</span>, beta_1 <span class="op">=</span> <span class="va">beta_1</span>, beta_2 <span class="op">=</span> <span class="va">beta_2</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># get summaries</span></span>
<span>    <span class="co"># -&gt; just want t-stat</span></span>
<span>    <span class="va">beta0_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span>    <span class="va">beta1_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"x"</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span>    <span class="va">se_beta1_hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"x"</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span>    <span class="va">t_star</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"x"</span>, <span class="st">"t value"</span><span class="op">]</span></span>
<span>    <span class="va">mse</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">r_squared</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">beta0_hat</span>, <span class="va">beta1_hat</span>, <span class="va">se_beta1_hat</span>, <span class="va">t_star</span>, <span class="va">mse</span>, <span class="va">r_squared</span>, sim_id <span class="op">=</span> <span class="va">sim_id</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define function to run simulation and format results</span></span>
<span><span class="va">simulation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">sim_function</span>, <span class="va">iterations</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">format_results</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># run simulation for each parameter settings</span></span>
<span>  <span class="co"># -&gt; have to transpose so that now each column is a parameter settings and convert to dataframe so can pass to map(), which needs a list</span></span>
<span>  <span class="va">results_raw</span> <span class="op">=</span> <span class="va">params</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="va">t</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="va">data.frame</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="fu">sim_function</span><span class="op">(</span><span class="va">vec</span>, vec_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, m <span class="op">=</span> <span class="va">iterations</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">format_results</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results_raw</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># reformat results</span></span>
<span>    <span class="co"># -&gt; convert each results matrix to a dataframe, then combine</span></span>
<span>    <span class="co"># -&gt; attach the simulation settings to the results</span></span>
<span>    <span class="co"># -&gt; pivot longer to have one column for the name of the summary measure and one for its value</span></span>
<span>    <span class="co"># -&gt; convert parameters to factors for plot</span></span>
<span>    <span class="va">results</span> <span class="op">=</span> <span class="va">results_raw</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">reduce</span><span class="op">(</span><span class="va">bind_rows</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">left_join</span><span class="op">(</span><span class="va">params</span>, by <span class="op">=</span> <span class="st">"sim_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">results_raw</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                   names_to <span class="op">=</span> <span class="st">"statistic"</span>,</span>
<span>                   values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define function to plot standard results</span></span>
<span><span class="va">plot_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">mods</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">model</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mods</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>,</span>
<span>               group <span class="op">=</span> <span class="va">model</span>,</span>
<span>               color <span class="op">=</span> <span class="va">model</span>,</span>
<span>               fill <span class="op">=</span> <span class="va">model</span><span class="op">)</span>,</span>
<span>           data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">statistic</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>               scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="results" class="level3" data-number="3.4.2"><h3 data-number="3.4.2" class="anchored" data-anchor-id="results">
<span class="header-section-number">3.4.2</span> Results</h3>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run simulation</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">simulation</span><span class="op">(</span>params <span class="op">=</span> <span class="va">params</span>, sim_function <span class="op">=</span> <span class="va">run_trial</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, format_results <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  sim_id model n     beta_0 beta_1 beta_2 sigma statistic     value
  &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt; &lt;chr&gt;         &lt;dbl&gt;
1 1      ideal 50    2      2      0      5     beta0_hat     4.84 
2 1      ideal 50    2      2      0      5     beta1_hat     1.79 
3 1      ideal 50    2      2      0      5     se_beta1_hat  0.239
4 1      ideal 50    2      2      0      5     t_star        7.49 
5 1      ideal 50    2      2      0      5     mse          22.8  
6 1      ideal 50    2      2      0      5     r_squared     0.539</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># unusual observations results</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span>res <span class="op">=</span> <span class="va">results</span>, mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Takeaways</p>
<ul>
<li>
<p>Estimated coefficients:</p>
<ul>
<li><p>High leverage points really have no impact on anything (slightly inflate <span class="math inline">\(R^2\)</span>).</p></li>
<li><p>Only influential points make estimated coefficients biased.</p></li>
<li><p>Both influential points and outliers inflate <span class="math inline">\(MSE\)</span>, with influential points having more of an impact.</p></li>
<li><p>Outliers have the largest decrease in <span class="math inline">\(R^2\)</span>; influential points decrease it as well.</p></li>
<li><p>Standard errors of estimated coefficients are much larger for influential points, then followed by outliers.</p></li>
<li><p>Least likely to reject test on coefficient when there is an outlier, then followed by influential points (which makes sense cause outliers lead to same estimated coefficients, but larger standard errors).</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># nonconstant error variance</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span>res <span class="op">=</span> <span class="va">results</span>, mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Takeaways</p>
<ul>
<li>Non constant error variance messes everything up, this definitely needs to be remedied first.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># dependent error variance</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span>res <span class="op">=</span> <span class="va">results</span>, mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Takeaways</p>
<ul>
<li><p>Not independent errors are just the wrong type of model for SLR.</p></li>
<li><p>All drastically lower <span class="math inline">\(R^2\)</span> and higher standard error of coefficients (less likely to reject), but similar estimates.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># non normal error distribution</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span>res <span class="op">=</span> <span class="va">results</span>, mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Takeaways</p>
<ul>
<li><p>Skewed errors seem to have little impact.</p></li>
<li><p>Not sure what to make of the others, they seem extreme.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># other</span></span>
<span><span class="fu">plot_results</span><span class="op">(</span>res <span class="op">=</span> <span class="va">results</span>, mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"missing important x"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Takeaways</p>
<p>(not looking at when missing <span class="math inline">\(x^2\)</span>, everything way off)</p>
<ul>
<li>Same estimated coefficients, lots more variability when skewed <span class="math inline">\(X\)</span>. This makes sense in the formula below.</li>
</ul>
<p><img src="files/images/x-dist.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li><p>Skewed <span class="math inline">\(X\)</span> results in a drastically lower <span class="math inline">\(R^2\)</span>. Interesting.</p></li>
<li><p>Missing important predictors leads to inflated <span class="math inline">\(MSE\)</span>, which makes sense.</p></li>
</ul></section></section><section id="tests" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="tests">
<span class="header-section-number">3.5</span> Tests</h2>
<!-- skipping all of the following sections for now, but NEED TO COME BACK TO -->
<!-- ### Overview of tests involving residuals  -->
<!-- ### Correlation test for normality  -->
<!-- ### Tests for constancy of error variance  -->
<section id="f-test-for-lack-of-fit" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="f-test-for-lack-of-fit">
<span class="header-section-number">3.5.1</span> <span class="math inline">\(F\)</span> test for lack of fit</h3>
<p>This is a formal test for determining whether a specific type of regression function adequately fits the data.</p>
<p>Assumptions</p>
<ul>
<li><p>The lack of fit test assumes that the observations Y for given X are (1) independent and (2) normally distributed, and that (3) the distributions of the same variance <span class="math inline">\(\sigma^2\)</span>.</p></li>
<li>
<p>The lack of fit test requires repeat observations at one or more <span class="math inline">\(X\)</span> levels (just this is sufficient). In observational studies, these just happen by chance.</p>
<ul>
<li>Repeat trials for the same level of the predictor variable are called <em>replications</em>. The resulting observations are called <em>replicates</em>.</li>
</ul>
</li>
</ul>
<p>Notation</p>
<ul>
<li>
<p>We need to modify our notation to recognize the existence of replications at some levels of <span class="math inline">\(X\)</span>.</p>
<ul>
<li><p>Let the different <span class="math inline">\(X\)</span> levels in the study, whether or not replicated observations are present, as <span class="math inline">\(X_1, \ldots , X_c\)</span> (so there are <span class="math inline">\(c\)</span> unique values of <span class="math inline">\(X\)</span>).</p></li>
<li><p>Let the number of replicates for the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(X\)</span> as <span class="math inline">\(n_j\)</span>. Thus the total number of observations is given by <span class="math inline">\(\displaystyle n = \sum_{j = 1}^c n_j\)</span>.</p></li>
<li><p>Let the observed value of the response variable for the <span class="math inline">\(i\)</span>th replicate for the <span class="math inline">\(j\)</span>th level of <span class="math inline">\(X\)</span> by <span class="math inline">\(Y_{ij}\)</span>, where <span class="math inline">\(i = 1, \ldots, n_j, \hspace{10pt} j = 1, \ldots, c\)</span>.</p></li>
<li><p>Let the mean of the <span class="math inline">\(Y\)</span> observations at the level <span class="math inline">\(X = X_j\)</span> by <span class="math inline">\(\bar{Y}_j\)</span>.</p></li>
</ul>
</li>
</ul>
<p>Full model</p>
<ul>
<li><p>The general linear test approach begins with the specification of the full model. The full model used for the lack of fit test makes the same assumptions as the simple linear regression model, except for assuming a linear regression relation (which is what we are testing against in this case).</p></li>
<li><p>So the full model is (where <span class="math inline">\(\mu_{ij}\)</span> are parameters <span class="math inline">\(j = 1, \ldots, c\)</span> and <span class="math inline">\(\epsilon_{ij} \overset{iid}\sim \text{Normal}\,(0, \sigma^2)\)</span>:</p></li>
</ul>
<p><span class="math display">\[Y_{ij} = \mu_j + \epsilon_{ij} \hspace{20pt} \text{full model}\]</span> - Thus the parameter <span class="math inline">\(\mu_j\)</span> is the mean response when <span class="math inline">\(X = X_j\)</span>:</p>
<p><span class="math display">\[E(Y_{ij}) = \mu_j\]</span></p>
<ul>
<li><p>This full model is like the SLR model in that it specifies the each response is made of two components: the mean response when <span class="math inline">\(X = X_j\)</span> and a random error term. The difference is that in the full model there is no restrictions on the means <span class="math inline">\(\mu_j\)</span>, whereas the SLR model the mean responses are linearly related to <span class="math inline">\(X\)</span> (i.e.&nbsp;<span class="math inline">\(E(Y) = \beta_0 + \beta_1 X\)</span>).</p></li>
<li><p>To fit the full model to the data, we require the least squares or maximum likelihood estimators for the parameters <span class="math inline">\(\mu_j\)</span>. It can be shown the estimators are the sample means:</p></li>
</ul>
<p><span class="math display">\[\hat{\mu}_j = \bar{Y}_j\]</span></p>
<ul>
<li>Thus, the estimated expected value for observation <span class="math inline">\(Y_{ij}\)</span> is <span class="math inline">\(\bar{Y}_j\)</span>, and the error sum of squares for the full model therefore is:</li>
</ul>
<p><span class="math display">\[SSE(F) = \sum_j^c \sum_i^{n_j} (Y_{ij} - \hat{Y}_{ij})^2 = \sum_j^c \sum_i^{n_j} (Y_{ij} - \bar{Y}_j)^2 = SSPE\]</span></p>
<ul>
<li><p>In the context of the test for lack of fit, the full model error sum of squares above is called the <em>pure error sum of squares (SSPE)</em>.</p></li>
<li><p>Note that <span class="math inline">\(SSPE\)</span> is made up of the sums of squared deviations at each <span class="math inline">\(X\)</span> level. At level <span class="math inline">\(X = X_j\)</span>, this sum of squared deviations is shown below, which then get added over all of the <span class="math inline">\(X\)</span> levels (<span class="math inline">\(j = 1, \ldots , c\)</span>):</p></li>
</ul>
<p><span class="math display">\[\sum_i (Y_{ij} - \bar{Y}_j)^2\]</span> - Also note that if there is no replication at an <span class="math inline">\(X\)</span> level, then <span class="math inline">\(Y_{1j} = \bar{Y}_j\)</span> and the sum of square is simply 0 (this is why we need replication).</p>
<ul>
<li>The degrees of freedom associated with <span class="math inline">\(SSPE\)</span> is found like usual. At each <span class="math inline">\(X_j\)</span>, there are <span class="math inline">\(n_j - 1\)</span> df. Then sum over <span class="math inline">\(j\)</span>:</li>
</ul>
<p><span class="math display">\[df_F = \sum_j^c (n_j - 1) = \sum_j^c n_j - c = n - c\]</span></p>
<ul>
<li>Note that any <span class="math inline">\(X\)</span> level with no replications makes no contribution to <span class="math inline">\(df_F\)</span> because <span class="math inline">\(n_j - 1 = 1 - 1 = 0\)</span>.</li>
</ul>
<p>Reduced model</p>
<ul>
<li>The general linear test approach next requires consideration of the reduced model under <span class="math inline">\(H_0\)</span>. For testing the appropriateness of a linear regression relation, the hypotheses are:</li>
</ul>
<p><span class="math display">\[
H_0: E(Y) = \beta_0 + \beta_1 X \hspace{20pt} \text{Reduced model}\\
H_A: E(Y) \ne \beta_0 + \beta_1 X \hspace{20pt} \text{Full model}
\]</span></p>
<ul>
<li>Thus, <span class="math inline">\(H_0\)</span> postulates that <span class="math inline">\(\mu_j\)</span> in the full model is linearly related to <span class="math inline">\(X_j\)</span>:</li>
</ul>
<p><span class="math display">\[\mu_j = \beta_0 + \beta_1 X_j\]</span></p>
<ul>
<li>The reduced model under <span class="math inline">\(H_0\)</span> therefore is:</li>
</ul>
<p><span class="math display">\[Y_{ij} = \beta_0 + \beta_1 X_j + \epsilon \hspace{20pt} \text{Reduced model}\]</span></p>
<ul>
<li>Note that the reduced model is the ordinary simple linear regression model as usual, with the subscripts modified to recognize the existence of replications. We know that the estimated expected value for observation <span class="math inline">\(Y_{ij}\)</span> with usual regression model is the fitted value <span class="math inline">\(Y_{ij}\)</span>
</li>
</ul>
<p><span class="math display">\[Y_{ij} = \hat{\beta}_0 + \hat{\beta}_1 X_j\]</span></p>
<ul>
<li>Hence, the error sum of squares for the reduced model is the usual error sum of squares <span class="math inline">\(SSE\)</span>
</li>
</ul>
<p><span class="math display">\[SSE(R) = \sum_j^c \sum_i^{n_j} (Y_{ij} - \hat{Y}_{ij})^2 = \sum_j^c \sum_i^{n_j} (Y_{ij} - (\hat{\beta}_0 + \hat{\beta}_1 X_j))^2 = SSE\]</span></p>
<ul>
<li>We also that the degrees of freedom associated with <span class="math inline">\(SSE(R)\)</span> are:</li>
</ul>
<p><span class="math display">\[df_R = n - 2\]</span></p>
<p>Test statistic</p>
<ul>
<li>The general linear test statistic <a href="notes-inference.html#eq-gen-lin-test" class="quarto-xref">Equation&nbsp;<span>2.1</span></a> (testing significant reduction is <span class="math inline">\(SSE\)</span>) becomes:</li>
</ul>
<p><span class="math display">\[F^* = \frac{SSE - SSPE}{(n - 2) - (n - c)} \big/ \frac{SSPE}{n - c}\]</span></p>
<ul>
<li>The difference between the two error sums of squares is called the lack of fit sum of squares <span class="math inline">\(SSLF\)</span>.</li>
</ul>
<p><span class="math display">\[SSLE = SSE - SSPE\]</span></p>
<ul>
<li>We can then express the test statistic as follows (and reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_A\)</span> for large values of <span class="math inline">\(F^*\)</span>):</li>
</ul>
<p><span class="math display">\[F^* = \frac{SSLF}{c - 2} \big/ \frac{SSPE}{n - c} = \frac{MSLF}{MSPE}\]</span></p>
<p>ANOVA table</p>
<ul>
<li>The definition of the lack of fit sum of squares <span class="math inline">\(SSLF\)</span> above indicates that we have decomposed the error sum of squares SSE into two components:</li>
</ul>
<p><span class="math display">\[SSE = SSPE + SSLF\]</span></p>
<ul>
<li>The decomposition comes from the identity (which shows that the error deviations in <span class="math inline">\(SSE\)</span> are made up of a pure error component and a lack of fit component):</li>
</ul>
<p><img src="files/images/lof-identity.png" class="img-fluid" style="width:50.0%"></p>
<p><img src="files/images/lof-visualized.png" class="img-fluid" style="width:50.0%"></p>
<p><img src="files/images/lof-formulas.png" class="img-fluid" style="width:80.0%"></p>
<ul>
<li>
<p>Last formula above indicates clearly why <span class="math inline">\(SSLF\)</span> measures lack of fit.</p>
<ul>
<li><p>If the linear regression function is appropriate, then the means <span class="math inline">\(\bar{Y}_j\)</span> will be near the fitted values <span class="math inline">\(\hat{Y}_j\)</span> calculated from the estimated linear regression function and <span class="math inline">\(SSLF\)</span> will be small.</p></li>
<li><p>On the other hand, if the linear regression function is not appropriate, the means <span class="math inline">\(\bar{Y}_j\)</span> will not be near the fitted values calculated from the estimated linear regression function and <span class="math inline">\(SSLF\)</span> will be large.</p></li>
</ul>
</li>
<li>
<p>This formulas also indicates why <span class="math inline">\(c - 2\)</span> degrees of freedom are associated with <span class="math inline">\(SSLF\)</span>.</p>
<ul>
<li>There are <span class="math inline">\(c\)</span> means <span class="math inline">\(\bar{Y}_j\)</span> in the sum of squares (<span class="math inline">\(\approx\)</span> <span class="math inline">\(c\)</span> observations), and two dfs are lost in estimating the parameters <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> of the linear regression function to obtain the fitted values <span class="math inline">\(\hat{Y}_j\)</span>.</li>
</ul>
</li>
<li><p>An ANOVA table can be constructed for the decomposition of SSE.</p></li>
</ul>
<p><img src="files/images/lof-anova-table.png" class="img-fluid" style="width:80.0%"></p>
<p>Notes</p>
<ul>
<li><p>The reason for the term “pure error” is that <span class="math inline">\(MSPE\)</span> is always an unbiased estimator of the error term variance <span class="math inline">\(\sigma^2\)</span>, no matter what is the true regression function. But we still always use <span class="math inline">\(MSE\)</span> becuase it has more df.</p></li>
<li><p>The general linear test approach just explained can be used to test the appropriateness of other regression functions. Only the degrees of freedom for <span class="math inline">\(SSLF\)</span> will need be modified. In general, <span class="math inline">\(c - p\)</span> degrees of freedom are associated with <span class="math inline">\(SSLF\)</span>, where <span class="math inline">\(p\)</span> is the number of parameters in the regression function.</p></li>
<li><p>The alternative <span class="math inline">\(H_A\)</span> includes all regression functions other than a linear one. For instance, it includes a quadratic regression function or a logarithmic one. If <span class="math inline">\(H_A\)</span> is concluded, a study of residuals can be helpful in identifying an appropriate function.</p></li>
</ul>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R functions - Testing linear model</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Manual</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Testing complex model</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false">Multiple regression higher order</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate data from ideal model (no lack of fit -&gt; expecting to not reject)</span></span>
<span></span>
<span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># generate X values (asuming there will be some replicates)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/DiscreteUniform.html">rdunif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot and add lines (don't have a straight line anymore, so can't use abline() for unrestricted model)</span></span>
<span><span class="co"># -&gt; have to plot x vs y-hat, but sorted according to x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%$%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_hat</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Reduced model trend line follows group means line fairly well.</p>
<p>Testing</p>
<p><span class="math display">\[
H_0: E(Y) = \beta_0 + \beta_1 X \hspace{20pt} \text{Reduced model}\\
H_A: E(Y) \ne \beta_0 + \beta_1 X \hspace{20pt} \text{Full model}
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit full model</span></span>
<span><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1X</span></span>
<span><span class="va">mod_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ as.factor(x))

Residuals:
     Min       1Q   Median       3Q      Max 
-11.7247  -3.4244   0.6088   3.0766   8.0136 

Coefficients:
               Estimate Std. Error t value    Pr(&gt;|t|)    
(Intercept)       2.198      1.983   1.109     0.27435    
as.factor(x)1    -1.695      2.941  -0.576     0.56760    
as.factor(x)2     6.579      3.135   2.099     0.04237 *  
as.factor(x)3     4.610      2.941   1.568     0.12507    
as.factor(x)4     6.282      2.560   2.454     0.01868 *  
as.factor(x)5     8.974      3.135   2.863     0.00673 ** 
as.factor(x)6    17.361      5.245   3.310     0.00202 ** 
as.factor(x)7     9.252      3.434   2.694     0.01035 *  
as.factor(x)8    11.293      3.135   3.603     0.00088 ***
as.factor(x)9    17.365      2.804   6.193 0.000000279 ***
as.factor(x)10   16.196      3.434   4.716 0.000030524 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.856 on 39 degrees of freedom
Multiple R-squared:  0.6621,    Adjusted R-squared:  0.5754 
F-statistic: 7.641 on 10 and 39 DF,  p-value: 0.000001339</code></pre>
</div>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit reduced model</span></span>
<span><span class="co"># -&gt; SLR model E(Y) + B0 + B1X</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.1129  -3.1738   0.6838   3.4474   8.6448 

Coefficients:
            Estimate Std. Error t value       Pr(&gt;|t|)    
(Intercept)   1.6835     1.2018   1.401          0.168    
x             1.7714     0.2169   8.167 0.000000000123 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.871 on 48 degrees of freedom
Multiple R-squared:  0.5815,    Adjusted R-squared:  0.5728 
F-statistic:  66.7 on 1 and 48 DF,  p-value: 0.0000000001233</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run lack of fit test</span></span>
<span><span class="co"># -&gt; looking at F and PR(&gt;F)</span></span>
<span><span class="op">(</span><span class="va">at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_full</span>, <span class="va">mod_reduced</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ as.factor(x)
Model 2: y ~ x
  Res.Df     RSS Df Sum of Sq      F Pr(&gt;F)
1     39  919.79                           
2     48 1139.10 -9   -219.31 1.0332 0.4318</code></pre>
</div>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># other terms</span></span>
<span><span class="co"># -&gt; Sum of Sq = SSLF --&gt; MSLF = SSLF / change in Df</span></span>
<span><span class="co"># -&gt; RSS(1) = SSPE --&gt; MSPE = SSPE / Res. Df(1)</span></span>
<span><span class="co"># -&gt; F = MSLF / MSPE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p>Setup dataset to manually calculate the required mean squares.</p>
<div class="cell">
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># order data by X variable</span></span>
<span><span class="co"># -&gt; use this dataset for the remainder of the calculations</span></span>
<span><span class="va">data_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># refit model on sorted data (so fitted values and residuals pull in correctly later)</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">data_sorted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate group means by X variable</span></span>
<span><span class="va">data_group_means</span> <span class="op">&lt;-</span> <span class="va">data_sorted</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>group_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># complete table to manually perform LOF test</span></span>
<span><span class="co"># -&gt; append predicted values from reduced model</span></span>
<span><span class="co"># -&gt; add group means by merging with group means dataset</span></span>
<span><span class="co"># -&gt; calculate:</span></span>
<span><span class="co"># --&gt; residual = Y - hat(Y) = obs - pred value -&gt; measure total deviation</span></span>
<span><span class="co"># --&gt; pure error = Y - bar(Y)_j = obs - group mean -&gt; measures the pure error, which is the randomness result from the data, not from the choice of model</span></span>
<span><span class="co"># --&gt; lack of fit error = bar(Y)_j - hat(Y) = group mean - pred value -&gt; measures the lack of fit deviation, which is the error result from the choice of model and could be improved with a better mode</span></span>
<span><span class="va">data_lof_process</span> <span class="op">&lt;-</span> <span class="va">data_sorted</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>predicted_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span>,</span>
<span>         residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">data_group_means</span>, by <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>pure_error <span class="op">=</span> <span class="va">y</span> <span class="op">-</span> <span class="va">group_mean</span>,</span>
<span>         lof_error <span class="op">=</span> <span class="va">group_mean</span> <span class="op">-</span> <span class="va">predicted_value</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_lof_process</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            y x predicted_value   residual group_mean pure_error  lof_error
1  -2.9550243 0        1.683506 -4.6385303  2.1980926 -5.1531169  0.5145866
2   5.1170018 0        1.683506  3.4334958  2.1980926  2.9189092  0.5145866
3   6.2590605 0        1.683506  4.5755545  2.1980926  4.0609679  0.5145866
4  -1.3297035 0        1.683506 -3.0132094  2.1980926 -3.5277960  0.5145866
5  -0.3316449 0        1.683506 -2.0151509  2.1980926 -2.5297375  0.5145866
6   6.4288659 0        1.683506  4.7453600  2.1980926  4.2307734  0.5145866
7   3.0812703 1        3.454932 -0.3736615  0.5028265  2.5784438 -2.9521054
8   0.8713813 1        3.454932 -2.5835506  0.5028265  0.3685548 -2.9521054
9   4.2705524 1        3.454932  0.8156205  0.5028265  3.7677259 -2.9521054
10 -0.7151128 1        3.454932 -4.1700447  0.5028265 -1.2179394 -2.9521054</code></pre>
</div>
</div>
<p>Find sum of squares.</p>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute final sums of squares</span></span>
<span><span class="co"># -&gt; lack of fit dataset is setup so that each quantity is calculated for every row</span></span>
<span><span class="co"># --&gt; just need to square each value and sum</span></span>
<span><span class="op">(</span><span class="va">data_ss</span> <span class="op">&lt;-</span> <span class="va">data_lof_process</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residual</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>            lf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lof_error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>            pe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pure_error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   error       lf       pe
1 1139.1 219.3104 919.7898</code></pre>
</div>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">at</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"Sum of Sq"</span><span class="op">]</span><span class="op">)</span>, <span class="va">data_ss</span><span class="op">$</span><span class="va">lf</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`abs(at[2, "Sum of Sq"])`
[1] 219.3104

$`data_ss$lf`
[1] 219.3104</code></pre>
</div>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">at</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"RSS"</span><span class="op">]</span><span class="op">)</span>, <span class="va">data_ss</span><span class="op">$</span><span class="va">pe</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`abs(at[1, "RSS"])`
[1] 919.7898

$`data_ss$pe`
[1] 919.7898</code></pre>
</div>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sums of squares are additive and SSPE and SSLF are partitioning SSE</span></span>
<span><span class="co"># -&gt; so check that SSE = SSPE + SSLF</span></span>
<span><span class="fu">compare</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data_ss</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="va">data_ss</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`sum(data_ss[, 2:3])`
[1] 1139.1

$`data_ss[, 1]`
[1] 1139.1</code></pre>
</div>
</div>
<p>Find df.</p>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set vector of df</span></span>
<span><span class="co"># -&gt; df sse = n - 2 (for slr, in general p)</span></span>
<span><span class="co"># -&gt; df sslf = c - 2 = # of x levels - 2 </span></span>
<span><span class="co"># -&gt; df sspe = n - c</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sorted</span><span class="op">)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_group_means</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"error"</span> <span class="op">=</span> <span class="va">n</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"lf"</span> <span class="op">=</span> <span class="va">c</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"pe"</span> <span class="op">=</span> <span class="va">n</span> <span class="op">-</span> <span class="va">c</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reshape SS data to add df</span></span>
<span><span class="op">(</span><span class="va">data_anova_table</span> <span class="op">&lt;-</span> <span class="va">data_ss</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"ss"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  type     ss    df
* &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
1 error 1139.    48
2 lf     219.     9
3 pe     920.    39</code></pre>
</div>
</div>
<p>Calculate mean squares.</p>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># add MS to anova table</span></span>
<span><span class="co"># -&gt; MS = SS / df</span></span>
<span><span class="op">(</span><span class="va">data_anova_table</span> <span class="op">%&lt;&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ms <span class="op">=</span> <span class="va">ss</span> <span class="op">/</span> <span class="va">df</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  type     ss    df    ms
  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1 error 1139.    48  23.7
2 lf     219.     9  24.4
3 pe     920.    39  23.6</code></pre>
</div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute final LOF test statistic</span></span>
<span><span class="co"># -&gt; F* = MSLF / MSPE</span></span>
<span><span class="co"># -&gt; convert to numeric so end result isn't a dataframe</span></span>
<span><span class="op">(</span><span class="va">F_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_anova_table</span><span class="op">[</span><span class="va">data_anova_table</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"lf"</span>, <span class="st">"ms"</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_anova_table</span><span class="op">[</span><span class="va">data_anova_table</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"pe"</span>, <span class="st">"ms"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.03322</code></pre>
</div>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare</span><span class="op">(</span><span class="va">at</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"F"</span><span class="op">]</span>, <span class="va">F_star</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`at[2, "F"]`
[1] 1.03322

$F_star
[1] 1.03322</code></pre>
</div>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compute critical value</span></span>
<span><span class="co"># -&gt; LOF critical value (and test statistic) ~ F(c-2, n-c)</span></span>
<span><span class="co"># -&gt; right tailed test</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="op">(</span><span class="va">F_crit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">alpha</span>, df1 <span class="op">=</span> <span class="va">c</span> <span class="op">-</span> <span class="fl">2</span>, df2 <span class="op">=</span> <span class="va">n</span> <span class="op">-</span> <span class="va">c</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.130597</code></pre>
</div>
</div>
<p>Conclusion</p>
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compare test statistic and critical value</span></span>
<span><span class="co"># -&gt; critical value way: if F* &gt;&gt; F_crit, then reject</span></span>
<span><span class="co"># -&gt; p-value way: if P(F &gt; F*) &lt; alpha = then reject</span></span>
<span><span class="va">F_star</span> <span class="op">&gt;</span> <span class="va">F_crit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">F_star</span>, df1 <span class="op">=</span> <span class="va">c</span> <span class="op">-</span> <span class="fl">2</span>, df2 <span class="op">=</span> <span class="va">n</span> <span class="op">-</span> <span class="va">c</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4318399</code></pre>
</div>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_value</span> <span class="op">&lt;</span> <span class="va">alpha</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">compare</span><span class="op">(</span><span class="va">at</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"Pr(&gt;F)"</span><span class="op">]</span>, <span class="va">p_value</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$comparison
[1] TRUE

$`at[2, "Pr(&gt;F)"]`
[1] 0.4318399

$p_value
[1] 0.4318399</code></pre>
</div>
</div>
<p>FAIL TO REJECT. There is not a lack of fit issue with the data.</p>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate data from complex model (lack of fit -&gt; expecting to reject)</span></span>
<span></span>
<span><span class="co"># initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_3</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># generate X values (asuming there will be some replicates)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/DiscreteUniform.html">rdunif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">beta_3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot and add lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%$%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_hat</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%$%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_hat</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lines are close, but the reduced model is relatively far (keep in mind <span class="math inline">\(Y\)</span> scale) the unrestricted model at certain <span class="math inline">\(X\)</span> levels.</p>
<p>Testing:</p>
<p><span class="math display">\[
H_0: E(Y) = \beta_0 + \beta_1 X + \beta_2 \ln(X) \hspace{20pt} \text{Reduced model}\\
H_A: E(Y) \ne \beta_0 + \beta_1 X + \beta_2 \ln(X)  \hspace{20pt} \text{Full model}
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit full model</span></span>
<span><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1 X + B2 ln(X)</span></span>
<span><span class="va">mod_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ as.factor(x))

Residuals:
    Min      1Q  Median      3Q     Max 
-16.366  -4.428   0.000   5.072  17.926 

Coefficients:
               Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)       8.152      3.462   2.354               0.0235 *  
as.factor(x)2     2.972      6.924   0.429               0.6701    
as.factor(x)3    22.301      4.718   4.727   0.0000281807336870 ***
as.factor(x)4    29.737      4.580   6.493   0.0000000959642153 ***
as.factor(x)5    55.992      4.896  11.436   0.0000000000000351 ***
as.factor(x)6    82.163      9.160   8.970   0.0000000000403176 ***
as.factor(x)7   103.263      6.924  14.913 &lt; 0.0000000000000002 ***
as.factor(x)8   141.486      4.379  32.307 &lt; 0.0000000000000002 ***
as.factor(x)9   185.246      9.160  20.223 &lt; 0.0000000000000002 ***
as.factor(x)10  218.477      4.718  46.305 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.481 on 40 degrees of freedom
Multiple R-squared:  0.9899,    Adjusted R-squared:  0.9876 
F-statistic: 434.1 on 9 and 40 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit reduced model</span></span>
<span><span class="co"># -&gt; polynomial model E(Y) + B0 + B1 X + B2 ln(X)</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + I(log(x)))

Residuals:
    Min      1Q  Median      3Q     Max 
-19.290  -7.101   0.161   5.859  24.809 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  -27.815      3.411  -8.154   0.0000000001501681 ***
x             39.764      1.493  26.634 &lt; 0.0000000000000002 ***
I(log(x))    -65.181      6.202 -10.510   0.0000000000000628 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.14 on 47 degrees of freedom
Multiple R-squared:  0.983, Adjusted R-squared:  0.9822 
F-statistic:  1356 on 2 and 47 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># perform lack of fit test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_full</span>, <span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ as.factor(x)
Model 2: y ~ x + I(log(x))
  Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)   
1     40 2876.8                               
2     47 4836.5 -7   -1959.7 3.8926 0.00254 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this matched when ran same scenario through manual process!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This shows significant lack of fit. So add in missing polynomial and retry.</p>
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot and add line (don't have a straight line anymore, so can't use abline())</span></span>
<span><span class="co"># -&gt; have to plot x vs y-hat, but sorted according to x</span></span>
<span><span class="co"># -&gt; NOTE both TRUE and FALSE for raw lead to SAME predictions, but DRASTISCALLY different estimates, perhaps because multicollinearity gives biased estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%$%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_hat</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%$%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_hat</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now the unrestriced and the reduced model are almost equivalent at all points.</p>
<div class="cell">
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit full model</span></span>
<span><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1 X + B2 ln(X)</span></span>
<span><span class="va">mod_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ as.factor(x))

Residuals:
    Min      1Q  Median      3Q     Max 
-16.366  -4.428   0.000   5.072  17.926 

Coefficients:
               Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)       8.152      3.462   2.354               0.0235 *  
as.factor(x)2     2.972      6.924   0.429               0.6701    
as.factor(x)3    22.301      4.718   4.727   0.0000281807336870 ***
as.factor(x)4    29.737      4.580   6.493   0.0000000959642153 ***
as.factor(x)5    55.992      4.896  11.436   0.0000000000000351 ***
as.factor(x)6    82.163      9.160   8.970   0.0000000000403176 ***
as.factor(x)7   103.263      6.924  14.913 &lt; 0.0000000000000002 ***
as.factor(x)8   141.486      4.379  32.307 &lt; 0.0000000000000002 ***
as.factor(x)9   185.246      9.160  20.223 &lt; 0.0000000000000002 ***
as.factor(x)10  218.477      4.718  46.305 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.481 on 40 degrees of freedom
Multiple R-squared:  0.9899,    Adjusted R-squared:  0.9876 
F-statistic: 434.1 on 9 and 40 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit reduced model</span></span>
<span><span class="co"># -&gt; polynomial model E(Y) + B0 + B1 X + B2 ln(X)</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ poly(x, 2, raw = TRUE) + I(log(x)))

Residuals:
     Min       1Q   Median       3Q      Max 
-20.5869  -5.8260  -0.0571   7.4095  16.9882 

Coefficients:
                        Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)               3.8511     7.4339   0.518     0.607    
poly(x, 2, raw = TRUE)1   2.2591     8.2266   0.275     0.785    
poly(x, 2, raw = TRUE)2   2.0766     0.4502   4.612 0.0000319 ***
I(log(x))                -2.8363    14.4765  -0.196     0.846    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.479 on 46 degrees of freedom
Multiple R-squared:  0.9883,    Adjusted R-squared:  0.9876 
F-statistic:  1301 on 3 and 46 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># perform lack of fit test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_full</span>, <span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ as.factor(x)
Model 2: y ~ poly(x, 2, raw = TRUE) + I(log(x))
  Res.Df    RSS Df Sum of Sq     F Pr(&gt;F)
1     40 2876.8                          
2     46 3307.0 -6   -430.22 0.997 0.4407</code></pre>
</div>
</div>
<p>This shows no lack of fit now!</p>
</div>
<div id="tabset-13-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<p>Testing:</p>
<p><span class="math display">\[
H_0: E(Y) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_{11} x_1^2 + \beta_{22} x_2^2 + \beta_{12} x_1 x_2\hspace{20pt} \text{Reduced model}\\
H_A: E(Y) \ne \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_{11} x_1^2 + \beta_{22} x_2^2 + \beta_{12} x_1 x_2\  \hspace{20pt} \text{Full model}
\]</span></p>
<p>Note that each <span class="math inline">\(X\)</span> variable is centered and scaled (to avoid multicollinearity of higher order terms): <span class="math inline">\(x_{i1} = X_{i1} - \bar{X_1}\)</span> and <span class="math inline">\(x_{i2} = X_{i2} - \bar{X_2}\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read in data (from table 8.1 on page 300 of textbook)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">150</span>,<span class="fl">86</span>,<span class="fl">49</span>,<span class="fl">288</span>,<span class="fl">157</span>,<span class="fl">131</span>,<span class="fl">184</span>,<span class="fl">109</span>,<span class="fl">279</span>,<span class="fl">235</span>,<span class="fl">224</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit full model</span></span>
<span><span class="co"># -&gt; E(Y) = mu_j = anything other than the reduced model</span></span>
<span><span class="co"># -&gt; note that x1*x2 denotes factor crossing = x1 + x2 + x1:x2</span></span>
<span><span class="va">mod_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ as.factor(x1) * as.factor(x2))

Residuals:
                     1                      2                      3 
  0.000000000000003116   0.000000000000001792  -0.000000000000002450 
                     4                      5                      6 
 -0.000000000000005551  -0.333333333333327431 -26.333333333333339255 
                     7                      8                      9 
 26.666666666666664298   0.000000000000005247   0.000000000000002271 
                    10                     11 
 -0.000000000000000173  -0.000000000000003009 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)                     150.00      26.50   5.660   0.0298 *
as.factor(x1)0                  -64.00      37.48  -1.708   0.2298  
as.factor(x1)1                 -101.00      37.48  -2.695   0.1145  
as.factor(x2)0                  138.00      37.48   3.682   0.0665 .
as.factor(x2)1                  129.00      37.48   3.442   0.0750 .
as.factor(x1)0:as.factor(x2)0   -66.67      48.39  -1.378   0.3022  
as.factor(x1)1:as.factor(x2)0   -78.00      53.00  -1.472   0.2790  
as.factor(x1)0:as.factor(x2)1    20.00      53.00   0.377   0.7422  
as.factor(x1)1:as.factor(x2)1    46.00      53.00   0.868   0.4770  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 26.5 on 2 degrees of freedom
Multiple R-squared:  0.9768,    Adjusted R-squared:  0.8841 
F-statistic: 10.54 on 8 and 2 DF,  p-value: 0.08953</code></pre>
</div>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit reduced model</span></span>
<span><span class="co"># -&gt; second order model</span></span>
<span><span class="co"># -&gt; can use I() because data is already transformed for multicollinearity</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">*</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + I(x1^2) + I(x2^2) + I(x1 * x2))

Residuals:
      1       2       3       4       5       6       7       8       9      10 
-21.465   9.263  12.202  41.930  -5.842 -31.842  21.158 -25.404 -20.465   7.263 
     11 
 13.202 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   162.84      16.61   9.805 0.000188 ***
x1            -55.83      13.22  -4.224 0.008292 ** 
x2             75.50      13.22   5.712 0.002297 ** 
I(x1^2)        27.39      20.34   1.347 0.235856    
I(x2^2)       -10.61      20.34  -0.521 0.624352    
I(x1 * x2)     11.50      16.19   0.710 0.509184    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.37 on 5 degrees of freedom
Multiple R-squared:  0.9135,    Adjusted R-squared:  0.8271 
F-statistic: 10.57 on 5 and 5 DF,  p-value: 0.01086</code></pre>
</div>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># perform lack of fit test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_full</span>, <span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ as.factor(x1) * as.factor(x2)
Model 2: y ~ x1 + x2 + I(x1^2) + I(x2^2) + I(x1 * x2)
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1      2 1404.7                           
2      5 5240.4 -3   -3835.8 1.8205 0.3738</code></pre>
</div>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this matched when ran same scenario through manual process!</span></span>
<span><span class="co"># -&gt; just had to group_by(x1, x2) for data_group_means and join_by("x1", "x2")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This shows that there is no lack of fit, so a higher order model isn’t needed.</p>
<p>Now we can do a partial <span class="math inline">\(F\)</span> test to determine if the second order terms are needed or if a first order model is sufficient.</p>
<p>Testing:</p>
<p><span class="math display">\[
H_0: \beta_{11} = \beta_{22} x_2^2 = \beta_{12} = 0\\
H_A: \text{Not all } \beta \text{s in } H_0\text{ equal } 0
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit new full model (second order)</span></span>
<span><span class="co"># -&gt; second order model</span></span>
<span><span class="va">mod_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">*</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + I(x1^2) + I(x2^2) + I(x1 * x2))

Residuals:
      1       2       3       4       5       6       7       8       9      10 
-21.465   9.263  12.202  41.930  -5.842 -31.842  21.158 -25.404 -20.465   7.263 
     11 
 13.202 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   162.84      16.61   9.805 0.000188 ***
x1            -55.83      13.22  -4.224 0.008292 ** 
x2             75.50      13.22   5.712 0.002297 ** 
I(x1^2)        27.39      20.34   1.347 0.235856    
I(x2^2)       -10.61      20.34  -0.521 0.624352    
I(x1 * x2)     11.50      16.19   0.710 0.509184    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.37 on 5 degrees of freedom
Multiple R-squared:  0.9135,    Adjusted R-squared:  0.8271 
F-statistic: 10.57 on 5 and 5 DF,  p-value: 0.01086</code></pre>
</div>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit new reduced model (first order)</span></span>
<span><span class="co"># -&gt; needs to be nested</span></span>
<span><span class="va">mod_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.000 -13.750  -7.167  10.167  60.167 

Coefficients:
            Estimate Std. Error t value     Pr(&gt;|t|)    
(Intercept)  172.000      9.354  18.387 0.0000000788 ***
x1           -55.833     12.666  -4.408     0.002262 ** 
x2            75.500     12.666   5.961     0.000338 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 31.02 on 8 degrees of freedom
Multiple R-squared:  0.8729,    Adjusted R-squared:  0.8412 
F-statistic: 27.48 on 2 and 8 DF,  p-value: 0.0002606</code></pre>
</div>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># perform partial F test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_full</span>, <span class="va">mod_reduced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ x1 + x2 + I(x1^2) + I(x2^2) + I(x1 * x2)
Model 2: y ~ x1 + x2
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1      5 5240.4                           
2      8 7700.3 -3   -2459.9 0.7823 0.5527</code></pre>
</div>
</div>
<p>This says that we can drop the higher order terms and a first order model is sufficient.</p>
</div>
</div>
</div>
</section></section><section id="overview-of-remedial-measures" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="overview-of-remedial-measures">
<span class="header-section-number">3.6</span> Overview of remedial measures</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Overview</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">More details on transformations</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<ul>
<li>
<p>If the normal error SLR model is not appropriate for a dataset, there are two basic choices, both of which have their advantages and disadvantages:</p>
<ol type="1">
<li>Abandon this model and develop and use a more appropriate model.</li>
</ol>
<ul>
<li><p>Pro → May lead to a more complex model that could yield better insights.</p></li>
<li><p>Con → May also lead to more complex procedures for estimating the parameters.</p></li>
</ul>
<ol start="2" type="1">
<li>Use some transformation on the data so that the normal error SLR model is appropriate for the transformed data.</li>
</ol>
<ul>
<li><p>Pro → Leads to relatively simple methods of estimation with smaller models (less parameters), which is desirable when the sample size is small.</p></li>
<li><p>Con → Transformations may obscure the fundamental interconnections between the variables, though at other times they may illuminate them.</p></li>
<li><p>Now we consider only transformations (will cover more complex models in later chapters).</p></li>
</ul>
</li>
</ul>
<p><img src="files/images/remedial-measures-summary.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p>Here is a more in depth discussion of when to use which transformation:</p>
<p>Nonlinearity of the regression function</p>
<ul>
<li>
<p>When the regression function is not linear, a direct approach is to modify the SLR regression model by altering the nature of the regression function (these methods will be discussed much later). For example,</p>
<ul>
<li><p>Quadratic regression function (this is an example of a polynomial regression function) → <span class="math inline">\(E(Y) = \beta_0 + \beta_1 X + \beta_2 X^2\)</span></p></li>
<li><p>Exponential regression function (another example of a nonlinear regression function) → <span class="math inline">\(E(Y) = \beta_0 \cdot \beta_1^X\)</span></p></li>
</ul>
</li>
<li><p>The transformation approach uses a transformation to linearize (at least approximately linearize) a nonlinear regression function.</p></li>
<li><p>When the nature of the regression function is unknown, exploratory analysis that does not require specifying a particular type of function is often useful (such as LOWESS regression).</p></li>
</ul>
<p>Nonconstancy of the error variance</p>
<ul>
<li><p>When the error variance is not constant but varies in a systematic fashion, a direct approach is to modify the model to allow for this and use the method of <em>weighted least squares</em> to obtain the estimators of the parameters.</p></li>
<li><p>Transformations can also be effective in stabilizing the variance, some will be shown shortly.</p></li>
</ul>
<p>Nonindependence of error terms</p>
<ul>
<li>When the error terms are correlated, the easiest method is to switch to a time series model.</li>
</ul>
<p>Nonnormality of error terms</p>
<ul>
<li><p>Lack of normality and nonconstant error variances occur together. Fortunately, it is often the case that the same transformation that helps stabilize the variance is also helpful in approximately normalizing the error terms.</p></li>
<li><p>This is why we should address the nonconstant variance (apply the appropriate stabilizing transformation), then do residual analysis to see if there are still serious departures from normality present.</p></li>
</ul>
<p>Omission of important predictor variables</p>
<ul>
<li>When residual analysis indicates that an important predictor variable has been omitted from the model, the solution is to modify the model with multiple regression (two or more predictor variables).</li>
</ul>
<p>Unusual observations</p>
<ul>
<li><p>When unusual observations are present (could be outliers, high-leverage points, or influential points) using LSE or MLE may lead to serious distortions in the estimated regression function.</p></li>
<li><p>When these unusual obesrvations are not data errors (and thus shouldn’t be thrown out), it may be desirable to use an estimation procedure that places less emphasis on them. One type of these models is discuss much later.</p></li>
</ul>
</div>
</div>
</div>
</section><section id="transformations" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="transformations">
<span class="header-section-number">3.7</span> Transformations</h2>
<ul>
<li><p>Now we will talk about the use of transformations on one or both of the original variables before carrying out the regression analysis.</p></li>
<li><p>Simple transformations of either the response variable <span class="math inline">\(Y\)</span> or the predictor variable <span class="math inline">\(X\)</span>, or of both, are often sufficient to make the SLR model appropriate for the transformed data.</p></li>
</ul>
<section id="transformations-for-nonlinear-relation-only" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="transformations-for-nonlinear-relation-only">
<span class="header-section-number">3.7.1</span> Transformations for nonlinear relation only</h3>
<p>Overview</p>
<ul>
<li><p>Goal → Linearize a nonlinear regression relation.</p></li>
<li><p>Use when → Distribution of error terms is reasonably close to a normal distribution AND have approximately constant variance.</p></li>
<li>
<p>Strategy → Transformations on <span class="math inline">\(X\)</span> should be attempted.</p>
<ul>
<li><p>Transformations on <span class="math inline">\(Y\)</span>, such as <span class="math inline">\(Y' = \sqrt{Y}\)</span>, may not be desirable here because they can materially change the shape of the distribution of the error terms from the normal distribution and may also lead to substantially differing error term variances.</p></li>
<li><p>e.g.) <span class="math inline">\(Y = \beta_0 + \beta_1 X + \epsilon\)</span>, where <span class="math inline">\(\epsilon \sim \text{Normal}\,\)</span> <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(\sqrt{Y} = \beta_0 + \beta_1 X + \text{new }\epsilon\)</span></p></li>
</ul>
</li>
</ul>
<p>Specific transformations</p>
<ul>
<li>
<p>Below are some prototype nonlinear regression relations with some simple transformations on <span class="math inline">\(X\)</span> that may be helpful for linearizing without affecting the distribution of <span class="math inline">\(Y\)</span>.</p>
<ul>
<li>
<p>Several transformations can be tried.</p>
<ul>
<li>Scatter plots and residual plots based on each should be made and analyzed to decide which transformation is most effective.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="files/images/transformations-nonlinear.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>
<p>At times, it may be helpful to introduce a constant into the transformation.</p>
<ul>
<li>e.g.&nbsp;If some of the <span class="math inline">\(X\)</span> data are near zero and the reciprocal transformation is desired, we can shift the origin by using the transformation <span class="math inline">\(X' = \frac{1}{X + k}\)</span>, where <span class="math inline">\(k\)</span> is an appropriately chosen constant.</li>
</ul>
</li>
</ul>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Increasing at decreasing rate</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Increasing at increasing rate</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false">Decreasing at decreasing rate</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-4" role="tab" aria-controls="tabset-15-4" aria-selected="false">Effect of constants and scalars</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<ul>
<li>
<p>Scatterplot of relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span></p>
<ul>
<li><p>Main issue → See curvilinear pattern (in this case <span class="math inline">\(Y\)</span> grows slower as <span class="math inline">\(X\)</span> increases). So standard SLR model not appropriate (note that in reality, we have no idea what type model this came from).</p></li>
<li><p>Roughly same variance in <span class="math inline">\(Y\)</span> as <span class="math inline">\(X\)</span> increases (imagining spread of observations relative to the smooth curve; the residual plot looks bad because of the lack of fit) and QQ plot looks decent enough → So only issue is the linearity, which means we want to transform <span class="math inline">\(X\)</span> based on the specific pattern.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-85-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-85-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Attempt two transformations chosen based on the observed pattern: 1a) <span class="math inline">\(X' = \log_{10}(X)\)</span> 1b) <span class="math inline">\(X' = \ln(X)\)</span> and 2) <span class="math inline">\(X' = \sqrt{X}\)</span>. Then view transformed scatterplots.</p>
<ul>
<li><p>All greatly improve the linear aspect of the regression. Note that <span class="math inline">\(\log_{10}(X)\)</span> and <span class="math inline">\(\ln(X)\)</span> have the same linearizing effect, obviously the scales are different for the results.</p></li>
<li><p>The variability of the scatter at the different <span class="math inline">\(X\)</span> levels is the same as before, since we did not make a transformation on <span class="math inline">\(Y\)</span>.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-86-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Look at diagnostics for fitted models based on transformed <span class="math inline">\(X\)</span>s.</p>
<ul>
<li>Residual plots are just fine now and normal QQ plots still look good.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit models on transformed X variables</span></span>
<span><span class="va">mod_log10_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_ln_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_sqrt_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_log10_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_ln_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_sqrt_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-5.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-87-6.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view model summaries (just the R^2)</span></span>
<span><span class="co"># -&gt; ln and log10 models give different coefficients, but SAME MSE and R^2, see last tab 'effect of scalars and constants' for why</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_log10_x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ log10(x))

Residuals:
     Min       1Q   Median       3Q      Max 
-0.94691 -0.14858 -0.00726  0.18588  0.51417 

Coefficients:
            Estimate Std. Error t value         Pr(&gt;|t|)    
(Intercept)   1.7006     0.1652   10.30 0.00000000005028 ***
log10(x)      2.3615     0.1829   12.91 0.00000000000026 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2991 on 28 degrees of freedom
Multiple R-squared:  0.8562,    Adjusted R-squared:  0.8511 
F-statistic: 166.7 on 1 and 28 DF,  p-value: 0.0000000000002598</code></pre>
</div>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_ln_x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ log(x))

Residuals:
     Min       1Q   Median       3Q      Max 
-0.94691 -0.14858 -0.00726  0.18588  0.51417 

Coefficients:
            Estimate Std. Error t value         Pr(&gt;|t|)    
(Intercept)  1.70061    0.16516   10.30 0.00000000005028 ***
log(x)       1.02557    0.07943   12.91 0.00000000000026 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2991 on 28 degrees of freedom
Multiple R-squared:  0.8562,    Adjusted R-squared:  0.8511 
F-statistic: 166.7 on 1 and 28 DF,  p-value: 0.0000000000002598</code></pre>
</div>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_sqrt_x</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8727202</code></pre>
</div>
</div>
<ul>
<li>Compare these the models <span class="math inline">\(R^2\)</span> to the original untransformed: 0.85</li>
</ul>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<ul>
<li>
<p>Scatterplot of relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span></p>
<ul>
<li><p>See curvilinear pattern (in this case <span class="math inline">\(Y\)</span> grows faster as <span class="math inline">\(X\)</span> increases) <span class="math inline">\(\Longrightarrow\)</span> SLR model not appropriate.</p></li>
<li><p>Constant variance through smooth curve and okay QQ plot <span class="math inline">\(\Longrightarrow\)</span> Try <span class="math inline">\(X\)</span> transformation to straighten out <span class="math inline">\(Y\)</span>.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-89-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-89-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Attempt two transformations chosen based on the observed pattern: 1) <span class="math inline">\(X' = X^2\)</span> and 2) <span class="math inline">\(X' = \mathrm{e}^X\)</span>.</p>
<ul>
<li>Both seem to improve the linearity, although not perfectly.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-90-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Look at diagnostics for fitted models based on transformed <span class="math inline">\(X\)</span>s.</p>
<ul>
<li>Still a bit of curvature in the residual plot, but normal QQ plots still look good.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit models on transformed X variables</span></span>
<span><span class="va">mod_squared_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_exp_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_squared_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-91-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_exp_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-91-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-91-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view model summaries (just the R^2)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_squared_x</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8071781</code></pre>
</div>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_exp_x</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8116208</code></pre>
</div>
</div>
<ul>
<li>Compare these the models <span class="math inline">\(R^2\)</span> to the original untransformed: 0.731</li>
</ul>
</div>
<div id="tabset-15-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<ul>
<li>
<p>Scatterplot of relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span></p>
<ul>
<li><p>See curvilinear pattern (in this case <span class="math inline">\(Y\)</span> decreases slower as <span class="math inline">\(X\)</span> increases) <span class="math inline">\(\Longrightarrow\)</span> SLR again model not appropriate.</p></li>
<li><p>Still constant variance and approximately normal residuals, <span class="math inline">\(\Longrightarrow\)</span> Just transform <span class="math inline">\(X\)</span>.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-93-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-93-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Attempt two transformations chosen based on the observed pattern: 1a) <span class="math inline">\(X' = 1 / X\)</span> 1b) <span class="math inline">\(X' = 1 / (X + k)\)</span> and 2) <span class="math inline">\(X' = \mathrm{e}^{-X}\)</span>.</p>
<ul>
<li><p><span class="math inline">\(1 / X\)</span> does not result in a linear relationship, so no need to continue with that. However all <span class="math inline">\(X\)</span> values are in between 0 and 1, so we can try to introduce a constant to move data away from origin, say <span class="math inline">\(X' = 1 / (1 + X)\)</span>. This works better. <span class="math inline">\(\mathrm{e}^{-X}\)</span> seems to helps as well.</p></li>
<li><p>Note that both transformations are decreasing, which means the association between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X'\)</span> gets flipped and is now increasing.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-94-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-94-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Look at diagnostics for fitted models based on transformed <span class="math inline">\(X\)</span>s.</p>
<ul>
<li>Still a bit of curvature in the residual plot, but normal QQ plots still look good.</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit models on transformed X variables</span></span>
<span><span class="va">mod_reciprocal_x_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_exp_neg_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_reciprocal_x_k</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-95-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_exp_neg_x</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-95-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-95-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view model summaries (just the R^2)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_reciprocal_x_k</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8103082</code></pre>
</div>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_exp_neg_x</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.785654</code></pre>
</div>
</div>
<ul>
<li>Compare these the models <span class="math inline">\(R^2\)</span> to the original untransformed: 0.729</li>
</ul>
</div>
<div id="tabset-15-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-4-tab">
<p>Quick demo of introducing constants to one or both sides of regression equation (so to the sample essentially) to see how impact results</p>
<p>Results</p>
<ul>
<li>
<p>Coefficients</p>
<ul>
<li><p>Adding constants (all combos <span class="math inline">\(X + k\)</span>, <span class="math inline">\(Y + k\)</span> and both) → Changes intercept, doesn’t affect slope.</p></li>
<li><p>Multiplying by scalar → <span class="math inline">\(k \cdot X\)</span> doesn’t affect intercept, but does affect slope; <span class="math inline">\(k \cdot Y\)</span> does affect intercept and slope; Both <span class="math inline">\(k \cdot X\)</span> and <span class="math inline">\(k \cdot Y\)</span> have same intercept as only <span class="math inline">\(k \cdot Y\)</span> (because <span class="math inline">\(k \cdot X\)</span> doesn’t affect it), but the same slope as the original <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> (in essence cancelling each others’ effect).</p></li>
</ul>
</li>
<li>
<p><span class="math inline">\(R^2\)</span> and <span class="math inline">\(F\)</span>-stat</p>
<ul>
<li>All models have the same.</li>
</ul>
</li>
<li>
<p><span class="math inline">\(MSE\)</span> and likelihood-related statistics (<span class="math inline">\(loglik\)</span>, <span class="math inline">\(AIC\)</span>, <span class="math inline">\(BIC\)</span>)</p>
<ul>
<li>Only <span class="math inline">\(k \cdot Y\)</span> models have different <span class="math inline">\(MSE\)</span> (larger because <span class="math inline">\(Y\)</span> values are stretched with <span class="math inline">\(\lvert k \rvert &gt; 1\)</span>) and likelihood-related statistics (optimizing a function of <span class="math inline">\(Y\)</span>).</li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-97-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;"> call </th>
   <th style="text-align:right;"> b0 </th>
   <th style="text-align:right;"> se(b0) </th>
   <th style="text-align:right;"> b1 </th>
   <th style="text-align:right;"> se(b1) </th>
   <th style="text-align:right;"> r.squared </th>
   <th style="text-align:right;"> adj.r.squared </th>
   <th style="text-align:right;"> sigma </th>
   <th style="text-align:right;"> statistic </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> logLik </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> lm = y ~ x </td>
   <td style="text-align:right;"> -0.770 </td>
   <td style="text-align:right;"> 1.346 </td>
   <td style="text-align:right;"> 2.179 </td>
   <td style="text-align:right;"> 0.135 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 3.084 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -75.317 </td>
   <td style="text-align:right;"> 156.635 </td>
   <td style="text-align:right;"> 160.838 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = y ~ I(x + k1) </td>
   <td style="text-align:right;"> -7.307 </td>
   <td style="text-align:right;"> 1.722 </td>
   <td style="text-align:right;"> 2.179 </td>
   <td style="text-align:right;"> 0.135 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 3.084 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -75.317 </td>
   <td style="text-align:right;"> 156.635 </td>
   <td style="text-align:right;"> 160.838 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = I(y + k1) ~ x </td>
   <td style="text-align:right;"> 2.230 </td>
   <td style="text-align:right;"> 1.346 </td>
   <td style="text-align:right;"> 2.179 </td>
   <td style="text-align:right;"> 0.135 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 3.084 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -75.317 </td>
   <td style="text-align:right;"> 156.635 </td>
   <td style="text-align:right;"> 160.838 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = I(y + k1) ~ I(x + k1) </td>
   <td style="text-align:right;"> -4.307 </td>
   <td style="text-align:right;"> 1.722 </td>
   <td style="text-align:right;"> 2.179 </td>
   <td style="text-align:right;"> 0.135 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 3.084 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -75.317 </td>
   <td style="text-align:right;"> 156.635 </td>
   <td style="text-align:right;"> 160.838 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = y ~ I(k2 * x) </td>
   <td style="text-align:right;"> -0.770 </td>
   <td style="text-align:right;"> 1.346 </td>
   <td style="text-align:right;"> 1.090 </td>
   <td style="text-align:right;"> 0.067 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 3.084 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -75.317 </td>
   <td style="text-align:right;"> 156.635 </td>
   <td style="text-align:right;"> 160.838 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = I(k2 * y) ~ x </td>
   <td style="text-align:right;"> -1.539 </td>
   <td style="text-align:right;"> 2.691 </td>
   <td style="text-align:right;"> 4.358 </td>
   <td style="text-align:right;"> 0.270 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 6.167 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -96.112 </td>
   <td style="text-align:right;"> 198.223 </td>
   <td style="text-align:right;"> 202.427 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = I(k2 * y) ~ I(k2 * x) </td>
   <td style="text-align:right;"> -1.539 </td>
   <td style="text-align:right;"> 2.691 </td>
   <td style="text-align:right;"> 2.179 </td>
   <td style="text-align:right;"> 0.135 </td>
   <td style="text-align:right;"> 0.903 </td>
   <td style="text-align:right;"> 0.900 </td>
   <td style="text-align:right;"> 6.167 </td>
   <td style="text-align:right;"> 260.690 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -96.112 </td>
   <td style="text-align:right;"> 198.223 </td>
   <td style="text-align:right;"> 202.427 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = y ~ log(x) </td>
   <td style="text-align:right;"> -2.260 </td>
   <td style="text-align:right;"> 2.685 </td>
   <td style="text-align:right;"> 10.562 </td>
   <td style="text-align:right;"> 1.248 </td>
   <td style="text-align:right;"> 0.719 </td>
   <td style="text-align:right;"> 0.709 </td>
   <td style="text-align:right;"> 5.250 </td>
   <td style="text-align:right;"> 71.598 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -91.281 </td>
   <td style="text-align:right;"> 188.561 </td>
   <td style="text-align:right;"> 192.765 </td>
  </tr>
<tr>
<td style="text-align:left;"> lm = y ~ log10(x) </td>
   <td style="text-align:right;"> -2.260 </td>
   <td style="text-align:right;"> 2.685 </td>
   <td style="text-align:right;"> 24.320 </td>
   <td style="text-align:right;"> 2.874 </td>
   <td style="text-align:right;"> 0.719 </td>
   <td style="text-align:right;"> 0.709 </td>
   <td style="text-align:right;"> 5.250 </td>
   <td style="text-align:right;"> 71.598 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> -91.281 </td>
   <td style="text-align:right;"> 188.561 </td>
   <td style="text-align:right;"> 192.765 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p><span class="math inline">\(log_{10}(X)\)</span> and <span class="math inline">\(\ln(X)\)</span></p>
<ul>
<li>These equate to the models <span class="math inline">\(y \sim \ln(X)\)</span> and <span class="math inline">\(y \sim k \cdot log_{10}(X)\)</span>, so we can switch between the two and these results show why these two transformations are essentially equivalent. Only the slopes of the resulting models differ, every other model summary is the same.</li>
</ul>
<p><img src="files/images/transformations-log10-vs-ln.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</div>
</section><section id="transformations-for-nonnormality-and-unequal-error-variances" class="level3" data-number="3.7.2"><h3 data-number="3.7.2" class="anchored" data-anchor-id="transformations-for-nonnormality-and-unequal-error-variances">
<span class="header-section-number">3.7.2</span> Transformations for Nonnormality and Unequal Error Variances</h3>
<p>Overview</p>
<ul>
<li><p>Unequal error variances and nonnormality of the error terms frequently appear together.</p></li>
<li>
<p>Often, these two departures show up as increasing skewness and increasing variability of the distributions of the error terms as the mean response <span class="math inline">\(E(Y)\)</span> increases.</p>
<ul>
<li>e.g.&nbsp;Regression on yearly household expenditures on vacation versus household income. There will tend to be more variation and greater positive skewness (i.e.&nbsp;some very high yearly vacation expenditures) for high-income households than for low-income households, who tend to consistently spend much less for vacations.</li>
</ul>
</li>
<li><p>Goal → Fix nonnormality and nonconstant variance of regression relation.</p></li>
<li>
<p>Strategy → We need a transformation on <span class="math inline">\(Y\)</span> because the shapes and spreads of the distributions of <span class="math inline">\(Y\)</span> need to be changed.</p>
<ul>
<li><p>A transformation like this may also help to linearize a curvilinear regression relation.</p></li>
<li><p>Other times, a simultaneous transformation on <span class="math inline">\(X\)</span> may be needed to obtain or maintain a linear regression relation.</p></li>
</ul>
</li>
</ul>
<p>Specific transformations</p>
<ul>
<li>
<p>Below are some prototype regression relations with some simple transformations on <span class="math inline">\(Y\)</span> that may be helpful for fixing non normality and unequal variances of the error distributions.</p>
<ul>
<li><p>Several alternative transformations on <span class="math inline">\(Y\)</span> may be tried, as well as some simultaneous transformations on <span class="math inline">\(X\)</span>.</p></li>
<li><p>Again, scatter plots and residual plots should be made to determine the most effective transformation(s).</p></li>
</ul>
</li>
</ul>
<p><img src="files/images/transformations-nonnormal-and-nonconstant-var.png" class="img-fluid" style="width:50.0%"></p>
<ul>
<li>Same as with the reciprocal transformation <span class="math inline">\(X' = \frac{1}{X + k}\)</span>, we can consider use of constant values to validate the transformation function. e.g.&nbsp;If <span class="math inline">\(Y\)</span> is negative, we can shift the origin for the log transformation <span class="math inline">\(Y' = \ln(Y + k)\)</span> so all <span class="math inline">\(Y + k &gt; 0\)</span> for all <span class="math inline">\(Y\)</span>.</li>
</ul>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Increasing linear trend, with increasing variance</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>
<p>Scatterplot of relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span></p>
<ul>
<li><p>Main issue → Because of the nonconstant variance, this leads us to think that there is issues with the error variance, perhaps also the structure of the model (but impossible to verify this totally). No serious departures from normality. Slight curvilinear pattern, but could be just because of the random non-constant variance</p></li>
<li><p>Before attempting transformations to linearize (working on <span class="math inline">\(X\)</span>) or nonlinear regression, we should transform <span class="math inline">\(Y\)</span> based on this pattern. This transformation may help to linearize and improve the normality as well (even though not of concern). If still not good, can try transformation on <span class="math inline">\(X\)</span> in conjunction.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-100-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Attempt transformations chosen based on the observed pattern: <span class="math inline">\(Y' = \frac{1}{Y}\)</span>. Then view transformed scatterplot.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-101-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-101-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Now the non-constant variance appears to be fixed, but there is a curvi-linear relationship now. So we can try to transform <span class="math inline">\(X\)</span> at the same time according to the prototype pattern.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view scatterplot, regression line and diagnostic plots for potential transformations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">"Transformation = 1/Y and 1/X"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-102-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-102-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This introduces some other issues, so perhaps another method such as weighted least squares would be more appropriate.</li>
</ul>
</div>
</div>
</div>
</section><section id="sec-box-cox" class="level3" data-number="3.7.3"><h3 data-number="3.7.3" class="anchored" data-anchor-id="sec-box-cox">
<span class="header-section-number">3.7.3</span> Box-Cox transformations</h3>
<p>Motivation:</p>
<ul>
<li><p>It is often difficult to determine from diagnostic plots which transformation of <span class="math inline">\(Y\)</span> is most appropriate for correcting skewness of the distributions of error terms, unequal error variances, and nonlinearity of the regression function.</p></li>
<li><p>The Box-Cox procedure automatically identifies a transformation from the family of power transformations on <span class="math inline">\(Y\)</span>.</p></li>
</ul>
<p>Power transformations have the form:</p>
<p><span class="math display">\[
Y' = Y^\lambda,
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is a parameter to be determined from the data.</p>
<p>This family encompasses the following simple transformations:</p>
<p><img src="files/images/box-cox-lambda.png" class="img-fluid" style="width:50.0%"></p>
<p>The normal error regression model with the response variable a member of the family of transformations becomes:</p>
<p><span class="math display">\[
Y^\lambda = \beta_0 + \beta_1 X_i + \epsilon_i
\]</span></p>
<ul>
<li><p>This includes an additional parameter <span class="math inline">\(\lambda\)</span> that needs to be estimated.</p></li>
<li><p>The Box-Cox procedure uses the method of maximum likelihood to estimate <span class="math inline">\(\lambda\)</span>, as well as the other parameters <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma^2\)</span>.</p></li>
<li><p>In this way, the Box-Cox procedure identifies <span class="math inline">\(\hat{\lambda}\)</span>, the maximum likelihood estimate of <span class="math inline">\(\lambda\)</span> to use in the power transformation.</p></li>
</ul>
<p>Demo</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R functions</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Manual</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false">Results</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># use same setup as linearly increasing trend with increasing variance</span></span>
<span></span>
<span><span class="co">## initialize items</span></span>
<span><span class="co"># -&gt; sample size, population parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span>; <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># generate X values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate error terms</span></span>
<span><span class="co"># -&gt; uniform errors that can increase with x</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate observations Y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span></span>
<span><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, main <span class="op">=</span> <span class="st">"Nonnormal errors with increasing variance \n ~ Increasing to with linear trend"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By observation of the prototype pattern and the results, we tried the model <span class="math inline">\(1/Y \sim 1/X\)</span> to some success. Let’s see what the Box-Cox procedure recommends.</p>
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run boxcox procedure</span></span>
<span><span class="co"># -&gt; plot MLE of lambda</span></span>
<span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/boxcox.html">boxcox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract lambda</span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/boxcox.html">boxcox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bc</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">bc</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5050505</code></pre>
</div>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run boxcox procedure</span></span>
<span><span class="co"># -&gt; plot of SSE</span></span>
<span><span class="fu">ALSM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ALSM/man/9_boxcox.sse.html">boxcox.sse</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="co"># to shorten output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-104-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   lambda       SSE
1    -1.0 36633.253
2    -0.9 26932.446
3    -0.8 19895.789
4    -0.7 14772.781
5    -0.6 11030.558
6    -0.5  8289.406
7    -0.4  6277.752
8    -0.3  4800.659
9    -0.2  3717.704
10   -0.1  2927.397
21    0.0  2356.174
11    0.1  1950.597
12    0.2  1671.807
13    0.3  1491.566
14    0.4  1389.434
15    0.5  1350.734
16    0.6  1365.103
17    0.7  1425.443
18    0.8  1527.172
19    0.9  1667.692
20    1.0  1846.015</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p>Can use standard regression procedures to obtain a <span class="math inline">\(\hat{lambda}\)</span> when software doesn’t automatically provide it. This procedure involves a numerical search in a range of potential <span class="math inline">\(\lambda\)</span> values such as <span class="math inline">\(\lambda = -2, -1.75, ..., 1.75, 2\)</span>. For each <span class="math inline">\(\lambda\)</span> value:</p>
<ol type="1">
<li>
<span class="math inline">\(Y_i^\lambda\)</span> observations are first standardized so that the magnitude of the error sum of squares does not depend on the value of <span class="math inline">\(\lambda\)</span>:</li>
</ol>
<p><span class="math display">\[
W_i = \left\{
  \begin{array}{ll}
     K_1 (Y_i^\lambda - 1) &amp; \lambda \ne 0\\
     K_2 \ln(Y_i) &amp; \lambda = 0\\
  \end{array}
\right.
\]</span></p>
<ul>
<li>where <span class="math inline">\(K_2 = \big(\prod_{i = 1}^{n}Y_i \big)^{1/n}\)</span> and <span class="math inline">\(K_1 = \frac{1}{\lambda K_2^{\lambda -1}}\)</span> (note that <span class="math inline">\(K_2\)</span> is the geometric mean of the <span class="math inline">\(Y_i\)</span> observations).</li>
</ul>
<ol start="2" type="1">
<li>Once the standardized observations <span class="math inline">\(W_i\)</span> have been obtained for a given <span class="math inline">\(\lambda\)</span> value, they are regressed on the predictor variable <span class="math inline">\(X\)</span> and the error sum of squares <span class="math inline">\(SSE\)</span> is obtained.</li>
</ol>
<ul>
<li><p>It can be shown that the maximum likelihood estimate <span class="math inline">\(\hat{\lambda}\)</span> is that value of <span class="math inline">\(\lambda\)</span> for which <span class="math inline">\(SSE\)</span> is a minimum.</p></li>
<li><p>If desired, a finer search can be conducted in the neighborhood of the <span class="math inline">\(\lambda\)</span> value that minimizes <span class="math inline">\(SSE\)</span>. However, the Box-Cox procedure ordinarily is used only to provide a guidefor selecting a transformation, so overly precise results are not needed.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define set of lambdas</span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># standardize repsonses</span></span>
<span><span class="va">box_cox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span>, <span class="va">lambda</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># define constants</span></span>
<span>  <span class="va">K_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">K_1</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="va">K_2</span><span class="op">^</span><span class="op">(</span><span class="va">lambda</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># standardize y observations</span></span>
<span>  <span class="va">W</span> <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">lambda</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">K_2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">K_1</span> <span class="op">*</span> <span class="va">y</span><span class="op">^</span><span class="va">lambda</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># regress W on X and get sse</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">W</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># calculate sse for each lambda value</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="va">lambdas</span> <span class="op">%&gt;%</span> <span class="fu">map_dbl</span><span class="op">(</span>\<span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu">box_cox</span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span>, lambda <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plt results and get minimum lambda</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambdas</span>, y <span class="op">=</span> <span class="va">sse</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">sse</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">lambdas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">sse</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lambdas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">sse</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.52</code></pre>
</div>
</div>
</div>
<div id="tabset-17-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<p>Both the R functions and the manual search suggest <span class="math inline">\(\hat{\lambda} = 0.5\)</span> <span class="math inline">\(\longrightarrow\)</span> <span class="math inline">\(Y' = \sqrt{Y}\)</span>. Lets fit the new model and view the diagnostic plots.</p>
<div class="cell">
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view scatterplot, regression line and diagnostic plots of transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Transformation = sqrt(Y)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-106-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-106-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Could now try other remedial measures. But there seems to be issues beyond what a simple transformation can fix. Other methods should be used for this particular example.</p>
</div>
</div>
</div>
<p>In practice:</p>
<ul>
<li><p>When the Box-Cox procedure leads to a <span class="math inline">\(\lambda\)</span> value near 1, no transformation of <span class="math inline">\(Y\)</span> may be needed.</p></li>
<li>
<p>It is reasonable to choose a nearby <span class="math inline">\(\lambda\)</span> value (e.g.&nbsp;can use <span class="math inline">\(\hat{\lambda} = -0.5\)</span> instead of <span class="math inline">\(\hat{\lambda} = -0.79\)</span>).</p>
<ul>
<li><p>This can make it easier to understand without sacrificing much in terms of the effectiveness of the transformation.</p></li>
<li><p>When choosing a more intuitive <span class="math inline">\(\hat{\lambda}\)</span>, we can look flatness of the likelihood function near the maximum or at the confidence interval for <span class="math inline">\(\lambda\)</span>.</p></li>
<li><p>This works because the <span class="math inline">\(SSE\)</span> is often fairly stable in the neighborhood of the estimate.</p></li>
</ul>
</li>
<li><p>After a transformation has been tentatively selected, residual plots and other analyses described earlier need to be employed to ascertain that the simple linear regression model is appropriate for the transformed data.</p></li>
</ul></section></section><section id="using-the-transformed-model" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="using-the-transformed-model">
<span class="header-section-number">3.8</span> Using the transformed model</h2>
<section id="overview-1" class="level3" data-number="3.8.1"><h3 data-number="3.8.1" class="anchored" data-anchor-id="overview-1">
<span class="header-section-number">3.8.1</span> Overview</h3>
<p>When implementing a transformation, interpretations of the results have now changed.</p>
<p>Regression coefficients:</p>
<ul>
<li>
<p>The estimators <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> obtained by least squares have the least squares properties with respect to the transformed observations, not the original ones.</p>
<ul>
<li>i.e.&nbsp;Estimated coefficients need to be interpreted with respect to the transformed scales.</li>
</ul>
</li>
<li><p>There is no straightforward way to ‘untransform’ the coefficients to values that can be interpreted on the original scales.</p></li>
<li><p>We cannot directly compare regression coefficients between models where the response variable transformation is different.</p></li>
</ul>
<p>Estimation and prediction:</p>
<ul>
<li>
<p>Even if we transform the response, we still want to express model estimates and predictions back in the original scale.</p>
<ul>
<li><p>This is simply a matter of ‘back transforming’ by using the inverse function of the transformation.</p></li>
<li><p>This is very helpful for communicating results to the public.</p></li>
</ul>
</li>
</ul></section><section id="interpreting-confidence-limits" class="level3" data-number="3.8.2"><h3 data-number="3.8.2" class="anchored" data-anchor-id="interpreting-confidence-limits">
<span class="header-section-number">3.8.2</span> Interpreting confidence limits</h3>
<p>In general, let <span class="math inline">\(Y' = f(Y)\)</span> and let <span class="math inline">\(f'\)</span> be the <strong>back-transformation</strong> (inverse) function.</p>
<ul>
<li>For example, if <span class="math inline">\(Y' = f(Y) = Y^2)\)</span> <span class="math inline">\(\longrightarrow\)</span> <span class="math inline">\(f'(Y') = Y\)</span>, so <span class="math inline">\(f'(Y') = \sqrt{Y^2} = Y\)</span>.</li>
</ul>
<p>Then, back transform the mean and single response confidence interval <span class="math inline">\((a, b)\)</span> as following: <span class="math inline">\((f'(a), f'(b))\)</span>. For example: <span class="math inline">\((\sqrt{a}, \sqrt{b})\)</span>.</p>
<p>Back transforming the coefficients or the standard error is not as straightforward.</p>
<ul>
<li><p>DO NOT DO: <span class="math inline">\(\hat{Y} = f'(b_0) + f'(b_1)X = \sqrt{b_0} + \sqrt{b_1}X\)</span>.</p></li>
<li><p>Have to do: <span class="math inline">\(\hat{Y} = f'(\hat{Y'}) = \sqrt{b_0 + b_1X}\)</span>.</p></li>
</ul>
<p>If only <span class="math inline">\(X\)</span> is transformed to <span class="math inline">\(X'\)</span>, then ne need to back transform the <span class="math inline">\(Y's\)</span> estimation because <span class="math inline">\(Y\)</span> hasn’t been transformed. For example: <span class="math inline">\(\hat{Y} = b_0 + b_1 X'\)</span>.</p>
<p>Demo</p>
<ul>
<li>Original data and model (with assumption violations)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot data with model</span></span>
<span><span class="va">plasma</span> <span class="op">&lt;-</span> <span class="fu">ALSM</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ALSM/man/Plasma.html">Plasma</a></span> </span>
<span><span class="va">mod_plasma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plasma</span><span class="op">)</span></span>
<span><span class="va">plasma</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># diagnostic plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_plasma</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-107-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-107-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Inference with bad model</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot data with model</span></span>
<span><span class="va">plasma</span> <span class="op">&lt;-</span> <span class="fu">ALSM</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ALSM/man/Plasma.html">Plasma</a></span> </span>
<span><span class="va">mod_plasma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plasma</span><span class="op">)</span></span>
<span><span class="va">plasma</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># diagnostic plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_plasma</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-108-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-108-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset of both pointwise confidence and prediction limits</span></span>
<span><span class="va">x_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">confs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"conf"</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, type <span class="op">=</span> <span class="st">"p"</span>, main <span class="op">=</span> <span class="st">"Inference on bad model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">preds</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">preds</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Fix model</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run boxcox and extract lambda</span></span>
<span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/boxcox.html">boxcox</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/boxcox.html">boxcox</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-110-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bc</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">bc</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5050505</code></pre>
</div>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit transformed model -&gt; Y' = 1 / sqrt(Y)</span></span>
<span><span class="va">mod_plasma_prime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plasma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot model and diagnostic plots</span></span>
<span><span class="va">plasma</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Transformed model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-110-2.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-110-3.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-110-4.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Now the working model is $ = $ 0.27 <span class="math inline">\(+\)</span> 0.04 <span class="math inline">\(X\)</span> (remember coefficients are in terms of new <span class="math inline">\(Y'\)</span> scale).</p></li>
<li><p>Bands before back transformation</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset of both pointwise confidence and prediction limits of transformed model</span></span>
<span><span class="va">x_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">confs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"conf"</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"p"</span>, main <span class="op">=</span> <span class="st">"Inference on transformed model (before back transformation)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">confs</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">preds</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">preds</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Now we can back transform <span class="math inline">\(Y' = \frac{1}{\sqrt{Y}}\)</span> <span class="math inline">\(\Longrightarrow\)</span> <span class="math inline">\(f'(Y') = (Y^{-1/2})^{-2} = (Y')^{-2} = Y\)</span>.</p></li>
<li>
<p>Bands after back transformation</p>
<ul>
<li><p>The predicted values should be <span class="math inline">\(\hat{Y} = (\hat{Y'})^{-2}\)</span></p></li>
<li><p>The confidence interval for the prediction, with for the mean or single response, should also be back transformed with <span class="math inline">\((value)^{-2}\)</span>.</p></li>
</ul>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset of both pointwise confidence and prediction limits of back transformed model</span></span>
<span><span class="va">x_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">confs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"conf"</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, type <span class="op">=</span> <span class="st">"p"</span>, main <span class="op">=</span> <span class="st">"Inference on transformed model AFTER back transformation"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">confs</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">confs</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">confs</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">preds</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">preds</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="summary-of-remedial-measures" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="summary-of-remedial-measures">
<span class="header-section-number">3.9</span> Summary of remedial measures</h2>
<ul>
<li>
<p>For nonlinear functional relationships with well behaved residuals:</p>
<ul>
<li><p>Try transforming <span class="math inline">\(X\)</span></p></li>
<li><p>May require a polynomial or piecewise fit</p></li>
</ul>
</li>
<li>
<p>For non-constant or non-normal error variance, possible with a nonlinear functional form</p>
<ul>
<li><p>Try transforming <span class="math inline">\(Y\)</span></p></li>
<li><p>The Box-Cox procedure may be helpful</p></li>
<li><p>If the transformation on <span class="math inline">\(Y\)</span> doesn’t fix the non-constant variance problem, weighted least squares can be used</p></li>
</ul>
</li>
<li><p>Transformations of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can be used together.</p></li>
<li>
<p>Any time you consider a transformation</p>
<p>– Remember to recheck all the diagnostics.</p>
<p>– Consider whether you gain enough to justify losing interpretability.</p>
<p>– Reciprocal transformations make interpretation especially hard.</p>
<p>– Consider back-transforming the results of the final model for presentation.</p>
</li>
<li><p>For very non-normal errors, especially those arising from discrete responses, generalized linear models are often a better option, but linear regression may be “good enough”.</p></li>
</ul>
<p><img src="files/images/transformation-map.png" class="img-fluid" style="width:80.0%"></p>
</section><section id="exploration-of-shape-regression-function" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="exploration-of-shape-regression-function">
<span class="header-section-number">3.10</span> Exploration of shape regression function</h2>
<p>Motivation</p>
<ul>
<li><p>Scatter plots often indicate readily the nature of the regression function. But at other times however, the scatter plot is complex and it becomes difficult to see the nature of the regression relationship, if any, from the plot. In these cases, it is helpful to explore the nature of the regression relationship by fitting a smoothed curve without any constraints on the regression function.</p></li>
<li><p>These smoothed curves are also called <em>nonparametric regression curves</em>. They are useful not only for exploring regression relationships but also for confirming the nature of the regression function.</p></li>
<li><p>There are lots of methods for time series, such as <em>moving averages</em> (or the same thing but with medians to reduce the influence of outlying observations). But these methods are for when the <span class="math inline">\(X\)</span> values (time points) are equally spaced out.</p></li>
<li><p>There are also many smoothing methods for regression data, with a main one being lowess method.</p></li>
</ul>
<section id="lowess-method" class="level3" data-number="3.10.1"><h3 data-number="3.10.1" class="anchored" data-anchor-id="lowess-method">
<span class="header-section-number">3.10.1</span> Lowess method</h3>
<p>Overview</p>
<ul>
<li>The <em>lowess method (locally weighted regression scatter plot smoothing)</em> obtains a smoothed curve by fitting successive linear regression functions in local neighborhoods and taking the fitted value at that particular <span class="math inline">\(X\)</span> as the smoothed value.</li>
</ul>
<p>Procedure</p>
<ul>
<li>The lowess method uses a number of refinements in obtaining the final smoothed values to improve the smoothing and to make the procedure robust to outlying observations.</li>
</ul>
<ol type="1">
<li><p>The linear regression is weighted to give cases further from the middle <span class="math inline">\(X\)</span> level in each neighborhood smaller weights.</p></li>
<li><p>To make the procedure robust to outlying observations, the linear regression fitting is repeated, with the weights revised so that cases that had large residuals in the first fitting receive smaller weights in the second fitting.</p></li>
<li><p>To improve the robustness of the procedure further, step 2 is repeated one or more times by revising the weights according to the size of the residuals in the latest fitting.</p></li>
</ol>
<ul>
<li>
<p>To implement the lowess procedure, one must choose (→ in practice):</p>
<ul>
<li><p>The size of the successive neighborhoods to be used when fitting each linear regression → This is the primary choice.</p></li>
<li><p>The weight function that gives less weight to neighborhood cases with <span class="math inline">\(X\)</span> values far from each center <span class="math inline">\(X\)</span> level → Default weight functios suggested by the creator are adequate for many circumstances.</p></li>
<li><p>Another weight function that gives less weight to cases with large residuals → Default.</p></li>
<li><p>The number of iterations to make the procedure robust must be chosen → Two iterations appears to be sufficient.</p></li>
</ul>
</li>
<li>
<p>Choosing the neighborhood size</p>
<ul>
<li><p>The larger the size, the smoother the function but the greater the danger that the smoothing will lose essential features of the regression relationship.</p></li>
<li><p>It may require some experimentation with different neighborhood sizes in order to find the size that best brings out the regression relationship.</p></li>
</ul>
</li>
</ul>
<p>Demo</p>
<div class="cell">
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get dataset</span></span>
<span><span class="va">plasma</span> <span class="op">&lt;-</span> <span class="fu">ALSM</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ALSM/man/Plasma.html">Plasma</a></span></span>
<span></span>
<span><span class="co"># plot dataset with lowess smoother</span></span>
<span><span class="co"># arguments (with defaults)</span></span>
<span><span class="co"># -&gt; f = the smoother span (proportion of points in the plot which influence the smooth at each value) ~ neighborood size</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, <span class="va">plasma</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, f <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ul>
<li><p>Smoothed curves, such as the lowess curve, do not provide an analytical expression for the functional form of the regression relationship. They only suggest the shape of the regression curve.</p></li>
<li><p>The lowess procedure is not restricted to fitting linear regression functions in each neighborhood. Higher-degree polynomials can also be utilized with this method.</p></li>
<li><p>Showed previously that lowess is used in residual plots to show their pattern</p></li>
</ul></section><section id="use-of-smoothed-curves-to-confirm-the-fitted-regression-function" class="level3" data-number="3.10.2"><h3 data-number="3.10.2" class="anchored" data-anchor-id="use-of-smoothed-curves-to-confirm-the-fitted-regression-function">
<span class="header-section-number">3.10.2</span> Use of smoothed curves to confirm the fitted regression function</h3>
<p>Overview</p>
<ul>
<li><p>Smoothed curves are useful not only in the exploratory a regression model is selected but they are also helpful in confirming the regression function chosen.</p></li>
<li><p>The procedure for confirmation is simple: The curve is plotted together with the confidence band for the fitted regression function. If the smoothed curve falls within the confidence band, we have supporting evidence of the appropriateness of the fitted regression function.</p></li>
</ul>
<p>Demo</p>
<div class="cell">
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit untransformed model</span></span>
<span><span class="va">mod_plasma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plasma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate confidence band using R functions</span></span>
<span><span class="co"># -&gt; using textbook function (to confirm)</span></span>
<span><span class="va">x_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plasma</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf_band1</span> <span class="op">&lt;-</span> <span class="fu">ALSM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ALSM/man/6_ci.reg.html">ci.reg</a></span><span class="op">(</span><span class="va">mod_plasma</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, type <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -&gt; using predict() for in practice</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, df1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span><span class="op">)</span>, df2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">mod_plasma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf_band2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma</span>, newdata <span class="op">=</span> <span class="va">x_h</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_h</span><span class="op">$</span><span class="va">x</span>,</span>
<span>         se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_plasma</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, interval <span class="op">=</span> <span class="st">"pred"</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">se.fit</span>,</span>
<span>         lwr <span class="op">=</span> <span class="va">fit</span> <span class="op">-</span> <span class="va">W</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>         upr <span class="op">=</span> <span class="va">fit</span> <span class="op">+</span> <span class="va">W</span> <span class="op">*</span> <span class="va">se</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot smooth curve and actual confidence bands</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">"Untransformed model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, f <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf_band2</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">lwr</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="va">conf_band2</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">upr</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="va">conf_band1</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">Lower.Band</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">conf_band1</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">Upper.Band</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit transformed model</span></span>
<span><span class="va">mod_plasma_prime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">plasma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate confidence bands</span></span>
<span><span class="va">conf_bands</span> <span class="op">&lt;-</span> <span class="fu">ALSM</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ALSM/man/6_ci.reg.html">ci.reg</a></span><span class="op">(</span><span class="va">mod_plasma_prime</span>, newdata <span class="op">=</span> <span class="va">x_h</span>, type <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot smooth curve and actual confidence bands after back transforming</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">"Transformed model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lowess.html">lowess</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">plasma</span><span class="op">$</span><span class="va">y</span>, f <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf_bands</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">Lower.Band</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="va">conf_bands</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">Upper.Band</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes-diagnostics-and-remedial-measures_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid figure-img" data-fig-pos="hold" width="672"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./notes-inference.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./notes-matrix-slr.html" class="pagination-link" aria-label="<span class='chapter-number'>4</span>&nbsp; <span class='chapter-title'>Matrix approach to SLR</span>">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Matrix approach to SLR</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb224" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Diagnostics and remedial measures {#sec-diag-remedial-measures}</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-prereqs</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr options</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define LaTeX macros (/shortcuts) --&gt;</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define vector (without parentheses, so when writing out in like a definition) of the form X_1, ..., X_n, where X and n are variable. </span><span class="al">NOTE</span><span class="co">: to call use $\vecn{X}{n}$ --&gt;</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a>\newcommand{\vecn}<span class="co">[</span><span class="ot">2</span><span class="co">]</span>{#1_1, \ldots, #1_{#2}}</span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --&gt;</span></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a>\newcommand{\follow}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\sim \text{#1}\,}</span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % (followsp is short for 'follow special') shortcut that can be used for iid or ind ~ 'Named dist ' in normal font with space before parameters would go --&gt;</span></span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a>\newcommand{\followsp}<span class="co">[</span><span class="ot">2</span><span class="co">]</span>{\overset{#1}\sim \text{#2}\,}</span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define independence symbol (it basically makes two orthogonal symbols very close to each other. The number of \! controls the space between each of the orthogonal symbols) --&gt;</span></span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a>\newcommand{\ind}{\perp <span class="sc">\!\!\!</span> \perp}</span>
<span id="cb224-32"><a href="#cb224-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-33"><a href="#cb224-33" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for Cov(X,Y) with formatting for Cov --&gt;</span></span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a>\newcommand{\cov}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\mathrm{Cov}(#1)}</span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-37"><a href="#cb224-37" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for Corr(X,Y) with formatting for Corr --&gt;</span></span>
<span id="cb224-38"><a href="#cb224-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-39"><a href="#cb224-39" aria-hidden="true" tabindex="-1"></a>\newcommand{\corr}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\mathrm{Corr}(#1)}</span>
<span id="cb224-40"><a href="#cb224-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-41"><a href="#cb224-41" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for non-italic e in math mode --&gt;</span></span>
<span id="cb224-42"><a href="#cb224-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-43"><a href="#cb224-43" aria-hidden="true" tabindex="-1"></a>\newcommand{\e}{\mathrm{e}}</span>
<span id="cb224-44"><a href="#cb224-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-45"><a href="#cb224-45" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for null hypothesis formatted nicely --&gt;</span></span>
<span id="cb224-46"><a href="#cb224-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-47"><a href="#cb224-47" aria-hidden="true" tabindex="-1"></a>\newcommand{\ho}{H_0}</span>
<span id="cb224-48"><a href="#cb224-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-49"><a href="#cb224-49" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for alternative hypothesis formatted nicely --&gt;</span></span>
<span id="cb224-50"><a href="#cb224-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-51"><a href="#cb224-51" aria-hidden="true" tabindex="-1"></a>\newcommand{\ha}{H_A}</span>
<span id="cb224-52"><a href="#cb224-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-53"><a href="#cb224-53" aria-hidden="true" tabindex="-1"></a>Two main ideas</span>
<span id="cb224-54"><a href="#cb224-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-55"><a href="#cb224-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Diagnostics → Methods to check whether our model is reasonable for our data and representative of the system that we are studying.</span>
<span id="cb224-56"><a href="#cb224-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-57"><a href="#cb224-57" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Some diagnostics check the *assumptions* of our model. Other diagnostics check the *influence* of different data points.</span>
<span id="cb224-58"><a href="#cb224-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-59"><a href="#cb224-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Remedies → Analytic strategies used to fix problems identified by the diagnostics.</span>
<span id="cb224-60"><a href="#cb224-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-61"><a href="#cb224-61" aria-hidden="true" tabindex="-1"></a>Why do we need to check the model?</span>
<span id="cb224-62"><a href="#cb224-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-63"><a href="#cb224-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The goal of building a model is to:</span>
<span id="cb224-64"><a href="#cb224-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-65"><a href="#cb224-65" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Learn something* about the real world.</span>
<span id="cb224-66"><a href="#cb224-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-67"><a href="#cb224-67" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Predict outcomes* in the real world.</span>
<span id="cb224-68"><a href="#cb224-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-69"><a href="#cb224-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To use a model successfully, we need to know its limitations:</span>
<span id="cb224-70"><a href="#cb224-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-71"><a href="#cb224-71" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Does it adequately describe the functional relationship of interest?</span>
<span id="cb224-72"><a href="#cb224-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-73"><a href="#cb224-73" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Is there reason to worry that inferences about the parameters might be flawed?</span>
<span id="cb224-74"><a href="#cb224-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-75"><a href="#cb224-75" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Is the error distribution appropriate?</span>
<span id="cb224-76"><a href="#cb224-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-77"><a href="#cb224-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All of these are checked via residual analysis.</span>
<span id="cb224-78"><a href="#cb224-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-79"><a href="#cb224-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagnostics for predictor variable</span></span>
<span id="cb224-80"><a href="#cb224-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-81"><a href="#cb224-81" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-82"><a href="#cb224-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-83"><a href="#cb224-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We need diagnostic information about the predictor variable in order to:</span>
<span id="cb224-84"><a href="#cb224-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-85"><a href="#cb224-85" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>See if there are any outlying $X$ values that could influence the appropriateness of the fitted regression function or if the $X$ distribution is skewed, which can impact some aspects of the model behavior / performance.</span>
<span id="cb224-86"><a href="#cb224-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-87"><a href="#cb224-87" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Get info about the range and concentration of the $X$ levels in the study. This is useful for figuring out the range of validity of the regression analysis.</span>
<span id="cb224-88"><a href="#cb224-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-89"><a href="#cb224-89" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can use simple graphical tools to help.</span>
<span id="cb224-90"><a href="#cb224-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-91"><a href="#cb224-91" aria-hidden="true" tabindex="-1"></a>Plots</span>
<span id="cb224-92"><a href="#cb224-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-93"><a href="#cb224-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dot plot → Good when the sample size is not large.</span>
<span id="cb224-94"><a href="#cb224-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-95"><a href="#cb224-95" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can look at min and max; are observations spread throughout this interval? any far outlying observations? replication at different $X$ levels?.</span>
<span id="cb224-96"><a href="#cb224-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-97"><a href="#cb224-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sequence plot → Should be utilized whenever data are obtained in a sequence, such as over time or for adjacent geographic areas.</span>
<span id="cb224-98"><a href="#cb224-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-99"><a href="#cb224-99" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Should look like a random walk (i.e. no obvious pattern).</span>
<span id="cb224-100"><a href="#cb224-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-101"><a href="#cb224-101" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For example, if one level of $X$ occurs way more frequently in the beginning and then another occurs way more at end, this info can be very helpful when looking at diagnostics later for how appropriate the model is.</span>
<span id="cb224-102"><a href="#cb224-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-103"><a href="#cb224-103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Box plots → Good when have a larger sample size.</span>
<span id="cb224-104"><a href="#cb224-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-105"><a href="#cb224-105" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can look at min and max, location of IQR, outliers, shape (skewness).</span>
<span id="cb224-106"><a href="#cb224-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-107"><a href="#cb224-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Histograms → Good with really big sample sizes.</span>
<span id="cb224-108"><a href="#cb224-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-109"><a href="#cb224-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can look for same characteristics as boxplots, as well as modality.</span>
<span id="cb224-110"><a href="#cb224-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-111"><a href="#cb224-111" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-112"><a href="#cb224-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-115"><a href="#cb224-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-116"><a href="#cb224-116" aria-hidden="true" tabindex="-1"></a><span class="co"># generate several samples of X values</span></span>
<span id="cb224-117"><a href="#cb224-117" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">rdunif</span>(<span class="at">n =</span> <span class="dv">15</span>, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-118"><a href="#cb224-118" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">rdunif</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-119"><a href="#cb224-119" aria-hidden="true" tabindex="-1"></a>x_3 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-120"><a href="#cb224-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-121"><a href="#cb224-121" aria-hidden="true" tabindex="-1"></a><span class="co"># create simple plots for diagnostics of X variable</span></span>
<span id="cb224-122"><a href="#cb224-122" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> -&gt; just doing simple base R plots </span></span>
<span id="cb224-123"><a href="#cb224-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-124"><a href="#cb224-124" aria-hidden="true" tabindex="-1"></a><span class="co"># dot plot for small samples</span></span>
<span id="cb224-125"><a href="#cb224-125" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(x_1, <span class="at">method =</span> <span class="st">"stack"</span>)</span>
<span id="cb224-126"><a href="#cb224-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-127"><a href="#cb224-127" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence plot for "sequential" data</span></span>
<span id="cb224-128"><a href="#cb224-128" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; data is random, so will be a random walk</span></span>
<span id="cb224-129"><a href="#cb224-129" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_1, <span class="at">type =</span> <span class="st">"b"</span>)</span>
<span id="cb224-130"><a href="#cb224-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-131"><a href="#cb224-131" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot for larger samples</span></span>
<span id="cb224-132"><a href="#cb224-132" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add mark for mean</span></span>
<span id="cb224-133"><a href="#cb224-133" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(x_2, <span class="at">horizontal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-134"><a href="#cb224-134" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> <span class="fu">mean</span>(x_2), <span class="at">y =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">4</span>)</span>
<span id="cb224-135"><a href="#cb224-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-136"><a href="#cb224-136" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram for really large sample</span></span>
<span id="cb224-137"><a href="#cb224-137" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x_3)</span>
<span id="cb224-138"><a href="#cb224-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-139"><a href="#cb224-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-140"><a href="#cb224-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-141"><a href="#cb224-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Residuals</span></span>
<span id="cb224-142"><a href="#cb224-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-143"><a href="#cb224-143" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-144"><a href="#cb224-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-145"><a href="#cb224-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Goal of residual analysis → Assess the aptness of a statistical model.</span>
<span id="cb224-146"><a href="#cb224-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-147"><a href="#cb224-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why use residuals</span>
<span id="cb224-148"><a href="#cb224-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-149"><a href="#cb224-149" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Direct diagnostic plots for the response variable $Y$ are ordinarily not too useful in regression analysis because the response variable observations are a function of the level of predictor variable.</span>
<span id="cb224-150"><a href="#cb224-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-151"><a href="#cb224-151" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>So, instead we look at diagnostics for $Y$ indirectly by examining the residuals.</span>
<span id="cb224-152"><a href="#cb224-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-153"><a href="#cb224-153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals and model error</span>
<span id="cb224-154"><a href="#cb224-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-155"><a href="#cb224-155" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Recall residual $e_i = Y_i - \hat{Y_i}$ is an estimate of the unobservable model error $\epsilon = Y_i - E(Y_i)$.</span>
<span id="cb224-156"><a href="#cb224-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-157"><a href="#cb224-157" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>** For our regression model, we assume $\epsilon_i \followsp{iid}{Normal}\,(0, \sigma^2$). So if the model is appropriate for the data at hand, the residuals should reflect these properties.</span>
<span id="cb224-158"><a href="#cb224-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-159"><a href="#cb224-159" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This is the basic idea of a residual analysis, which is a highly useful way to check if a model is appropriate.</span>
<span id="cb224-160"><a href="#cb224-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-161"><a href="#cb224-161" aria-hidden="true" tabindex="-1"></a><span class="fu">### Properites of residuals</span></span>
<span id="cb224-162"><a href="#cb224-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-163"><a href="#cb224-163" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Mean</span>
<span id="cb224-164"><a href="#cb224-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-165"><a href="#cb224-165" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The mean of the $n$ residuals for the SLR is shown below.</span>
<span id="cb224-166"><a href="#cb224-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-167"><a href="#cb224-167" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Since this is always 0, it doesn't give any info as to whether the true errors $\epsilon_i$ have expected value $E(\epsilon_i) = 0$.</span>
<span id="cb224-168"><a href="#cb224-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-169"><a href="#cb224-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-170"><a href="#cb224-170" aria-hidden="true" tabindex="-1"></a>\bar{e} = \sum e_i = 0</span>
<span id="cb224-171"><a href="#cb224-171" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-172"><a href="#cb224-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-173"><a href="#cb224-173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Variance</span>
<span id="cb224-174"><a href="#cb224-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-175"><a href="#cb224-175" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The variance of the $n$ residuals for the SLR is shown below.</span>
<span id="cb224-176"><a href="#cb224-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-177"><a href="#cb224-177" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Again, if the model is appropriate $MSE$ is an unbiased estimator of the variance of the error terms $\sigma^2$</span>
<span id="cb224-178"><a href="#cb224-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-179"><a href="#cb224-179" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-180"><a href="#cb224-180" aria-hidden="true" tabindex="-1"></a>S^2 = \frac{\sum (e_i - \bar{e})^2}{n - 2} = \frac{\sum e_i^2}{n - 2} = \frac{SSE}{n - 2} = MSE</span>
<span id="cb224-181"><a href="#cb224-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-182"><a href="#cb224-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-183"><a href="#cb224-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Nonindependence</span>
<span id="cb224-184"><a href="#cb224-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-185"><a href="#cb224-185" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The residuals $e_i$ are not independent random variables because they involve the fitted values $\hat{Y_i}$, which are computed on the same $\hat{\beta}_0$ and $\hat{\beta}_1$.</span>
<span id="cb224-186"><a href="#cb224-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-187"><a href="#cb224-187" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>As a result, the residuals are subject to two constraints: $\sum e_i = 0$ and $\sum X_i e_i = 0$.</span>
<span id="cb224-188"><a href="#cb224-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-189"><a href="#cb224-189" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>However, when the sample size $n$ is much larger than the number of parameters $p$, we can ignore the minor dependence.</span>
<span id="cb224-190"><a href="#cb224-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-191"><a href="#cb224-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### Semistudentized residuals</span></span>
<span id="cb224-192"><a href="#cb224-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-193"><a href="#cb224-193" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>At times, it is helpful to standardize the residuals for residual analysis. Since the standard deviation of the error terms $\epsilon_i$ is $\sigma$, which is estimated by $\sqrt{MSE}$, we can naturally standardize with</span>
<span id="cb224-194"><a href="#cb224-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-195"><a href="#cb224-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-196"><a href="#cb224-196" aria-hidden="true" tabindex="-1"></a>e_i^* = \frac{e_i - \bar{e}}{\sqrt{MSE}} = \frac{e_i}{\sqrt{MSE}} </span>
<span id="cb224-197"><a href="#cb224-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-198"><a href="#cb224-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-199"><a href="#cb224-199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Studentized → If $\sqrt{MSE}$ were an estimate of the standard deviation of the residual $e_i$, we would call $e_i^*$ a studentized residual. But it is not...</span>
<span id="cb224-200"><a href="#cb224-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-201"><a href="#cb224-201" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Semistudentized → $\sigma_{e_i}$ is complex and varies for the different residuals $e_i$, and $\sqrt{MSE}$ is only an approximation of the standard deviation of $\sigma_{e_i}$. So, instead it is a semistudentized residual.</span>
<span id="cb224-202"><a href="#cb224-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-203"><a href="#cb224-203" aria-hidden="true" tabindex="-1"></a><span class="fu">### Departures from model to be studied by residuals</span></span>
<span id="cb224-204"><a href="#cb224-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-205"><a href="#cb224-205" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We are going to use residuals to study the following departures from the SLR model with normal errors:</span>
<span id="cb224-206"><a href="#cb224-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-207"><a href="#cb224-207" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>The regression function is not linear → Is the functional form of the model appropriate?</span>
<span id="cb224-208"><a href="#cb224-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-209"><a href="#cb224-209" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>The error terms do not have constant variance.</span>
<span id="cb224-210"><a href="#cb224-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-211"><a href="#cb224-211" aria-hidden="true" tabindex="-1"></a><span class="ss">    3.  </span>The error terms are not independent.</span>
<span id="cb224-212"><a href="#cb224-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-213"><a href="#cb224-213" aria-hidden="true" tabindex="-1"></a><span class="ss">    4.  </span>The model fits all but one or a few outlier observations → Do any of the data points have a disproportionate influence on the parameter estimates?</span>
<span id="cb224-214"><a href="#cb224-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-215"><a href="#cb224-215" aria-hidden="true" tabindex="-1"></a><span class="ss">    5.  </span>The error terms are not normally distributed.</span>
<span id="cb224-216"><a href="#cb224-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-217"><a href="#cb224-217" aria-hidden="true" tabindex="-1"></a><span class="ss">    6.  </span>One or several important predictor variables have been omitted from the model.</span>
<span id="cb224-218"><a href="#cb224-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-219"><a href="#cb224-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagnostics for residuals</span></span>
<span id="cb224-220"><a href="#cb224-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-221"><a href="#cb224-221" aria-hidden="true" tabindex="-1"></a>Types of plots</span>
<span id="cb224-222"><a href="#cb224-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-223"><a href="#cb224-223" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Here are the informal diagnostic plots of residuals we will use to see if any of the above 6 departures from the SLR model are present,</span>
<span id="cb224-224"><a href="#cb224-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-225"><a href="#cb224-225" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Residuals against predictor variable.</span>
<span id="cb224-226"><a href="#cb224-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-227"><a href="#cb224-227" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Absolute or squared residuals against predictor variable.</span>
<span id="cb224-228"><a href="#cb224-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-229"><a href="#cb224-229" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Residuals against fitted values.</span>
<span id="cb224-230"><a href="#cb224-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-231"><a href="#cb224-231" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Residuals against time or other sequence.</span>
<span id="cb224-232"><a href="#cb224-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-233"><a href="#cb224-233" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Residuals against omitted predictor variables.</span>
<span id="cb224-234"><a href="#cb224-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-235"><a href="#cb224-235" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Boxplot of residuals.</span>
<span id="cb224-236"><a href="#cb224-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-237"><a href="#cb224-237" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>Normal probability plot of residuals.</span>
<span id="cb224-238"><a href="#cb224-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-239"><a href="#cb224-239" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-240"><a href="#cb224-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-241"><a href="#cb224-241" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How to make plots and what they look like when assumptions are met.</span>
<span id="cb224-242"><a href="#cb224-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-245"><a href="#cb224-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-246"><a href="#cb224-246" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-247"><a href="#cb224-247" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-248"><a href="#cb224-248" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-249"><a href="#cb224-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-250"><a href="#cb224-250" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-251"><a href="#cb224-251" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-252"><a href="#cb224-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-253"><a href="#cb224-253" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-254"><a href="#cb224-254" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-255"><a href="#cb224-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-256"><a href="#cb224-256" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-257"><a href="#cb224-257" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-258"><a href="#cb224-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-259"><a href="#cb224-259" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-260"><a href="#cb224-260" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-261"><a href="#cb224-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-262"><a href="#cb224-262" aria-hidden="true" tabindex="-1"></a><span class="co"># view diagnostic plots (base R)</span></span>
<span id="cb224-263"><a href="#cb224-263" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span>
<span id="cb224-264"><a href="#cb224-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-265"><a href="#cb224-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-266"><a href="#cb224-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-269"><a href="#cb224-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-270"><a href="#cb224-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb224-271"><a href="#cb224-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-272"><a href="#cb224-272" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT RUN -&gt; note this works inline</span></span>
<span id="cb224-273"><a href="#cb224-273" aria-hidden="true" tabindex="-1"></a><span class="co"># view ggplot versions of diagnostic plots</span></span>
<span id="cb224-274"><a href="#cb224-274" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(mod)</span>
<span id="cb224-275"><a href="#cb224-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-276"><a href="#cb224-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-277"><a href="#cb224-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-278"><a href="#cb224-278" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/autoplot-lm.png)</span>{width="50%"}</span>
<span id="cb224-279"><a href="#cb224-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-280"><a href="#cb224-280" aria-hidden="true" tabindex="-1"></a>Next section</span>
<span id="cb224-281"><a href="#cb224-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-282"><a href="#cb224-282" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Now we will go through how to visually assess each assumption to see if it is met and diagnosis (identify) each violation if present.</span>
<span id="cb224-283"><a href="#cb224-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-284"><a href="#cb224-284" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>At then end, we will discuss the impacts of each departure on things such as $MSE$, slope standard errors, prediction accuracy, etc.</span>
<span id="cb224-285"><a href="#cb224-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-286"><a href="#cb224-286" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonlinearity of regression function</span></span>
<span id="cb224-287"><a href="#cb224-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-288"><a href="#cb224-288" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-289"><a href="#cb224-289" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-290"><a href="#cb224-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-291"><a href="#cb224-291" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-292"><a href="#cb224-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-293"><a href="#cb224-293" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can look at the following plots to check if a linear regression function is appropriate:</span>
<span id="cb224-294"><a href="#cb224-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-295"><a href="#cb224-295" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>*Residual plot against the fitted values* → This is the preferred plot for this assumption check.</span>
<span id="cb224-296"><a href="#cb224-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-297"><a href="#cb224-297" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When a linear regression model is appropriate, the residuals then fall within a horizontal band centered around 0, displaying no systematic tendencies to be positive and negative (randomly scattered around 0).</span>
<span id="cb224-298"><a href="#cb224-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-299"><a href="#cb224-299" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When the linearity assumption is violated, there are systematic deviations.</span>
<span id="cb224-300"><a href="#cb224-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-301"><a href="#cb224-301" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-linearity.png)</span>{width="50%"}</span>
<span id="cb224-302"><a href="#cb224-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-303"><a href="#cb224-303" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>*Residual plot against the predictor variable*</span>
<span id="cb224-304"><a href="#cb224-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-305"><a href="#cb224-305" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For *SLR only*, this shows the same info as the residuals vs fitted values because the $\hat{Y_i}$ are a linear function of the $X_i$.</span>
<span id="cb224-306"><a href="#cb224-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-307"><a href="#cb224-307" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>So the basic pattern of the plotted points is not affected whether the residual plot is against the $X_i$ or the $\hat{Y_i}$ (only the $X$ scale values are affected).</span>
<span id="cb224-308"><a href="#cb224-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-309"><a href="#cb224-309" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For curvilinear regression and multiple regression, separate plots of the residuals against the fitted values and against the predictor variable(s) are usually helpful.</span>
<span id="cb224-310"><a href="#cb224-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-311"><a href="#cb224-311" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>*Scatterplot of* $Y$ vs $X$ → If the actual trend in the data in linear, then it makes sense to fit a straight-line model to the data.</span>
<span id="cb224-312"><a href="#cb224-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-313"><a href="#cb224-313" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>But, not always as effective as the residual plots. Residual plots are preferred over scatteplot, because it has two advantages:</span>
<span id="cb224-314"><a href="#cb224-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-315"><a href="#cb224-315" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/scatterplot-y-vs-x.png)</span>{width="50%"}</span>
<span id="cb224-316"><a href="#cb224-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-317"><a href="#cb224-317" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Can also easily be used for checking other assumptions.</span>
<span id="cb224-318"><a href="#cb224-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-319"><a href="#cb224-319" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>There are occasions when the scaling of the scatter plot places the $Y_i$ observations close to the fitted values $\hat{Y_i}$, for instance, when there is a steep slope. It then becomes more difficult to study the appropriateness of a linear regression function from the scatterplot, while the residual plot can clearly show any systematic pattern in the deviations around the fitted regression line under these conditions.</span>
<span id="cb224-320"><a href="#cb224-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-321"><a href="#cb224-321" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-322"><a href="#cb224-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-323"><a href="#cb224-323" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-324"><a href="#cb224-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-327"><a href="#cb224-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-328"><a href="#cb224-328" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-329"><a href="#cb224-329" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-330"><a href="#cb224-330" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-331"><a href="#cb224-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-332"><a href="#cb224-332" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-333"><a href="#cb224-333" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-334"><a href="#cb224-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-335"><a href="#cb224-335" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-336"><a href="#cb224-336" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-337"><a href="#cb224-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-338"><a href="#cb224-338" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-339"><a href="#cb224-339" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-340"><a href="#cb224-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-341"><a href="#cb224-341" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-342"><a href="#cb224-342" aria-hidden="true" tabindex="-1"></a>mod_ideal <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-343"><a href="#cb224-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-344"><a href="#cb224-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-345"><a href="#cb224-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-346"><a href="#cb224-346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-347"><a href="#cb224-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-348"><a href="#cb224-348" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>R also adds a trend line, which we want to be approximately horizontal.</span>
<span id="cb224-349"><a href="#cb224-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-352"><a href="#cb224-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-353"><a href="#cb224-353" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs fitted plot</span></span>
<span id="cb224-354"><a href="#cb224-354" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-355"><a href="#cb224-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-356"><a href="#cb224-356" aria-hidden="true" tabindex="-1"></a><span class="co"># verify smoothing line that plot.lm() performs (see discussion in nonconstant variance ideal section)</span></span>
<span id="cb224-357"><a href="#cb224-357" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-358"><a href="#cb224-358" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">lowess</span>(<span class="fu">fitted</span>(mod_ideal), <span class="at">y =</span> <span class="fu">resid</span>(mod_ideal)), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-359"><a href="#cb224-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-360"><a href="#cb224-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-361"><a href="#cb224-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-362"><a href="#cb224-362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs $X$ plot</span>
<span id="cb224-363"><a href="#cb224-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-364"><a href="#cb224-364" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For SLR → Shows same pattern as above, different scale on $X$ axis.</span>
<span id="cb224-365"><a href="#cb224-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-368"><a href="#cb224-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-369"><a href="#cb224-369" aria-hidden="true" tabindex="-1"></a><span class="co"># create residuals vs X plot</span></span>
<span id="cb224-370"><a href="#cb224-370" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add smoothing line</span></span>
<span id="cb224-371"><a href="#cb224-371" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">residuals</span>(mod_ideal), <span class="at">ylab =</span> <span class="st">"residuals"</span>, <span class="at">main =</span> <span class="st">"Residuals vs X"</span>)</span>
<span id="cb224-372"><a href="#cb224-372" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-373"><a href="#cb224-373" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">resid</span>(mod_ideal)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-374"><a href="#cb224-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-375"><a href="#cb224-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-376"><a href="#cb224-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-377"><a href="#cb224-377" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Demo for difference when in MLR</span>
<span id="cb224-378"><a href="#cb224-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-379"><a href="#cb224-379" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Results → Can see different pattern (even if only slightly based on values chosen) pattern in each.</span>
<span id="cb224-380"><a href="#cb224-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-383"><a href="#cb224-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-384"><a href="#cb224-384" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize new items</span></span>
<span id="cb224-385"><a href="#cb224-385" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb224-386"><a href="#cb224-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-387"><a href="#cb224-387" aria-hidden="true" tabindex="-1"></a><span class="co"># generate new X sample</span></span>
<span id="cb224-388"><a href="#cb224-388" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>)</span>
<span id="cb224-389"><a href="#cb224-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-390"><a href="#cb224-390" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate new Y observations using same errors, but with both xs</span></span>
<span id="cb224-391"><a href="#cb224-391" aria-hidden="true" tabindex="-1"></a>y_2 <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> beta_2 <span class="sc">*</span> x_2  <span class="sc">+</span> epsilon</span>
<span id="cb224-392"><a href="#cb224-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-393"><a href="#cb224-393" aria-hidden="true" tabindex="-1"></a><span class="co"># fit new MLR model</span></span>
<span id="cb224-394"><a href="#cb224-394" aria-hidden="true" tabindex="-1"></a>mod_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_2 <span class="sc">~</span> x <span class="sc">+</span> x_2)</span>
<span id="cb224-395"><a href="#cb224-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-396"><a href="#cb224-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-397"><a href="#cb224-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-400"><a href="#cb224-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-401"><a href="#cb224-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| class.source = "fold-hide"</span></span>
<span id="cb224-402"><a href="#cb224-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-403"><a href="#cb224-403" aria-hidden="true" tabindex="-1"></a><span class="co"># plot residuals vs fitted, X and X2</span></span>
<span id="cb224-404"><a href="#cb224-404" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; create dataset so can display all three plots</span></span>
<span id="cb224-405"><a href="#cb224-405" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; also add smoothing line to make differences in patterns more noticeable</span></span>
<span id="cb224-406"><a href="#cb224-406" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">X1 =</span> x,</span>
<span id="cb224-407"><a href="#cb224-407" aria-hidden="true" tabindex="-1"></a>           <span class="at">X2 =</span> x_2,</span>
<span id="cb224-408"><a href="#cb224-408" aria-hidden="true" tabindex="-1"></a>           <span class="at">fitted =</span> <span class="fu">fitted</span>(mod_mlr),</span>
<span id="cb224-409"><a href="#cb224-409" aria-hidden="true" tabindex="-1"></a>           <span class="at">residuals =</span> <span class="fu">residuals</span>(mod_mlr)) <span class="sc">%&gt;%</span></span>
<span id="cb224-410"><a href="#cb224-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb224-411"><a href="#cb224-411" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"X_axis"</span>,</span>
<span id="cb224-412"><a href="#cb224-412" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-413"><a href="#cb224-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb224-414"><a href="#cb224-414" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> residuals),</span>
<span id="cb224-415"><a href="#cb224-415" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb224-416"><a href="#cb224-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb224-417"><a href="#cb224-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb224-418"><a href="#cb224-418" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>,</span>
<span id="cb224-419"><a href="#cb224-419" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span> </span>
<span id="cb224-420"><a href="#cb224-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> X_axis,</span>
<span id="cb224-421"><a href="#cb224-421" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb224-422"><a href="#cb224-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb224-423"><a href="#cb224-423" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb224-424"><a href="#cb224-424" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-425"><a href="#cb224-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-426"><a href="#cb224-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-427"><a href="#cb224-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-428"><a href="#cb224-428" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot</span>
<span id="cb224-429"><a href="#cb224-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-432"><a href="#cb224-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-433"><a href="#cb224-433" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span id="cb224-434"><a href="#cb224-434" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Scatterplot of Y vs X"</span>)</span>
<span id="cb224-435"><a href="#cb224-435" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_ideal, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-436"><a href="#cb224-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-437"><a href="#cb224-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-438"><a href="#cb224-438" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-439"><a href="#cb224-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-440"><a href="#cb224-440" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-441"><a href="#cb224-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-442"><a href="#cb224-442" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-443"><a href="#cb224-443" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Polynomial</span></span>
<span id="cb224-444"><a href="#cb224-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-445"><a href="#cb224-445" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \beta_2 X_i^2 + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-446"><a href="#cb224-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-447"><a href="#cb224-447" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note that this is still a linear model (even though there is a higher order term), becuase the model in linear *in the parameters*.</span>
<span id="cb224-448"><a href="#cb224-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-451"><a href="#cb224-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-452"><a href="#cb224-452" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-453"><a href="#cb224-453" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-454"><a href="#cb224-454" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>;</span>
<span id="cb224-455"><a href="#cb224-455" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb224-456"><a href="#cb224-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-457"><a href="#cb224-457" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-458"><a href="#cb224-458" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-459"><a href="#cb224-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-460"><a href="#cb224-460" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-461"><a href="#cb224-461" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-462"><a href="#cb224-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-463"><a href="#cb224-463" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-464"><a href="#cb224-464" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x  <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> epsilon</span>
<span id="cb224-465"><a href="#cb224-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-466"><a href="#cb224-466" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span id="cb224-467"><a href="#cb224-467" aria-hidden="true" tabindex="-1"></a>mod_squared_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-468"><a href="#cb224-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-469"><a href="#cb224-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-470"><a href="#cb224-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-471"><a href="#cb224-471" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-472"><a href="#cb224-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-475"><a href="#cb224-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-476"><a href="#cb224-476" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs fitted plot</span></span>
<span id="cb224-477"><a href="#cb224-477" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_squared_x, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-478"><a href="#cb224-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-479"><a href="#cb224-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-480"><a href="#cb224-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-481"><a href="#cb224-481" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot</span>
<span id="cb224-482"><a href="#cb224-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-485"><a href="#cb224-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-486"><a href="#cb224-486" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span id="cb224-487"><a href="#cb224-487" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Squared predictor"</span>)</span>
<span id="cb224-488"><a href="#cb224-488" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_squared_x, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-489"><a href="#cb224-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-490"><a href="#cb224-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-491"><a href="#cb224-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-492"><a href="#cb224-492" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Demo to show how steep slope can hide lack of fit in scatterplot, but residual plot still picks it up.</span>
<span id="cb224-493"><a href="#cb224-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-494"><a href="#cb224-494" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Results → For a true quadratic model, the scatterplot of $Y$ vs $X$ looks just linear (not noticeable curvature) when there is a large $\beta_1$ term (coefficient of linear term). But this is misleading, especially after seeing the residual plot which shows the missing evidence of curvature.</span>
<span id="cb224-495"><a href="#cb224-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-498"><a href="#cb224-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-499"><a href="#cb224-499" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-500"><a href="#cb224-500" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-501"><a href="#cb224-501" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-502"><a href="#cb224-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-503"><a href="#cb224-503" aria-hidden="true" tabindex="-1"></a><span class="co"># SMALL slope of linear term</span></span>
<span id="cb224-504"><a href="#cb224-504" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb224-505"><a href="#cb224-505" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-506"><a href="#cb224-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-507"><a href="#cb224-507" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-508"><a href="#cb224-508" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-509"><a href="#cb224-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-510"><a href="#cb224-510" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-511"><a href="#cb224-511" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-512"><a href="#cb224-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-513"><a href="#cb224-513" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-514"><a href="#cb224-514" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x  <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> epsilon</span>
<span id="cb224-515"><a href="#cb224-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-516"><a href="#cb224-516" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span id="cb224-517"><a href="#cb224-517" aria-hidden="true" tabindex="-1"></a>mod_squared <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-518"><a href="#cb224-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-519"><a href="#cb224-519" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span id="cb224-520"><a href="#cb224-520" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; can see curvature</span></span>
<span id="cb224-521"><a href="#cb224-521" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Samll slope"</span>)</span>
<span id="cb224-522"><a href="#cb224-522" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_squared, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-523"><a href="#cb224-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-524"><a href="#cb224-524" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals vs fitted plot</span></span>
<span id="cb224-525"><a href="#cb224-525" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; curvature very obvious here</span></span>
<span id="cb224-526"><a href="#cb224-526" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_squared, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-527"><a href="#cb224-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-528"><a href="#cb224-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-529"><a href="#cb224-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-532"><a href="#cb224-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-533"><a href="#cb224-533" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-534"><a href="#cb224-534" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-535"><a href="#cb224-535" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-536"><a href="#cb224-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-537"><a href="#cb224-537" aria-hidden="true" tabindex="-1"></a><span class="co"># LARGE slope of linear term</span></span>
<span id="cb224-538"><a href="#cb224-538" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb224-539"><a href="#cb224-539" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb224-540"><a href="#cb224-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-541"><a href="#cb224-541" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-542"><a href="#cb224-542" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-543"><a href="#cb224-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-544"><a href="#cb224-544" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-545"><a href="#cb224-545" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-546"><a href="#cb224-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-547"><a href="#cb224-547" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-548"><a href="#cb224-548" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x  <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> epsilon</span>
<span id="cb224-549"><a href="#cb224-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-550"><a href="#cb224-550" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model (only on SLR x with linear term)</span></span>
<span id="cb224-551"><a href="#cb224-551" aria-hidden="true" tabindex="-1"></a>mod_squared <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-552"><a href="#cb224-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-553"><a href="#cb224-553" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line added</span></span>
<span id="cb224-554"><a href="#cb224-554" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; curvature is hidden more, regression line looks okay</span></span>
<span id="cb224-555"><a href="#cb224-555" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Large slope"</span>)</span>
<span id="cb224-556"><a href="#cb224-556" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_squared, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-557"><a href="#cb224-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-558"><a href="#cb224-558" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals vs fitted plot</span></span>
<span id="cb224-559"><a href="#cb224-559" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; curvature still visible here</span></span>
<span id="cb224-560"><a href="#cb224-560" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_squared, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-561"><a href="#cb224-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-562"><a href="#cb224-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-563"><a href="#cb224-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-564"><a href="#cb224-564" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Nonlinear regression model</span></span>
<span id="cb224-565"><a href="#cb224-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-566"><a href="#cb224-566" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 \, \mathrm{e}^{\beta_1 \, X_i} + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-567"><a href="#cb224-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-568"><a href="#cb224-568" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Nonlinear because $Y_i$ cannot be expressed as a linear combination of the $\beta_i$s.</span>
<span id="cb224-569"><a href="#cb224-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-572"><a href="#cb224-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-573"><a href="#cb224-573" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-574"><a href="#cb224-574" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-575"><a href="#cb224-575" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="fl">0.1</span>; beta_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-576"><a href="#cb224-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-577"><a href="#cb224-577" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-578"><a href="#cb224-578" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-579"><a href="#cb224-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-580"><a href="#cb224-580" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-581"><a href="#cb224-581" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-582"><a href="#cb224-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-583"><a href="#cb224-583" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-584"><a href="#cb224-584" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">*</span> <span class="fu">exp</span>(beta_1 <span class="sc">*</span> x) <span class="sc">+</span> epsilon</span>
<span id="cb224-585"><a href="#cb224-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-586"><a href="#cb224-586" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-587"><a href="#cb224-587" aria-hidden="true" tabindex="-1"></a>mod_nonlinear <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-588"><a href="#cb224-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-589"><a href="#cb224-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-590"><a href="#cb224-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-591"><a href="#cb224-591" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scattterplot of $Y$ vs $X$ and residual plot</span>
<span id="cb224-592"><a href="#cb224-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-593"><a href="#cb224-593" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can see obvious nonlinear pattern in scatterplot and systematic deviations in residual plot.</span>
<span id="cb224-594"><a href="#cb224-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-597"><a href="#cb224-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-598"><a href="#cb224-598" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line</span></span>
<span id="cb224-599"><a href="#cb224-599" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; obviously not a linear pattern</span></span>
<span id="cb224-600"><a href="#cb224-600" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Scatterplot of Y vs X"</span>)</span>
<span id="cb224-601"><a href="#cb224-601" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_nonlinear, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-602"><a href="#cb224-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-603"><a href="#cb224-603" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs fitted plot</span></span>
<span id="cb224-604"><a href="#cb224-604" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; definite pattern to residuals</span></span>
<span id="cb224-605"><a href="#cb224-605" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_nonlinear, <span class="dv">1</span>)</span>
<span id="cb224-606"><a href="#cb224-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-607"><a href="#cb224-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-608"><a href="#cb224-608" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-609"><a href="#cb224-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-610"><a href="#cb224-610" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonconstant variance</span></span>
<span id="cb224-611"><a href="#cb224-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-612"><a href="#cb224-612" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-613"><a href="#cb224-613" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-614"><a href="#cb224-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-615"><a href="#cb224-615" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-616"><a href="#cb224-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-617"><a href="#cb224-617" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can look at the following plots to check if the error terms have constant variance:</span>
<span id="cb224-618"><a href="#cb224-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-619"><a href="#cb224-619" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>*Residual plot against the fitted values*</span>
<span id="cb224-620"><a href="#cb224-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-621"><a href="#cb224-621" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Again for SLR, this shows the same info as residuals vs $X$ plot, but in MLR we want to use the fitted values.</span>
<span id="cb224-622"><a href="#cb224-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-623"><a href="#cb224-623" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When there is a constant error variance, points again should fall within a horizontal band. So there is a constant spread of the residuals as move across the scope of fitted (or $X$) values.</span>
<span id="cb224-624"><a href="#cb224-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-625"><a href="#cb224-625" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"Tipped over tornado" effect of the points indicates a non-constant variance (i.e. as the fitted values increase, the residuals vary more, or vice versa). Reverse megaphone (decreasing variance with increasing levels of $X$ or $\hat{Y}$) is possible as well or varying in some other complex fashion. A nonconstant variance in called *heteroscedasticity* (the assumption is a *homoscedastic* error variance).</span>
<span id="cb224-626"><a href="#cb224-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-627"><a href="#cb224-627" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-nonconstant-variance.png)</span>{width="50%"}</span>
<span id="cb224-628"><a href="#cb224-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-629"><a href="#cb224-629" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>*Scale-location plot* → Refined version of above, preferred plot for this assumption.</span>
<span id="cb224-630"><a href="#cb224-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-631"><a href="#cb224-631" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Plots standardized residuals against fitted values.</span>
<span id="cb224-632"><a href="#cb224-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-633"><a href="#cb224-633" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>There are a few ways to transform the residuals for this type of plot, all of which get at the same purpose (options include: absolute value, square root of absolute value, squared, standardized (studentized, semistudentized), square root of standardized).</span>
<span id="cb224-634"><a href="#cb224-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-635"><a href="#cb224-635" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>By doing this, it places all of the information on changing magnitudes of the residuals above the horizontal zero line, which makes it easier to see whether the magnitude of the residuals is changing with the level $\hat{Y}$ ($\pm$ is not important for this condition).</span>
<span id="cb224-636"><a href="#cb224-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-637"><a href="#cb224-637" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The scale-location plot specifically uses the standardized residuals (which have equal variance by assumption), and are given by $e_i^* = \frac{e_i}{\sqrt{MSE (1 - h_{ii})}}$, where the leverages $h_{ii}$ are the diagonal entries of the hat matrix. It then takes the absolute value and square root $\sqrt{\lvert e_i^* \rvert}$ to diminish the skewness because under $\text{Normal}(0, \sigma^2)$, $\sqrt{\lvert e_i^* \rvert}$ is much less skewed than $\lvert e_i^* \rvert$.</span>
<span id="cb224-638"><a href="#cb224-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-639"><a href="#cb224-639" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-nonconstant-variance-scale-location.png)</span>{width="50%"}</span>
<span id="cb224-640"><a href="#cb224-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-641"><a href="#cb224-641" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-scale-location-standardized-residuals.png)</span>{width="50%"}</span>
<span id="cb224-642"><a href="#cb224-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-643"><a href="#cb224-643" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- not totally sure why we need residuals to not be skewed for scale-location plot though --&gt;</span></span>
<span id="cb224-644"><a href="#cb224-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-645"><a href="#cb224-645" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-646"><a href="#cb224-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-647"><a href="#cb224-647" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-648"><a href="#cb224-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-649"><a href="#cb224-649" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-650"><a href="#cb224-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-651"><a href="#cb224-651" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking residuals to fall within horizontal bands on either side of 0.</span>
<span id="cb224-652"><a href="#cb224-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-655"><a href="#cb224-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-656"><a href="#cb224-656" aria-hidden="true" tabindex="-1"></a><span class="co"># using ideal model from linearity assumption demo</span></span>
<span id="cb224-657"><a href="#cb224-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-658"><a href="#cb224-658" aria-hidden="true" tabindex="-1"></a><span class="co"># again, same plot as to check linearity</span></span>
<span id="cb224-659"><a href="#cb224-659" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-660"><a href="#cb224-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-661"><a href="#cb224-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-662"><a href="#cb224-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-663"><a href="#cb224-663" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scale-location plot</span>
<span id="cb224-664"><a href="#cb224-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-665"><a href="#cb224-665" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Now we want a flat trend line.</span>
<span id="cb224-666"><a href="#cb224-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-669"><a href="#cb224-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-670"><a href="#cb224-670" aria-hidden="true" tabindex="-1"></a><span class="co"># scale-location plot</span></span>
<span id="cb224-671"><a href="#cb224-671" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">3</span>)</span>
<span id="cb224-672"><a href="#cb224-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-673"><a href="#cb224-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-674"><a href="#cb224-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-675"><a href="#cb224-675" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Demo of different ways to standardize residuals (including the scale-location plot)</span>
<span id="cb224-676"><a href="#cb224-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-679"><a href="#cb224-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-680"><a href="#cb224-680" aria-hidden="true" tabindex="-1"></a><span class="co"># scale-location plot</span></span>
<span id="cb224-681"><a href="#cb224-681" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">3</span>)</span>
<span id="cb224-682"><a href="#cb224-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-683"><a href="#cb224-683" aria-hidden="true" tabindex="-1"></a><span class="co"># demo of the standardized residuals used above</span></span>
<span id="cb224-684"><a href="#cb224-684" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; check help page for plot.lm() for more details on methods behind diagnostic plots</span></span>
<span id="cb224-685"><a href="#cb224-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-686"><a href="#cb224-686" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize the residuals</span></span>
<span id="cb224-687"><a href="#cb224-687" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; manual calculation using the formula for e* or r functions</span></span>
<span id="cb224-688"><a href="#cb224-688" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_ideal)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-689"><a href="#cb224-689" aria-hidden="true" tabindex="-1"></a>e_star <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_ideal) <span class="sc">%&gt;%</span> <span class="fu">divide_by</span>(<span class="fu">sqrt</span>(mse <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">hatvalues</span>(mod_ideal)))) </span>
<span id="cb224-690"><a href="#cb224-690" aria-hidden="true" tabindex="-1"></a>e_star <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(mod_ideal)</span>
<span id="cb224-691"><a href="#cb224-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-692"><a href="#cb224-692" aria-hidden="true" tabindex="-1"></a><span class="co"># view final transformation of residuals</span></span>
<span id="cb224-693"><a href="#cb224-693" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">e =</span> <span class="fu">resid</span>(mod), e_star, <span class="at">f_e_star =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(e_star))) <span class="sc">%&gt;%</span> </span>
<span id="cb224-694"><a href="#cb224-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-695"><a href="#cb224-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">display_nice</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Residuals e"</span>, <span class="st">"Standardized residuals e-star"</span>, <span class="st">"f(e-star ) = sqrt(abs(e-star))"</span>))</span>
<span id="cb224-696"><a href="#cb224-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-697"><a href="#cb224-697" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay function of standardized residuals to scale-location plot to confirm they line up </span></span>
<span id="cb224-698"><a href="#cb224-698" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> <span class="fu">fitted</span>(mod_ideal), <span class="at">y =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(e_star)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">3</span>)</span>
<span id="cb224-699"><a href="#cb224-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-700"><a href="#cb224-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-701"><a href="#cb224-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-704"><a href="#cb224-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-705"><a href="#cb224-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| class.source = "fold-hide"</span></span>
<span id="cb224-706"><a href="#cb224-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-707"><a href="#cb224-707" aria-hidden="true" tabindex="-1"></a><span class="co"># demo different residual plots AND different smoothers</span></span>
<span id="cb224-708"><a href="#cb224-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-709"><a href="#cb224-709" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of different standardized residuals so can display all</span></span>
<span id="cb224-710"><a href="#cb224-710" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) residuals</span></span>
<span id="cb224-711"><a href="#cb224-711" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) f(e*) from above (sqrt of abs of standardized residuals from scale-location)</span></span>
<span id="cb224-712"><a href="#cb224-712" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) semistudentized residuals = e / sqrt(MSE)</span></span>
<span id="cb224-713"><a href="#cb224-713" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) abs(residuals)</span></span>
<span id="cb224-714"><a href="#cb224-714" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) sqrt(abs(residuals))</span></span>
<span id="cb224-715"><a href="#cb224-715" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) residuals^2</span></span>
<span id="cb224-716"><a href="#cb224-716" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_ideal)</span>
<span id="cb224-717"><a href="#cb224-717" aria-hidden="true" tabindex="-1"></a>data_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"fitted"</span> <span class="ot">=</span> <span class="fu">fitted</span>(mod_ideal),</span>
<span id="cb224-718"><a href="#cb224-718" aria-hidden="true" tabindex="-1"></a>                        e,</span>
<span id="cb224-719"><a href="#cb224-719" aria-hidden="true" tabindex="-1"></a>                        <span class="at">f_e_star =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(e_star)),</span>
<span id="cb224-720"><a href="#cb224-720" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_semi =</span> e <span class="sc">/</span> <span class="fu">sqrt</span>(mse),</span>
<span id="cb224-721"><a href="#cb224-721" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_abs =</span> <span class="fu">abs</span>(e),</span>
<span id="cb224-722"><a href="#cb224-722" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_abs_sqrt =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(e)),</span>
<span id="cb224-723"><a href="#cb224-723" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_squared =</span> e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-724"><a href="#cb224-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"e"</span>), <span class="st">"f_e_star"</span>),</span>
<span id="cb224-725"><a href="#cb224-725" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb224-726"><a href="#cb224-726" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"residuals"</span>)</span>
<span id="cb224-727"><a href="#cb224-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-728"><a href="#cb224-728" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for lowess smoothers of each residual type</span></span>
<span id="cb224-729"><a href="#cb224-729" aria-hidden="true" tabindex="-1"></a>data_lowess <span class="ot">&lt;-</span> data_plot <span class="sc">%&gt;%</span> </span>
<span id="cb224-730"><a href="#cb224-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>type) <span class="sc">%&gt;%</span> <span class="fu">map2</span>(<span class="fu">names</span>(.), \(df, type) <span class="fu">data.frame</span>(<span class="fu">lowess</span>(<span class="at">x =</span> df<span class="sc">$</span>fitted, <span class="at">y =</span> df<span class="sc">$</span>residuals), <span class="at">type =</span> type)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-731"><a href="#cb224-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(bind_rows)</span>
<span id="cb224-732"><a href="#cb224-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-733"><a href="#cb224-733" aria-hidden="true" tabindex="-1"></a><span class="co"># set more informative labels for the facets</span></span>
<span id="cb224-734"><a href="#cb224-734" aria-hidden="true" tabindex="-1"></a>labels_residuals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">e =</span> <span class="st">"residuals"</span>,</span>
<span id="cb224-735"><a href="#cb224-735" aria-hidden="true" tabindex="-1"></a>                      <span class="at">f_e_star =</span> <span class="st">"f(standardized residuals"</span>,</span>
<span id="cb224-736"><a href="#cb224-736" aria-hidden="true" tabindex="-1"></a>                      <span class="at">e_semi =</span> <span class="st">"residuals / sqrt(MSE)"</span>,</span>
<span id="cb224-737"><a href="#cb224-737" aria-hidden="true" tabindex="-1"></a>                      <span class="at">e_abs =</span> <span class="st">"abs(residuals)"</span>,</span>
<span id="cb224-738"><a href="#cb224-738" aria-hidden="true" tabindex="-1"></a>                      <span class="at">e_abs_sqrt =</span> <span class="st">"sqrt(abs(residuals))"</span>,</span>
<span id="cb224-739"><a href="#cb224-739" aria-hidden="true" tabindex="-1"></a>                      <span class="at">e_squared =</span> <span class="st">"residuals^2"</span>)</span>
<span id="cb224-740"><a href="#cb224-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-741"><a href="#cb224-741" aria-hidden="true" tabindex="-1"></a><span class="co"># then plot with different smoothing lines</span></span>
<span id="cb224-742"><a href="#cb224-742" aria-hidden="true" tabindex="-1"></a><span class="co"># smoothing line</span></span>
<span id="cb224-743"><a href="#cb224-743" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; geom_smooth() default method is loess smoother, which is a local polynomial regression fit</span></span>
<span id="cb224-744"><a href="#cb224-744" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; plot() uses lowess smoother, which uses locally-weighted polynomial regression </span></span>
<span id="cb224-745"><a href="#cb224-745" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; summary -&gt; similar methods, slight difference</span></span>
<span id="cb224-746"><a href="#cb224-746" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; lowess is for adding a smooth curve to a scatterplot, i.e., for univariate smoothing, while loess is for fitting a smooth surface to multivariate data</span></span>
<span id="cb224-747"><a href="#cb224-747" aria-hidden="true" tabindex="-1"></a>data_plot <span class="sc">%&gt;%</span> </span>
<span id="cb224-748"><a href="#cb224-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted,</span>
<span id="cb224-749"><a href="#cb224-749" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> residuals),</span>
<span id="cb224-750"><a href="#cb224-750" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb224-751"><a href="#cb224-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb224-752"><a href="#cb224-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb224-753"><a href="#cb224-753" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>,</span>
<span id="cb224-754"><a href="#cb224-754" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span> </span>
<span id="cb224-755"><a href="#cb224-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-756"><a href="#cb224-756" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y),</span>
<span id="cb224-757"><a href="#cb224-757" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> data_lowess,</span>
<span id="cb224-758"><a href="#cb224-758" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb224-759"><a href="#cb224-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> type,</span>
<span id="cb224-760"><a href="#cb224-760" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb224-761"><a href="#cb224-761" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(labels_residuals)) <span class="sc">+</span> </span>
<span id="cb224-762"><a href="#cb224-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb224-763"><a href="#cb224-763" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb224-764"><a href="#cb224-764" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-765"><a href="#cb224-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-766"><a href="#cb224-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-767"><a href="#cb224-767" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-768"><a href="#cb224-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-769"><a href="#cb224-769" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-770"><a href="#cb224-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-771"><a href="#cb224-771" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-772"><a href="#cb224-772" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Increasing variance</span></span>
<span id="cb224-773"><a href="#cb224-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-774"><a href="#cb224-774" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2_i = 5 X_i)$</span>
<span id="cb224-775"><a href="#cb224-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-778"><a href="#cb224-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-779"><a href="#cb224-779" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-780"><a href="#cb224-780" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-781"><a href="#cb224-781" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-782"><a href="#cb224-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-783"><a href="#cb224-783" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-784"><a href="#cb224-784" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-785"><a href="#cb224-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-786"><a href="#cb224-786" aria-hidden="true" tabindex="-1"></a><span class="co"># specify a vector of variances, which is a function of X</span></span>
<span id="cb224-787"><a href="#cb224-787" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> x</span>
<span id="cb224-788"><a href="#cb224-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-789"><a href="#cb224-789" aria-hidden="true" tabindex="-1"></a><span class="co"># generate response Y</span></span>
<span id="cb224-790"><a href="#cb224-790" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x, <span class="at">sd =</span> sigma)</span>
<span id="cb224-791"><a href="#cb224-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-792"><a href="#cb224-792" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-793"><a href="#cb224-793" aria-hidden="true" tabindex="-1"></a>mod_increasing_error_variance <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-794"><a href="#cb224-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-795"><a href="#cb224-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-796"><a href="#cb224-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-797"><a href="#cb224-797" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot</span>
<span id="cb224-798"><a href="#cb224-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-799"><a href="#cb224-799" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can see more variation around ftted line as $X$ increases.</span>
<span id="cb224-800"><a href="#cb224-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-803"><a href="#cb224-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-804"><a href="#cb224-804" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplot with regression line</span></span>
<span id="cb224-805"><a href="#cb224-805" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb224-806"><a href="#cb224-806" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_increasing_error_variance, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-807"><a href="#cb224-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-808"><a href="#cb224-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-809"><a href="#cb224-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-810"><a href="#cb224-810" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-811"><a href="#cb224-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-812"><a href="#cb224-812" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking for a pattern that doesn't follow horizontal bands as move left to right, trend line may still be horizontal though.</span>
<span id="cb224-813"><a href="#cb224-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-816"><a href="#cb224-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-817"><a href="#cb224-817" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot</span></span>
<span id="cb224-818"><a href="#cb224-818" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_increasing_error_variance, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-819"><a href="#cb224-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-820"><a href="#cb224-820" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-821"><a href="#cb224-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-822"><a href="#cb224-822" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scale-location plot</span>
<span id="cb224-823"><a href="#cb224-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-824"><a href="#cb224-824" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Now trend line will not be horizontal after transforming residuals, should increase with an increasing variance.</span>
<span id="cb224-825"><a href="#cb224-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-828"><a href="#cb224-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-829"><a href="#cb224-829" aria-hidden="true" tabindex="-1"></a><span class="co"># scale-location plot</span></span>
<span id="cb224-830"><a href="#cb224-830" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_increasing_error_variance, <span class="at">which =</span> <span class="dv">3</span>)</span>
<span id="cb224-831"><a href="#cb224-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-832"><a href="#cb224-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-833"><a href="#cb224-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-834"><a href="#cb224-834" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Complex variance</span></span>
<span id="cb224-835"><a href="#cb224-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-836"><a href="#cb224-836" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \text{ decreasing then increasing } \sigma^2_i)$</span>
<span id="cb224-837"><a href="#cb224-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-840"><a href="#cb224-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-841"><a href="#cb224-841" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-842"><a href="#cb224-842" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-843"><a href="#cb224-843" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-844"><a href="#cb224-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-845"><a href="#cb224-845" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; specify a vector of variances instead so it sequentially increases</span></span>
<span id="cb224-846"><a href="#cb224-846" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">2</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">2</span>))</span>
<span id="cb224-847"><a href="#cb224-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-848"><a href="#cb224-848" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-849"><a href="#cb224-849" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; need pattern of variances to follow as X increases, so sort Xs after</span></span>
<span id="cb224-850"><a href="#cb224-850" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> sort</span>
<span id="cb224-851"><a href="#cb224-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-852"><a href="#cb224-852" aria-hidden="true" tabindex="-1"></a><span class="co"># generate response Y</span></span>
<span id="cb224-853"><a href="#cb224-853" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x, <span class="at">sd =</span> sigma)</span>
<span id="cb224-854"><a href="#cb224-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-855"><a href="#cb224-855" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-856"><a href="#cb224-856" aria-hidden="true" tabindex="-1"></a>mod_complex_error_variance <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-857"><a href="#cb224-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-858"><a href="#cb224-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-859"><a href="#cb224-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-862"><a href="#cb224-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-863"><a href="#cb224-863" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplot with regression line</span></span>
<span id="cb224-864"><a href="#cb224-864" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now see values are closer to line in middle of plot</span></span>
<span id="cb224-865"><a href="#cb224-865" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb224-866"><a href="#cb224-866" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_complex_error_variance, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-867"><a href="#cb224-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-868"><a href="#cb224-868" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot</span></span>
<span id="cb224-869"><a href="#cb224-869" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; see ribbon-like pattern</span></span>
<span id="cb224-870"><a href="#cb224-870" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_complex_error_variance, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-871"><a href="#cb224-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-872"><a href="#cb224-872" aria-hidden="true" tabindex="-1"></a><span class="co"># scale-location plot</span></span>
<span id="cb224-873"><a href="#cb224-873" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; see U kinda pattern</span></span>
<span id="cb224-874"><a href="#cb224-874" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_complex_error_variance, <span class="at">which =</span> <span class="dv">3</span>)</span>
<span id="cb224-875"><a href="#cb224-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-876"><a href="#cb224-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-877"><a href="#cb224-877" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-878"><a href="#cb224-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-879"><a href="#cb224-879" aria-hidden="true" tabindex="-1"></a><span class="fu">### Presence of unusual observations</span></span>
<span id="cb224-880"><a href="#cb224-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-881"><a href="#cb224-881" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-882"><a href="#cb224-882" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-883"><a href="#cb224-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-884"><a href="#cb224-884" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-885"><a href="#cb224-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-886"><a href="#cb224-886" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Unusual observations can create much difficulty when fitting models. When present, they can lead to a misleading fit because the line was estimated by minimizing the squared deviations.</span>
<span id="cb224-887"><a href="#cb224-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-888"><a href="#cb224-888" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Thus, a fitted line may be pulled disproportionately toward an unusual observation. Unusual observations far from $\bar{X}$ have a larger impact on the model and estimates than those near $\bar{X}$ (this is the idea of leverage / influence).</span>
<span id="cb224-889"><a href="#cb224-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-890"><a href="#cb224-890" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/outliers-relative-xbar.png)</span>{width="50%"}</span>
<span id="cb224-891"><a href="#cb224-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-892"><a href="#cb224-892" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There are two types unusual observations and how we define them, check for them, and their impact is different.</span>
<span id="cb224-893"><a href="#cb224-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-894"><a href="#cb224-894" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>**Outliers** → Extreme values of the response (outliers in $Y$).</span>
<span id="cb224-895"><a href="#cb224-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-896"><a href="#cb224-896" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A rough rule of thumb → When the sample size is large, semistudentized (or standardized) residuals with absolute value more than 3 or 4 can be considered outliers (i.e. outliers if $\lvert \frac{e_i}{\sqrt{MSE}} \text{ or } e_i^* \rvert \ge 3 \text{ or } 4$).</span>
<span id="cb224-897"><a href="#cb224-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-898"><a href="#cb224-898" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We can look at the following plots to check if residual outliers are present:</span>
<span id="cb224-899"><a href="#cb224-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-900"><a href="#cb224-900" aria-hidden="true" tabindex="-1"></a>    a.  *Residual plot against the fitted values (or* $X$)</span>
<span id="cb224-901"><a href="#cb224-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-902"><a href="#cb224-902" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Just looking for points far away from the pattern of the rest. In SLR, can also look at the scatterplot of $Y$ vs $X$ for points far from overall pattern.</span></span>
<span id="cb224-903"><a href="#cb224-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-904"><a href="#cb224-904" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Plotting of semistudentized residuals is helpful for distinguishing outiers because it's easy to identify residuals that lie many standard deviations from zero.</span></span>
<span id="cb224-905"><a href="#cb224-905" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb224-906"><a href="#cb224-906" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-outlier-y.png)</span>{width="30%"}</span>
<span id="cb224-907"><a href="#cb224-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-908"><a href="#cb224-908" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-outlier-semistudentized.png)</span>{width="30%"}</span>
<span id="cb224-909"><a href="#cb224-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-910"><a href="#cb224-910" aria-hidden="true" tabindex="-1"></a>b.  *Boxplots, histograms, Normal QQ of the residuals (or standardized residuals)*</span>
<span id="cb224-911"><a href="#cb224-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-912"><a href="#cb224-912" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Can also look for outliers in the usual way based on these plots. Note that different visuals / rules will give more or less evidence for outliers.</span></span>
<span id="cb224-913"><a href="#cb224-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-914"><a href="#cb224-914" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-outliers-other-plots.png)</span>{width="50%"}</span>
<span id="cb224-915"><a href="#cb224-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-916"><a href="#cb224-916" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**High leverage points** → Observations whose predictor values are far from the center of the predictor space (extreme values (outliers) of $X$ or unusual combination of $X$s).</span>
<span id="cb224-917"><a href="#cb224-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-918"><a href="#cb224-918" aria-hidden="true" tabindex="-1"></a>    c.  Plots → *Residuals vs Leverage plot* (or Cook's distance plot, Cook's dist vs Leverage (1 - Leverage) plot) → These use measures not covered yet.</span>
<span id="cb224-919"><a href="#cb224-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-920"><a href="#cb224-920" aria-hidden="true" tabindex="-1"></a>(3.) **Influential points** → High leverage points that actually *influence* the slope of the regression line (outlier in $X$ AND $Y$).</span>
<span id="cb224-921"><a href="#cb224-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-922"><a href="#cb224-922" aria-hidden="true" tabindex="-1"></a>d.  Plots → In order to determine if a point is influential, visualize the regression line with and without the point. Does the slope of the line change considerably? If so, then the point is influential. If not, then it's not an influential point.</span>
<span id="cb224-923"><a href="#cb224-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-924"><a href="#cb224-924" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-high-leverage-influential.png)</span>{width="50%"}</span>
<span id="cb224-925"><a href="#cb224-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-926"><a href="#cb224-926" aria-hidden="true" tabindex="-1"></a>Removing unusual observations</span>
<span id="cb224-927"><a href="#cb224-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-928"><a href="#cb224-928" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Because unusual observations can create lots of difficulty, when we find one, we initially think that the observation resulted from a mistake or some extraneous effect. So it should be removed.</span>
<span id="cb224-929"><a href="#cb224-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-930"><a href="#cb224-930" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On the other hand, unusual observations may convey significant information (such as if it occurs because of an interaction with another predictor variable omitted from the model).</span>
<span id="cb224-931"><a href="#cb224-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-932"><a href="#cb224-932" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A safe rule → Discard an unusual observation only if there is direct evidence that it represents an error in recording, a miscalculation, a malfunctioning of equipment, or a similar type of circumstance.</span>
<span id="cb224-933"><a href="#cb224-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-934"><a href="#cb224-934" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-935"><a href="#cb224-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-936"><a href="#cb224-936" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-937"><a href="#cb224-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-938"><a href="#cb224-938" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-939"><a href="#cb224-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-940"><a href="#cb224-940" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking for observations with residuals far below or above 0.</span>
<span id="cb224-941"><a href="#cb224-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-944"><a href="#cb224-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-945"><a href="#cb224-945" aria-hidden="true" tabindex="-1"></a><span class="co"># using ideal model from linearity assumption demo</span></span>
<span id="cb224-946"><a href="#cb224-946" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; randomness may result in an outlier or two</span></span>
<span id="cb224-947"><a href="#cb224-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-948"><a href="#cb224-948" aria-hidden="true" tabindex="-1"></a><span class="co"># again, same plot as to check linearity and nonconstant variance</span></span>
<span id="cb224-949"><a href="#cb224-949" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-950"><a href="#cb224-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-951"><a href="#cb224-951" aria-hidden="true" tabindex="-1"></a><span class="co"># by default, on all the diagnostic plots R labels the 3 observations with the most extreme residuals </span></span>
<span id="cb224-952"><a href="#cb224-952" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; this says nothing about being potential outliers, just the top three</span></span>
<span id="cb224-953"><a href="#cb224-953" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; can change how many get labeled and what the label is (by default it is the observation number)</span></span>
<span id="cb224-954"><a href="#cb224-954" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">id.n =</span> <span class="dv">10</span>, <span class="at">labels.id =</span> <span class="fu">paste</span>(<span class="st">"x = "</span>, <span class="fu">round</span>(x, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st"> y = "</span>, <span class="fu">round</span>(y, <span class="dv">3</span>)))</span>
<span id="cb224-955"><a href="#cb224-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-956"><a href="#cb224-956" aria-hidden="true" tabindex="-1"></a><span class="co"># could also add lines for 3 * sqrt(MSE) to get the same comparison as below, just in units of the original residuals</span></span>
<span id="cb224-957"><a href="#cb224-957" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; </span><span class="al">NOTE</span><span class="co">: bounds are off plot cause not any outliers</span></span>
<span id="cb224-958"><a href="#cb224-958" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-959"><a href="#cb224-959" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_ideal)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-960"><a href="#cb224-960" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span> <span class="sc">*</span> <span class="fu">sqrt</span>(mse), <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb224-961"><a href="#cb224-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-962"><a href="#cb224-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-963"><a href="#cb224-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-964"><a href="#cb224-964" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Standardized residuals vs fitted plot</span>
<span id="cb224-965"><a href="#cb224-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-966"><a href="#cb224-966" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking for observations beyond with residuals 3 or 4 away from zero after standardizing.</span>
<span id="cb224-967"><a href="#cb224-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-968"><a href="#cb224-968" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Both ways of standardizing get essentially the same outcomes $\Longrightarrow$ An outlier in one will be an outlier in the other, so can just use the default R</span>
<span id="cb224-969"><a href="#cb224-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-972"><a href="#cb224-972" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-973"><a href="#cb224-973" aria-hidden="true" tabindex="-1"></a><span class="co"># show how to check the standardized residual plots and compare different versions</span></span>
<span id="cb224-974"><a href="#cb224-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-975"><a href="#cb224-975" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of two different standardized residuals for variation of residual plot</span></span>
<span id="cb224-976"><a href="#cb224-976" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) semistudentized residuals</span></span>
<span id="cb224-977"><a href="#cb224-977" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) e* from above (standardized residuals from scale-location)</span></span>
<span id="cb224-978"><a href="#cb224-978" aria-hidden="true" tabindex="-1"></a>data_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"fitted"</span> <span class="ot">=</span> <span class="fu">fitted</span>(mod_ideal),</span>
<span id="cb224-979"><a href="#cb224-979" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_semi =</span> <span class="fu">resid</span>(mod_ideal) <span class="sc">/</span> <span class="fu">sqrt</span>(mse),</span>
<span id="cb224-980"><a href="#cb224-980" aria-hidden="true" tabindex="-1"></a>                        <span class="at">e_star =</span> <span class="fu">rstandard</span>(mod_ideal)) <span class="sc">%&gt;%</span></span>
<span id="cb224-981"><a href="#cb224-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"e"</span>),</span>
<span id="cb224-982"><a href="#cb224-982" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb224-983"><a href="#cb224-983" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"residuals"</span>)</span>
<span id="cb224-984"><a href="#cb224-984" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb224-985"><a href="#cb224-985" aria-hidden="true" tabindex="-1"></a><span class="co"># create residual plot with smoothing line for both types of residuals</span></span>
<span id="cb224-986"><a href="#cb224-986" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add bands at +/- 3 "standardized units" from zero</span></span>
<span id="cb224-987"><a href="#cb224-987" aria-hidden="true" tabindex="-1"></a>data_plot <span class="sc">%&gt;%</span> </span>
<span id="cb224-988"><a href="#cb224-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted,</span>
<span id="cb224-989"><a href="#cb224-989" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> residuals,</span>
<span id="cb224-990"><a href="#cb224-990" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> type),</span>
<span id="cb224-991"><a href="#cb224-991" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> .,</span>
<span id="cb224-992"><a href="#cb224-992" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span> </span>
<span id="cb224-993"><a href="#cb224-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb224-994"><a href="#cb224-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb224-995"><a href="#cb224-995" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>,</span>
<span id="cb224-996"><a href="#cb224-996" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span> </span>
<span id="cb224-997"><a href="#cb224-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb224-998"><a href="#cb224-998" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"orange"</span>, <span class="st">"orange"</span>),</span>
<span id="cb224-999"><a href="#cb224-999" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span> </span>
<span id="cb224-1000"><a href="#cb224-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Type of residual"</span>,</span>
<span id="cb224-1001"><a href="#cb224-1001" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="at">e_semi =</span> <span class="st">"#F8766D"</span>, <span class="at">e_star =</span> <span class="st">"#00BFC4"</span>), <span class="co"># use hexcode of default colors when two values</span></span>
<span id="cb224-1002"><a href="#cb224-1002" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">e_semi =</span> <span class="st">"semistudentized"</span>, <span class="at">e_star =</span>  <span class="st">"standardized"</span>))</span>
<span id="cb224-1003"><a href="#cb224-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1004"><a href="#cb224-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1005"><a href="#cb224-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1006"><a href="#cb224-1006" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Boxplot, histogram and Normal QQ plot of residuals</span>
<span id="cb224-1007"><a href="#cb224-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1008"><a href="#cb224-1008" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Should not see any observations far away from the general patterns.</span>
<span id="cb224-1009"><a href="#cb224-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1012"><a href="#cb224-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1013"><a href="#cb224-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1014"><a href="#cb224-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_ideal), <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="st">"Boxplot of residuals"</span>)</span>
<span id="cb224-1015"><a href="#cb224-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1016"><a href="#cb224-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of residuals</span></span>
<span id="cb224-1017"><a href="#cb224-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(mod_ideal), <span class="at">main =</span> <span class="st">"Histogram  of residuals"</span>)</span>
<span id="cb224-1018"><a href="#cb224-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1019"><a href="#cb224-1019" aria-hidden="true" tabindex="-1"></a><span class="co"># normal qq plot</span></span>
<span id="cb224-1020"><a href="#cb224-1020" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb224-1021"><a href="#cb224-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1022"><a href="#cb224-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1023"><a href="#cb224-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1024"><a href="#cb224-1024" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs Leverage plot, Cook's distance plot and Cook's dist vs Leverage / (1 - Leverage) plot</span>
<span id="cb224-1025"><a href="#cb224-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1028"><a href="#cb224-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1029"><a href="#cb224-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnostic plots of: residuals vs lev, cooks dist, and cooks dist vs lev</span></span>
<span id="cb224-1030"><a href="#cb224-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT RUN -&gt; note works inline</span></span>
<span id="cb224-1031"><a href="#cb224-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(mod_ideal, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">6</span>))</span>
<span id="cb224-1032"><a href="#cb224-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1033"><a href="#cb224-1033" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals vs lev plot uses standardized residuals (and not transforming them with sqrt(abs(.)) like the scale-location plot)</span></span>
<span id="cb224-1034"><a href="#cb224-1034" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so could add the +/- 3 lines to this plot (and for now ignore the leverage lines)</span></span>
<span id="cb224-1035"><a href="#cb224-1035" aria-hidden="true" tabindex="-1"></a><span class="co"># note -&gt; lines are off plot cause no outliers</span></span>
<span id="cb224-1036"><a href="#cb224-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">5</span>)</span>
<span id="cb224-1037"><a href="#cb224-1037" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb224-1038"><a href="#cb224-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1039"><a href="#cb224-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1040"><a href="#cb224-1040" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1041"><a href="#cb224-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1042"><a href="#cb224-1042" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-1043"><a href="#cb224-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1044"><a href="#cb224-1044" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1045"><a href="#cb224-1045" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outlier</span></span>
<span id="cb224-1046"><a href="#cb224-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1047"><a href="#cb224-1047" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0^* + \beta_1^* X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1048"><a href="#cb224-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1051"><a href="#cb224-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1052"><a href="#cb224-1052" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1053"><a href="#cb224-1053" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1054"><a href="#cb224-1054" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">4</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1055"><a href="#cb224-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1056"><a href="#cb224-1056" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values and y values in a dataframe</span></span>
<span id="cb224-1057"><a href="#cb224-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># (SIDENOTE -&gt; needs to be a separate mutate() statement so y uses the x's just generated and not ones from a previous vector)</span></span>
<span id="cb224-1058"><a href="#cb224-1058" aria-hidden="true" tabindex="-1"></a>data_without <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1059"><a href="#cb224-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x, <span class="at">sd =</span> sigma))</span>
<span id="cb224-1060"><a href="#cb224-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1061"><a href="#cb224-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1062"><a href="#cb224-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1065"><a href="#cb224-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1066"><a href="#cb224-1066" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce outlier</span></span>
<span id="cb224-1067"><a href="#cb224-1067" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; new point follows different population regression model, but with typical X value</span></span>
<span id="cb224-1068"><a href="#cb224-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; X ranges from 5 to 15 from above</span></span>
<span id="cb224-1069"><a href="#cb224-1069" aria-hidden="true" tabindex="-1"></a>data_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1070"><a href="#cb224-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> (beta_0 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">+</span> (beta_1 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">*</span> x, <span class="at">sd =</span> sigma))</span>
<span id="cb224-1071"><a href="#cb224-1071" aria-hidden="true" tabindex="-1"></a>data_outlier <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_without, data_new)</span>
<span id="cb224-1072"><a href="#cb224-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1073"><a href="#cb224-1073" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1074"><a href="#cb224-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1075"><a href="#cb224-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Diagnostic plots with outlier (typical $X$ but extreme $Y$ $\Longrightarrow$ Outlier in $Y$)</span>
<span id="cb224-1076"><a href="#cb224-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1077"><a href="#cb224-1077" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can see a point with unusually large residuals (outlier in boxplot, way above / below in residual plot).</span>
<span id="cb224-1078"><a href="#cb224-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1081"><a href="#cb224-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1082"><a href="#cb224-1082" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of data with outlier</span></span>
<span id="cb224-1083"><a href="#cb224-1083" aria-hidden="true" tabindex="-1"></a>data_outlier <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb224-1084"><a href="#cb224-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1085"><a href="#cb224-1085" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with outlier</span></span>
<span id="cb224-1086"><a href="#cb224-1086" aria-hidden="true" tabindex="-1"></a>mod_outlier <span class="ot">&lt;-</span> data_outlier <span class="sc">%$%</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1087"><a href="#cb224-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1088"><a href="#cb224-1088" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1089"><a href="#cb224-1089" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_outlier), <span class="at">horizontal =</span> <span class="cn">TRUE</span>, <span class="at">main  =</span> <span class="st">"Boxplot of residuals"</span>)</span>
<span id="cb224-1090"><a href="#cb224-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1091"><a href="#cb224-1091" aria-hidden="true" tabindex="-1"></a><span class="co"># if there is an outlier in the boxplot, can extract it</span></span>
<span id="cb224-1092"><a href="#cb224-1092" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then find the corresponding (x,y) pair</span></span>
<span id="cb224-1093"><a href="#cb224-1093" aria-hidden="true" tabindex="-1"></a>(outlier <span class="ot">&lt;-</span> <span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_outlier), <span class="at">horizontal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>out)</span>
<span id="cb224-1094"><a href="#cb224-1094" aria-hidden="true" tabindex="-1"></a>data_outlier[<span class="fu">which</span>(mod_outlier<span class="sc">$</span>residuals <span class="sc">==</span> outlier),] <span class="sc">%&gt;%</span> display_nice</span>
<span id="cb224-1095"><a href="#cb224-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1096"><a href="#cb224-1096" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs fitted plot with reference lines to confirm outlier</span></span>
<span id="cb224-1097"><a href="#cb224-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_outlier, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb224-1098"><a href="#cb224-1098" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_outlier)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1099"><a href="#cb224-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span> <span class="sc">*</span> <span class="fu">sqrt</span>(mse), <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb224-1100"><a href="#cb224-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1101"><a href="#cb224-1101" aria-hidden="true" tabindex="-1"></a><span class="co"># get standardized residual value of the identified outlier</span></span>
<span id="cb224-1102"><a href="#cb224-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">rstandard</span>(mod_outlier)[<span class="dv">31</span>]</span>
<span id="cb224-1103"><a href="#cb224-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1104"><a href="#cb224-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1105"><a href="#cb224-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1108"><a href="#cb224-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1109"><a href="#cb224-1109" aria-hidden="true" tabindex="-1"></a><span class="co"># view regression lines with and without outlier</span></span>
<span id="cb224-1110"><a href="#cb224-1110" aria-hidden="true" tabindex="-1"></a>data_outlier <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Outlier"</span>)</span>
<span id="cb224-1111"><a href="#cb224-1111" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_outlier, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1112"><a href="#cb224-1112" aria-hidden="true" tabindex="-1"></a>data_outlier[<span class="sc">-</span><span class="dv">31</span>,] <span class="sc">%$%</span> <span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb224-1113"><a href="#cb224-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1114"><a href="#cb224-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1115"><a href="#cb224-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1116"><a href="#cb224-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">#### High-leverage point</span></span>
<span id="cb224-1117"><a href="#cb224-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1118"><a href="#cb224-1118" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0 + \beta_1 X_i^* + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1119"><a href="#cb224-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1122"><a href="#cb224-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1123"><a href="#cb224-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce high-leverage point</span></span>
<span id="cb224-1124"><a href="#cb224-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; new point follows same population regression model, just with extreme X value</span></span>
<span id="cb224-1125"><a href="#cb224-1125" aria-hidden="true" tabindex="-1"></a>data_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1126"><a href="#cb224-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x, <span class="at">sd =</span> sigma))</span>
<span id="cb224-1127"><a href="#cb224-1127" aria-hidden="true" tabindex="-1"></a>data_high_leverage <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_without, data_new)</span>
<span id="cb224-1128"><a href="#cb224-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1129"><a href="#cb224-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1130"><a href="#cb224-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1131"><a href="#cb224-1131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Diagnostic plots with high-leverage point (extreme $X$ but follow pattern of $Y$ $\Longrightarrow$ Outlier in $X$)</span>
<span id="cb224-1132"><a href="#cb224-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1133"><a href="#cb224-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Residual of high-leverage point will be typical, but far away horizontally from the rest of the points.</span>
<span id="cb224-1134"><a href="#cb224-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1137"><a href="#cb224-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1138"><a href="#cb224-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of data with high-leverage point</span></span>
<span id="cb224-1139"><a href="#cb224-1139" aria-hidden="true" tabindex="-1"></a>data_high_leverage <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb224-1140"><a href="#cb224-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1141"><a href="#cb224-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with high-leverage point</span></span>
<span id="cb224-1142"><a href="#cb224-1142" aria-hidden="true" tabindex="-1"></a>mod_high_leverage <span class="ot">&lt;-</span> data_high_leverage <span class="sc">%$%</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1143"><a href="#cb224-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1144"><a href="#cb224-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs leverage plot with reference lines to confirm high-leverage (outlier in X) and also outlier (in Y)</span></span>
<span id="cb224-1145"><a href="#cb224-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_high_leverage, <span class="at">which =</span> <span class="dv">5</span>)</span>
<span id="cb224-1146"><a href="#cb224-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb224-1147"><a href="#cb224-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1148"><a href="#cb224-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1149"><a href="#cb224-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1152"><a href="#cb224-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1153"><a href="#cb224-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># view regression lines with and without outlier</span></span>
<span id="cb224-1154"><a href="#cb224-1154" aria-hidden="true" tabindex="-1"></a>data_high_leverage <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"High-leverage point"</span>)</span>
<span id="cb224-1155"><a href="#cb224-1155" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_high_leverage, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1156"><a href="#cb224-1156" aria-hidden="true" tabindex="-1"></a>data_high_leverage[<span class="sc">-</span><span class="dv">31</span>,] <span class="sc">%$%</span> <span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb224-1157"><a href="#cb224-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1158"><a href="#cb224-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1159"><a href="#cb224-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1160"><a href="#cb224-1160" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Influential point</span></span>
<span id="cb224-1161"><a href="#cb224-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1162"><a href="#cb224-1162" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2), \hspace{20pt} \text{except} \hspace{10pt} Y_{n+1} = \beta_0^* + \beta_1^* X_i^* + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1163"><a href="#cb224-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1166"><a href="#cb224-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1167"><a href="#cb224-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce influential point</span></span>
<span id="cb224-1168"><a href="#cb224-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; new point follows different population regression model AND extreme X value</span></span>
<span id="cb224-1169"><a href="#cb224-1169" aria-hidden="true" tabindex="-1"></a>data_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1170"><a href="#cb224-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> (beta_0 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">+</span> (beta_1 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">*</span> x, <span class="at">sd =</span> sigma))</span>
<span id="cb224-1171"><a href="#cb224-1171" aria-hidden="true" tabindex="-1"></a>data_influential <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_without, data_new)</span>
<span id="cb224-1172"><a href="#cb224-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1173"><a href="#cb224-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1174"><a href="#cb224-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1175"><a href="#cb224-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Diagnostic plots with influential point (extreme $X$ and does NOT follow patter of $Y$ $\Longrightarrow$ Outlier in $X$ and $Y$)</span>
<span id="cb224-1176"><a href="#cb224-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1177"><a href="#cb224-1177" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Residual of influential point will be extreme AND far away horizontally from the rest of the points.</span>
<span id="cb224-1178"><a href="#cb224-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1181"><a href="#cb224-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1182"><a href="#cb224-1182" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of data with influential point</span></span>
<span id="cb224-1183"><a href="#cb224-1183" aria-hidden="true" tabindex="-1"></a>data_influential <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Influential point"</span>)</span>
<span id="cb224-1184"><a href="#cb224-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1185"><a href="#cb224-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with influential point</span></span>
<span id="cb224-1186"><a href="#cb224-1186" aria-hidden="true" tabindex="-1"></a>mod_influential <span class="ot">&lt;-</span> data_influential <span class="sc">%$%</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1187"><a href="#cb224-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1188"><a href="#cb224-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs leverage plot with reference lines to confirm high-leverage and not outlier</span></span>
<span id="cb224-1189"><a href="#cb224-1189" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_influential, <span class="at">which =</span> <span class="dv">5</span>)</span>
<span id="cb224-1190"><a href="#cb224-1190" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="at">col =</span> <span class="st">"orange"</span>)</span>
<span id="cb224-1191"><a href="#cb224-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1192"><a href="#cb224-1192" aria-hidden="true" tabindex="-1"></a><span class="co"># view regression lines with and without outlier</span></span>
<span id="cb224-1193"><a href="#cb224-1193" aria-hidden="true" tabindex="-1"></a>data_influential <span class="sc">%$%</span> <span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Influential point"</span>)</span>
<span id="cb224-1194"><a href="#cb224-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_influential, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1195"><a href="#cb224-1195" aria-hidden="true" tabindex="-1"></a>data_influential[<span class="sc">-</span><span class="dv">31</span>,] <span class="sc">%$%</span> <span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb224-1196"><a href="#cb224-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1197"><a href="#cb224-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1198"><a href="#cb224-1198" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1199"><a href="#cb224-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1200"><a href="#cb224-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonindependence of error terms</span></span>
<span id="cb224-1201"><a href="#cb224-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1202"><a href="#cb224-1202" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1203"><a href="#cb224-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-1204"><a href="#cb224-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1205"><a href="#cb224-1205" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-1206"><a href="#cb224-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1207"><a href="#cb224-1207" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ideally, any potential source of dependence is handled at the experimental design stage (or the sampling scheme), so that it is either eliminated by randomization or explicitly included in the data and we have one observation per subject.</span>
<span id="cb224-1208"><a href="#cb224-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1209"><a href="#cb224-1209" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Whenever data are obtained in a time sequence or some other type of sequence, such as for adjacent geographic areas, we can examine the potential dependence of error terms using a sequence plot of residuals.</span>
<span id="cb224-1210"><a href="#cb224-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1211"><a href="#cb224-1211" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This is used to see if there is any correlation between error terms that are near each other in the sequence.</span>
<span id="cb224-1212"><a href="#cb224-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1213"><a href="#cb224-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Sequence plot of residuals*</span>
<span id="cb224-1214"><a href="#cb224-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1215"><a href="#cb224-1215" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We want to plot the residuals against *time, collection order, spatial coordinates, or some other indicator of the sequence that we think might affect the data*.</span>
<span id="cb224-1216"><a href="#cb224-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1217"><a href="#cb224-1217" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If errors are independent, residuals hould look like a random walk around the base line zero (i.e. no obvious pattern).</span>
<span id="cb224-1218"><a href="#cb224-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1219"><a href="#cb224-1219" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Dependence (lack of randomness) can appear as a trend or cyclical pattern</span>
<span id="cb224-1220"><a href="#cb224-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1221"><a href="#cb224-1221" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-sequence-plot-time.png)</span>{width="70%"}</span>
<span id="cb224-1222"><a href="#cb224-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1223"><a href="#cb224-1223" aria-hidden="true" tabindex="-1"></a>Modelling with nonindependence or apparent nonindependence</span>
<span id="cb224-1224"><a href="#cb224-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1225"><a href="#cb224-1225" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It can be useful to view the problem of nonindependence of the error terms as one in which and important variable has been omitted from the model (whether it be time, observation number, etc.).</span>
<span id="cb224-1226"><a href="#cb224-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1227"><a href="#cb224-1227" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>More subtle dependencies can be difficult to detect, especially if the information needed to detect them has not been included with the dataset.</span>
<span id="cb224-1228"><a href="#cb224-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1229"><a href="#cb224-1229" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the residuals are plotted against $X$, the plot may not appear to be random. But the basic problem could be from a poorly fitting regression function rather than a lack of independence of the error terms. Example, where a quadratic term should be included:</span>
<span id="cb224-1230"><a href="#cb224-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1231"><a href="#cb224-1231" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-residual-plot-squared-missing.png)</span>{width="30%"}</span>
<span id="cb224-1232"><a href="#cb224-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1233"><a href="#cb224-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-1234"><a href="#cb224-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1235"><a href="#cb224-1235" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1236"><a href="#cb224-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1237"><a href="#cb224-1237" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sequence plot of residuals vs observation number</span>
<span id="cb224-1238"><a href="#cb224-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1239"><a href="#cb224-1239" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking for random walk.</span>
<span id="cb224-1240"><a href="#cb224-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1243"><a href="#cb224-1243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1244"><a href="#cb224-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># using ideal model from linearity assumption demo</span></span>
<span id="cb224-1245"><a href="#cb224-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1246"><a href="#cb224-1246" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence plot of residuals vs observation number</span></span>
<span id="cb224-1247"><a href="#cb224-1247" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_ideal)</span>
<span id="cb224-1248"><a href="#cb224-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(e), <span class="at">y =</span> e, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"Sequence plot of residuals vs collection order"</span>, <span class="at">xlab =</span> <span class="st">"obs #"</span>)</span>
<span id="cb224-1249"><a href="#cb224-1249" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1250"><a href="#cb224-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1251"><a href="#cb224-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1252"><a href="#cb224-1252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1253"><a href="#cb224-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1254"><a href="#cb224-1254" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-1255"><a href="#cb224-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1256"><a href="#cb224-1256" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1257"><a href="#cb224-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dependent errors</span></span>
<span id="cb224-1258"><a href="#cb224-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1259"><a href="#cb224-1259" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\mu = \epsilon_{i - 1}, \sigma^2)$</span>
<span id="cb224-1260"><a href="#cb224-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1261"><a href="#cb224-1261" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Error terms are dependent now because the mean for $\epsilon_i$ mean is based (dependent) on the previous error term $\epsilon_{i - 1}$.</span>
<span id="cb224-1262"><a href="#cb224-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1265"><a href="#cb224-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1266"><a href="#cb224-1266" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1267"><a href="#cb224-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1268"><a href="#cb224-1268" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1269"><a href="#cb224-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1270"><a href="#cb224-1270" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1271"><a href="#cb224-1271" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1272"><a href="#cb224-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1273"><a href="#cb224-1273" aria-hidden="true" tabindex="-1"></a><span class="co"># generate dependent normal error terms</span></span>
<span id="cb224-1274"><a href="#cb224-1274" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; setup to first generate the deviations from rnorm()</span></span>
<span id="cb224-1275"><a href="#cb224-1275" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; the first deviation is from mean = 0, the second will now be from (centered on) the first deviation</span></span>
<span id="cb224-1276"><a href="#cb224-1276" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; so just add the first deviation and the new second deviations together, which will give the effect of a new mean from which rnorm() generated the next deviation</span></span>
<span id="cb224-1277"><a href="#cb224-1277" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma) <span class="sc">%&gt;%</span> cumsum</span>
<span id="cb224-1278"><a href="#cb224-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1279"><a href="#cb224-1279" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1280"><a href="#cb224-1280" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1281"><a href="#cb224-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1282"><a href="#cb224-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1283"><a href="#cb224-1283" aria-hidden="true" tabindex="-1"></a>mod_dependent_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1284"><a href="#cb224-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1285"><a href="#cb224-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1286"><a href="#cb224-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1289"><a href="#cb224-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1290"><a href="#cb224-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot of y vs x with regression line</span></span>
<span id="cb224-1291"><a href="#cb224-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; nothing looks amiss</span></span>
<span id="cb224-1292"><a href="#cb224-1292" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Scatterplot - Dependent errors"</span>)</span>
<span id="cb224-1293"><a href="#cb224-1293" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_dependent_error, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1294"><a href="#cb224-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1295"><a href="#cb224-1295" aria-hidden="true" tabindex="-1"></a><span class="co"># residual vs fitted plot</span></span>
<span id="cb224-1296"><a href="#cb224-1296" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; again, seems fine</span></span>
<span id="cb224-1297"><a href="#cb224-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_dependent_error, <span class="dv">1</span>, <span class="st">"Residuals vs fitted - Dependent errors"</span>)</span>
<span id="cb224-1298"><a href="#cb224-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1299"><a href="#cb224-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1300"><a href="#cb224-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1301"><a href="#cb224-1301" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sequence plot with dependent errors ($\epsilon_i$ are no longer *iid*).</span>
<span id="cb224-1302"><a href="#cb224-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1303"><a href="#cb224-1303" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Now there is not a random walk around zero.</span>
<span id="cb224-1304"><a href="#cb224-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1307"><a href="#cb224-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1308"><a href="#cb224-1308" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence plot of residuals vs observation number</span></span>
<span id="cb224-1309"><a href="#cb224-1309" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_dependent_error)</span>
<span id="cb224-1310"><a href="#cb224-1310" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(e), <span class="at">y =</span> e, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"Dependent errors"</span>, <span class="at">xlab =</span> <span class="st">"obs #"</span>)</span>
<span id="cb224-1311"><a href="#cb224-1311" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1312"><a href="#cb224-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1313"><a href="#cb224-1313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1314"><a href="#cb224-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1315"><a href="#cb224-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Linear trend effect</span></span>
<span id="cb224-1316"><a href="#cb224-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1317"><a href="#cb224-1317" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\text{increasing } \mu, \sigma^2)$</span>
<span id="cb224-1318"><a href="#cb224-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1319"><a href="#cb224-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dependent now because successive error terms are more likely to be greater.</span>
<span id="cb224-1320"><a href="#cb224-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1323"><a href="#cb224-1323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1324"><a href="#cb224-1324" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1325"><a href="#cb224-1325" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1326"><a href="#cb224-1326" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1327"><a href="#cb224-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1328"><a href="#cb224-1328" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1329"><a href="#cb224-1329" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1330"><a href="#cb224-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1331"><a href="#cb224-1331" aria-hidden="true" tabindex="-1"></a><span class="co"># generate dependent normal error terms</span></span>
<span id="cb224-1332"><a href="#cb224-1332" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; increasing means</span></span>
<span id="cb224-1333"><a href="#cb224-1333" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n), <span class="at">sd =</span> sigma)</span>
<span id="cb224-1334"><a href="#cb224-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1335"><a href="#cb224-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1336"><a href="#cb224-1336" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1337"><a href="#cb224-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1338"><a href="#cb224-1338" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1339"><a href="#cb224-1339" aria-hidden="true" tabindex="-1"></a>mod_linear_trend_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1340"><a href="#cb224-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1341"><a href="#cb224-1341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1342"><a href="#cb224-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1343"><a href="#cb224-1343" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sequence plot with linear trend effect (still dependent).</span>
<span id="cb224-1344"><a href="#cb224-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1345"><a href="#cb224-1345" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Clear increase from in residuals with collection order → Early points more have negative residuals and later ones are positive.</span>
<span id="cb224-1346"><a href="#cb224-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1349"><a href="#cb224-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1350"><a href="#cb224-1350" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence plot of residuals vs observation number</span></span>
<span id="cb224-1351"><a href="#cb224-1351" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_linear_trend_error)</span>
<span id="cb224-1352"><a href="#cb224-1352" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(e), <span class="at">y =</span> e, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"Linear trend effect"</span>, <span class="at">xlab =</span> <span class="st">"obs #"</span>)</span>
<span id="cb224-1353"><a href="#cb224-1353" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1354"><a href="#cb224-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1355"><a href="#cb224-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1356"><a href="#cb224-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1357"><a href="#cb224-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cyclical nonindependence</span></span>
<span id="cb224-1358"><a href="#cb224-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1359"><a href="#cb224-1359" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \epsilon_i, \hspace{20pt} \text{where} \hspace{10pt} \epsilon_i \sim \text{Normal}\,(\text{cyclical } \mu, \sigma^2)$</span>
<span id="cb224-1360"><a href="#cb224-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1361"><a href="#cb224-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dependent now because adjacent errors are more likely to be closer to each other.</span>
<span id="cb224-1362"><a href="#cb224-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1365"><a href="#cb224-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1366"><a href="#cb224-1366" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1367"><a href="#cb224-1367" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1368"><a href="#cb224-1368" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1369"><a href="#cb224-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1370"><a href="#cb224-1370" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1371"><a href="#cb224-1371" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1372"><a href="#cb224-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1373"><a href="#cb224-1373" aria-hidden="true" tabindex="-1"></a><span class="co"># generate dependent normal error terms</span></span>
<span id="cb224-1374"><a href="#cb224-1374" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; cyclical (decreasing, then increasing, then decreasing, repeat) means</span></span>
<span id="cb224-1375"><a href="#cb224-1375" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>),</span>
<span id="cb224-1376"><a href="#cb224-1376" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>),</span>
<span id="cb224-1377"><a href="#cb224-1377" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>)),</span>
<span id="cb224-1378"><a href="#cb224-1378" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd =</span> sigma)</span>
<span id="cb224-1379"><a href="#cb224-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1380"><a href="#cb224-1380" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1381"><a href="#cb224-1381" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1382"><a href="#cb224-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1383"><a href="#cb224-1383" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1384"><a href="#cb224-1384" aria-hidden="true" tabindex="-1"></a>mod_cyclical_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1385"><a href="#cb224-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1386"><a href="#cb224-1386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1387"><a href="#cb224-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1388"><a href="#cb224-1388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sequence plot with cyclical pattern in errors (still dependent).</span>
<span id="cb224-1389"><a href="#cb224-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1390"><a href="#cb224-1390" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Cyclical pattern in residuals against collection order.</span>
<span id="cb224-1391"><a href="#cb224-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1394"><a href="#cb224-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1395"><a href="#cb224-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence plot of residuals vs observation number</span></span>
<span id="cb224-1396"><a href="#cb224-1396" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_cyclical_error)</span>
<span id="cb224-1397"><a href="#cb224-1397" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(e), <span class="at">y =</span> e, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"Cyclical nonindependence"</span>, <span class="at">xlab =</span> <span class="st">"obs #"</span>)</span>
<span id="cb224-1398"><a href="#cb224-1398" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1399"><a href="#cb224-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1400"><a href="#cb224-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1401"><a href="#cb224-1401" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1402"><a href="#cb224-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1403"><a href="#cb224-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nonnormality of errors</span></span>
<span id="cb224-1404"><a href="#cb224-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1405"><a href="#cb224-1405" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1406"><a href="#cb224-1406" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-1407"><a href="#cb224-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1408"><a href="#cb224-1408" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-1409"><a href="#cb224-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1410"><a href="#cb224-1410" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Small departures from normality do not create any serious problems, but major departures should be of concern.</span>
<span id="cb224-1411"><a href="#cb224-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1412"><a href="#cb224-1412" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can check the normality of error terms in a variety of errors:</span>
<span id="cb224-1413"><a href="#cb224-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1414"><a href="#cb224-1414" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>*Distribution plots of residuals* → This is one of the two preferred plots.</span>
<span id="cb224-1415"><a href="#cb224-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1416"><a href="#cb224-1416" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Boxplots are helpful for seeing if residuals are symmetric and if there are any possible outliers.</span>
<span id="cb224-1417"><a href="#cb224-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1418"><a href="#cb224-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Histograms can also be used for the same purpose, looking for roughly normal. But the sample size needs to be reasonably large for this plot to convey reliable information about the shape of the distribution of error terms (there can be lots of fluctuation in the shape with small samples) $\Longrightarrow$ Moderate departures from normality do not imply a serious violation of this assumption.</span>
<span id="cb224-1419"><a href="#cb224-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1420"><a href="#cb224-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For both of these plots, as long as there is not severe departures, it is okay.</span>
<span id="cb224-1421"><a href="#cb224-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1422"><a href="#cb224-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>*Comparison of relative frequencies* → Use the empirical rule to compare observed relative frequencies to expected under normality.</span>
<span id="cb224-1423"><a href="#cb224-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1424"><a href="#cb224-1424" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Using $\sqrt{MSE}$ as an estimate for $\sigma$, for large sample size $n$ we expect approximately:</span>
<span id="cb224-1425"><a href="#cb224-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1426"><a href="#cb224-1426" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>68% of residuals to fall within $\pm \sqrt{MSE}$.</span>
<span id="cb224-1427"><a href="#cb224-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>95% of residuals to fall within $\pm 2 \sqrt{MSE}$.</span>
<span id="cb224-1428"><a href="#cb224-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">    3.  </span>99.7% of residuals to fall within $\pm 3 \sqrt{MSE}$.</span>
<span id="cb224-1429"><a href="#cb224-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1430"><a href="#cb224-1430" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If the sample size is moderately large, then we can the corresponding $t_{n-1}$ critical values (multipliers).</span>
<span id="cb224-1431"><a href="#cb224-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1432"><a href="#cb224-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Just looking for relative consistency with these rules.</span>
<span id="cb224-1433"><a href="#cb224-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1434"><a href="#cb224-1434" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-normality-empirical-rule.png)</span>{width="50%"}</span>
<span id="cb224-1435"><a href="#cb224-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1436"><a href="#cb224-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>*Normal probability (QQ) plot of residuals* → This is the other preffered plot.</span>
<span id="cb224-1437"><a href="#cb224-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1438"><a href="#cb224-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each standardized residual is plotted against its theoretical percentile (aka quantile, which gives us the expected value) under normality. Note that there are a few ways to make the QQ plots (different ways of standardizing residuals and different algorithms for theoretical quantiles), but none of these variations affect the nature of the plot.</span>
<span id="cb224-1439"><a href="#cb224-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1440"><a href="#cb224-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A plot that is nearly linear suggests agreement with normality, whereas a plot that departs substantially from linearity suggests that the error distribution is not normal.</span>
<span id="cb224-1441"><a href="#cb224-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1442"><a href="#cb224-1442" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Again a moderate departure from normality is of little concern, only extreme departures are of note.</span>
<span id="cb224-1443"><a href="#cb224-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1444"><a href="#cb224-1444" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/diagnostics-qq-plots-histograms.png)</span>{width="80%"}</span>
<span id="cb224-1445"><a href="#cb224-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1446"><a href="#cb224-1446" aria-hidden="true" tabindex="-1"></a>Difficulties in assessing normality</span>
<span id="cb224-1447"><a href="#cb224-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1448"><a href="#cb224-1448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The analysis for model departures regarding normality is often more difficult than departures of other types because...</span>
<span id="cb224-1449"><a href="#cb224-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1450"><a href="#cb224-1450" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Random variation can be particularly mischievous when studying the nature of a probability distribution unless the sample size is quite large.</span>
<span id="cb224-1451"><a href="#cb224-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1452"><a href="#cb224-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Even worse, other types of departures can and do affect the distribution of the residuals.</span>
<span id="cb224-1453"><a href="#cb224-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1454"><a href="#cb224-1454" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>e.g. Residuals may appear to be not normally distributed because an inappropriate regression function is used or because the error variance is not constant.</span>
<span id="cb224-1455"><a href="#cb224-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1456"><a href="#cb224-1456" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>So, it is usually a good strategy to investigate these other types of departures first, before assessing the normality of the error terms.</span>
<span id="cb224-1457"><a href="#cb224-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1458"><a href="#cb224-1458" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-1459"><a href="#cb224-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1460"><a href="#cb224-1460" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1461"><a href="#cb224-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1462"><a href="#cb224-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Distribution plots</span>
<span id="cb224-1463"><a href="#cb224-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1464"><a href="#cb224-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looking roughly symmetric boxplot and a roughly symmetric histogram, both with no extreme outliers.</span>
<span id="cb224-1465"><a href="#cb224-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1468"><a href="#cb224-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1469"><a href="#cb224-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># using ideal model from linearity assumption demo</span></span>
<span id="cb224-1470"><a href="#cb224-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1471"><a href="#cb224-1471" aria-hidden="true" tabindex="-1"></a><span class="co"># again, same distribution plots used to check residuals for outliers</span></span>
<span id="cb224-1472"><a href="#cb224-1472" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1473"><a href="#cb224-1473" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_ideal), <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="st">"Boxplot of residuals"</span>)</span>
<span id="cb224-1474"><a href="#cb224-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1475"><a href="#cb224-1475" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of residuals</span></span>
<span id="cb224-1476"><a href="#cb224-1476" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(mod_ideal), <span class="at">main =</span> <span class="st">"Histogram  of residuals"</span>)</span>
<span id="cb224-1477"><a href="#cb224-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1478"><a href="#cb224-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1479"><a href="#cb224-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1480"><a href="#cb224-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comparison of relative frequencies of residuals</span>
<span id="cb224-1481"><a href="#cb224-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1482"><a href="#cb224-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Percentages should match the empirical rule.</span>
<span id="cb224-1483"><a href="#cb224-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1486"><a href="#cb224-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1487"><a href="#cb224-1487" aria-hidden="true" tabindex="-1"></a><span class="co"># create relative frequency table for interval probabilities of residuals</span></span>
<span id="cb224-1488"><a href="#cb224-1488" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; assuming here 30 is large enough to use Z multipliers</span></span>
<span id="cb224-1489"><a href="#cb224-1489" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; pass z multipliers to map() statement calculating proportion of abs value residuals less than multiplier * sqrt(MSE) -&gt; (gets interval rel freq because centered around zero)</span></span>
<span id="cb224-1490"><a href="#cb224-1490" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_ideal)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1491"><a href="#cb224-1491" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_ideal)</span>
<span id="cb224-1492"><a href="#cb224-1492" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1493"><a href="#cb224-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1494"><a href="#cb224-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(\(z) <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(e) <span class="sc">&lt;=</span> z <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="dv">3</span>))</span>
<span id="cb224-1495"><a href="#cb224-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1496"><a href="#cb224-1496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1497"><a href="#cb224-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1498"><a href="#cb224-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Normal QQ plot of residuals</span>
<span id="cb224-1499"><a href="#cb224-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1500"><a href="#cb224-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Want standard residuals to follow the trend line.</span>
<span id="cb224-1501"><a href="#cb224-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1504"><a href="#cb224-1504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1505"><a href="#cb224-1505" aria-hidden="true" tabindex="-1"></a><span class="co"># normal qq plot</span></span>
<span id="cb224-1506"><a href="#cb224-1506" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ideal, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb224-1507"><a href="#cb224-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1508"><a href="#cb224-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1509"><a href="#cb224-1509" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1510"><a href="#cb224-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1511"><a href="#cb224-1511" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-1512"><a href="#cb224-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1513"><a href="#cb224-1513" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1514"><a href="#cb224-1514" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Skewed errors</span></span>
<span id="cb224-1515"><a href="#cb224-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1516"><a href="#cb224-1516" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Exponential}(\lambda = 1/5)$</span>
<span id="cb224-1517"><a href="#cb224-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1520"><a href="#cb224-1520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1521"><a href="#cb224-1521" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1522"><a href="#cb224-1522" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-1523"><a href="#cb224-1523" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1524"><a href="#cb224-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1525"><a href="#cb224-1525" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1526"><a href="#cb224-1526" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1527"><a href="#cb224-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1528"><a href="#cb224-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># generate right-skewed error terms from exponential distribution</span></span>
<span id="cb224-1529"><a href="#cb224-1529" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb224-1530"><a href="#cb224-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1531"><a href="#cb224-1531" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1532"><a href="#cb224-1532" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1533"><a href="#cb224-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1534"><a href="#cb224-1534" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1535"><a href="#cb224-1535" aria-hidden="true" tabindex="-1"></a>mod_skewed_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1536"><a href="#cb224-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1537"><a href="#cb224-1537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1538"><a href="#cb224-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1539"><a href="#cb224-1539" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- not sure if need to correct error terms to have mean zero; epsilon * = epsilon - mean(epsilon); (so satisfies BLUE assumptions)?? --&gt;</span></span>
<span id="cb224-1540"><a href="#cb224-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1541"><a href="#cb224-1541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comparison of frequencies, distribution plots and QQ plot of residuals</span>
<span id="cb224-1542"><a href="#cb224-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1543"><a href="#cb224-1543" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can see relative frequencies don't match the empirical rule; right skew in boxplot (with high outliers) and histogram; concave up pattern in qq plot.</span>
<span id="cb224-1544"><a href="#cb224-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1547"><a href="#cb224-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1548"><a href="#cb224-1548" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison of frequencies</span></span>
<span id="cb224-1549"><a href="#cb224-1549" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_skewed_error)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1550"><a href="#cb224-1550" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_skewed_error)</span>
<span id="cb224-1551"><a href="#cb224-1551" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1552"><a href="#cb224-1552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1553"><a href="#cb224-1553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(\(z) <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(e) <span class="sc">&lt;=</span> z <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="dv">3</span>))</span>
<span id="cb224-1554"><a href="#cb224-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1555"><a href="#cb224-1555" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1556"><a href="#cb224-1556" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_skewed_error), <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="st">"Right-skewed error"</span>)</span>
<span id="cb224-1557"><a href="#cb224-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1558"><a href="#cb224-1558" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of residuals</span></span>
<span id="cb224-1559"><a href="#cb224-1559" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(mod_skewed_error), <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">"Right-skewed error"</span>)</span>
<span id="cb224-1560"><a href="#cb224-1560" aria-hidden="true" tabindex="-1"></a>x_plot <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb224-1561"><a href="#cb224-1561" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_plot, <span class="fu">dnorm</span>(<span class="at">x =</span> x_plot))</span>
<span id="cb224-1562"><a href="#cb224-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1563"><a href="#cb224-1563" aria-hidden="true" tabindex="-1"></a><span class="co"># normal qq plot</span></span>
<span id="cb224-1564"><a href="#cb224-1564" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_skewed_error, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb224-1565"><a href="#cb224-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1566"><a href="#cb224-1566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1567"><a href="#cb224-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1568"><a href="#cb224-1568" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Light-tailed errors</span></span>
<span id="cb224-1569"><a href="#cb224-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1570"><a href="#cb224-1570" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{Uniform}(a = -2, b = 2)$</span>
<span id="cb224-1571"><a href="#cb224-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1574"><a href="#cb224-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1575"><a href="#cb224-1575" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1576"><a href="#cb224-1576" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-1577"><a href="#cb224-1577" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1578"><a href="#cb224-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1579"><a href="#cb224-1579" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1580"><a href="#cb224-1580" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1581"><a href="#cb224-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1582"><a href="#cb224-1582" aria-hidden="true" tabindex="-1"></a><span class="co"># generate light-tailed error terms from uniform distribution</span></span>
<span id="cb224-1583"><a href="#cb224-1583" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">max =</span> <span class="dv">2</span>)</span>
<span id="cb224-1584"><a href="#cb224-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1585"><a href="#cb224-1585" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1586"><a href="#cb224-1586" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1587"><a href="#cb224-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1588"><a href="#cb224-1588" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1589"><a href="#cb224-1589" aria-hidden="true" tabindex="-1"></a>mod_light_tailed_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1590"><a href="#cb224-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1591"><a href="#cb224-1591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1592"><a href="#cb224-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1593"><a href="#cb224-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Same methods → Relative frequencies don't line up; likely no outliers on boxplot; the histogram may show more data closer to the center; S-shape in QQ plot.</span>
<span id="cb224-1594"><a href="#cb224-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1597"><a href="#cb224-1597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1598"><a href="#cb224-1598" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison of frequencies</span></span>
<span id="cb224-1599"><a href="#cb224-1599" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_light_tailed_error)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1600"><a href="#cb224-1600" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_light_tailed_error)</span>
<span id="cb224-1601"><a href="#cb224-1601" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1602"><a href="#cb224-1602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1603"><a href="#cb224-1603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(\(z) <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(e) <span class="sc">&lt;=</span> z <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="dv">3</span>))</span>
<span id="cb224-1604"><a href="#cb224-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1605"><a href="#cb224-1605" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1606"><a href="#cb224-1606" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_light_tailed_error), <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="st">"Light-tailed error"</span>)</span>
<span id="cb224-1607"><a href="#cb224-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1608"><a href="#cb224-1608" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of standardized residuals (so can overlay Z density curve)</span></span>
<span id="cb224-1609"><a href="#cb224-1609" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rstandard</span>(mod_light_tailed_error), <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Light-tailed error"</span>)</span>
<span id="cb224-1610"><a href="#cb224-1610" aria-hidden="true" tabindex="-1"></a>x_plot <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb224-1611"><a href="#cb224-1611" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_plot, <span class="fu">dnorm</span>(<span class="at">x =</span> x_plot))</span>
<span id="cb224-1612"><a href="#cb224-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1613"><a href="#cb224-1613" aria-hidden="true" tabindex="-1"></a><span class="co"># normal qq plot</span></span>
<span id="cb224-1614"><a href="#cb224-1614" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_light_tailed_error, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb224-1615"><a href="#cb224-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1616"><a href="#cb224-1616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1617"><a href="#cb224-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1618"><a href="#cb224-1618" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- is uniform light-tailed??? --&gt;</span></span>
<span id="cb224-1619"><a href="#cb224-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1620"><a href="#cb224-1620" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Heavy-tailed errors</span></span>
<span id="cb224-1621"><a href="#cb224-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1622"><a href="#cb224-1622" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_i + \text{t}_4$</span>
<span id="cb224-1623"><a href="#cb224-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1626"><a href="#cb224-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1627"><a href="#cb224-1627" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1628"><a href="#cb224-1628" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-1629"><a href="#cb224-1629" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1630"><a href="#cb224-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1631"><a href="#cb224-1631" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-1632"><a href="#cb224-1632" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1633"><a href="#cb224-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1634"><a href="#cb224-1634" aria-hidden="true" tabindex="-1"></a><span class="co"># generate heavy-tailed error terms from t-distribution</span></span>
<span id="cb224-1635"><a href="#cb224-1635" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; df = 4 so not the most extreme</span></span>
<span id="cb224-1636"><a href="#cb224-1636" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rt</span>(<span class="at">n =</span> n, <span class="at">df =</span> <span class="dv">4</span>)</span>
<span id="cb224-1637"><a href="#cb224-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1638"><a href="#cb224-1638" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-1639"><a href="#cb224-1639" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-1640"><a href="#cb224-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1641"><a href="#cb224-1641" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb224-1642"><a href="#cb224-1642" aria-hidden="true" tabindex="-1"></a>mod_heavy_tailed_error <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1643"><a href="#cb224-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1644"><a href="#cb224-1644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1645"><a href="#cb224-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1646"><a href="#cb224-1646" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Same methods → Again, relative frequencies don't line up; likely outliers on both sides of boxplot; the histogram will may show more data away from the center; flipped S-shape in QQ plot.</span>
<span id="cb224-1647"><a href="#cb224-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1650"><a href="#cb224-1650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1651"><a href="#cb224-1651" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison of frequencies</span></span>
<span id="cb224-1652"><a href="#cb224-1652" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_heavy_tailed_error)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1653"><a href="#cb224-1653" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod_heavy_tailed_error)</span>
<span id="cb224-1654"><a href="#cb224-1654" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1655"><a href="#cb224-1655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"± sqrt(MSE)"</span>, <span class="st">"± 2 sqrt(MSE)"</span>,<span class="st">"± 3 sqrt(MSE)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1656"><a href="#cb224-1656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(\(z) <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(e) <span class="sc">&lt;=</span> z <span class="sc">*</span> <span class="fu">sqrt</span>(mse)), <span class="dv">3</span>))</span>
<span id="cb224-1657"><a href="#cb224-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1658"><a href="#cb224-1658" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot of residuals</span></span>
<span id="cb224-1659"><a href="#cb224-1659" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(mod_heavy_tailed_error), <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="st">"Heavy-tailed error"</span>)</span>
<span id="cb224-1660"><a href="#cb224-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1661"><a href="#cb224-1661" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of standarized residuals (so can overlay Z density curve)</span></span>
<span id="cb224-1662"><a href="#cb224-1662" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rstandard</span>(mod_heavy_tailed_error), <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Heavy-tailed error"</span>)</span>
<span id="cb224-1663"><a href="#cb224-1663" aria-hidden="true" tabindex="-1"></a>x_plot <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb224-1664"><a href="#cb224-1664" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_plot, <span class="fu">dnorm</span>(<span class="at">x =</span> x_plot))</span>
<span id="cb224-1665"><a href="#cb224-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1666"><a href="#cb224-1666" aria-hidden="true" tabindex="-1"></a><span class="co"># normal qq plot</span></span>
<span id="cb224-1667"><a href="#cb224-1667" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_heavy_tailed_error, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb224-1668"><a href="#cb224-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1669"><a href="#cb224-1669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1670"><a href="#cb224-1670" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1671"><a href="#cb224-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1672"><a href="#cb224-1672" aria-hidden="true" tabindex="-1"></a><span class="fu">### Omission of important predictor variables</span></span>
<span id="cb224-1673"><a href="#cb224-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1674"><a href="#cb224-1674" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1675"><a href="#cb224-1675" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Content</span></span>
<span id="cb224-1676"><a href="#cb224-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1677"><a href="#cb224-1677" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-1678"><a href="#cb224-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1679"><a href="#cb224-1679" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals should also be plotted against variables omitted from the model that might have important effects on the response.</span>
<span id="cb224-1680"><a href="#cb224-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1681"><a href="#cb224-1681" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Allows us to see whether or not the residuals tend to vary systematically with the level of the additional predictor variable (can be qualitative or quantitative).</span>
<span id="cb224-1682"><a href="#cb224-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1683"><a href="#cb224-1683" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](files/images/diagnostics-residual-vs-omittted-x.png)</span>{width="50%"}</span>
<span id="cb224-1684"><a href="#cb224-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1685"><a href="#cb224-1685" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Only a few of the factors operating on any response variable $Y$ in real-world situations can be included explicitly in a regression model (depends on what data was collected).</span>
<span id="cb224-1686"><a href="#cb224-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1687"><a href="#cb224-1687" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>So when using residual analysis to identify other important predictors, we are simply testing the adequacy of the model and seeing if it could be improved materially by adding one or more predictor variables.</span>
<span id="cb224-1688"><a href="#cb224-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1689"><a href="#cb224-1689" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In doing so, we can provide important additional descriptive and predictive power to the model.</span>
<span id="cb224-1690"><a href="#cb224-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1691"><a href="#cb224-1691" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ideal</span></span>
<span id="cb224-1692"><a href="#cb224-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1693"><a href="#cb224-1693" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_{1,i} + 0 \, X_{2,i} + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1694"><a href="#cb224-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1695"><a href="#cb224-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Simplifies to: $Y_i = \beta_0 + \beta_1 X_{1,i} + \beta_2 X_{2,i} + \epsilon_i \hspace{20pt} \text{with unrelated } X_{2,i}$</span>
<span id="cb224-1696"><a href="#cb224-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1699"><a href="#cb224-1699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1700"><a href="#cb224-1700" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1701"><a href="#cb224-1701" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1702"><a href="#cb224-1702" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">3</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1703"><a href="#cb224-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1704"><a href="#cb224-1704" aria-hidden="true" tabindex="-1"></a><span class="co"># unimportant predictor</span></span>
<span id="cb224-1705"><a href="#cb224-1705" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb224-1706"><a href="#cb224-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1707"><a href="#cb224-1707" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X samples</span></span>
<span id="cb224-1708"><a href="#cb224-1708" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1709"><a href="#cb224-1709" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>)</span>
<span id="cb224-1710"><a href="#cb224-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1711"><a href="#cb224-1711" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-1712"><a href="#cb224-1712" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-1713"><a href="#cb224-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1714"><a href="#cb224-1714" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate Y observations using with both xs</span></span>
<span id="cb224-1715"><a href="#cb224-1715" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; beta_2 = 0 cancels out x_2 terms</span></span>
<span id="cb224-1716"><a href="#cb224-1716" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x_2 <span class="sc">+</span> epsilon</span>
<span id="cb224-1717"><a href="#cb224-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1718"><a href="#cb224-1718" aria-hidden="true" tabindex="-1"></a><span class="co"># fit simplified (correct) model</span></span>
<span id="cb224-1719"><a href="#cb224-1719" aria-hidden="true" tabindex="-1"></a>mod_correct <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x_1)</span>
<span id="cb224-1720"><a href="#cb224-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1721"><a href="#cb224-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1722"><a href="#cb224-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1723"><a href="#cb224-1723" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-1724"><a href="#cb224-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1725"><a href="#cb224-1725" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Looks like random noise, no systematic deviations when residuals for correct model are plotted against unimportant (unrelated) omitted predictor.</span>
<span id="cb224-1726"><a href="#cb224-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1729"><a href="#cb224-1729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1730"><a href="#cb224-1730" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot against unimportant predictor not included in model</span></span>
<span id="cb224-1731"><a href="#cb224-1731" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; no systematic variation of residuals by additional predictor</span></span>
<span id="cb224-1732"><a href="#cb224-1732" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x_2, <span class="at">y =</span> <span class="fu">resid</span>(mod_correct), <span class="at">main =</span> <span class="st">"Residuals vs unimportant predictor"</span>)</span>
<span id="cb224-1733"><a href="#cb224-1733" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1734"><a href="#cb224-1734" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> x_2, <span class="at">y =</span> <span class="fu">resid</span>(mod_correct)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1735"><a href="#cb224-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1736"><a href="#cb224-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1737"><a href="#cb224-1737" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1738"><a href="#cb224-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1739"><a href="#cb224-1739" aria-hidden="true" tabindex="-1"></a>Departures</span>
<span id="cb224-1740"><a href="#cb224-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1741"><a href="#cb224-1741" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-1742"><a href="#cb224-1742" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Missing important predictor</span></span>
<span id="cb224-1743"><a href="#cb224-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1744"><a href="#cb224-1744" aria-hidden="true" tabindex="-1"></a>Model statement → $Y_i = \beta_0 + \beta_1 X_{1,i} + \beta_2 X_{2,i} + \text{Normal}(0, \sigma^2)$</span>
<span id="cb224-1745"><a href="#cb224-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1748"><a href="#cb224-1748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1749"><a href="#cb224-1749" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-1750"><a href="#cb224-1750" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-1751"><a href="#cb224-1751" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">3</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1752"><a href="#cb224-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1753"><a href="#cb224-1753" aria-hidden="true" tabindex="-1"></a><span class="co"># important predictor</span></span>
<span id="cb224-1754"><a href="#cb224-1754" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-1755"><a href="#cb224-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1756"><a href="#cb224-1756" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X samples</span></span>
<span id="cb224-1757"><a href="#cb224-1757" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-1758"><a href="#cb224-1758" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>)</span>
<span id="cb224-1759"><a href="#cb224-1759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1760"><a href="#cb224-1760" aria-hidden="true" tabindex="-1"></a><span class="co"># generate normal error terms</span></span>
<span id="cb224-1761"><a href="#cb224-1761" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-1762"><a href="#cb224-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1763"><a href="#cb224-1763" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate Y observations using with both xs</span></span>
<span id="cb224-1764"><a href="#cb224-1764" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x_2 <span class="sc">+</span> epsilon</span>
<span id="cb224-1765"><a href="#cb224-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1766"><a href="#cb224-1766" aria-hidden="true" tabindex="-1"></a><span class="co"># fit incorrect model (missing X2)</span></span>
<span id="cb224-1767"><a href="#cb224-1767" aria-hidden="true" tabindex="-1"></a>mod_missing_important_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x_1)</span>
<span id="cb224-1768"><a href="#cb224-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1769"><a href="#cb224-1769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1770"><a href="#cb224-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1771"><a href="#cb224-1771" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals vs fitted plot</span>
<span id="cb224-1772"><a href="#cb224-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1773"><a href="#cb224-1773" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Now there is a pattern in the residuals for the omitted important predictor.</span>
<span id="cb224-1774"><a href="#cb224-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1777"><a href="#cb224-1777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1778"><a href="#cb224-1778" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot against important predictor not included in model</span></span>
<span id="cb224-1779"><a href="#cb224-1779" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now there is a clear pattern</span></span>
<span id="cb224-1780"><a href="#cb224-1780" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x_2, <span class="at">y =</span> <span class="fu">resid</span>(mod_missing_important_x), <span class="at">main =</span> <span class="st">"Missing predictor"</span>)</span>
<span id="cb224-1781"><a href="#cb224-1781" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb224-1782"><a href="#cb224-1782" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> x_2, <span class="at">y =</span> <span class="fu">resid</span>(mod_missing_important_x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-1783"><a href="#cb224-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1784"><a href="#cb224-1784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1785"><a href="#cb224-1785" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-1786"><a href="#cb224-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1787"><a href="#cb224-1787" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effects of departures</span></span>
<span id="cb224-1788"><a href="#cb224-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1789"><a href="#cb224-1789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup and functions</span></span>
<span id="cb224-1790"><a href="#cb224-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1791"><a href="#cb224-1791" aria-hidden="true" tabindex="-1"></a>Simulation to determine the effect of various model departures on model performance.</span>
<span id="cb224-1792"><a href="#cb224-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1795"><a href="#cb224-1795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1796"><a href="#cb224-1796" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb224-1797"><a href="#cb224-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1798"><a href="#cb224-1798" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize simulation settings</span></span>
<span id="cb224-1799"><a href="#cb224-1799" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; first the parameter(s) of interest (that are variable), excluding nonlinear cause scales are totally different</span></span>
<span id="cb224-1800"><a href="#cb224-1800" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; create all combos</span></span>
<span id="cb224-1801"><a href="#cb224-1801" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add in the constant settings</span></span>
<span id="cb224-1802"><a href="#cb224-1802" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; arrange in good order if necessary</span></span>
<span id="cb224-1803"><a href="#cb224-1803" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add simulation id column</span></span>
<span id="cb224-1804"><a href="#cb224-1804" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; set row names equal to id (helps keep track of results later)</span></span>
<span id="cb224-1805"><a href="#cb224-1805" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"squared x"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span>, <span class="st">"missing important x"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1806"><a href="#cb224-1806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">as.character</span>(model),</span>
<span id="cb224-1807"><a href="#cb224-1807" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb224-1808"><a href="#cb224-1808" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_0 =</span> <span class="dv">2</span>,</span>
<span id="cb224-1809"><a href="#cb224-1809" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_1 =</span> <span class="dv">2</span>,</span>
<span id="cb224-1810"><a href="#cb224-1810" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_2 =</span> <span class="dv">0</span>,</span>
<span id="cb224-1811"><a href="#cb224-1811" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-1812"><a href="#cb224-1812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(<span class="at">sim_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)))</span>
<span id="cb224-1813"><a href="#cb224-1813" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(params) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"sim"</span>, params<span class="sc">$</span>sim_id)</span>
<span id="cb224-1814"><a href="#cb224-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1815"><a href="#cb224-1815" aria-hidden="true" tabindex="-1"></a><span class="co"># set beta2 for models that need it</span></span>
<span id="cb224-1816"><a href="#cb224-1816" aria-hidden="true" tabindex="-1"></a>params[<span class="fu">which</span>(params<span class="sc">$</span>model <span class="sc">==</span> <span class="st">"squared x"</span>), <span class="st">"beta_2"</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-1817"><a href="#cb224-1817" aria-hidden="true" tabindex="-1"></a>params[<span class="fu">which</span>(params<span class="sc">$</span>model <span class="sc">==</span> <span class="st">"missing important x"</span>), <span class="st">"beta_2"</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-1818"><a href="#cb224-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1819"><a href="#cb224-1819" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(params)</span>
<span id="cb224-1820"><a href="#cb224-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1821"><a href="#cb224-1821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1822"><a href="#cb224-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1825"><a href="#cb224-1825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1826"><a href="#cb224-1826" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb224-1827"><a href="#cb224-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1828"><a href="#cb224-1828" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to generate the model of interest</span></span>
<span id="cb224-1829"><a href="#cb224-1829" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; conditionally generates X values, error terms and Y values, then fits model</span></span>
<span id="cb224-1830"><a href="#cb224-1830" aria-hidden="true" tabindex="-1"></a>generate_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"squared x"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span>, <span class="st">"missing important x"</span>), <span class="at">n =</span> <span class="dv">30</span>, <span class="at">beta_0 =</span> <span class="dv">1</span>, <span class="at">beta_1 =</span> <span class="dv">2</span>, <span class="at">beta_2 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">5</span>) {</span>
<span id="cb224-1831"><a href="#cb224-1831" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1832"><a href="#cb224-1832" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set model type by matching argument</span></span>
<span id="cb224-1833"><a href="#cb224-1833" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; if no model is specified, defaults to the first one</span></span>
<span id="cb224-1834"><a href="#cb224-1834" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; partial string matches work</span></span>
<span id="cb224-1835"><a href="#cb224-1835" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">=</span> <span class="fu">match.arg</span>(model)</span>
<span id="cb224-1836"><a href="#cb224-1836" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1837"><a href="#cb224-1837" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate X samples</span></span>
<span id="cb224-1838"><a href="#cb224-1838" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; only model with specific x dist is skewed predictor</span></span>
<span id="cb224-1839"><a href="#cb224-1839" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; need to sort x for complex error variance</span></span>
<span id="cb224-1840"><a href="#cb224-1840" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> </span>
<span id="cb224-1841"><a href="#cb224-1841" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"skewed x"</span>)) {truncdist<span class="sc">::</span><span class="fu">rtrunc</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">spec =</span> <span class="st">"exp"</span>, <span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">15</span>)}</span>
<span id="cb224-1842"><a href="#cb224-1842" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {<span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)}</span>
<span id="cb224-1843"><a href="#cb224-1843" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"complex error variance"</span>)) {x <span class="ot">=</span> <span class="fu">sort</span>(x)}</span>
<span id="cb224-1844"><a href="#cb224-1844" aria-hidden="true" tabindex="-1"></a>  x_2 <span class="ot">=</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>)</span>
<span id="cb224-1845"><a href="#cb224-1845" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1846"><a href="#cb224-1846" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate error terms</span></span>
<span id="cb224-1847"><a href="#cb224-1847" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">=</span> </span>
<span id="cb224-1848"><a href="#cb224-1848" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"increasing error variance"</span>)) {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span> <span class="sc">*</span> x)}</span>
<span id="cb224-1849"><a href="#cb224-1849" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"complex error variance"</span>)) {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span> , <span class="at">sd =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">2</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">2</span>)))}</span>
<span id="cb224-1850"><a href="#cb224-1850" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"linear trend error"</span>)) {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n), <span class="at">sd =</span> sigma)}</span>
<span id="cb224-1851"><a href="#cb224-1851" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"cyclical error"</span>)) {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n <span class="sc">/</span> <span class="dv">3</span>)), <span class="at">sd =</span> sigma)}</span>
<span id="cb224-1852"><a href="#cb224-1852" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"skewed error"</span>)) {<span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span>sigma)}</span>
<span id="cb224-1853"><a href="#cb224-1853" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"light tailed error"</span>)) {<span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">max =</span> <span class="dv">2</span>)}</span>
<span id="cb224-1854"><a href="#cb224-1854" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"heavy tailed error"</span>)) {<span class="fu">rt</span>(<span class="at">n =</span> n, <span class="at">df =</span> <span class="dv">4</span>)}</span>
<span id="cb224-1855"><a href="#cb224-1855" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {<span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)}</span>
<span id="cb224-1856"><a href="#cb224-1856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"dependent error"</span>)) {epsilon <span class="ot">=</span> <span class="fu">cumsum</span>(epsilon)}</span>
<span id="cb224-1857"><a href="#cb224-1857" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1858"><a href="#cb224-1858" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate Y observations using with both xs</span></span>
<span id="cb224-1859"><a href="#cb224-1859" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; if X2 is not needed beta_2 = 0 cancels it out</span></span>
<span id="cb224-1860"><a href="#cb224-1860" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> </span>
<span id="cb224-1861"><a href="#cb224-1861" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"squared x"</span>)) {beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> epsilon}</span>
<span id="cb224-1862"><a href="#cb224-1862" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> beta_2 <span class="sc">*</span> x_2 <span class="sc">+</span> epsilon}</span>
<span id="cb224-1863"><a href="#cb224-1863" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1864"><a href="#cb224-1864" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change last observation for unusual observations</span></span>
<span id="cb224-1865"><a href="#cb224-1865" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"outlier"</span>)) {x[n] <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">8</span>, <span class="at">max =</span> <span class="dv">12</span>); y[n] <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> (beta_0 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">+</span> (beta_1 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">*</span> x[n], <span class="at">sd =</span> sigma)}</span>
<span id="cb224-1866"><a href="#cb224-1866" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"high leverage point"</span>)) {x[n] <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">18</span>, <span class="at">max =</span> <span class="dv">22</span>); y[n] <span class="ot">=</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x[n] <span class="sc">+</span> epsilon[n]} <span class="co"># same regression function (use same error), extreme x value</span></span>
<span id="cb224-1867"><a href="#cb224-1867" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">identical</span>(model, <span class="st">"influential point"</span>)) {x[n] <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">18</span>, <span class="at">max =</span> <span class="dv">22</span>); y[n] <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> (beta_0 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">+</span> (beta_1 <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">*</span> x[n], <span class="at">sd =</span> sigma)}</span>
<span id="cb224-1868"><a href="#cb224-1868" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1869"><a href="#cb224-1869" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit model</span></span>
<span id="cb224-1870"><a href="#cb224-1870" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-1871"><a href="#cb224-1871" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1872"><a href="#cb224-1872" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1873"><a href="#cb224-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1874"><a href="#cb224-1874" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to run on each unique simulation setting</span></span>
<span id="cb224-1875"><a href="#cb224-1875" aria-hidden="true" tabindex="-1"></a>run_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, vec_names, <span class="at">m =</span> <span class="dv">1000</span>) {</span>
<span id="cb224-1876"><a href="#cb224-1876" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1877"><a href="#cb224-1877" aria-hidden="true" tabindex="-1"></a>  <span class="co"># redefine arguments for easier reference</span></span>
<span id="cb224-1878"><a href="#cb224-1878" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; numeric values get coerced to character because of `model` data type</span></span>
<span id="cb224-1879"><a href="#cb224-1879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(vec) <span class="ot">=</span> vec_names</span>
<span id="cb224-1880"><a href="#cb224-1880" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">=</span> vec[<span class="st">"model"</span>]</span>
<span id="cb224-1881"><a href="#cb224-1881" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"n"</span>])</span>
<span id="cb224-1882"><a href="#cb224-1882" aria-hidden="true" tabindex="-1"></a>  beta_0 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_0"</span>])</span>
<span id="cb224-1883"><a href="#cb224-1883" aria-hidden="true" tabindex="-1"></a>  beta_1 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_1"</span>])</span>
<span id="cb224-1884"><a href="#cb224-1884" aria-hidden="true" tabindex="-1"></a>  beta_2 <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"beta_2"</span>])</span>
<span id="cb224-1885"><a href="#cb224-1885" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"sigma"</span>])</span>
<span id="cb224-1886"><a href="#cb224-1886" aria-hidden="true" tabindex="-1"></a>  sim_id <span class="ot">=</span> <span class="fu">as.numeric</span>(vec[<span class="st">"sim_id"</span>])</span>
<span id="cb224-1887"><a href="#cb224-1887" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1888"><a href="#cb224-1888" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize vectors of quantities of interest</span></span>
<span id="cb224-1889"><a href="#cb224-1889" aria-hidden="true" tabindex="-1"></a>  beta0_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1890"><a href="#cb224-1890" aria-hidden="true" tabindex="-1"></a>  beta1_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1891"><a href="#cb224-1891" aria-hidden="true" tabindex="-1"></a>  se_beta1_hat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1892"><a href="#cb224-1892" aria-hidden="true" tabindex="-1"></a>  t_star <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1893"><a href="#cb224-1893" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1894"><a href="#cb224-1894" aria-hidden="true" tabindex="-1"></a>  r_squared <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, m)</span>
<span id="cb224-1895"><a href="#cb224-1895" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1896"><a href="#cb224-1896" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop to simulate m models and extract summaries</span></span>
<span id="cb224-1897"><a href="#cb224-1897" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb224-1898"><a href="#cb224-1898" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1899"><a href="#cb224-1899" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb224-1900"><a href="#cb224-1900" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">generate_mod</span>(<span class="at">model =</span> model, <span class="at">n =</span> n, <span class="at">beta_0 =</span> beta_0, <span class="at">beta_1 =</span> beta_1, <span class="at">beta_2 =</span> beta_2, <span class="at">sigma =</span> sigma)</span>
<span id="cb224-1901"><a href="#cb224-1901" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1902"><a href="#cb224-1902" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get summaries</span></span>
<span id="cb224-1903"><a href="#cb224-1903" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; just want t-stat</span></span>
<span id="cb224-1904"><a href="#cb224-1904" aria-hidden="true" tabindex="-1"></a>    beta0_hat[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">"(Intercept)"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1905"><a href="#cb224-1905" aria-hidden="true" tabindex="-1"></a>    beta1_hat[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">"x"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb224-1906"><a href="#cb224-1906" aria-hidden="true" tabindex="-1"></a>    se_beta1_hat[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">"x"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb224-1907"><a href="#cb224-1907" aria-hidden="true" tabindex="-1"></a>    t_star[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">"x"</span>, <span class="st">"t value"</span>]</span>
<span id="cb224-1908"><a href="#cb224-1908" aria-hidden="true" tabindex="-1"></a>    mse[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb224-1909"><a href="#cb224-1909" aria-hidden="true" tabindex="-1"></a>    r_squared[i] <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span>
<span id="cb224-1910"><a href="#cb224-1910" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1911"><a href="#cb224-1911" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1912"><a href="#cb224-1912" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1913"><a href="#cb224-1913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cbind</span>(beta0_hat, beta1_hat, se_beta1_hat, t_star, mse, r_squared, <span class="at">sim_id =</span> sim_id))</span>
<span id="cb224-1914"><a href="#cb224-1914" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1915"><a href="#cb224-1915" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1916"><a href="#cb224-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1917"><a href="#cb224-1917" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to run simulation and format results</span></span>
<span id="cb224-1918"><a href="#cb224-1918" aria-hidden="true" tabindex="-1"></a>simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(params, sim_function, <span class="at">iterations =</span> <span class="dv">100</span>, <span class="at">format_results =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb224-1919"><a href="#cb224-1919" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1920"><a href="#cb224-1920" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run simulation for each parameter settings</span></span>
<span id="cb224-1921"><a href="#cb224-1921" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; have to transpose so that now each column is a parameter settings and convert to dataframe so can pass to map(), which needs a list</span></span>
<span id="cb224-1922"><a href="#cb224-1922" aria-hidden="true" tabindex="-1"></a>  results_raw <span class="ot">=</span> params <span class="sc">%&gt;%</span> </span>
<span id="cb224-1923"><a href="#cb224-1923" aria-hidden="true" tabindex="-1"></a>    t <span class="sc">%&gt;%</span> </span>
<span id="cb224-1924"><a href="#cb224-1924" aria-hidden="true" tabindex="-1"></a>    data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb224-1925"><a href="#cb224-1925" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(\(vec) <span class="fu">sim_function</span>(vec, <span class="at">vec_names =</span> <span class="fu">names</span>(params), <span class="at">m =</span> iterations), <span class="at">.progress =</span> T)</span>
<span id="cb224-1926"><a href="#cb224-1926" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1927"><a href="#cb224-1927" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>format_results){</span>
<span id="cb224-1928"><a href="#cb224-1928" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1929"><a href="#cb224-1929" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(results_raw)</span>
<span id="cb224-1930"><a href="#cb224-1930" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1931"><a href="#cb224-1931" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb224-1932"><a href="#cb224-1932" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1933"><a href="#cb224-1933" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reformat results</span></span>
<span id="cb224-1934"><a href="#cb224-1934" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; convert each results matrix to a dataframe, then combine</span></span>
<span id="cb224-1935"><a href="#cb224-1935" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; attach the simulation settings to the results</span></span>
<span id="cb224-1936"><a href="#cb224-1936" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; pivot longer to have one column for the name of the summary measure and one for its value</span></span>
<span id="cb224-1937"><a href="#cb224-1937" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; convert parameters to factors for plot</span></span>
<span id="cb224-1938"><a href="#cb224-1938" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">=</span> results_raw <span class="sc">%&gt;%</span> </span>
<span id="cb224-1939"><a href="#cb224-1939" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(\(x) <span class="fu">data.frame</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1940"><a href="#cb224-1940" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reduce</span>(bind_rows) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1941"><a href="#cb224-1941" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(params, <span class="at">by =</span> <span class="st">"sim_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1942"><a href="#cb224-1942" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(results_raw[[<span class="dv">1</span>]])<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb224-1943"><a href="#cb224-1943" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">"statistic"</span>,</span>
<span id="cb224-1944"><a href="#cb224-1944" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1945"><a href="#cb224-1945" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(params), as.factor))</span>
<span id="cb224-1946"><a href="#cb224-1946" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(results)</span>
<span id="cb224-1947"><a href="#cb224-1947" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-1948"><a href="#cb224-1948" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1949"><a href="#cb224-1949" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1950"><a href="#cb224-1950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1951"><a href="#cb224-1951" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to plot standard results</span></span>
<span id="cb224-1952"><a href="#cb224-1952" aria-hidden="true" tabindex="-1"></a>plot_results <span class="ot">&lt;-</span> <span class="cf">function</span>(res, mods) {</span>
<span id="cb224-1953"><a href="#cb224-1953" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-1954"><a href="#cb224-1954" aria-hidden="true" tabindex="-1"></a>  res <span class="sc">%&gt;%</span> </span>
<span id="cb224-1955"><a href="#cb224-1955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> mods) <span class="sc">%&gt;%</span> </span>
<span id="cb224-1956"><a href="#cb224-1956" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb224-1957"><a href="#cb224-1957" aria-hidden="true" tabindex="-1"></a>               <span class="at">group =</span> model,</span>
<span id="cb224-1958"><a href="#cb224-1958" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> model,</span>
<span id="cb224-1959"><a href="#cb224-1959" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> model),</span>
<span id="cb224-1960"><a href="#cb224-1960" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb224-1961"><a href="#cb224-1961" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb224-1962"><a href="#cb224-1962" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(statistic <span class="sc">~</span> .,</span>
<span id="cb224-1963"><a href="#cb224-1963" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">"free"</span>) </span>
<span id="cb224-1964"><a href="#cb224-1964" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-1965"><a href="#cb224-1965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1966"><a href="#cb224-1966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1967"><a href="#cb224-1967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1968"><a href="#cb224-1968" aria-hidden="true" tabindex="-1"></a><span class="fu">### Results</span></span>
<span id="cb224-1969"><a href="#cb224-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1972"><a href="#cb224-1972" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1973"><a href="#cb224-1973" aria-hidden="true" tabindex="-1"></a><span class="co"># run simulation</span></span>
<span id="cb224-1974"><a href="#cb224-1974" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">simulation</span>(<span class="at">params =</span> params, <span class="at">sim_function =</span> run_trial, <span class="at">iterations =</span> <span class="dv">1000</span>, <span class="at">format_results =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-1975"><a href="#cb224-1975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1976"><a href="#cb224-1976" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results)</span>
<span id="cb224-1977"><a href="#cb224-1977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1978"><a href="#cb224-1978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1979"><a href="#cb224-1979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1982"><a href="#cb224-1982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-1983"><a href="#cb224-1983" aria-hidden="true" tabindex="-1"></a><span class="co"># unusual observations results</span></span>
<span id="cb224-1984"><a href="#cb224-1984" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(<span class="at">res =</span> results, <span class="at">mods =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"outlier"</span>, <span class="st">"high leverage point"</span>, <span class="st">"influential point"</span>))</span>
<span id="cb224-1985"><a href="#cb224-1985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1986"><a href="#cb224-1986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-1987"><a href="#cb224-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1988"><a href="#cb224-1988" aria-hidden="true" tabindex="-1"></a>Takeaways</span>
<span id="cb224-1989"><a href="#cb224-1989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1990"><a href="#cb224-1990" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Estimated coefficients:</span>
<span id="cb224-1991"><a href="#cb224-1991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-1992"><a href="#cb224-1992" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>High leverage points really have no impact on anything (slightly inflate $R^2$).</span>
<span id="cb224-1993"><a href="#cb224-1993" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1994"><a href="#cb224-1994" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Only influential points make estimated coefficients biased.</span>
<span id="cb224-1995"><a href="#cb224-1995" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1996"><a href="#cb224-1996" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Both influential points and outliers inflate $MSE$, with influential points having more of an impact.</span>
<span id="cb224-1997"><a href="#cb224-1997" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-1998"><a href="#cb224-1998" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Outliers have the largest decrease in $R^2$; influential points decrease it as well.</span>
<span id="cb224-1999"><a href="#cb224-1999" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2000"><a href="#cb224-2000" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Standard errors of estimated coefficients are much larger for influential points, then followed by outliers.</span>
<span id="cb224-2001"><a href="#cb224-2001" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2002"><a href="#cb224-2002" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Least likely to reject test on coefficient when there is an outlier, then followed by influential points (which makes sense cause outliers lead to same estimated coefficients, but larger standard errors).</span>
<span id="cb224-2003"><a href="#cb224-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2006"><a href="#cb224-2006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2007"><a href="#cb224-2007" aria-hidden="true" tabindex="-1"></a><span class="co"># nonconstant error variance</span></span>
<span id="cb224-2008"><a href="#cb224-2008" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(<span class="at">res =</span> results, <span class="at">mods =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"increasing error variance"</span>, <span class="st">"complex error variance"</span>))</span>
<span id="cb224-2009"><a href="#cb224-2009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2010"><a href="#cb224-2010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2011"><a href="#cb224-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2012"><a href="#cb224-2012" aria-hidden="true" tabindex="-1"></a>Takeaways</span>
<span id="cb224-2013"><a href="#cb224-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2014"><a href="#cb224-2014" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Non constant error variance messes everything up, this definitely needs to be remedied first.</span>
<span id="cb224-2015"><a href="#cb224-2015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2018"><a href="#cb224-2018" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2019"><a href="#cb224-2019" aria-hidden="true" tabindex="-1"></a><span class="co"># dependent error variance</span></span>
<span id="cb224-2020"><a href="#cb224-2020" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(<span class="at">res =</span> results, <span class="at">mods =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"dependent error"</span>, <span class="st">"linear trend error"</span>, <span class="st">"cyclical error"</span>))</span>
<span id="cb224-2021"><a href="#cb224-2021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2022"><a href="#cb224-2022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2023"><a href="#cb224-2023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2024"><a href="#cb224-2024" aria-hidden="true" tabindex="-1"></a>Takeaways</span>
<span id="cb224-2025"><a href="#cb224-2025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2026"><a href="#cb224-2026" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not independent errors are just the wrong type of model for SLR.</span>
<span id="cb224-2027"><a href="#cb224-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2028"><a href="#cb224-2028" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All drastically lower $R^2$ and higher standard error of coefficients (less likely to reject), but similar estimates.</span>
<span id="cb224-2029"><a href="#cb224-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2032"><a href="#cb224-2032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2033"><a href="#cb224-2033" aria-hidden="true" tabindex="-1"></a><span class="co"># non normal error distribution</span></span>
<span id="cb224-2034"><a href="#cb224-2034" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(<span class="at">res =</span> results, <span class="at">mods =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"skewed error"</span>, <span class="st">"light tailed error"</span>, <span class="st">"heavy tailed error"</span>))</span>
<span id="cb224-2035"><a href="#cb224-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2036"><a href="#cb224-2036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2037"><a href="#cb224-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2038"><a href="#cb224-2038" aria-hidden="true" tabindex="-1"></a>Takeaways</span>
<span id="cb224-2039"><a href="#cb224-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2040"><a href="#cb224-2040" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Skewed errors seem to have little impact.</span>
<span id="cb224-2041"><a href="#cb224-2041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2042"><a href="#cb224-2042" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not sure what to make of the others, they seem extreme.</span>
<span id="cb224-2043"><a href="#cb224-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2046"><a href="#cb224-2046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2047"><a href="#cb224-2047" aria-hidden="true" tabindex="-1"></a><span class="co"># other</span></span>
<span id="cb224-2048"><a href="#cb224-2048" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_results</span>(<span class="at">res =</span> results, <span class="at">mods =</span> <span class="fu">c</span>(<span class="st">"ideal"</span>, <span class="st">"skewed x"</span>, <span class="st">"missing important x"</span>))</span>
<span id="cb224-2049"><a href="#cb224-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2050"><a href="#cb224-2050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2051"><a href="#cb224-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2052"><a href="#cb224-2052" aria-hidden="true" tabindex="-1"></a>Takeaways</span>
<span id="cb224-2053"><a href="#cb224-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2054"><a href="#cb224-2054" aria-hidden="true" tabindex="-1"></a>(not looking at when missing $x^2$, everything way off)</span>
<span id="cb224-2055"><a href="#cb224-2055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2056"><a href="#cb224-2056" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Same estimated coefficients, lots more variability when skewed $X$. This makes sense in the formula below.</span>
<span id="cb224-2057"><a href="#cb224-2057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2058"><a href="#cb224-2058" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/x-dist.png)</span>{width="80%"}</span>
<span id="cb224-2059"><a href="#cb224-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2060"><a href="#cb224-2060" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Skewed $X$ results in a drastically lower $R^2$. Interesting.</span>
<span id="cb224-2061"><a href="#cb224-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2062"><a href="#cb224-2062" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Missing important predictors leads to inflated $MSE$, which makes sense.</span>
<span id="cb224-2063"><a href="#cb224-2063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2064"><a href="#cb224-2064" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tests</span></span>
<span id="cb224-2065"><a href="#cb224-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2066"><a href="#cb224-2066" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- skipping all of the following sections for now, but NEED TO COME BACK TO --&gt;</span></span>
<span id="cb224-2067"><a href="#cb224-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2068"><a href="#cb224-2068" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Overview of tests involving residuals  --&gt;</span></span>
<span id="cb224-2069"><a href="#cb224-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2070"><a href="#cb224-2070" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Correlation test for normality  --&gt;</span></span>
<span id="cb224-2071"><a href="#cb224-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2072"><a href="#cb224-2072" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Tests for constancy of error variance  --&gt;</span></span>
<span id="cb224-2073"><a href="#cb224-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2074"><a href="#cb224-2074" aria-hidden="true" tabindex="-1"></a><span class="fu">### $F$ test for lack of fit</span></span>
<span id="cb224-2075"><a href="#cb224-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2076"><a href="#cb224-2076" aria-hidden="true" tabindex="-1"></a>This is a formal test for determining whether a specific type of regression function adequately fits the data.</span>
<span id="cb224-2077"><a href="#cb224-2077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2078"><a href="#cb224-2078" aria-hidden="true" tabindex="-1"></a>Assumptions</span>
<span id="cb224-2079"><a href="#cb224-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2080"><a href="#cb224-2080" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The lack of fit test assumes that the observations Y for given X are (1) independent and (2) normally distributed, and that (3) the distributions of the same variance $\sigma^2$.</span>
<span id="cb224-2081"><a href="#cb224-2081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2082"><a href="#cb224-2082" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The lack of fit test requires repeat observations at one or more $X$ levels (just this is sufficient). In observational studies, these just happen by chance.</span>
<span id="cb224-2083"><a href="#cb224-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2084"><a href="#cb224-2084" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Repeat trials for the same level of the predictor variable are called *replications*. The resulting observations are called *replicates*.</span>
<span id="cb224-2085"><a href="#cb224-2085" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2086"><a href="#cb224-2086" aria-hidden="true" tabindex="-1"></a>Notation</span>
<span id="cb224-2087"><a href="#cb224-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2088"><a href="#cb224-2088" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We need to modify our notation to recognize the existence of replications at some levels of $X$.</span>
<span id="cb224-2089"><a href="#cb224-2089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2090"><a href="#cb224-2090" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Let the different $X$ levels in the study, whether or not replicated observations are present, as $X_1, \ldots , X_c$ (so there are $c$ unique values of $X$).</span>
<span id="cb224-2091"><a href="#cb224-2091" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2092"><a href="#cb224-2092" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Let the number of replicates for the $j$th level of $X$ as $n_j$. Thus the total number of observations is given by $\displaystyle n = \sum_{j = 1}^c n_j$.</span>
<span id="cb224-2093"><a href="#cb224-2093" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2094"><a href="#cb224-2094" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Let the observed value of the response variable for the $i$th replicate for the $j$th level of $X$ by $Y_{ij}$, where $i = 1, \ldots, n_j, \hspace{10pt} j = 1, \ldots, c$.</span>
<span id="cb224-2095"><a href="#cb224-2095" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2096"><a href="#cb224-2096" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Let the mean of the $Y$ observations at the level $X = X_j$ by $\bar{Y}_j$. </span>
<span id="cb224-2097"><a href="#cb224-2097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2098"><a href="#cb224-2098" aria-hidden="true" tabindex="-1"></a>Full model</span>
<span id="cb224-2099"><a href="#cb224-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2100"><a href="#cb224-2100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The general linear test approach begins with the specification of the full model. The full model used for the lack of fit test makes the same assumptions as the simple linear regression model, except for assuming a linear regression relation (which is what we are testing against in this case).</span>
<span id="cb224-2101"><a href="#cb224-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2102"><a href="#cb224-2102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So the full model is (where $\mu_{ij}$ are parameters $j = 1, \ldots, c$ and $\epsilon_{ij} \followsp{iid}{Normal}(0, \sigma^2)$:</span>
<span id="cb224-2103"><a href="#cb224-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2104"><a href="#cb224-2104" aria-hidden="true" tabindex="-1"></a>$$Y_{ij} = \mu_j + \epsilon_{ij} \hspace{20pt} \text{full model}$$</span>
<span id="cb224-2105"><a href="#cb224-2105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus the parameter $\mu_j$ is the mean response when $X = X_j$:</span>
<span id="cb224-2106"><a href="#cb224-2106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2107"><a href="#cb224-2107" aria-hidden="true" tabindex="-1"></a>$$E(Y_{ij}) = \mu_j$$</span>
<span id="cb224-2108"><a href="#cb224-2108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2109"><a href="#cb224-2109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This full model is like the SLR model in that it specifies the each response is made of two components: the mean response when $X = X_j$ and a random error term. The difference is that in the full model there is no restrictions on the means $\mu_j$, whereas the SLR model the mean responses are linearly related to $X$ (i.e. $E(Y) = \beta_0 + \beta_1 X$).</span>
<span id="cb224-2110"><a href="#cb224-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2111"><a href="#cb224-2111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To fit the full model to the data, we require the least squares or maximum likelihood</span>
<span id="cb224-2112"><a href="#cb224-2112" aria-hidden="true" tabindex="-1"></a>estimators for the parameters $\mu_j$. It can be shown the estimators are the sample means:</span>
<span id="cb224-2113"><a href="#cb224-2113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2114"><a href="#cb224-2114" aria-hidden="true" tabindex="-1"></a>$$\hat{\mu}_j = \bar{Y}_j$$</span>
<span id="cb224-2115"><a href="#cb224-2115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2116"><a href="#cb224-2116" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus, the estimated expected value for observation $Y_{ij}$ is $\bar{Y}_j$, and the error sum of squares for the full model therefore is:</span>
<span id="cb224-2117"><a href="#cb224-2117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2118"><a href="#cb224-2118" aria-hidden="true" tabindex="-1"></a>$$SSE(F) = \sum_j^c \sum_i^{n_j} (Y_{ij} - \hat{Y}_{ij})^2 = \sum_j^c \sum_i^{n_j} (Y_{ij} - \bar{Y}_j)^2 = SSPE$$</span>
<span id="cb224-2119"><a href="#cb224-2119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2120"><a href="#cb224-2120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the context of the test for lack of fit, the full model error sum of squares above is called the *pure error sum of squares (SSPE)*.</span>
<span id="cb224-2121"><a href="#cb224-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2122"><a href="#cb224-2122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that $SSPE$ is made up of the sums of squared deviations at each $X$ level. At level $X = X_j$, this sum of squared deviations is shown below, which then get added over all of the $X$ levels ($j = 1, \ldots , c$):</span>
<span id="cb224-2123"><a href="#cb224-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2124"><a href="#cb224-2124" aria-hidden="true" tabindex="-1"></a>$$\sum_i (Y_{ij} - \bar{Y}_j)^2$$</span>
<span id="cb224-2125"><a href="#cb224-2125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Also note that if there is no replication at an $X$ level, then $Y_{1j} = \bar{Y}_j$ and the sum of square is simply 0 (this is why we need replication).</span>
<span id="cb224-2126"><a href="#cb224-2126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2127"><a href="#cb224-2127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The degrees of freedom associated with $SSPE$ is found like usual. At each $X_j$, there are $n_j - 1$ df. Then sum over $j$:</span>
<span id="cb224-2128"><a href="#cb224-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2129"><a href="#cb224-2129" aria-hidden="true" tabindex="-1"></a>$$df_F = \sum_j^c (n_j - 1) = \sum_j^c n_j - c = n - c$$</span>
<span id="cb224-2130"><a href="#cb224-2130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2131"><a href="#cb224-2131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that any $X$ level with no replications makes no contribution to $df_F$ because $n_j - 1 = 1 -  1 = 0$.</span>
<span id="cb224-2132"><a href="#cb224-2132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2133"><a href="#cb224-2133" aria-hidden="true" tabindex="-1"></a>Reduced model</span>
<span id="cb224-2134"><a href="#cb224-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2135"><a href="#cb224-2135" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The general linear test approach next requires consideration of the reduced model under $\ho$. For testing the appropriateness of a linear regression relation, the hypotheses are:</span>
<span id="cb224-2136"><a href="#cb224-2136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2137"><a href="#cb224-2137" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2138"><a href="#cb224-2138" aria-hidden="true" tabindex="-1"></a>\ho: E(Y) = \beta_0 + \beta_1 X \hspace{20pt} \text{Reduced model}<span class="sc">\\</span></span>
<span id="cb224-2139"><a href="#cb224-2139" aria-hidden="true" tabindex="-1"></a>\ha: E(Y) \ne \beta_0 + \beta_1 X \hspace{20pt} \text{Full model}</span>
<span id="cb224-2140"><a href="#cb224-2140" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2141"><a href="#cb224-2141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2142"><a href="#cb224-2142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Thus, $\ho$ postulates that $\mu_j$ in the full model is linearly related to $X_j$:</span>
<span id="cb224-2143"><a href="#cb224-2143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2144"><a href="#cb224-2144" aria-hidden="true" tabindex="-1"></a>$$\mu_j = \beta_0 + \beta_1 X_j$$</span>
<span id="cb224-2145"><a href="#cb224-2145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2146"><a href="#cb224-2146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The reduced model under $\ho$ therefore is:</span>
<span id="cb224-2147"><a href="#cb224-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2148"><a href="#cb224-2148" aria-hidden="true" tabindex="-1"></a>$$Y_{ij} = \beta_0 + \beta_1 X_j + \epsilon \hspace{20pt} \text{Reduced model}$$</span>
<span id="cb224-2149"><a href="#cb224-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2150"><a href="#cb224-2150" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that the reduced model is the ordinary simple linear regression model as usual, with the subscripts modified to recognize the existence of replications. We know that the estimated expected value for observation $Y_{ij}$ with usual regression model is the fitted value $Y_{ij}$</span>
<span id="cb224-2151"><a href="#cb224-2151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2152"><a href="#cb224-2152" aria-hidden="true" tabindex="-1"></a>$$Y_{ij} = \hat{\beta}_0 + \hat{\beta}_1 X_j$$</span>
<span id="cb224-2153"><a href="#cb224-2153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2154"><a href="#cb224-2154" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hence, the error sum of squares for the reduced model is the usual error sum of squares $SSE$</span>
<span id="cb224-2155"><a href="#cb224-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2156"><a href="#cb224-2156" aria-hidden="true" tabindex="-1"></a>$$SSE(R) = \sum_j^c \sum_i^{n_j} (Y_{ij} - \hat{Y}_{ij})^2 = \sum_j^c \sum_i^{n_j} (Y_{ij} - (\hat{\beta}_0 + \hat{\beta}_1 X_j))^2 = SSE$$</span>
<span id="cb224-2157"><a href="#cb224-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2158"><a href="#cb224-2158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also that the degrees of freedom associated with $SSE(R)$ are:</span>
<span id="cb224-2159"><a href="#cb224-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2160"><a href="#cb224-2160" aria-hidden="true" tabindex="-1"></a>$$df_R = n - 2$$</span>
<span id="cb224-2161"><a href="#cb224-2161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2162"><a href="#cb224-2162" aria-hidden="true" tabindex="-1"></a>Test statistic</span>
<span id="cb224-2163"><a href="#cb224-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2164"><a href="#cb224-2164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The general linear test statistic @eq-gen-lin-test (testing significant reduction is $SSE$) becomes:</span>
<span id="cb224-2165"><a href="#cb224-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2166"><a href="#cb224-2166" aria-hidden="true" tabindex="-1"></a>$$F^* = \frac{SSE - SSPE}{(n - 2) - (n - c)} \big/ \frac{SSPE}{n - c}$$</span>
<span id="cb224-2167"><a href="#cb224-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2168"><a href="#cb224-2168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The difference between the two error sums of squares is called the lack of fit sum of squares $SSLF$.</span>
<span id="cb224-2169"><a href="#cb224-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2170"><a href="#cb224-2170" aria-hidden="true" tabindex="-1"></a>$$SSLE = SSE - SSPE$$</span>
<span id="cb224-2171"><a href="#cb224-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2172"><a href="#cb224-2172" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can then express the test statistic as follows (and reject $\ho$ in favor of $\ha$ for large values of $F^*$):</span>
<span id="cb224-2173"><a href="#cb224-2173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2174"><a href="#cb224-2174" aria-hidden="true" tabindex="-1"></a>$$F^* = \frac{SSLF}{c - 2} \big/ \frac{SSPE}{n - c} = \frac{MSLF}{MSPE}$$</span>
<span id="cb224-2175"><a href="#cb224-2175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2176"><a href="#cb224-2176" aria-hidden="true" tabindex="-1"></a>ANOVA table</span>
<span id="cb224-2177"><a href="#cb224-2177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2178"><a href="#cb224-2178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The definition of the lack of fit sum of squares $SSLF$ above indicates that we have decomposed the error sum of squares SSE into two components:</span>
<span id="cb224-2179"><a href="#cb224-2179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2180"><a href="#cb224-2180" aria-hidden="true" tabindex="-1"></a>$$SSE = SSPE + SSLF$$</span>
<span id="cb224-2181"><a href="#cb224-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2182"><a href="#cb224-2182" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The decomposition comes from the identity (which shows that the error deviations in $SSE$ are made up of a pure error component and a lack of fit component):</span>
<span id="cb224-2183"><a href="#cb224-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2184"><a href="#cb224-2184" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/lof-identity.png)</span>{width="50%"}</span>
<span id="cb224-2185"><a href="#cb224-2185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2186"><a href="#cb224-2186" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/lof-visualized.png)</span>{width="50%"}</span>
<span id="cb224-2187"><a href="#cb224-2187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2188"><a href="#cb224-2188" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/lof-formulas.png)</span>{width="80%"}</span>
<span id="cb224-2189"><a href="#cb224-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2190"><a href="#cb224-2190" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Last formula above indicates clearly why $SSLF$ measures lack of fit.</span>
<span id="cb224-2191"><a href="#cb224-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2192"><a href="#cb224-2192" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>If the linear regression function is appropriate, then the means $\bar{Y}_j$ will be near the fitted values $\hat{Y}_j$ calculated from the estimated linear regression function and $SSLF$ will be small.</span>
<span id="cb224-2193"><a href="#cb224-2193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2194"><a href="#cb224-2194" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>On the other hand, if the linear regression function is not appropriate, the means $\bar{Y}_j$ will not be near the fitted values calculated from the estimated linear regression function and $SSLF$ will be large.</span>
<span id="cb224-2195"><a href="#cb224-2195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2196"><a href="#cb224-2196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This formulas also indicates why $c - 2$ degrees of freedom are associated with $SSLF$.</span>
<span id="cb224-2197"><a href="#cb224-2197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2198"><a href="#cb224-2198" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>There are $c$ means $\bar{Y}_j$ in the sum of squares ($\approx$ $c$ observations), and two dfs are lost in estimating the parameters $\beta_0$ and $\beta_1$ of the linear regression function to obtain the fitted values $\hat{Y}_j$.</span>
<span id="cb224-2199"><a href="#cb224-2199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-2200"><a href="#cb224-2200" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An ANOVA table can be constructed for the decomposition of SSE.</span>
<span id="cb224-2201"><a href="#cb224-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2202"><a href="#cb224-2202" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/lof-anova-table.png)</span>{width="80%"}</span>
<span id="cb224-2203"><a href="#cb224-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2204"><a href="#cb224-2204" aria-hidden="true" tabindex="-1"></a>Notes</span>
<span id="cb224-2205"><a href="#cb224-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2206"><a href="#cb224-2206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The reason for the term "pure error" is that $MSPE$ is always an unbiased estimator of the error term variance $\sigma^2$, no matter what is the true regression function. But we still always use $MSE$ becuase it has more df.</span>
<span id="cb224-2207"><a href="#cb224-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2208"><a href="#cb224-2208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The general linear test approach just explained can be used to test the appropriateness of other regression functions.  Only the degrees of freedom for $SSLF$ will need be modified. In general, $c - p$ degrees of freedom are associated with $SSLF$, where $p$ is the number of parameters in the regression function.</span>
<span id="cb224-2209"><a href="#cb224-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2210"><a href="#cb224-2210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The alternative $\ha$ includes all regression functions other than a linear one. For instance, it includes a quadratic regression function or a logarithmic one. If $\ha$ is concluded, a study of residuals can be helpful in identifying an appropriate function.</span>
<span id="cb224-2211"><a href="#cb224-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2212"><a href="#cb224-2212" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-2213"><a href="#cb224-2213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2214"><a href="#cb224-2214" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-2215"><a href="#cb224-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2216"><a href="#cb224-2216" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R functions - Testing linear model</span></span>
<span id="cb224-2217"><a href="#cb224-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2220"><a href="#cb224-2220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2221"><a href="#cb224-2221" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data from ideal model (no lack of fit -&gt; expecting to not reject)</span></span>
<span id="cb224-2222"><a href="#cb224-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2223"><a href="#cb224-2223" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-2224"><a href="#cb224-2224" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-2225"><a href="#cb224-2225" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb224-2226"><a href="#cb224-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2227"><a href="#cb224-2227" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values (asuming there will be some replicates)</span></span>
<span id="cb224-2228"><a href="#cb224-2228" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">rdunif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb224-2229"><a href="#cb224-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2230"><a href="#cb224-2230" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-2231"><a href="#cb224-2231" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-2232"><a href="#cb224-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2233"><a href="#cb224-2233" aria-hidden="true" tabindex="-1"></a><span class="co"># plot and add lines (don't have a straight line anymore, so can't use abline() for unrestricted model)</span></span>
<span id="cb224-2234"><a href="#cb224-2234" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have to plot x vs y-hat, but sorted according to x</span></span>
<span id="cb224-2235"><a href="#cb224-2235" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span>
<span id="cb224-2236"><a href="#cb224-2236" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2237"><a href="#cb224-2237" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">data.frame</span>(<span class="at">y_hat =</span> <span class="fu">fitted</span>(.), x)} <span class="sc">%&gt;%</span> </span>
<span id="cb224-2238"><a href="#cb224-2238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x) <span class="sc">%$%</span> </span>
<span id="cb224-2239"><a href="#cb224-2239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x, y_hat, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2240"><a href="#cb224-2240" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2241"><a href="#cb224-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2242"><a href="#cb224-2242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2243"><a href="#cb224-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2244"><a href="#cb224-2244" aria-hidden="true" tabindex="-1"></a>Reduced model trend line follows group means line fairly well.</span>
<span id="cb224-2245"><a href="#cb224-2245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2246"><a href="#cb224-2246" aria-hidden="true" tabindex="-1"></a>Testing</span>
<span id="cb224-2247"><a href="#cb224-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2248"><a href="#cb224-2248" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2249"><a href="#cb224-2249" aria-hidden="true" tabindex="-1"></a>\ho: E(Y) = \beta_0 + \beta_1 X \hspace{20pt} \text{Reduced model}<span class="sc">\\</span></span>
<span id="cb224-2250"><a href="#cb224-2250" aria-hidden="true" tabindex="-1"></a>\ha: E(Y) \ne \beta_0 + \beta_1 X \hspace{20pt} \text{Full model}</span>
<span id="cb224-2251"><a href="#cb224-2251" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2252"><a href="#cb224-2252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2255"><a href="#cb224-2255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2256"><a href="#cb224-2256" aria-hidden="true" tabindex="-1"></a><span class="co"># fit full model</span></span>
<span id="cb224-2257"><a href="#cb224-2257" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1X</span></span>
<span id="cb224-2258"><a href="#cb224-2258" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x))</span>
<span id="cb224-2259"><a href="#cb224-2259" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span>
<span id="cb224-2260"><a href="#cb224-2260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2261"><a href="#cb224-2261" aria-hidden="true" tabindex="-1"></a><span class="co"># fit reduced model</span></span>
<span id="cb224-2262"><a href="#cb224-2262" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; SLR model E(Y) + B0 + B1X</span></span>
<span id="cb224-2263"><a href="#cb224-2263" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb224-2264"><a href="#cb224-2264" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reduced)</span>
<span id="cb224-2265"><a href="#cb224-2265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2266"><a href="#cb224-2266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2267"><a href="#cb224-2267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2270"><a href="#cb224-2270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2271"><a href="#cb224-2271" aria-hidden="true" tabindex="-1"></a><span class="co"># run lack of fit test</span></span>
<span id="cb224-2272"><a href="#cb224-2272" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; looking at F and PR(&gt;F)</span></span>
<span id="cb224-2273"><a href="#cb224-2273" aria-hidden="true" tabindex="-1"></a>(at <span class="ot">&lt;-</span> <span class="fu">anova</span>(mod_full, mod_reduced))</span>
<span id="cb224-2274"><a href="#cb224-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2275"><a href="#cb224-2275" aria-hidden="true" tabindex="-1"></a><span class="co"># other terms</span></span>
<span id="cb224-2276"><a href="#cb224-2276" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; Sum of Sq = SSLF --&gt; MSLF = SSLF / change in Df</span></span>
<span id="cb224-2277"><a href="#cb224-2277" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; RSS(1) = SSPE --&gt; MSPE = SSPE / Res. Df(1)</span></span>
<span id="cb224-2278"><a href="#cb224-2278" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; F = MSLF / MSPE</span></span>
<span id="cb224-2279"><a href="#cb224-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2280"><a href="#cb224-2280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2281"><a href="#cb224-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2282"><a href="#cb224-2282" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Manual</span></span>
<span id="cb224-2283"><a href="#cb224-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2284"><a href="#cb224-2284" aria-hidden="true" tabindex="-1"></a>Setup dataset to manually calculate the required mean squares.</span>
<span id="cb224-2285"><a href="#cb224-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2288"><a href="#cb224-2288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2289"><a href="#cb224-2289" aria-hidden="true" tabindex="-1"></a><span class="co"># order data by X variable</span></span>
<span id="cb224-2290"><a href="#cb224-2290" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; use this dataset for the remainder of the calculations</span></span>
<span id="cb224-2291"><a href="#cb224-2291" aria-hidden="true" tabindex="-1"></a>data_sorted <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y, x) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2292"><a href="#cb224-2292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x)</span>
<span id="cb224-2293"><a href="#cb224-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2294"><a href="#cb224-2294" aria-hidden="true" tabindex="-1"></a><span class="co"># refit model on sorted data (so fitted values and residuals pull in correctly later)</span></span>
<span id="cb224-2295"><a href="#cb224-2295" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, data_sorted)</span>
<span id="cb224-2296"><a href="#cb224-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2297"><a href="#cb224-2297" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate group means by X variable</span></span>
<span id="cb224-2298"><a href="#cb224-2298" aria-hidden="true" tabindex="-1"></a>data_group_means <span class="ot">&lt;-</span> data_sorted <span class="sc">%&gt;%</span> </span>
<span id="cb224-2299"><a href="#cb224-2299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2300"><a href="#cb224-2300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">group_mean =</span> <span class="fu">mean</span>(y))</span>
<span id="cb224-2301"><a href="#cb224-2301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2302"><a href="#cb224-2302" aria-hidden="true" tabindex="-1"></a><span class="co"># complete table to manually perform LOF test</span></span>
<span id="cb224-2303"><a href="#cb224-2303" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; append predicted values from reduced model</span></span>
<span id="cb224-2304"><a href="#cb224-2304" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add group means by merging with group means dataset</span></span>
<span id="cb224-2305"><a href="#cb224-2305" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; calculate:</span></span>
<span id="cb224-2306"><a href="#cb224-2306" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; residual = Y - hat(Y) = obs - pred value -&gt; measure total deviation</span></span>
<span id="cb224-2307"><a href="#cb224-2307" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; pure error = Y - bar(Y)_j = obs - group mean -&gt; measures the pure error, which is the randomness result from the data, not from the choice of model</span></span>
<span id="cb224-2308"><a href="#cb224-2308" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; lack of fit error = bar(Y)_j - hat(Y) = group mean - pred value -&gt; measures the lack of fit deviation, which is the error result from the choice of model and could be improved with a better mode</span></span>
<span id="cb224-2309"><a href="#cb224-2309" aria-hidden="true" tabindex="-1"></a>data_lof_process <span class="ot">&lt;-</span> data_sorted <span class="sc">%&gt;%</span> </span>
<span id="cb224-2310"><a href="#cb224-2310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_value =</span> <span class="fu">fitted</span>(mod_reduced),</span>
<span id="cb224-2311"><a href="#cb224-2311" aria-hidden="true" tabindex="-1"></a>         <span class="at">residual =</span> <span class="fu">residuals</span>(mod_reduced)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2312"><a href="#cb224-2312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_group_means, <span class="at">by =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2313"><a href="#cb224-2313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pure_error =</span> y <span class="sc">-</span> group_mean,</span>
<span id="cb224-2314"><a href="#cb224-2314" aria-hidden="true" tabindex="-1"></a>         <span class="at">lof_error =</span> group_mean <span class="sc">-</span> predicted_value)</span>
<span id="cb224-2315"><a href="#cb224-2315" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_lof_process, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb224-2316"><a href="#cb224-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2317"><a href="#cb224-2317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2318"><a href="#cb224-2318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2319"><a href="#cb224-2319" aria-hidden="true" tabindex="-1"></a>Find sum of squares.</span>
<span id="cb224-2320"><a href="#cb224-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2323"><a href="#cb224-2323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2324"><a href="#cb224-2324" aria-hidden="true" tabindex="-1"></a><span class="co"># compute final sums of squares</span></span>
<span id="cb224-2325"><a href="#cb224-2325" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; lack of fit dataset is setup so that each quantity is calculated for every row</span></span>
<span id="cb224-2326"><a href="#cb224-2326" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; just need to square each value and sum</span></span>
<span id="cb224-2327"><a href="#cb224-2327" aria-hidden="true" tabindex="-1"></a>(data_ss <span class="ot">&lt;-</span> data_lof_process <span class="sc">%&gt;%</span> </span>
<span id="cb224-2328"><a href="#cb224-2328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">error =</span> <span class="fu">sum</span>(residual<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb224-2329"><a href="#cb224-2329" aria-hidden="true" tabindex="-1"></a>            <span class="at">lf =</span> <span class="fu">sum</span>(lof_error<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb224-2330"><a href="#cb224-2330" aria-hidden="true" tabindex="-1"></a>            <span class="at">pe =</span> <span class="fu">sum</span>(pure_error<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb224-2331"><a href="#cb224-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2332"><a href="#cb224-2332" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(<span class="fu">abs</span>(at[<span class="dv">2</span>, <span class="st">"Sum of Sq"</span>]), data_ss<span class="sc">$</span>lf)</span>
<span id="cb224-2333"><a href="#cb224-2333" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(<span class="fu">abs</span>(at[<span class="dv">1</span>, <span class="st">"RSS"</span>]), data_ss<span class="sc">$</span>pe)</span>
<span id="cb224-2334"><a href="#cb224-2334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2335"><a href="#cb224-2335" aria-hidden="true" tabindex="-1"></a><span class="co"># sums of squares are additive and SSPE and SSLF are partitioning SSE</span></span>
<span id="cb224-2336"><a href="#cb224-2336" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so check that SSE = SSPE + SSLF</span></span>
<span id="cb224-2337"><a href="#cb224-2337" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(<span class="fu">sum</span>(data_ss[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]), data_ss[,<span class="dv">1</span>])</span>
<span id="cb224-2338"><a href="#cb224-2338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2339"><a href="#cb224-2339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2340"><a href="#cb224-2340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2341"><a href="#cb224-2341" aria-hidden="true" tabindex="-1"></a>Find df.</span>
<span id="cb224-2342"><a href="#cb224-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2345"><a href="#cb224-2345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2346"><a href="#cb224-2346" aria-hidden="true" tabindex="-1"></a><span class="co"># set vector of df</span></span>
<span id="cb224-2347"><a href="#cb224-2347" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; df sse = n - 2 (for slr, in general p)</span></span>
<span id="cb224-2348"><a href="#cb224-2348" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; df sslf = c - 2 = # of x levels - 2 </span></span>
<span id="cb224-2349"><a href="#cb224-2349" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; df sspe = n - c</span></span>
<span id="cb224-2350"><a href="#cb224-2350" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_sorted)</span>
<span id="cb224-2351"><a href="#cb224-2351" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_group_means)</span>
<span id="cb224-2352"><a href="#cb224-2352" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"error"</span> <span class="ot">=</span> n <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(mod_reduced)),</span>
<span id="cb224-2353"><a href="#cb224-2353" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lf"</span> <span class="ot">=</span> c <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(mod_reduced)),</span>
<span id="cb224-2354"><a href="#cb224-2354" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pe"</span> <span class="ot">=</span> n <span class="sc">-</span> c)</span>
<span id="cb224-2355"><a href="#cb224-2355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2356"><a href="#cb224-2356" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape SS data to add df</span></span>
<span id="cb224-2357"><a href="#cb224-2357" aria-hidden="true" tabindex="-1"></a>(data_anova_table <span class="ot">&lt;-</span> data_ss <span class="sc">%&gt;%</span> </span>
<span id="cb224-2358"><a href="#cb224-2358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb224-2359"><a href="#cb224-2359" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb224-2360"><a href="#cb224-2360" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"ss"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2361"><a href="#cb224-2361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(df)))</span>
<span id="cb224-2362"><a href="#cb224-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2363"><a href="#cb224-2363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2364"><a href="#cb224-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2365"><a href="#cb224-2365" aria-hidden="true" tabindex="-1"></a>Calculate mean squares.</span>
<span id="cb224-2366"><a href="#cb224-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2369"><a href="#cb224-2369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2370"><a href="#cb224-2370" aria-hidden="true" tabindex="-1"></a><span class="co"># add MS to anova table</span></span>
<span id="cb224-2371"><a href="#cb224-2371" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; MS = SS / df</span></span>
<span id="cb224-2372"><a href="#cb224-2372" aria-hidden="true" tabindex="-1"></a>(data_anova_table <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb224-2373"><a href="#cb224-2373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms =</span> ss <span class="sc">/</span> df))</span>
<span id="cb224-2374"><a href="#cb224-2374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2375"><a href="#cb224-2375" aria-hidden="true" tabindex="-1"></a><span class="co"># compute final LOF test statistic</span></span>
<span id="cb224-2376"><a href="#cb224-2376" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; F* = MSLF / MSPE</span></span>
<span id="cb224-2377"><a href="#cb224-2377" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; convert to numeric so end result isn't a dataframe</span></span>
<span id="cb224-2378"><a href="#cb224-2378" aria-hidden="true" tabindex="-1"></a>(F_star <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data_anova_table[data_anova_table<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"lf"</span>, <span class="st">"ms"</span>]) <span class="sc">/</span> <span class="fu">as.numeric</span>(data_anova_table[data_anova_table<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"pe"</span>, <span class="st">"ms"</span>]))</span>
<span id="cb224-2379"><a href="#cb224-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2380"><a href="#cb224-2380" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(at[<span class="dv">2</span>, <span class="st">"F"</span>], F_star)</span>
<span id="cb224-2381"><a href="#cb224-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2382"><a href="#cb224-2382" aria-hidden="true" tabindex="-1"></a><span class="co"># compute critical value</span></span>
<span id="cb224-2383"><a href="#cb224-2383" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; LOF critical value (and test statistic) ~ F(c-2, n-c)</span></span>
<span id="cb224-2384"><a href="#cb224-2384" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; right tailed test</span></span>
<span id="cb224-2385"><a href="#cb224-2385" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb224-2386"><a href="#cb224-2386" aria-hidden="true" tabindex="-1"></a>(F_crit <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> alpha, <span class="at">df1 =</span> c <span class="sc">-</span> <span class="dv">2</span>, <span class="at">df2 =</span> n <span class="sc">-</span> c, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))</span>
<span id="cb224-2387"><a href="#cb224-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2388"><a href="#cb224-2388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2389"><a href="#cb224-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2390"><a href="#cb224-2390" aria-hidden="true" tabindex="-1"></a>Conclusion</span>
<span id="cb224-2391"><a href="#cb224-2391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2394"><a href="#cb224-2394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2395"><a href="#cb224-2395" aria-hidden="true" tabindex="-1"></a><span class="co"># compare test statistic and critical value</span></span>
<span id="cb224-2396"><a href="#cb224-2396" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; critical value way: if F* &gt;&gt; F_crit, then reject</span></span>
<span id="cb224-2397"><a href="#cb224-2397" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; p-value way: if P(F &gt; F*) &lt; alpha = then reject</span></span>
<span id="cb224-2398"><a href="#cb224-2398" aria-hidden="true" tabindex="-1"></a>F_star <span class="sc">&gt;</span> F_crit</span>
<span id="cb224-2399"><a href="#cb224-2399" aria-hidden="true" tabindex="-1"></a>(p_value <span class="ot">&lt;-</span> <span class="fu">pf</span>(<span class="at">q =</span> F_star, <span class="at">df1 =</span> c <span class="sc">-</span> <span class="dv">2</span>, <span class="at">df2 =</span> n <span class="sc">-</span> c, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))</span>
<span id="cb224-2400"><a href="#cb224-2400" aria-hidden="true" tabindex="-1"></a>p_value <span class="sc">&lt;</span> alpha</span>
<span id="cb224-2401"><a href="#cb224-2401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2402"><a href="#cb224-2402" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(at[<span class="dv">2</span>, <span class="st">"Pr(&gt;F)"</span>], p_value)</span>
<span id="cb224-2403"><a href="#cb224-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2404"><a href="#cb224-2404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2405"><a href="#cb224-2405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2406"><a href="#cb224-2406" aria-hidden="true" tabindex="-1"></a>FAIL TO REJECT. There is not a lack of fit issue with the data.</span>
<span id="cb224-2407"><a href="#cb224-2407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2408"><a href="#cb224-2408" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Testing complex model</span></span>
<span id="cb224-2409"><a href="#cb224-2409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2412"><a href="#cb224-2412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2413"><a href="#cb224-2413" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data from complex model (lack of fit -&gt; expecting to reject)</span></span>
<span id="cb224-2414"><a href="#cb224-2414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2415"><a href="#cb224-2415" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-2416"><a href="#cb224-2416" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-2417"><a href="#cb224-2417" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_2 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_3 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb224-2418"><a href="#cb224-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2419"><a href="#cb224-2419" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values (asuming there will be some replicates)</span></span>
<span id="cb224-2420"><a href="#cb224-2420" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> extraDistr<span class="sc">::</span><span class="fu">rdunif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb224-2421"><a href="#cb224-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2422"><a href="#cb224-2422" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-2423"><a href="#cb224-2423" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta_3 <span class="sc">*</span> <span class="fu">log</span>(x) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-2424"><a href="#cb224-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2425"><a href="#cb224-2425" aria-hidden="true" tabindex="-1"></a><span class="co"># plot and add lines</span></span>
<span id="cb224-2426"><a href="#cb224-2426" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span>
<span id="cb224-2427"><a href="#cb224-2427" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2428"><a href="#cb224-2428" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">data.frame</span>(<span class="at">y_hat =</span> <span class="fu">fitted</span>(.), x)} <span class="sc">%&gt;%</span> </span>
<span id="cb224-2429"><a href="#cb224-2429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x) <span class="sc">%$%</span> </span>
<span id="cb224-2430"><a href="#cb224-2430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x, y_hat, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2431"><a href="#cb224-2431" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">log</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2432"><a href="#cb224-2432" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">data.frame</span>(<span class="at">y_hat =</span> <span class="fu">fitted</span>(.), x)} <span class="sc">%&gt;%</span> </span>
<span id="cb224-2433"><a href="#cb224-2433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x) <span class="sc">%$%</span> </span>
<span id="cb224-2434"><a href="#cb224-2434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x, y_hat, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2435"><a href="#cb224-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2436"><a href="#cb224-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2437"><a href="#cb224-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2438"><a href="#cb224-2438" aria-hidden="true" tabindex="-1"></a>Lines are close, but the reduced model is relatively far (keep in mind $Y$ scale) the unrestricted model at certain $X$ levels.</span>
<span id="cb224-2439"><a href="#cb224-2439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2440"><a href="#cb224-2440" aria-hidden="true" tabindex="-1"></a>Testing:</span>
<span id="cb224-2441"><a href="#cb224-2441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2442"><a href="#cb224-2442" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2443"><a href="#cb224-2443" aria-hidden="true" tabindex="-1"></a>\ho: E(Y) = \beta_0 + \beta_1 X + \beta_2 \ln(X) \hspace{20pt} \text{Reduced model}<span class="sc">\\</span></span>
<span id="cb224-2444"><a href="#cb224-2444" aria-hidden="true" tabindex="-1"></a>\ha: E(Y) \ne \beta_0 + \beta_1 X + \beta_2 \ln(X)  \hspace{20pt} \text{Full model}</span>
<span id="cb224-2445"><a href="#cb224-2445" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2446"><a href="#cb224-2446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2449"><a href="#cb224-2449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2450"><a href="#cb224-2450" aria-hidden="true" tabindex="-1"></a><span class="co"># fit full model</span></span>
<span id="cb224-2451"><a href="#cb224-2451" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1 X + B2 ln(X)</span></span>
<span id="cb224-2452"><a href="#cb224-2452" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x))</span>
<span id="cb224-2453"><a href="#cb224-2453" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span>
<span id="cb224-2454"><a href="#cb224-2454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2455"><a href="#cb224-2455" aria-hidden="true" tabindex="-1"></a><span class="co"># fit reduced model</span></span>
<span id="cb224-2456"><a href="#cb224-2456" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; polynomial model E(Y) + B0 + B1 X + B2 ln(X)</span></span>
<span id="cb224-2457"><a href="#cb224-2457" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">log</span>(x)))</span>
<span id="cb224-2458"><a href="#cb224-2458" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reduced)</span>
<span id="cb224-2459"><a href="#cb224-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2460"><a href="#cb224-2460" aria-hidden="true" tabindex="-1"></a><span class="co"># perform lack of fit test</span></span>
<span id="cb224-2461"><a href="#cb224-2461" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_full, mod_reduced)</span>
<span id="cb224-2462"><a href="#cb224-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2463"><a href="#cb224-2463" aria-hidden="true" tabindex="-1"></a><span class="co"># this matched when ran same scenario through manual process!</span></span>
<span id="cb224-2464"><a href="#cb224-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2465"><a href="#cb224-2465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2466"><a href="#cb224-2466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2467"><a href="#cb224-2467" aria-hidden="true" tabindex="-1"></a>This shows significant lack of fit. So add in missing polynomial and retry.</span>
<span id="cb224-2468"><a href="#cb224-2468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2471"><a href="#cb224-2471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2472"><a href="#cb224-2472" aria-hidden="true" tabindex="-1"></a><span class="co"># plot and add line (don't have a straight line anymore, so can't use abline())</span></span>
<span id="cb224-2473"><a href="#cb224-2473" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have to plot x vs y-hat, but sorted according to x</span></span>
<span id="cb224-2474"><a href="#cb224-2474" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; </span><span class="al">NOTE</span><span class="co"> both TRUE and FALSE for raw lead to SAME predictions, but DRASTISCALLY different estimates, perhaps because multicollinearity gives biased estimates</span></span>
<span id="cb224-2475"><a href="#cb224-2475" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span>
<span id="cb224-2476"><a href="#cb224-2476" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2477"><a href="#cb224-2477" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">data.frame</span>(<span class="at">y_hat =</span> <span class="fu">fitted</span>(.), x)} <span class="sc">%&gt;%</span> </span>
<span id="cb224-2478"><a href="#cb224-2478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x) <span class="sc">%$%</span> </span>
<span id="cb224-2479"><a href="#cb224-2479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x, y_hat, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2480"><a href="#cb224-2480" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2481"><a href="#cb224-2481" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">data.frame</span>(<span class="at">y_hat =</span> <span class="fu">fitted</span>(.), x)} <span class="sc">%&gt;%</span> </span>
<span id="cb224-2482"><a href="#cb224-2482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x) <span class="sc">%$%</span> </span>
<span id="cb224-2483"><a href="#cb224-2483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x, y_hat, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2484"><a href="#cb224-2484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2485"><a href="#cb224-2485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2486"><a href="#cb224-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2487"><a href="#cb224-2487" aria-hidden="true" tabindex="-1"></a>Now the unrestriced and the reduced model are almost equivalent at all points.</span>
<span id="cb224-2488"><a href="#cb224-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2489"><a href="#cb224-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2492"><a href="#cb224-2492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2493"><a href="#cb224-2493" aria-hidden="true" tabindex="-1"></a><span class="co"># fit full model</span></span>
<span id="cb224-2494"><a href="#cb224-2494" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; E(Y) = mu_j = anything other than B0 + B1 X + B2 ln(X)</span></span>
<span id="cb224-2495"><a href="#cb224-2495" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x))</span>
<span id="cb224-2496"><a href="#cb224-2496" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span>
<span id="cb224-2497"><a href="#cb224-2497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2498"><a href="#cb224-2498" aria-hidden="true" tabindex="-1"></a><span class="co"># fit reduced model</span></span>
<span id="cb224-2499"><a href="#cb224-2499" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; polynomial model E(Y) + B0 + B1 X + B2 ln(X)</span></span>
<span id="cb224-2500"><a href="#cb224-2500" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">log</span>(x)))</span>
<span id="cb224-2501"><a href="#cb224-2501" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reduced)</span>
<span id="cb224-2502"><a href="#cb224-2502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2503"><a href="#cb224-2503" aria-hidden="true" tabindex="-1"></a><span class="co"># perform lack of fit test</span></span>
<span id="cb224-2504"><a href="#cb224-2504" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_full, mod_reduced)</span>
<span id="cb224-2505"><a href="#cb224-2505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2506"><a href="#cb224-2506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2507"><a href="#cb224-2507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2508"><a href="#cb224-2508" aria-hidden="true" tabindex="-1"></a>This shows no lack of fit now!</span>
<span id="cb224-2509"><a href="#cb224-2509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2510"><a href="#cb224-2510" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Multiple regression higher order</span></span>
<span id="cb224-2511"><a href="#cb224-2511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2512"><a href="#cb224-2512" aria-hidden="true" tabindex="-1"></a>Testing:</span>
<span id="cb224-2513"><a href="#cb224-2513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2514"><a href="#cb224-2514" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2515"><a href="#cb224-2515" aria-hidden="true" tabindex="-1"></a>\ho: E(Y) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_{11} x_1^2 + \beta_{22} x_2^2 + \beta_{12} x_1 x_2\hspace{20pt} \text{Reduced model}<span class="sc">\\</span></span>
<span id="cb224-2516"><a href="#cb224-2516" aria-hidden="true" tabindex="-1"></a>\ha: E(Y) \ne \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_{11} x_1^2 + \beta_{22} x_2^2 + \beta_{12} x_1 x_2\  \hspace{20pt} \text{Full model}</span>
<span id="cb224-2517"><a href="#cb224-2517" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2518"><a href="#cb224-2518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2519"><a href="#cb224-2519" aria-hidden="true" tabindex="-1"></a>Note that each $X$ variable is centered and scaled (to avoid multicollinearity of higher order terms): $x_{i1} = X_{i1} - \bar{X_1}$ and $x_{i2} = X_{i2} - \bar{X_2}$.</span>
<span id="cb224-2520"><a href="#cb224-2520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2523"><a href="#cb224-2523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2524"><a href="#cb224-2524" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data (from table 8.1 on page 300 of textbook)</span></span>
<span id="cb224-2525"><a href="#cb224-2525" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb224-2526"><a href="#cb224-2526" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb224-2527"><a href="#cb224-2527" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">86</span>,<span class="dv">49</span>,<span class="dv">288</span>,<span class="dv">157</span>,<span class="dv">131</span>,<span class="dv">184</span>,<span class="dv">109</span>,<span class="dv">279</span>,<span class="dv">235</span>,<span class="dv">224</span>)</span>
<span id="cb224-2528"><a href="#cb224-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2529"><a href="#cb224-2529" aria-hidden="true" tabindex="-1"></a><span class="co"># fit full model</span></span>
<span id="cb224-2530"><a href="#cb224-2530" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; E(Y) = mu_j = anything other than the reduced model</span></span>
<span id="cb224-2531"><a href="#cb224-2531" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; note that x1*x2 denotes factor crossing = x1 + x2 + x1:x2</span></span>
<span id="cb224-2532"><a href="#cb224-2532" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">as.factor</span>(x1) <span class="sc">*</span> <span class="fu">as.factor</span>(x2))</span>
<span id="cb224-2533"><a href="#cb224-2533" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span>
<span id="cb224-2534"><a href="#cb224-2534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2535"><a href="#cb224-2535" aria-hidden="true" tabindex="-1"></a><span class="co"># fit reduced model</span></span>
<span id="cb224-2536"><a href="#cb224-2536" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; second order model</span></span>
<span id="cb224-2537"><a href="#cb224-2537" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; can use I() because data is already transformed for multicollinearity</span></span>
<span id="cb224-2538"><a href="#cb224-2538" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">*</span>x2))</span>
<span id="cb224-2539"><a href="#cb224-2539" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reduced)</span>
<span id="cb224-2540"><a href="#cb224-2540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2541"><a href="#cb224-2541" aria-hidden="true" tabindex="-1"></a><span class="co"># perform lack of fit test</span></span>
<span id="cb224-2542"><a href="#cb224-2542" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_full, mod_reduced)</span>
<span id="cb224-2543"><a href="#cb224-2543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2544"><a href="#cb224-2544" aria-hidden="true" tabindex="-1"></a><span class="co"># this matched when ran same scenario through manual process!</span></span>
<span id="cb224-2545"><a href="#cb224-2545" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; just had to group_by(x1, x2) for data_group_means and join_by("x1", "x2")</span></span>
<span id="cb224-2546"><a href="#cb224-2546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2547"><a href="#cb224-2547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2548"><a href="#cb224-2548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2549"><a href="#cb224-2549" aria-hidden="true" tabindex="-1"></a>This shows that there is no lack of fit, so a higher order model isn't needed.</span>
<span id="cb224-2550"><a href="#cb224-2550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2551"><a href="#cb224-2551" aria-hidden="true" tabindex="-1"></a>Now we can do a partial $F$ test to determine if the second order terms are needed or if a first order model is sufficient.</span>
<span id="cb224-2552"><a href="#cb224-2552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2553"><a href="#cb224-2553" aria-hidden="true" tabindex="-1"></a>Testing:</span>
<span id="cb224-2554"><a href="#cb224-2554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2555"><a href="#cb224-2555" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2556"><a href="#cb224-2556" aria-hidden="true" tabindex="-1"></a>\ho: \beta_{11} = \beta_{22} x_2^2 = \beta_{12} = 0<span class="sc">\\</span></span>
<span id="cb224-2557"><a href="#cb224-2557" aria-hidden="true" tabindex="-1"></a>\ha: \text{Not all } \beta \text{s in } \ho \text{ equal } 0</span>
<span id="cb224-2558"><a href="#cb224-2558" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-2559"><a href="#cb224-2559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2562"><a href="#cb224-2562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2563"><a href="#cb224-2563" aria-hidden="true" tabindex="-1"></a><span class="co"># fit new full model (second order)</span></span>
<span id="cb224-2564"><a href="#cb224-2564" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; second order model</span></span>
<span id="cb224-2565"><a href="#cb224-2565" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">*</span>x2))</span>
<span id="cb224-2566"><a href="#cb224-2566" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span>
<span id="cb224-2567"><a href="#cb224-2567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2568"><a href="#cb224-2568" aria-hidden="true" tabindex="-1"></a><span class="co"># fit new reduced model (first order)</span></span>
<span id="cb224-2569"><a href="#cb224-2569" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; needs to be nested</span></span>
<span id="cb224-2570"><a href="#cb224-2570" aria-hidden="true" tabindex="-1"></a>mod_reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2)</span>
<span id="cb224-2571"><a href="#cb224-2571" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reduced)</span>
<span id="cb224-2572"><a href="#cb224-2572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2573"><a href="#cb224-2573" aria-hidden="true" tabindex="-1"></a><span class="co"># perform partial F test</span></span>
<span id="cb224-2574"><a href="#cb224-2574" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_full, mod_reduced)</span>
<span id="cb224-2575"><a href="#cb224-2575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2576"><a href="#cb224-2576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2577"><a href="#cb224-2577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2578"><a href="#cb224-2578" aria-hidden="true" tabindex="-1"></a>This says that we can drop the higher order terms and a first order model is sufficient.</span>
<span id="cb224-2579"><a href="#cb224-2579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2580"><a href="#cb224-2580" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-2581"><a href="#cb224-2581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2582"><a href="#cb224-2582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview of remedial measures</span></span>
<span id="cb224-2583"><a href="#cb224-2583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2584"><a href="#cb224-2584" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-2585"><a href="#cb224-2585" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Overview</span></span>
<span id="cb224-2586"><a href="#cb224-2586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2587"><a href="#cb224-2587" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the normal error SLR model is not appropriate for a dataset, there are two basic choices, both of which have their advantages and disadvantages:</span>
<span id="cb224-2588"><a href="#cb224-2588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2589"><a href="#cb224-2589" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>Abandon this model and develop and use a more appropriate model.</span>
<span id="cb224-2590"><a href="#cb224-2590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2591"><a href="#cb224-2591" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pro → May lead to a more complex model that could yield better insights.</span>
<span id="cb224-2592"><a href="#cb224-2592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2593"><a href="#cb224-2593" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Con → May also lead to more complex procedures for estimating the parameters.</span>
<span id="cb224-2594"><a href="#cb224-2594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2595"><a href="#cb224-2595" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>Use some transformation on the data so that the normal error SLR model is appropriate for the transformed data.</span>
<span id="cb224-2596"><a href="#cb224-2596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2597"><a href="#cb224-2597" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pro → Leads to relatively simple methods of estimation with smaller models (less parameters), which is desirable when the sample size is small.</span>
<span id="cb224-2598"><a href="#cb224-2598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2599"><a href="#cb224-2599" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Con → Transformations may obscure the fundamental interconnections between the variables, though at other times they may illuminate them.</span>
<span id="cb224-2600"><a href="#cb224-2600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2601"><a href="#cb224-2601" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Now we consider only transformations (will cover more complex models in later chapters).</span>
<span id="cb224-2602"><a href="#cb224-2602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2603"><a href="#cb224-2603" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/remedial-measures-summary.png)</span>{width="50%"}</span>
<span id="cb224-2604"><a href="#cb224-2604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2605"><a href="#cb224-2605" aria-hidden="true" tabindex="-1"></a><span class="fu">#### More details on transformations</span></span>
<span id="cb224-2606"><a href="#cb224-2606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2607"><a href="#cb224-2607" aria-hidden="true" tabindex="-1"></a>Here is a more in depth discussion of when to use which transformation:</span>
<span id="cb224-2608"><a href="#cb224-2608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2609"><a href="#cb224-2609" aria-hidden="true" tabindex="-1"></a>Nonlinearity of the regression function</span>
<span id="cb224-2610"><a href="#cb224-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2611"><a href="#cb224-2611" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the regression function is not linear, a direct approach is to modify the SLR regression model by altering the nature of the regression function (these methods will be discussed much later). For example,</span>
<span id="cb224-2612"><a href="#cb224-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2613"><a href="#cb224-2613" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Quadratic regression function (this is an example of a polynomial regression function) → $E(Y) = \beta_0 + \beta_1 X + \beta_2 X^2$</span>
<span id="cb224-2614"><a href="#cb224-2614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2615"><a href="#cb224-2615" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Exponential regression function (another example of a nonlinear regression function) → $E(Y) = \beta_0 \cdot \beta_1^X$</span>
<span id="cb224-2616"><a href="#cb224-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2617"><a href="#cb224-2617" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The transformation approach uses a transformation to linearize (at least approximately linearize) a nonlinear regression function.</span>
<span id="cb224-2618"><a href="#cb224-2618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2619"><a href="#cb224-2619" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the nature of the regression function is unknown, exploratory analysis that does not require specifying a particular type of function is often useful (such as LOWESS regression).</span>
<span id="cb224-2620"><a href="#cb224-2620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2621"><a href="#cb224-2621" aria-hidden="true" tabindex="-1"></a>Nonconstancy of the error variance</span>
<span id="cb224-2622"><a href="#cb224-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2623"><a href="#cb224-2623" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the error variance is not constant but varies in a systematic fashion, a direct approach is to modify the model to allow for this and use the method of *weighted least squares* to obtain the estimators of the parameters.</span>
<span id="cb224-2624"><a href="#cb224-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2625"><a href="#cb224-2625" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Transformations can also be effective in stabilizing the variance, some will be shown shortly.</span>
<span id="cb224-2626"><a href="#cb224-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2627"><a href="#cb224-2627" aria-hidden="true" tabindex="-1"></a>Nonindependence of error terms</span>
<span id="cb224-2628"><a href="#cb224-2628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2629"><a href="#cb224-2629" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When the error terms are correlated, the easiest method is to switch to a time series model.</span>
<span id="cb224-2630"><a href="#cb224-2630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2631"><a href="#cb224-2631" aria-hidden="true" tabindex="-1"></a>Nonnormality of error terms</span>
<span id="cb224-2632"><a href="#cb224-2632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2633"><a href="#cb224-2633" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Lack of normality and nonconstant error variances occur together. Fortunately, it is often the case that the same transformation that helps stabilize the variance is also helpful in approximately normalizing the error terms.</span>
<span id="cb224-2634"><a href="#cb224-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2635"><a href="#cb224-2635" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is why we should address the nonconstant variance (apply the appropriate stabilizing transformation), then do residual analysis to see if there are still serious departures from normality present.</span>
<span id="cb224-2636"><a href="#cb224-2636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2637"><a href="#cb224-2637" aria-hidden="true" tabindex="-1"></a>Omission of important predictor variables</span>
<span id="cb224-2638"><a href="#cb224-2638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2639"><a href="#cb224-2639" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When residual analysis indicates that an important predictor variable has been omitted from the model, the solution is to modify the model with multiple regression (two or more predictor variables).</span>
<span id="cb224-2640"><a href="#cb224-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2641"><a href="#cb224-2641" aria-hidden="true" tabindex="-1"></a>Unusual observations</span>
<span id="cb224-2642"><a href="#cb224-2642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2643"><a href="#cb224-2643" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When unusual observations are present (could be outliers, high-leverage points, or influential points) using LSE or MLE may lead to serious distortions in the estimated regression function.</span>
<span id="cb224-2644"><a href="#cb224-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2645"><a href="#cb224-2645" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When these unusual obesrvations are not data errors (and thus shouldn't be thrown out), it may be desirable to use an estimation procedure that places less emphasis on them. One type of these models is discuss much later.</span>
<span id="cb224-2646"><a href="#cb224-2646" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-2647"><a href="#cb224-2647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2648"><a href="#cb224-2648" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transformations</span></span>
<span id="cb224-2649"><a href="#cb224-2649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2650"><a href="#cb224-2650" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Now we will talk about the use of transformations on one or both of the original variables before carrying out the regression analysis.</span>
<span id="cb224-2651"><a href="#cb224-2651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2652"><a href="#cb224-2652" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Simple transformations of either the response variable $Y$ or the predictor variable $X$, or of both, are often sufficient to make the SLR model appropriate for the transformed data.</span>
<span id="cb224-2653"><a href="#cb224-2653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2654"><a href="#cb224-2654" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transformations for nonlinear relation only </span></span>
<span id="cb224-2655"><a href="#cb224-2655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2656"><a href="#cb224-2656" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-2657"><a href="#cb224-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2658"><a href="#cb224-2658" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Goal → Linearize a nonlinear regression relation.</span>
<span id="cb224-2659"><a href="#cb224-2659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2660"><a href="#cb224-2660" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use when → Distribution of error terms is reasonably close to a normal distribution AND have approximately constant variance.</span>
<span id="cb224-2661"><a href="#cb224-2661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2662"><a href="#cb224-2662" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Strategy → Transformations on $X$ should be attempted.</span>
<span id="cb224-2663"><a href="#cb224-2663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2664"><a href="#cb224-2664" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Transformations on $Y$, such as $Y' = \sqrt{Y}$, may not be desirable here because they can materially change the shape of the distribution of the error terms from the normal distribution and may also lead to substantially differing error term variances.</span>
<span id="cb224-2665"><a href="#cb224-2665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2666"><a href="#cb224-2666" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g.) $Y = \beta_0 + \beta_1 X + \epsilon$, where $\epsilon \sim \text{Normal}\,$ $\rightarrow$ $\sqrt{Y} = \beta_0 + \beta_1 X + \text{new }\epsilon$</span>
<span id="cb224-2667"><a href="#cb224-2667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2668"><a href="#cb224-2668" aria-hidden="true" tabindex="-1"></a>Specific transformations</span>
<span id="cb224-2669"><a href="#cb224-2669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2670"><a href="#cb224-2670" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Below are some prototype nonlinear regression relations with some simple transformations on $X$ that may be helpful for linearizing without affecting the distribution of $Y$.</span>
<span id="cb224-2671"><a href="#cb224-2671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2672"><a href="#cb224-2672" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Several transformations can be tried.</span>
<span id="cb224-2673"><a href="#cb224-2673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2674"><a href="#cb224-2674" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Scatter plots and residual plots based on each should be made and analyzed to decide which transformation is most effective.</span>
<span id="cb224-2675"><a href="#cb224-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2676"><a href="#cb224-2676" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/transformations-nonlinear.png)</span>{width="50%"}</span>
<span id="cb224-2677"><a href="#cb224-2677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2678"><a href="#cb224-2678" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>At times, it may be helpful to introduce a constant into the transformation.</span>
<span id="cb224-2679"><a href="#cb224-2679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2680"><a href="#cb224-2680" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. If some of the $X$ data are near zero and the reciprocal transformation is desired, we can shift the origin by using the transformation $X' = \frac{1}{X + k}$, where $k$ is an appropriately chosen constant.</span>
<span id="cb224-2681"><a href="#cb224-2681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2682"><a href="#cb224-2682" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-2683"><a href="#cb224-2683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2684"><a href="#cb224-2684" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-2685"><a href="#cb224-2685" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Increasing at decreasing rate</span></span>
<span id="cb224-2686"><a href="#cb224-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2689"><a href="#cb224-2689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2690"><a href="#cb224-2690" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2691"><a href="#cb224-2691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2692"><a href="#cb224-2692" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-2693"><a href="#cb224-2693" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-2694"><a href="#cb224-2694" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">10</span>; sigma <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb224-2695"><a href="#cb224-2695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2696"><a href="#cb224-2696" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-2697"><a href="#cb224-2697" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">20</span>)</span>
<span id="cb224-2698"><a href="#cb224-2698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2699"><a href="#cb224-2699" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-2700"><a href="#cb224-2700" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-2701"><a href="#cb224-2701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2702"><a href="#cb224-2702" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-2703"><a href="#cb224-2703" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have a nonlinear pattern with X (violate linearity assumption)</span></span>
<span id="cb224-2704"><a href="#cb224-2704" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; only modifying the mean structure of the model so that the error distribution remains unchanged and is what it should be</span></span>
<span id="cb224-2705"><a href="#cb224-2705" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x)<span class="sc">^</span><span class="fl">0.3</span> <span class="sc">+</span> epsilon</span>
<span id="cb224-2706"><a href="#cb224-2706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2707"><a href="#cb224-2707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2708"><a href="#cb224-2708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2709"><a href="#cb224-2709" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot of relationship between $Y$ and $X$</span>
<span id="cb224-2710"><a href="#cb224-2710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2711"><a href="#cb224-2711" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Main issue → See curvilinear pattern (in this case $Y$ grows slower as $X$ increases). So standard SLR model not appropriate (note that in reality, we have no idea what type model this came from).</span>
<span id="cb224-2712"><a href="#cb224-2712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2713"><a href="#cb224-2713" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Roughly same variance in $Y$ as $X$ increases (imagining spread of observations relative to the smooth curve; the residual plot looks bad because of the lack of fit) and QQ plot looks decent enough → So only issue is the linearity, which means we want to transform $X$ based on the specific pattern.</span>
<span id="cb224-2714"><a href="#cb224-2714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2717"><a href="#cb224-2717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2718"><a href="#cb224-2718" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2719"><a href="#cb224-2719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2720"><a href="#cb224-2720" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span id="cb224-2721"><a href="#cb224-2721" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Nonlinear ~ Increasing to an asymptote pattern"</span>)</span>
<span id="cb224-2722"><a href="#cb224-2722" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2723"><a href="#cb224-2723" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(x, y), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2724"><a href="#cb224-2724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2725"><a href="#cb224-2725" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot and normal qq plot</span></span>
<span id="cb224-2726"><a href="#cb224-2726" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2727"><a href="#cb224-2727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2728"><a href="#cb224-2728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2729"><a href="#cb224-2729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2730"><a href="#cb224-2730" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Attempt two transformations chosen based on the observed pattern: 1a) $X' = \log_{10}(X)$ 1b) $X' = \ln(X)$ and 2) $X' = \sqrt{X}$. Then view transformed scatterplots.</span>
<span id="cb224-2731"><a href="#cb224-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2732"><a href="#cb224-2732" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>All greatly improve the linear aspect of the regression. Note that $\log_{10}(X)$ and $\ln(X)$ have the same linearizing effect, obviously the scales are different for the results.</span>
<span id="cb224-2733"><a href="#cb224-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2734"><a href="#cb224-2734" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The variability of the scatter at the different $X$ levels is the same as before, since we did not make a transformation on $Y$.</span>
<span id="cb224-2735"><a href="#cb224-2735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2738"><a href="#cb224-2738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2739"><a href="#cb224-2739" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2740"><a href="#cb224-2740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2741"><a href="#cb224-2741" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplots and regression lines for potential transformations</span></span>
<span id="cb224-2742"><a href="#cb224-2742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2743"><a href="#cb224-2743" aria-hidden="true" tabindex="-1"></a><span class="co"># show ln and log10 perform the same function</span></span>
<span id="cb224-2744"><a href="#cb224-2744" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(x, y) <span class="sc">%&gt;%</span> </span>
<span id="cb224-2745"><a href="#cb224-2745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y),</span>
<span id="cb224-2746"><a href="#cb224-2746" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb224-2747"><a href="#cb224-2747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(x),</span>
<span id="cb224-2748"><a href="#cb224-2748" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"log10(X)"</span>)) <span class="sc">+</span> </span>
<span id="cb224-2749"><a href="#cb224-2749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(x),</span>
<span id="cb224-2750"><a href="#cb224-2750" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"ln(X)"</span>)) <span class="sc">+</span> </span>
<span id="cb224-2751"><a href="#cb224-2751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(x),</span>
<span id="cb224-2752"><a href="#cb224-2752" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"log10(X)"</span>),</span>
<span id="cb224-2753"><a href="#cb224-2753" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-2754"><a href="#cb224-2754" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-2755"><a href="#cb224-2755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(x),</span>
<span id="cb224-2756"><a href="#cb224-2756" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"ln(X)"</span>),</span>
<span id="cb224-2757"><a href="#cb224-2757" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-2758"><a href="#cb224-2758" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-2759"><a href="#cb224-2759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Transformation"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"log10(X)"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"ln(X)"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span> </span>
<span id="cb224-2760"><a href="#cb224-2760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"x"</span>)</span>
<span id="cb224-2761"><a href="#cb224-2761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2762"><a href="#cb224-2762" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(x), <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = sqrt(X)"</span>)</span>
<span id="cb224-2763"><a href="#cb224-2763" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">sqrt</span>(x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2764"><a href="#cb224-2764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2765"><a href="#cb224-2765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2766"><a href="#cb224-2766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2767"><a href="#cb224-2767" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Look at diagnostics for fitted models based on transformed $X$s.</span>
<span id="cb224-2768"><a href="#cb224-2768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2769"><a href="#cb224-2769" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Residual plots are just fine now and normal QQ plots still look good.</span>
<span id="cb224-2770"><a href="#cb224-2770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2773"><a href="#cb224-2773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2774"><a href="#cb224-2774" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models on transformed X variables</span></span>
<span id="cb224-2775"><a href="#cb224-2775" aria-hidden="true" tabindex="-1"></a>mod_log10_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log10</span>(x))</span>
<span id="cb224-2776"><a href="#cb224-2776" aria-hidden="true" tabindex="-1"></a>mod_ln_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log</span>(x))</span>
<span id="cb224-2777"><a href="#cb224-2777" aria-hidden="true" tabindex="-1"></a>mod_sqrt_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">sqrt</span>(x))</span>
<span id="cb224-2778"><a href="#cb224-2778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2779"><a href="#cb224-2779" aria-hidden="true" tabindex="-1"></a><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span id="cb224-2780"><a href="#cb224-2780" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_log10_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2781"><a href="#cb224-2781" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_ln_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2782"><a href="#cb224-2782" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_sqrt_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2783"><a href="#cb224-2783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2784"><a href="#cb224-2784" aria-hidden="true" tabindex="-1"></a><span class="co"># view model summaries (just the R^2)</span></span>
<span id="cb224-2785"><a href="#cb224-2785" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; ln and log10 models give different coefficients, but SAME MSE and R^2, see last tab 'effect of scalars and constants' for why</span></span>
<span id="cb224-2786"><a href="#cb224-2786" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_log10_x)</span>
<span id="cb224-2787"><a href="#cb224-2787" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_ln_x)</span>
<span id="cb224-2788"><a href="#cb224-2788" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_sqrt_x)<span class="sc">$</span>r.squared</span>
<span id="cb224-2789"><a href="#cb224-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2790"><a href="#cb224-2790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2791"><a href="#cb224-2791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2792"><a href="#cb224-2792" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare these the models $R^2$ to the original untransformed: <span class="in">`r round(summary(lm(y ~ x))$r.squared, 3)`</span></span>
<span id="cb224-2793"><a href="#cb224-2793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2794"><a href="#cb224-2794" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Increasing at increasing rate</span></span>
<span id="cb224-2795"><a href="#cb224-2795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2798"><a href="#cb224-2798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2799"><a href="#cb224-2799" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2800"><a href="#cb224-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2801"><a href="#cb224-2801" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-2802"><a href="#cb224-2802" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-2803"><a href="#cb224-2803" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="fl">0.5</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-2804"><a href="#cb224-2804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2805"><a href="#cb224-2805" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-2806"><a href="#cb224-2806" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span>)</span>
<span id="cb224-2807"><a href="#cb224-2807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2808"><a href="#cb224-2808" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-2809"><a href="#cb224-2809" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-2810"><a href="#cb224-2810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2811"><a href="#cb224-2811" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-2812"><a href="#cb224-2812" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have a nonlinear pattern with X (violate linearity assumption)</span></span>
<span id="cb224-2813"><a href="#cb224-2813" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; only modifying the mean structure of the model so that the error distribution remains unchanged and is what it should be</span></span>
<span id="cb224-2814"><a href="#cb224-2814" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">*</span> <span class="fu">exp</span>(beta_1 <span class="sc">*</span> x) <span class="sc">+</span> epsilon</span>
<span id="cb224-2815"><a href="#cb224-2815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2816"><a href="#cb224-2816" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: X scale (location, e.g. 0 to 2 vs 20 to 22) obviously plays a part when generating the data because of the function to get Y. But once have Y, shifting the X data doesn't affect the relationship between X* and Y</span></span>
<span id="cb224-2817"><a href="#cb224-2817" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; for example, generate X and Y = f(X). Then using X* = X + 10 and original Y still as the sample</span></span>
<span id="cb224-2818"><a href="#cb224-2818" aria-hidden="true" tabindex="-1"></a><span class="co"># BUT it DOES affect a transformation because the effect won't be additive anymore (i.e. uniform for all x values)</span></span>
<span id="cb224-2819"><a href="#cb224-2819" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; e.g. X* = (X + 10)^2</span></span>
<span id="cb224-2820"><a href="#cb224-2820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2821"><a href="#cb224-2821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2822"><a href="#cb224-2822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2823"><a href="#cb224-2823" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot of relationship between $Y$ and $X$</span>
<span id="cb224-2824"><a href="#cb224-2824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2825"><a href="#cb224-2825" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>See curvilinear pattern (in this case $Y$ grows faster as $X$ increases) $\Longrightarrow$ SLR model not appropriate.</span>
<span id="cb224-2826"><a href="#cb224-2826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2827"><a href="#cb224-2827" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Constant variance through smooth curve and okay QQ plot $\Longrightarrow$ Try $X$ transformation to straighten out $Y$.</span>
<span id="cb224-2828"><a href="#cb224-2828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2831"><a href="#cb224-2831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2832"><a href="#cb224-2832" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2833"><a href="#cb224-2833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2834"><a href="#cb224-2834" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span id="cb224-2835"><a href="#cb224-2835" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Nonlinear ~ Exponential growth pattern"</span>)</span>
<span id="cb224-2836"><a href="#cb224-2836" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2837"><a href="#cb224-2837" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(x, y), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2838"><a href="#cb224-2838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2839"><a href="#cb224-2839" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot and normal qq plot</span></span>
<span id="cb224-2840"><a href="#cb224-2840" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2841"><a href="#cb224-2841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2842"><a href="#cb224-2842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2843"><a href="#cb224-2843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2844"><a href="#cb224-2844" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Attempt two transformations chosen based on the observed pattern: 1) $X' = X^2$ and 2) $X' = \mathrm{e}^X$.</span>
<span id="cb224-2845"><a href="#cb224-2845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2846"><a href="#cb224-2846" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Both seem to improve the linearity, although not perfectly.</span>
<span id="cb224-2847"><a href="#cb224-2847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2850"><a href="#cb224-2850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2851"><a href="#cb224-2851" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2852"><a href="#cb224-2852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2853"><a href="#cb224-2853" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplots and regression lines for two potential transformations</span></span>
<span id="cb224-2854"><a href="#cb224-2854" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x<span class="sc">^</span><span class="dv">2</span>, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = X^2"</span>)</span>
<span id="cb224-2855"><a href="#cb224-2855" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2856"><a href="#cb224-2856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2857"><a href="#cb224-2857" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">exp</span>(x), <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = exp(X)"</span>)</span>
<span id="cb224-2858"><a href="#cb224-2858" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">exp</span>(x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2859"><a href="#cb224-2859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2860"><a href="#cb224-2860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2861"><a href="#cb224-2861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2862"><a href="#cb224-2862" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Look at diagnostics for fitted models based on transformed $X$s.</span>
<span id="cb224-2863"><a href="#cb224-2863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2864"><a href="#cb224-2864" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Still a bit of curvature in the residual plot, but normal QQ plots still look good.</span>
<span id="cb224-2865"><a href="#cb224-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2868"><a href="#cb224-2868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2869"><a href="#cb224-2869" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models on transformed X variables</span></span>
<span id="cb224-2870"><a href="#cb224-2870" aria-hidden="true" tabindex="-1"></a>mod_squared_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb224-2871"><a href="#cb224-2871" aria-hidden="true" tabindex="-1"></a>mod_exp_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">exp</span>(x))</span>
<span id="cb224-2872"><a href="#cb224-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2873"><a href="#cb224-2873" aria-hidden="true" tabindex="-1"></a><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span id="cb224-2874"><a href="#cb224-2874" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_squared_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2875"><a href="#cb224-2875" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_exp_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2876"><a href="#cb224-2876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2877"><a href="#cb224-2877" aria-hidden="true" tabindex="-1"></a><span class="co"># view model summaries (just the R^2)</span></span>
<span id="cb224-2878"><a href="#cb224-2878" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_squared_x)<span class="sc">$</span>r.squared</span>
<span id="cb224-2879"><a href="#cb224-2879" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_exp_x)<span class="sc">$</span>r.squared</span>
<span id="cb224-2880"><a href="#cb224-2880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2881"><a href="#cb224-2881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2882"><a href="#cb224-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2883"><a href="#cb224-2883" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare these the models $R^2$ to the original untransformed: <span class="in">`r round(summary(lm(y ~ x))$r.squared, 3)`</span></span>
<span id="cb224-2884"><a href="#cb224-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2885"><a href="#cb224-2885" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Decreasing at decreasing rate</span></span>
<span id="cb224-2886"><a href="#cb224-2886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2889"><a href="#cb224-2889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2890"><a href="#cb224-2890" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2891"><a href="#cb224-2891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2892"><a href="#cb224-2892" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-2893"><a href="#cb224-2893" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-2894"><a href="#cb224-2894" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">3</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">5</span>; sigma <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb224-2895"><a href="#cb224-2895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2896"><a href="#cb224-2896" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-2897"><a href="#cb224-2897" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb224-2898"><a href="#cb224-2898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2899"><a href="#cb224-2899" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-2900"><a href="#cb224-2900" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-2901"><a href="#cb224-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2902"><a href="#cb224-2902" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-2903"><a href="#cb224-2903" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have a nonlinear pattern with X (violate linearity assumption)</span></span>
<span id="cb224-2904"><a href="#cb224-2904" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; only modifying the mean structure of the model so that the error distribution remains unchanged and is what it should be</span></span>
<span id="cb224-2905"><a href="#cb224-2905" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>beta_1 <span class="sc">*</span> x) <span class="sc">+</span> epsilon</span>
<span id="cb224-2906"><a href="#cb224-2906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2907"><a href="#cb224-2907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2908"><a href="#cb224-2908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2909"><a href="#cb224-2909" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot of relationship between $Y$ and $X$</span>
<span id="cb224-2910"><a href="#cb224-2910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2911"><a href="#cb224-2911" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>See curvilinear pattern (in this case $Y$ decreases slower as $X$ increases) $\Longrightarrow$ SLR again model not appropriate.</span>
<span id="cb224-2912"><a href="#cb224-2912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2913"><a href="#cb224-2913" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Still constant variance and approximately normal residuals, $\Longrightarrow$ Just transform $X$.</span>
<span id="cb224-2914"><a href="#cb224-2914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2917"><a href="#cb224-2917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2918"><a href="#cb224-2918" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2919"><a href="#cb224-2919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2920"><a href="#cb224-2920" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span id="cb224-2921"><a href="#cb224-2921" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Nonlinear ~ Exponential decay pattern"</span>)</span>
<span id="cb224-2922"><a href="#cb224-2922" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2923"><a href="#cb224-2923" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(x, y), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-2924"><a href="#cb224-2924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2925"><a href="#cb224-2925" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot and normal qq plot</span></span>
<span id="cb224-2926"><a href="#cb224-2926" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2927"><a href="#cb224-2927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2928"><a href="#cb224-2928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2929"><a href="#cb224-2929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2930"><a href="#cb224-2930" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Attempt two transformations chosen based on the observed pattern: 1a) $X' = 1 / X$ 1b) $X' = 1 / (X + k)$ and 2) $X' = \mathrm{e}^{-X}$.</span>
<span id="cb224-2931"><a href="#cb224-2931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2932"><a href="#cb224-2932" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$1 / X$ does not result in a linear relationship, so no need to continue with that. However all $X$ values are in between 0 and 1, so we can try to introduce a constant to move data away from origin, say $X' = 1 / (1 + X)$. This works better. $\mathrm{e}^{-X}$ seems to helps as well.</span>
<span id="cb224-2933"><a href="#cb224-2933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2934"><a href="#cb224-2934" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Note that both transformations are decreasing, which means the association between $Y$ and $X'$ gets flipped and is now increasing.</span>
<span id="cb224-2935"><a href="#cb224-2935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2938"><a href="#cb224-2938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2939"><a href="#cb224-2939" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-2940"><a href="#cb224-2940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2941"><a href="#cb224-2941" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplots and regression lines for two potential transformations</span></span>
<span id="cb224-2942"><a href="#cb224-2942" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">/</span>x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = 1/X"</span>)</span>
<span id="cb224-2943"><a href="#cb224-2943" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2944"><a href="#cb224-2944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2945"><a href="#cb224-2945" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb224-2946"><a href="#cb224-2946" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">/</span>(x<span class="sc">+</span>k), <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = 1/(X+1)"</span>)</span>
<span id="cb224-2947"><a href="#cb224-2947" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>(x<span class="sc">+</span>k))), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2948"><a href="#cb224-2948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2949"><a href="#cb224-2949" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">exp</span>(<span class="sc">-</span>x), <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Transformation = exp(X)"</span>)</span>
<span id="cb224-2950"><a href="#cb224-2950" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">exp</span>(<span class="sc">-</span>x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-2951"><a href="#cb224-2951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2952"><a href="#cb224-2952" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2953"><a href="#cb224-2953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2954"><a href="#cb224-2954" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Look at diagnostics for fitted models based on transformed $X$s.</span>
<span id="cb224-2955"><a href="#cb224-2955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2956"><a href="#cb224-2956" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Still a bit of curvature in the residual plot, but normal QQ plots still look good.</span>
<span id="cb224-2957"><a href="#cb224-2957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2960"><a href="#cb224-2960" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-2961"><a href="#cb224-2961" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models on transformed X variables</span></span>
<span id="cb224-2962"><a href="#cb224-2962" aria-hidden="true" tabindex="-1"></a>mod_reciprocal_x_k <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>(x<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb224-2963"><a href="#cb224-2963" aria-hidden="true" tabindex="-1"></a>mod_exp_neg_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">exp</span>(<span class="sc">-</span>x))</span>
<span id="cb224-2964"><a href="#cb224-2964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2965"><a href="#cb224-2965" aria-hidden="true" tabindex="-1"></a><span class="co"># view some diagnostic plots for models with transformations</span></span>
<span id="cb224-2966"><a href="#cb224-2966" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_reciprocal_x_k, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2967"><a href="#cb224-2967" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_exp_neg_x, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-2968"><a href="#cb224-2968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2969"><a href="#cb224-2969" aria-hidden="true" tabindex="-1"></a><span class="co"># view model summaries (just the R^2)</span></span>
<span id="cb224-2970"><a href="#cb224-2970" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_reciprocal_x_k)<span class="sc">$</span>r.squared</span>
<span id="cb224-2971"><a href="#cb224-2971" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_exp_neg_x)<span class="sc">$</span>r.squared</span>
<span id="cb224-2972"><a href="#cb224-2972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2973"><a href="#cb224-2973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-2974"><a href="#cb224-2974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2975"><a href="#cb224-2975" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare these the models $R^2$ to the original untransformed: <span class="in">`r round(summary(lm(y ~ x))$r.squared, 3)`</span></span>
<span id="cb224-2976"><a href="#cb224-2976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2977"><a href="#cb224-2977" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of constants and scalars</span></span>
<span id="cb224-2978"><a href="#cb224-2978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2979"><a href="#cb224-2979" aria-hidden="true" tabindex="-1"></a>Quick demo of introducing constants to one or both sides of regression equation (so to the sample essentially) to see how impact results</span>
<span id="cb224-2980"><a href="#cb224-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2981"><a href="#cb224-2981" aria-hidden="true" tabindex="-1"></a>Results</span>
<span id="cb224-2982"><a href="#cb224-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2983"><a href="#cb224-2983" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Coefficients</span>
<span id="cb224-2984"><a href="#cb224-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2985"><a href="#cb224-2985" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Adding constants (all combos $X + k$, $Y + k$ and both) → Changes intercept, doesn't affect slope.</span>
<span id="cb224-2986"><a href="#cb224-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2987"><a href="#cb224-2987" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Multiplying by scalar → $k \cdot X$ doesn't affect intercept, but does affect slope; $k \cdot Y$ does affect intercept and slope; Both $k \cdot X$ and $k \cdot Y$ have same intercept as only $k \cdot Y$ (because $k \cdot X$ doesn't affect it), but the same slope as the original $X$ and $Y$ (in essence cancelling each others' effect).</span>
<span id="cb224-2988"><a href="#cb224-2988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2989"><a href="#cb224-2989" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$R^2$ and $F$-stat</span>
<span id="cb224-2990"><a href="#cb224-2990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2991"><a href="#cb224-2991" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>All models have the same.</span>
<span id="cb224-2992"><a href="#cb224-2992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2993"><a href="#cb224-2993" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$MSE$ and likelihood-related statistics ($loglik$, $AIC$, $BIC$)</span>
<span id="cb224-2994"><a href="#cb224-2994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2995"><a href="#cb224-2995" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Only $k \cdot Y$ models have different $MSE$ (larger because $Y$ values are stretched with $\lvert k \rvert &gt; 1$) and likelihood-related statistics (optimizing a function of $Y$).</span>
<span id="cb224-2996"><a href="#cb224-2996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-2999"><a href="#cb224-2999" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3000"><a href="#cb224-3000" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3001"><a href="#cb224-3001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3002"><a href="#cb224-3002" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-3003"><a href="#cb224-3003" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters and error distribution parameters</span></span>
<span id="cb224-3004"><a href="#cb224-3004" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">1</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span>; sigma <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb224-3005"><a href="#cb224-3005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3006"><a href="#cb224-3006" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data</span></span>
<span id="cb224-3007"><a href="#cb224-3007" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">15</span>)</span>
<span id="cb224-3008"><a href="#cb224-3008" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb224-3009"><a href="#cb224-3009" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-3010"><a href="#cb224-3010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3011"><a href="#cb224-3011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3012"><a href="#cb224-3012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3015"><a href="#cb224-3015" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3016"><a href="#cb224-3016" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3017"><a href="#cb224-3017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3018"><a href="#cb224-3018" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplots with regression lines for different models</span></span>
<span id="cb224-3019"><a href="#cb224-3019" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb224-3020"><a href="#cb224-3020" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb224-3021"><a href="#cb224-3021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3022"><a href="#cb224-3022" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y,</span>
<span id="cb224-3023"><a href="#cb224-3023" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y ~ x"</span>)) <span class="sc">+</span> </span>
<span id="cb224-3024"><a href="#cb224-3024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3025"><a href="#cb224-3025" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb224-3026"><a href="#cb224-3026" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y ~ x"</span>),</span>
<span id="cb224-3027"><a href="#cb224-3027" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3028"><a href="#cb224-3028" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3029"><a href="#cb224-3029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> k1,</span>
<span id="cb224-3030"><a href="#cb224-3030" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y,</span>
<span id="cb224-3031"><a href="#cb224-3031" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y ~ x + k"</span>),</span>
<span id="cb224-3032"><a href="#cb224-3032" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3033"><a href="#cb224-3033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> k1,</span>
<span id="cb224-3034"><a href="#cb224-3034" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb224-3035"><a href="#cb224-3035" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y ~ x + k"</span>),</span>
<span id="cb224-3036"><a href="#cb224-3036" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3037"><a href="#cb224-3037" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3038"><a href="#cb224-3038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3039"><a href="#cb224-3039" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y <span class="sc">+</span> k1,</span>
<span id="cb224-3040"><a href="#cb224-3040" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y + k ~ x"</span>),</span>
<span id="cb224-3041"><a href="#cb224-3041" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3042"><a href="#cb224-3042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3043"><a href="#cb224-3043" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y <span class="sc">+</span> k1,</span>
<span id="cb224-3044"><a href="#cb224-3044" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y + k ~ x"</span>),</span>
<span id="cb224-3045"><a href="#cb224-3045" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3046"><a href="#cb224-3046" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3047"><a href="#cb224-3047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> k1,</span>
<span id="cb224-3048"><a href="#cb224-3048" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y <span class="sc">+</span> k1,</span>
<span id="cb224-3049"><a href="#cb224-3049" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y + k ~ x + k"</span>),</span>
<span id="cb224-3050"><a href="#cb224-3050" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3051"><a href="#cb224-3051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> k1,</span>
<span id="cb224-3052"><a href="#cb224-3052" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y <span class="sc">+</span> k1,</span>
<span id="cb224-3053"><a href="#cb224-3053" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y + k ~ x + k"</span>),</span>
<span id="cb224-3054"><a href="#cb224-3054" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3055"><a href="#cb224-3055" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3056"><a href="#cb224-3056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Model"</span>,</span>
<span id="cb224-3057"><a href="#cb224-3057" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"y ~ x"</span>, <span class="st">"y ~ x + k"</span>, <span class="st">"y + k ~ x"</span>,  <span class="st">"y + k ~ x + k"</span>),</span>
<span id="cb224-3058"><a href="#cb224-3058" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"y ~ x"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"y ~ x + k"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"y + k ~ x"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"y + k ~ x + k"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb224-3059"><a href="#cb224-3059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Adding constants"</span>)</span>
<span id="cb224-3060"><a href="#cb224-3060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3061"><a href="#cb224-3061" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-3062"><a href="#cb224-3062" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb224-3063"><a href="#cb224-3063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3064"><a href="#cb224-3064" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y,</span>
<span id="cb224-3065"><a href="#cb224-3065" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y ~ x"</span>)) <span class="sc">+</span> </span>
<span id="cb224-3066"><a href="#cb224-3066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3067"><a href="#cb224-3067" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb224-3068"><a href="#cb224-3068" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y ~ x"</span>),</span>
<span id="cb224-3069"><a href="#cb224-3069" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3070"><a href="#cb224-3070" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3071"><a href="#cb224-3071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> k2 <span class="sc">*</span> x,</span>
<span id="cb224-3072"><a href="#cb224-3072" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y,</span>
<span id="cb224-3073"><a href="#cb224-3073" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"y ~ kx"</span>),</span>
<span id="cb224-3074"><a href="#cb224-3074" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3075"><a href="#cb224-3075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> k2 <span class="sc">*</span> x,</span>
<span id="cb224-3076"><a href="#cb224-3076" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb224-3077"><a href="#cb224-3077" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"y ~ kx"</span>),</span>
<span id="cb224-3078"><a href="#cb224-3078" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3079"><a href="#cb224-3079" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3080"><a href="#cb224-3080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3081"><a href="#cb224-3081" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> k2 <span class="sc">*</span> y,</span>
<span id="cb224-3082"><a href="#cb224-3082" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"ky ~ x"</span>),</span>
<span id="cb224-3083"><a href="#cb224-3083" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3084"><a href="#cb224-3084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb224-3085"><a href="#cb224-3085" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> k2 <span class="sc">*</span> y,</span>
<span id="cb224-3086"><a href="#cb224-3086" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"ky ~ x"</span>),</span>
<span id="cb224-3087"><a href="#cb224-3087" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3088"><a href="#cb224-3088" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3089"><a href="#cb224-3089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> k2 <span class="sc">*</span> x,</span>
<span id="cb224-3090"><a href="#cb224-3090" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> k2 <span class="sc">*</span> y,</span>
<span id="cb224-3091"><a href="#cb224-3091" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"ky ~ kx"</span>),</span>
<span id="cb224-3092"><a href="#cb224-3092" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span> </span>
<span id="cb224-3093"><a href="#cb224-3093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> k2 <span class="sc">*</span> x,</span>
<span id="cb224-3094"><a href="#cb224-3094" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> k2 <span class="sc">*</span> y,</span>
<span id="cb224-3095"><a href="#cb224-3095" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"ky ~ kx"</span>),</span>
<span id="cb224-3096"><a href="#cb224-3096" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb224-3097"><a href="#cb224-3097" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb224-3098"><a href="#cb224-3098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Model"</span>,</span>
<span id="cb224-3099"><a href="#cb224-3099" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"y ~ x"</span>, <span class="st">"y ~ kx"</span>, <span class="st">"ky ~ x"</span>, <span class="st">"ky ~ kx"</span>),</span>
<span id="cb224-3100"><a href="#cb224-3100" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"y ~ x"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"y ~ kx"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"ky ~ x"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"ky ~ kx"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb224-3101"><a href="#cb224-3101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb224-3102"><a href="#cb224-3102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Multiplying by scalars"</span>)</span>
<span id="cb224-3103"><a href="#cb224-3103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3104"><a href="#cb224-3104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3105"><a href="#cb224-3105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3108"><a href="#cb224-3108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3109"><a href="#cb224-3109" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3110"><a href="#cb224-3110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3111"><a href="#cb224-3111" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models and display</span></span>
<span id="cb224-3112"><a href="#cb224-3112" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt;&lt; start with list of all different models then pass to saving info function</span></span>
<span id="cb224-3113"><a href="#cb224-3113" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-3114"><a href="#cb224-3114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> x),</span>
<span id="cb224-3115"><a href="#cb224-3115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">+</span>k1)),</span>
<span id="cb224-3116"><a href="#cb224-3116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">I</span>(y<span class="sc">+</span>k1) <span class="sc">~</span> x),</span>
<span id="cb224-3117"><a href="#cb224-3117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">I</span>(y<span class="sc">+</span>k1) <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">+</span>k1)),</span>
<span id="cb224-3118"><a href="#cb224-3118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(k2<span class="sc">*</span>x)),</span>
<span id="cb224-3119"><a href="#cb224-3119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">I</span>(k2<span class="sc">*</span>y) <span class="sc">~</span> x),</span>
<span id="cb224-3120"><a href="#cb224-3120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">I</span>(k2<span class="sc">*</span>y) <span class="sc">~</span> <span class="fu">I</span>(k2<span class="sc">*</span>x)),</span>
<span id="cb224-3121"><a href="#cb224-3121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log</span>(x)),</span>
<span id="cb224-3122"><a href="#cb224-3122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log10</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb224-3123"><a href="#cb224-3123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(mod) {</span>
<span id="cb224-3124"><a href="#cb224-3124" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">=</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coef <span class="co"># save coefficients table</span></span>
<span id="cb224-3125"><a href="#cb224-3125" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(m[<span class="dv">1</span>,<span class="dv">1</span>], m[<span class="dv">1</span>,<span class="dv">2</span>], m[<span class="dv">2</span>,<span class="dv">1</span>], m[<span class="dv">2</span>,<span class="dv">2</span>]), <span class="at">nrow =</span> <span class="dv">1</span>)) <span class="co"># extract estimate and st error for intercept and X and put all info in one row (4 columns)</span></span>
<span id="cb224-3126"><a href="#cb224-3126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(coefs) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b0"</span>, <span class="st">"se(b0)"</span>, <span class="st">"b1"</span>, <span class="st">"se(b1)"</span>) <span class="co"># name them</span></span>
<span id="cb224-3127"><a href="#cb224-3127" aria-hidden="true" tabindex="-1"></a>    call <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">call =</span> <span class="fu">paste</span>(<span class="fu">as.character</span>(mod<span class="sc">$</span>call), <span class="at">collapse =</span> <span class="st">" = "</span>)) <span class="co"># extract model call and save as character string, then dataframe</span></span>
<span id="cb224-3128"><a href="#cb224-3128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(call, coefs, <span class="fu">glance</span>(mod)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]) <span class="co"># combine all info into one long row</span></span>
<span id="cb224-3129"><a href="#cb224-3129" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb224-3130"><a href="#cb224-3130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(rbind) <span class="sc">%&gt;%</span> </span>
<span id="cb224-3131"><a href="#cb224-3131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">3</span>)))</span>
<span id="cb224-3132"><a href="#cb224-3132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3133"><a href="#cb224-3133" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> display_nice</span>
<span id="cb224-3134"><a href="#cb224-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3135"><a href="#cb224-3135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3136"><a href="#cb224-3136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3137"><a href="#cb224-3137" aria-hidden="true" tabindex="-1"></a>$log_{10}(X)$ and $\ln(X)$</span>
<span id="cb224-3138"><a href="#cb224-3138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3139"><a href="#cb224-3139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These equate to the models $y \sim \ln(X)$ and $y \sim k \cdot log_{10}(X)$, so we can switch between the two and these results show why these two transformations are essentially equivalent. Only the slopes of the resulting models differ, every other model summary is the same.</span>
<span id="cb224-3140"><a href="#cb224-3140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3141"><a href="#cb224-3141" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/transformations-log10-vs-ln.png)</span>{width="50%"}</span>
<span id="cb224-3142"><a href="#cb224-3142" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-3143"><a href="#cb224-3143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3144"><a href="#cb224-3144" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transformations for Nonnormality and Unequal Error Variances</span></span>
<span id="cb224-3145"><a href="#cb224-3145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3146"><a href="#cb224-3146" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-3147"><a href="#cb224-3147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3148"><a href="#cb224-3148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Unequal error variances and nonnormality of the error terms frequently appear together.</span>
<span id="cb224-3149"><a href="#cb224-3149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3150"><a href="#cb224-3150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Often, these two departures show up as increasing skewness and increasing variability of the distributions of the error terms as the mean response $E(Y)$ increases.</span>
<span id="cb224-3151"><a href="#cb224-3151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3152"><a href="#cb224-3152" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. Regression on yearly household expenditures on vacation versus household income. There will tend to be more variation and greater positive skewness (i.e. some very high yearly vacation expenditures) for high-income households than for low-income households, who tend to consistently spend much less for vacations.</span>
<span id="cb224-3153"><a href="#cb224-3153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3154"><a href="#cb224-3154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Goal → Fix nonnormality and nonconstant variance of regression relation.</span>
<span id="cb224-3155"><a href="#cb224-3155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3156"><a href="#cb224-3156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Strategy → We need a transformation on $Y$ because the shapes and spreads of the distributions of $Y$ need to be changed.</span>
<span id="cb224-3157"><a href="#cb224-3157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3158"><a href="#cb224-3158" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A transformation like this may also help to linearize a curvilinear regression relation.</span>
<span id="cb224-3159"><a href="#cb224-3159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3160"><a href="#cb224-3160" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Other times, a simultaneous transformation on $X$ may be needed to obtain or maintain a linear regression relation.</span>
<span id="cb224-3161"><a href="#cb224-3161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3162"><a href="#cb224-3162" aria-hidden="true" tabindex="-1"></a>Specific transformations</span>
<span id="cb224-3163"><a href="#cb224-3163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3164"><a href="#cb224-3164" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Below are some prototype regression relations with some simple transformations on $Y$ that may be helpful for fixing non normality and unequal variances of the error distributions.</span>
<span id="cb224-3165"><a href="#cb224-3165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3166"><a href="#cb224-3166" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Several alternative transformations on $Y$ may be tried, as well as some simultaneous transformations on $X$.</span>
<span id="cb224-3167"><a href="#cb224-3167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3168"><a href="#cb224-3168" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Again, scatter plots and residual plots should be made to determine the most effective transformation(s).</span>
<span id="cb224-3169"><a href="#cb224-3169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3170"><a href="#cb224-3170" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/transformations-nonnormal-and-nonconstant-var.png)</span>{width="50%"}</span>
<span id="cb224-3171"><a href="#cb224-3171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3172"><a href="#cb224-3172" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Same as with the reciprocal transformation $X' = \frac{1}{X + k}$, we can consider use of constant values to validate the transformation function. e.g. If $Y$ is negative, we can shift the origin for the log transformation $Y' = \ln(Y + k)$ so all $Y + k &gt; 0$ for all $Y$.</span>
<span id="cb224-3173"><a href="#cb224-3173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3174"><a href="#cb224-3174" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-3175"><a href="#cb224-3175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3176"><a href="#cb224-3176" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-3177"><a href="#cb224-3177" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- #### Increasing at decreasing rate, with increasing variance --&gt;</span></span>
<span id="cb224-3178"><a href="#cb224-3178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3179"><a href="#cb224-3179" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- can't figure out how to generate this kinda data --&gt;</span></span>
<span id="cb224-3180"><a href="#cb224-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3181"><a href="#cb224-3181" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- #### Decreasing at decreasing rate, with decreasing variance --&gt;</span></span>
<span id="cb224-3182"><a href="#cb224-3182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3183"><a href="#cb224-3183" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Increasing linear trend, with increasing variance</span></span>
<span id="cb224-3184"><a href="#cb224-3184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3187"><a href="#cb224-3187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3188"><a href="#cb224-3188" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3189"><a href="#cb224-3189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3190"><a href="#cb224-3190" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb224-3191"><a href="#cb224-3191" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-3192"><a href="#cb224-3192" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-3193"><a href="#cb224-3193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3194"><a href="#cb224-3194" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-3195"><a href="#cb224-3195" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">20</span>)</span>
<span id="cb224-3196"><a href="#cb224-3196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3197"><a href="#cb224-3197" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-3198"><a href="#cb224-3198" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; uniform errors that can increase with x</span></span>
<span id="cb224-3199"><a href="#cb224-3199" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span><span class="sc">*</span>x)</span>
<span id="cb224-3200"><a href="#cb224-3200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3201"><a href="#cb224-3201" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-3202"><a href="#cb224-3202" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-3203"><a href="#cb224-3203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3204"><a href="#cb224-3204" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span id="cb224-3205"><a href="#cb224-3205" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Nonnormal errors with increasing variance </span><span class="sc">\n</span><span class="st"> ~ Increasing to with linear trend"</span>)</span>
<span id="cb224-3206"><a href="#cb224-3206" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-3207"><a href="#cb224-3207" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(x, y), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3208"><a href="#cb224-3208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3209"><a href="#cb224-3209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3210"><a href="#cb224-3210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3211"><a href="#cb224-3211" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scatterplot of relationship between $Y$ and $X$</span>
<span id="cb224-3212"><a href="#cb224-3212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3213"><a href="#cb224-3213" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Main issue → Because of the nonconstant variance, this leads us to think that there is issues with the error variance, perhaps also the structure of the model (but impossible to verify this totally). No serious departures from normality. Slight curvilinear pattern, but could be just because of the random non-constant variance</span>
<span id="cb224-3214"><a href="#cb224-3214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3215"><a href="#cb224-3215" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Before attempting transformations to linearize (working on $X$) or nonlinear regression, we should transform $Y$ based on this pattern. This transformation may help to linearize and improve the normality as well (even though not of concern). If still not good, can try transformation on $X$ in conjunction.</span>
<span id="cb224-3216"><a href="#cb224-3216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3219"><a href="#cb224-3219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3220"><a href="#cb224-3220" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3221"><a href="#cb224-3221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3222"><a href="#cb224-3222" aria-hidden="true" tabindex="-1"></a><span class="co"># residual plot and normal qq plot</span></span>
<span id="cb224-3223"><a href="#cb224-3223" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3224"><a href="#cb224-3224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3225"><a href="#cb224-3225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3226"><a href="#cb224-3226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3227"><a href="#cb224-3227" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Attempt transformations chosen based on the observed pattern: $Y' = \frac{1}{Y}$. Then view transformed scatterplot.</span>
<span id="cb224-3228"><a href="#cb224-3228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3231"><a href="#cb224-3231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3232"><a href="#cb224-3232" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb224-3233"><a href="#cb224-3233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3234"><a href="#cb224-3234" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplot, regression line and diagnostic plots for potential transformations</span></span>
<span id="cb224-3235"><a href="#cb224-3235" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span>y, <span class="at">main =</span> <span class="st">"Transformation = 1/Y"</span>)</span>
<span id="cb224-3236"><a href="#cb224-3236" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="dv">1</span><span class="sc">/</span>y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-3237"><a href="#cb224-3237" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(<span class="dv">1</span><span class="sc">/</span>y <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3238"><a href="#cb224-3238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3239"><a href="#cb224-3239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3240"><a href="#cb224-3240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3241"><a href="#cb224-3241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now the non-constant variance appears to be fixed, but there is a curvi-linear relationship now. So we can try to transform $X$ at the same time according to the prototype pattern.</span>
<span id="cb224-3242"><a href="#cb224-3242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3245"><a href="#cb224-3245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3246"><a href="#cb224-3246" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplot, regression line and diagnostic plots for potential transformations</span></span>
<span id="cb224-3247"><a href="#cb224-3247" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">/</span>x, <span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span>y, <span class="at">main =</span> <span class="st">"Transformation = 1/Y and 1/X"</span>)</span>
<span id="cb224-3248"><a href="#cb224-3248" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="dv">1</span><span class="sc">/</span>y <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>x)), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-3249"><a href="#cb224-3249" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(<span class="dv">1</span><span class="sc">/</span>y <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>x)), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3250"><a href="#cb224-3250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3251"><a href="#cb224-3251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3252"><a href="#cb224-3252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3253"><a href="#cb224-3253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This introduces some other issues, so perhaps another method such as weighted least squares would be more appropriate.</span>
<span id="cb224-3254"><a href="#cb224-3254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3255"><a href="#cb224-3255" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-3256"><a href="#cb224-3256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3257"><a href="#cb224-3257" aria-hidden="true" tabindex="-1"></a><span class="fu">### Box-Cox transformations {#sec-box-cox}</span></span>
<span id="cb224-3258"><a href="#cb224-3258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3259"><a href="#cb224-3259" aria-hidden="true" tabindex="-1"></a>Motivation:</span>
<span id="cb224-3260"><a href="#cb224-3260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3261"><a href="#cb224-3261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is often difficult to determine from diagnostic plots which transformation of $Y$ is most appropriate for correcting skewness of the distributions of error terms, unequal error variances, and nonlinearity of the regression function.</span>
<span id="cb224-3262"><a href="#cb224-3262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3263"><a href="#cb224-3263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The Box-Cox procedure automatically identifies a transformation from the family of power transformations on $Y$. </span>
<span id="cb224-3264"><a href="#cb224-3264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3265"><a href="#cb224-3265" aria-hidden="true" tabindex="-1"></a>Power transformations have the form:</span>
<span id="cb224-3266"><a href="#cb224-3266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3267"><a href="#cb224-3267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3268"><a href="#cb224-3268" aria-hidden="true" tabindex="-1"></a>Y' = Y^\lambda,</span>
<span id="cb224-3269"><a href="#cb224-3269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3270"><a href="#cb224-3270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3271"><a href="#cb224-3271" aria-hidden="true" tabindex="-1"></a>where $\lambda$ is a parameter to be determined from the data.</span>
<span id="cb224-3272"><a href="#cb224-3272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3273"><a href="#cb224-3273" aria-hidden="true" tabindex="-1"></a>This family encompasses the following simple transformations:</span>
<span id="cb224-3274"><a href="#cb224-3274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3275"><a href="#cb224-3275" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/box-cox-lambda.png)</span>{width="50%"}</span>
<span id="cb224-3276"><a href="#cb224-3276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3277"><a href="#cb224-3277" aria-hidden="true" tabindex="-1"></a>The normal error regression model with the response variable a member of the family of transformations becomes:</span>
<span id="cb224-3278"><a href="#cb224-3278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3279"><a href="#cb224-3279" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3280"><a href="#cb224-3280" aria-hidden="true" tabindex="-1"></a>Y^\lambda = \beta_0 + \beta_1 X_i + \epsilon_i</span>
<span id="cb224-3281"><a href="#cb224-3281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3282"><a href="#cb224-3282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3283"><a href="#cb224-3283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This includes an additional parameter $\lambda$ that needs to be estimated.</span>
<span id="cb224-3284"><a href="#cb224-3284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3285"><a href="#cb224-3285" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The Box-Cox procedure uses the method of maximum likelihood to estimate $\lambda$, as well as the other parameters $\beta_0$, $\beta_1$ and $\sigma^2$.</span>
<span id="cb224-3286"><a href="#cb224-3286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3287"><a href="#cb224-3287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this way, the Box-Cox procedure identifies $\hat{\lambda}$, the maximum likelihood estimate of $\lambda$ to use in the power transformation.</span>
<span id="cb224-3288"><a href="#cb224-3288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3289"><a href="#cb224-3289" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-3290"><a href="#cb224-3290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3291"><a href="#cb224-3291" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb224-3292"><a href="#cb224-3292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3293"><a href="#cb224-3293" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R functions</span></span>
<span id="cb224-3294"><a href="#cb224-3294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3297"><a href="#cb224-3297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3298"><a href="#cb224-3298" aria-hidden="true" tabindex="-1"></a><span class="co"># use same setup as linearly increasing trend with increasing variance</span></span>
<span id="cb224-3299"><a href="#cb224-3299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3300"><a href="#cb224-3300" aria-hidden="true" tabindex="-1"></a><span class="do">## initialize items</span></span>
<span id="cb224-3301"><a href="#cb224-3301" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sample size, population parameters</span></span>
<span id="cb224-3302"><a href="#cb224-3302" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span>; beta_0 <span class="ot">&lt;-</span> <span class="dv">2</span>; beta_1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb224-3303"><a href="#cb224-3303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3304"><a href="#cb224-3304" aria-hidden="true" tabindex="-1"></a><span class="co"># generate X values</span></span>
<span id="cb224-3305"><a href="#cb224-3305" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">20</span>)</span>
<span id="cb224-3306"><a href="#cb224-3306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3307"><a href="#cb224-3307" aria-hidden="true" tabindex="-1"></a><span class="co"># generate error terms</span></span>
<span id="cb224-3308"><a href="#cb224-3308" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; uniform errors that can increase with x</span></span>
<span id="cb224-3309"><a href="#cb224-3309" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span><span class="sc">*</span>x)</span>
<span id="cb224-3310"><a href="#cb224-3310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3311"><a href="#cb224-3311" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate observations Y</span></span>
<span id="cb224-3312"><a href="#cb224-3312" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> epsilon</span>
<span id="cb224-3313"><a href="#cb224-3313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3314"><a href="#cb224-3314" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with poorly fit regression line and smoothed curve added</span></span>
<span id="cb224-3315"><a href="#cb224-3315" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">main =</span> <span class="st">"Nonnormal errors with increasing variance </span><span class="sc">\n</span><span class="st"> ~ Increasing to with linear trend"</span>)</span>
<span id="cb224-3316"><a href="#cb224-3316" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-3317"><a href="#cb224-3317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3318"><a href="#cb224-3318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3319"><a href="#cb224-3319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3320"><a href="#cb224-3320" aria-hidden="true" tabindex="-1"></a>By observation of the prototype pattern and the results, we tried the model $1/Y \sim 1/X$ to some success. Let's see what the Box-Cox procedure recommends.</span>
<span id="cb224-3321"><a href="#cb224-3321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3324"><a href="#cb224-3324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3325"><a href="#cb224-3325" aria-hidden="true" tabindex="-1"></a><span class="co"># run boxcox procedure</span></span>
<span id="cb224-3326"><a href="#cb224-3326" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; plot MLE of lambda</span></span>
<span id="cb224-3327"><a href="#cb224-3327" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))</span>
<span id="cb224-3328"><a href="#cb224-3328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3329"><a href="#cb224-3329" aria-hidden="true" tabindex="-1"></a><span class="co"># extract lambda</span></span>
<span id="cb224-3330"><a href="#cb224-3330" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">boxcox</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))</span>
<span id="cb224-3331"><a href="#cb224-3331" aria-hidden="true" tabindex="-1"></a>bc<span class="sc">$</span>x[<span class="fu">which.max</span>(bc<span class="sc">$</span>y)]</span>
<span id="cb224-3332"><a href="#cb224-3332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3333"><a href="#cb224-3333" aria-hidden="true" tabindex="-1"></a><span class="co"># run boxcox procedure</span></span>
<span id="cb224-3334"><a href="#cb224-3334" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; plot of SSE</span></span>
<span id="cb224-3335"><a href="#cb224-3335" aria-hidden="true" tabindex="-1"></a>ALSM<span class="sc">::</span><span class="fu">boxcox.sse</span>(x, y, <span class="at">l =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="co"># to shorten output</span></span>
<span id="cb224-3336"><a href="#cb224-3336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3337"><a href="#cb224-3337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3338"><a href="#cb224-3338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3339"><a href="#cb224-3339" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Manual</span></span>
<span id="cb224-3340"><a href="#cb224-3340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3341"><a href="#cb224-3341" aria-hidden="true" tabindex="-1"></a>Can use standard regression procedures to obtain a $\hat{lambda}$ when software doesn't automatically provide it. This procedure involves a numerical search in a range of potential $\lambda$ values such as $\lambda = -2, -1.75, ..., 1.75, 2$. For each $\lambda$ value:</span>
<span id="cb224-3342"><a href="#cb224-3342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3343"><a href="#cb224-3343" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>$Y_i^\lambda$ observations are first standardized so that the magnitude of the error sum of squares does not depend on the value of $\lambda$:</span>
<span id="cb224-3344"><a href="#cb224-3344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3345"><a href="#cb224-3345" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3346"><a href="#cb224-3346" aria-hidden="true" tabindex="-1"></a>W_i = \left<span class="sc">\{</span></span>
<span id="cb224-3347"><a href="#cb224-3347" aria-hidden="true" tabindex="-1"></a>  \begin{array}{ll}</span>
<span id="cb224-3348"><a href="#cb224-3348" aria-hidden="true" tabindex="-1"></a>     K_1 (Y_i^\lambda - 1) &amp; \lambda \ne 0<span class="sc">\\</span></span>
<span id="cb224-3349"><a href="#cb224-3349" aria-hidden="true" tabindex="-1"></a>     K_2 \ln(Y_i) &amp; \lambda = 0<span class="sc">\\</span></span>
<span id="cb224-3350"><a href="#cb224-3350" aria-hidden="true" tabindex="-1"></a>  \end{array}</span>
<span id="cb224-3351"><a href="#cb224-3351" aria-hidden="true" tabindex="-1"></a>\right.</span>
<span id="cb224-3352"><a href="#cb224-3352" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb224-3353"><a href="#cb224-3353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3354"><a href="#cb224-3354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>where $K_2 = \big(\prod_{i = 1}^{n}Y_i \big)^{1/n}$ and $K_1 = \frac{1}{\lambda K_2^{\lambda -1}}$ (note that $K_2$ is the geometric mean of the $Y_i$ observations).</span>
<span id="cb224-3355"><a href="#cb224-3355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3356"><a href="#cb224-3356" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Once the standardized observations $W_i$ have been obtained for a given $\lambda$ value, they are regressed on the predictor variable $X$ and the error sum of squares $SSE$ is obtained.</span>
<span id="cb224-3357"><a href="#cb224-3357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3358"><a href="#cb224-3358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It can be shown that the maximum likelihood estimate $\hat{\lambda}$ is that value of $\lambda$ for which $SSE$ is a minimum.</span>
<span id="cb224-3359"><a href="#cb224-3359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3360"><a href="#cb224-3360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If desired, a finer search can be conducted in the neighborhood of the $\lambda$ value that minimizes $SSE$. However, the Box-Cox procedure ordinarily is used only to provide a guidefor selecting a transformation, so overly precise results are not needed.</span>
<span id="cb224-3361"><a href="#cb224-3361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3364"><a href="#cb224-3364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3365"><a href="#cb224-3365" aria-hidden="true" tabindex="-1"></a><span class="co"># define set of lambdas</span></span>
<span id="cb224-3366"><a href="#cb224-3366" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb224-3367"><a href="#cb224-3367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3368"><a href="#cb224-3368" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize repsonses</span></span>
<span id="cb224-3369"><a href="#cb224-3369" aria-hidden="true" tabindex="-1"></a>box_cox <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x, <span class="at">lambda =</span> <span class="dv">1</span>) {</span>
<span id="cb224-3370"><a href="#cb224-3370" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-3371"><a href="#cb224-3371" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define constants</span></span>
<span id="cb224-3372"><a href="#cb224-3372" aria-hidden="true" tabindex="-1"></a>  K_2 <span class="ot">=</span> <span class="fu">prod</span>(y)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(y))</span>
<span id="cb224-3373"><a href="#cb224-3373" aria-hidden="true" tabindex="-1"></a>  K_1 <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> (lambda <span class="sc">*</span> K_2<span class="sc">^</span>(lambda <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb224-3374"><a href="#cb224-3374" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-3375"><a href="#cb224-3375" aria-hidden="true" tabindex="-1"></a>  <span class="co"># standardize y observations</span></span>
<span id="cb224-3376"><a href="#cb224-3376" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> <span class="cf">if</span>(lambda <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb224-3377"><a href="#cb224-3377" aria-hidden="true" tabindex="-1"></a>    K_2 <span class="sc">*</span> <span class="fu">log</span>(y)</span>
<span id="cb224-3378"><a href="#cb224-3378" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb224-3379"><a href="#cb224-3379" aria-hidden="true" tabindex="-1"></a>    K_1 <span class="sc">*</span> y<span class="sc">^</span>lambda <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb224-3380"><a href="#cb224-3380" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-3381"><a href="#cb224-3381" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb224-3382"><a href="#cb224-3382" aria-hidden="true" tabindex="-1"></a>  <span class="co"># regress W on X and get sse</span></span>
<span id="cb224-3383"><a href="#cb224-3383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">resid</span>(<span class="fu">lm</span>(W <span class="sc">~</span> x))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb224-3384"><a href="#cb224-3384" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-3385"><a href="#cb224-3385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3386"><a href="#cb224-3386" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate sse for each lambda value</span></span>
<span id="cb224-3387"><a href="#cb224-3387" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> lambdas <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(\(l) <span class="fu">box_cox</span>(y, x, <span class="at">lambda =</span> l))</span>
<span id="cb224-3388"><a href="#cb224-3388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3389"><a href="#cb224-3389" aria-hidden="true" tabindex="-1"></a><span class="co"># plt results and get minimum lambda</span></span>
<span id="cb224-3390"><a href="#cb224-3390" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> lambdas, <span class="at">y =</span> sse, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb224-3391"><a href="#cb224-3391" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(sse), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb224-3392"><a href="#cb224-3392" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> lambdas[<span class="fu">which.min</span>(sse)], <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb224-3393"><a href="#cb224-3393" aria-hidden="true" tabindex="-1"></a>lambdas[<span class="fu">which.min</span>(sse)]</span>
<span id="cb224-3394"><a href="#cb224-3394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3395"><a href="#cb224-3395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3396"><a href="#cb224-3396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3397"><a href="#cb224-3397" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Results</span></span>
<span id="cb224-3398"><a href="#cb224-3398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3399"><a href="#cb224-3399" aria-hidden="true" tabindex="-1"></a>Both the R functions and the manual search suggest $\hat{\lambda} = 0.5$ $\longrightarrow$ $Y' = \sqrt{Y}$. Lets fit the new model and view the diagnostic plots.</span>
<span id="cb224-3400"><a href="#cb224-3400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3403"><a href="#cb224-3403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3404"><a href="#cb224-3404" aria-hidden="true" tabindex="-1"></a><span class="co"># view scatterplot, regression line and diagnostic plots of transformation</span></span>
<span id="cb224-3405"><a href="#cb224-3405" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">sqrt</span>(y), <span class="at">main =</span> <span class="st">"Transformation = sqrt(Y)"</span>)</span>
<span id="cb224-3406"><a href="#cb224-3406" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">sqrt</span>(y) <span class="sc">~</span> x), <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb224-3407"><a href="#cb224-3407" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">lm</span>(<span class="fu">sqrt</span>(y) <span class="sc">~</span> x), <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3408"><a href="#cb224-3408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3409"><a href="#cb224-3409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3410"><a href="#cb224-3410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3411"><a href="#cb224-3411" aria-hidden="true" tabindex="-1"></a>Could now try other remedial measures. But there seems to be issues beyond what a simple transformation can fix. Other methods should be used for this particular example.</span>
<span id="cb224-3412"><a href="#cb224-3412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3413"><a href="#cb224-3413" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb224-3414"><a href="#cb224-3414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3415"><a href="#cb224-3415" aria-hidden="true" tabindex="-1"></a>In practice:</span>
<span id="cb224-3416"><a href="#cb224-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3417"><a href="#cb224-3417" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When the Box-Cox procedure leads to a $\lambda$ value near 1, no transformation of $Y$ may be needed.</span>
<span id="cb224-3418"><a href="#cb224-3418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3419"><a href="#cb224-3419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is reasonable to choose a nearby $\lambda$ value (e.g. can use $\hat{\lambda} = -0.5$ instead of $\hat{\lambda} = -0.79$).</span>
<span id="cb224-3420"><a href="#cb224-3420" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3421"><a href="#cb224-3421" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This can make it easier to understand without sacrificing much in terms of the effectiveness of the transformation.</span>
<span id="cb224-3422"><a href="#cb224-3422" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3423"><a href="#cb224-3423" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>When choosing a more intuitive $\hat{\lambda}$, we can look flatness of the likelihood function near the maximum or at the confidence interval for $\lambda$.</span>
<span id="cb224-3424"><a href="#cb224-3424" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3425"><a href="#cb224-3425" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This works because the $SSE$ is often fairly stable in the neighborhood of the estimate.</span>
<span id="cb224-3426"><a href="#cb224-3426" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3427"><a href="#cb224-3427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After a transformation has been tentatively selected, residual plots and other analyses described earlier need to be employed to ascertain that the simple linear regression model is appropriate for the transformed data.</span>
<span id="cb224-3428"><a href="#cb224-3428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3429"><a href="#cb224-3429" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using the transformed model</span></span>
<span id="cb224-3430"><a href="#cb224-3430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3431"><a href="#cb224-3431" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview</span></span>
<span id="cb224-3432"><a href="#cb224-3432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3433"><a href="#cb224-3433" aria-hidden="true" tabindex="-1"></a>When implementing a transformation, interpretations of the results have now changed.</span>
<span id="cb224-3434"><a href="#cb224-3434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3435"><a href="#cb224-3435" aria-hidden="true" tabindex="-1"></a>Regression coefficients:</span>
<span id="cb224-3436"><a href="#cb224-3436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3437"><a href="#cb224-3437" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The estimators $\beta_0$ and $\beta_1$ obtained by least squares have the least squares properties with respect to the transformed observations, not the original ones. </span>
<span id="cb224-3438"><a href="#cb224-3438" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3439"><a href="#cb224-3439" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>i.e. Estimated coefficients need to be interpreted with respect to the transformed scales.</span>
<span id="cb224-3440"><a href="#cb224-3440" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3441"><a href="#cb224-3441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is no straightforward way to 'untransform' the coefficients to values that can be interpreted on the original scales.</span>
<span id="cb224-3442"><a href="#cb224-3442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3443"><a href="#cb224-3443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We cannot directly compare regression coefficients between models where the response variable transformation is different.</span>
<span id="cb224-3444"><a href="#cb224-3444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3445"><a href="#cb224-3445" aria-hidden="true" tabindex="-1"></a>Estimation and prediction:</span>
<span id="cb224-3446"><a href="#cb224-3446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3447"><a href="#cb224-3447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Even if we transform the response, we still want to express model estimates and predictions back in the original scale.</span>
<span id="cb224-3448"><a href="#cb224-3448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3449"><a href="#cb224-3449" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This is simply a matter of 'back transforming' by using the inverse function of the transformation.</span>
<span id="cb224-3450"><a href="#cb224-3450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3451"><a href="#cb224-3451" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This is very helpful for communicating results to the public.</span>
<span id="cb224-3452"><a href="#cb224-3452" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3453"><a href="#cb224-3453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting confidence limits</span></span>
<span id="cb224-3454"><a href="#cb224-3454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3455"><a href="#cb224-3455" aria-hidden="true" tabindex="-1"></a>In general, let $Y' = f(Y)$ and let $f'$ be the **back-transformation** (inverse) function.</span>
<span id="cb224-3456"><a href="#cb224-3456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3457"><a href="#cb224-3457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For example, if $Y' = f(Y) = Y^2)$ $\longrightarrow$ $f'(Y') = Y$, so $f'(Y') = \sqrt{Y^2} = Y$.</span>
<span id="cb224-3458"><a href="#cb224-3458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3459"><a href="#cb224-3459" aria-hidden="true" tabindex="-1"></a>Then, back transform the mean and single response confidence interval $(a, b)$ as following: $(f'(a), f'(b))$. For example: $(\sqrt{a}, \sqrt{b})$.</span>
<span id="cb224-3460"><a href="#cb224-3460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3461"><a href="#cb224-3461" aria-hidden="true" tabindex="-1"></a>Back transforming the coefficients or the standard error is not as straightforward.</span>
<span id="cb224-3462"><a href="#cb224-3462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3463"><a href="#cb224-3463" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>DO NOT DO: $\hat{Y} = f'(b_0) + f'(b_1)X = \sqrt{b_0} + \sqrt{b_1}X$.</span>
<span id="cb224-3464"><a href="#cb224-3464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3465"><a href="#cb224-3465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Have to do: $\hat{Y} = f'(\hat{Y'}) = \sqrt{b_0 + b_1X}$.</span>
<span id="cb224-3466"><a href="#cb224-3466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3467"><a href="#cb224-3467" aria-hidden="true" tabindex="-1"></a>If only $X$ is transformed to $X'$, then ne need to back transform the $Y's$ estimation because $Y$ hasn't been transformed. For example: $\hat{Y} = b_0 + b_1 X'$.</span>
<span id="cb224-3468"><a href="#cb224-3468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3469"><a href="#cb224-3469" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-3470"><a href="#cb224-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3471"><a href="#cb224-3471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Original data and model (with assumption violations)</span>
<span id="cb224-3472"><a href="#cb224-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3475"><a href="#cb224-3475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3476"><a href="#cb224-3476" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data with model</span></span>
<span id="cb224-3477"><a href="#cb224-3477" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> ALSM<span class="sc">::</span>Plasma </span>
<span id="cb224-3478"><a href="#cb224-3478" aria-hidden="true" tabindex="-1"></a>mod_plasma <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> plasma)</span>
<span id="cb224-3479"><a href="#cb224-3479" aria-hidden="true" tabindex="-1"></a>plasma <span class="sc">%$%</span> <span class="fu">plot</span>(x, y)</span>
<span id="cb224-3480"><a href="#cb224-3480" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_plasma)</span>
<span id="cb224-3481"><a href="#cb224-3481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3482"><a href="#cb224-3482" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnostic plots</span></span>
<span id="cb224-3483"><a href="#cb224-3483" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_plasma, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3484"><a href="#cb224-3484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3485"><a href="#cb224-3485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3486"><a href="#cb224-3486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3487"><a href="#cb224-3487" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Inference with bad model</span>
<span id="cb224-3488"><a href="#cb224-3488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3491"><a href="#cb224-3491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3492"><a href="#cb224-3492" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data with model</span></span>
<span id="cb224-3493"><a href="#cb224-3493" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> ALSM<span class="sc">::</span>Plasma </span>
<span id="cb224-3494"><a href="#cb224-3494" aria-hidden="true" tabindex="-1"></a>mod_plasma <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> plasma)</span>
<span id="cb224-3495"><a href="#cb224-3495" aria-hidden="true" tabindex="-1"></a>plasma <span class="sc">%$%</span> <span class="fu">plot</span>(x, y)</span>
<span id="cb224-3496"><a href="#cb224-3496" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_plasma)</span>
<span id="cb224-3497"><a href="#cb224-3497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3498"><a href="#cb224-3498" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnostic plots</span></span>
<span id="cb224-3499"><a href="#cb224-3499" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_plasma, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3500"><a href="#cb224-3500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3501"><a href="#cb224-3501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3502"><a href="#cb224-3502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3505"><a href="#cb224-3505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3506"><a href="#cb224-3506" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of both pointwise confidence and prediction limits</span></span>
<span id="cb224-3507"><a href="#cb224-3507" aria-hidden="true" tabindex="-1"></a>x_h <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(plasma<span class="sc">$</span>x), <span class="at">to =</span> <span class="fu">max</span>(plasma<span class="sc">$</span>x), <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb224-3508"><a href="#cb224-3508" aria-hidden="true" tabindex="-1"></a>confs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"conf"</span>)</span>
<span id="cb224-3509"><a href="#cb224-3509" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"pred"</span>)</span>
<span id="cb224-3510"><a href="#cb224-3510" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">main =</span> <span class="st">"Inference on bad model"</span>)</span>
<span id="cb224-3511"><a href="#cb224-3511" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"fit"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb224-3512"><a href="#cb224-3512" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"lwr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3513"><a href="#cb224-3513" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"upr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3514"><a href="#cb224-3514" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> preds[,<span class="st">"lwr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3515"><a href="#cb224-3515" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> preds[,<span class="st">"upr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3516"><a href="#cb224-3516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3517"><a href="#cb224-3517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3518"><a href="#cb224-3518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3519"><a href="#cb224-3519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fix model</span>
<span id="cb224-3520"><a href="#cb224-3520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3523"><a href="#cb224-3523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3524"><a href="#cb224-3524" aria-hidden="true" tabindex="-1"></a><span class="co"># run boxcox and extract lambda</span></span>
<span id="cb224-3525"><a href="#cb224-3525" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">boxcox</span>(mod_plasma)</span>
<span id="cb224-3526"><a href="#cb224-3526" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">boxcox</span>(mod_plasma)</span>
<span id="cb224-3527"><a href="#cb224-3527" aria-hidden="true" tabindex="-1"></a>bc<span class="sc">$</span>x[<span class="fu">which.max</span>(bc<span class="sc">$</span>y)]</span>
<span id="cb224-3528"><a href="#cb224-3528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3529"><a href="#cb224-3529" aria-hidden="true" tabindex="-1"></a><span class="co"># fit transformed model -&gt; Y' = 1 / sqrt(Y)</span></span>
<span id="cb224-3530"><a href="#cb224-3530" aria-hidden="true" tabindex="-1"></a>mod_plasma_prime <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(y) <span class="sc">~</span> x, <span class="at">data =</span> plasma)</span>
<span id="cb224-3531"><a href="#cb224-3531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3532"><a href="#cb224-3532" aria-hidden="true" tabindex="-1"></a><span class="co"># plot model and diagnostic plots</span></span>
<span id="cb224-3533"><a href="#cb224-3533" aria-hidden="true" tabindex="-1"></a>plasma <span class="sc">%$%</span> <span class="fu">plot</span>(x, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(y), <span class="at">main =</span> <span class="st">"Transformed model"</span>)</span>
<span id="cb224-3534"><a href="#cb224-3534" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod_plasma_prime)</span>
<span id="cb224-3535"><a href="#cb224-3535" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_plasma_prime, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb224-3536"><a href="#cb224-3536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3537"><a href="#cb224-3537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3538"><a href="#cb224-3538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3539"><a href="#cb224-3539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now the working model is $\frac{1}{\sqrt{Y}} = $ <span class="in">`r round(coef(mod_plasma_prime)[1], 2)`</span> $+$ <span class="in">`r round(coef(mod_plasma_prime)[2], 2)`</span> $X$ (remember coefficients are in terms of new $Y'$ scale).</span>
<span id="cb224-3540"><a href="#cb224-3540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3541"><a href="#cb224-3541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bands before back transformation</span>
<span id="cb224-3542"><a href="#cb224-3542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3545"><a href="#cb224-3545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3546"><a href="#cb224-3546" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of both pointwise confidence and prediction limits of transformed model</span></span>
<span id="cb224-3547"><a href="#cb224-3547" aria-hidden="true" tabindex="-1"></a>x_h <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(plasma<span class="sc">$</span>x), <span class="at">to =</span> <span class="fu">max</span>(plasma<span class="sc">$</span>x), <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb224-3548"><a href="#cb224-3548" aria-hidden="true" tabindex="-1"></a>confs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma_prime, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"conf"</span>)</span>
<span id="cb224-3549"><a href="#cb224-3549" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma_prime, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"pred"</span>)</span>
<span id="cb224-3550"><a href="#cb224-3550" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(plasma<span class="sc">$</span>y), <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">main =</span> <span class="st">"Inference on transformed model (before back transformation)"</span>)</span>
<span id="cb224-3551"><a href="#cb224-3551" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"fit"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb224-3552"><a href="#cb224-3552" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"lwr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3553"><a href="#cb224-3553" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> confs[,<span class="st">"upr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3554"><a href="#cb224-3554" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> preds[,<span class="st">"lwr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3555"><a href="#cb224-3555" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> preds[,<span class="st">"upr"</span>],  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3556"><a href="#cb224-3556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3557"><a href="#cb224-3557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3558"><a href="#cb224-3558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3559"><a href="#cb224-3559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we can back transform $Y' = \frac{1}{\sqrt{Y}}$ $\Longrightarrow$ $f'(Y') = (Y^{-1/2})^{-2} = (Y')^{-2} = Y$.</span>
<span id="cb224-3560"><a href="#cb224-3560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3561"><a href="#cb224-3561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bands after back transformation</span>
<span id="cb224-3562"><a href="#cb224-3562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3563"><a href="#cb224-3563" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The predicted values should be $\hat{Y} = (\hat{Y'})^{-2}$</span>
<span id="cb224-3564"><a href="#cb224-3564" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3565"><a href="#cb224-3565" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The confidence interval for the prediction, with for the mean or single response, should also be back transformed with $(value)^{-2}$.</span>
<span id="cb224-3566"><a href="#cb224-3566" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3569"><a href="#cb224-3569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3570"><a href="#cb224-3570" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset of both pointwise confidence and prediction limits of back transformed model</span></span>
<span id="cb224-3571"><a href="#cb224-3571" aria-hidden="true" tabindex="-1"></a>x_h <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(plasma<span class="sc">$</span>x), <span class="at">to =</span> <span class="fu">max</span>(plasma<span class="sc">$</span>x), <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb224-3572"><a href="#cb224-3572" aria-hidden="true" tabindex="-1"></a>confs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma_prime, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"conf"</span>)</span>
<span id="cb224-3573"><a href="#cb224-3573" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma_prime, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"pred"</span>)</span>
<span id="cb224-3574"><a href="#cb224-3574" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">main =</span> <span class="st">"Inference on transformed model AFTER back transformation"</span>)</span>
<span id="cb224-3575"><a href="#cb224-3575" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> (confs[,<span class="st">"fit"</span>])<span class="sc">^-</span><span class="dv">2</span>,  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb224-3576"><a href="#cb224-3576" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> (confs[,<span class="st">"lwr"</span>])<span class="sc">^-</span><span class="dv">2</span>,  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3577"><a href="#cb224-3577" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> (confs[,<span class="st">"upr"</span>])<span class="sc">^-</span><span class="dv">2</span>,  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3578"><a href="#cb224-3578" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> (preds[,<span class="st">"lwr"</span>])<span class="sc">^-</span><span class="dv">2</span>,  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3579"><a href="#cb224-3579" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x, <span class="at">y =</span> (preds[,<span class="st">"upr"</span>])<span class="sc">^-</span><span class="dv">2</span>,  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3580"><a href="#cb224-3580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3581"><a href="#cb224-3581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3582"><a href="#cb224-3582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3583"><a href="#cb224-3583" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of remedial measures</span></span>
<span id="cb224-3584"><a href="#cb224-3584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3585"><a href="#cb224-3585" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For nonlinear functional relationships with well behaved residuals:</span>
<span id="cb224-3586"><a href="#cb224-3586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3587"><a href="#cb224-3587" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Try transforming $X$</span>
<span id="cb224-3588"><a href="#cb224-3588" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3589"><a href="#cb224-3589" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>May require a polynomial or piecewise fit</span>
<span id="cb224-3590"><a href="#cb224-3590" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3591"><a href="#cb224-3591" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For non-constant or non-normal error variance, possible with a nonlinear functional form</span>
<span id="cb224-3592"><a href="#cb224-3592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3593"><a href="#cb224-3593" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Try transforming $Y$</span>
<span id="cb224-3594"><a href="#cb224-3594" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3595"><a href="#cb224-3595" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The Box-Cox procedure may be helpful</span>
<span id="cb224-3596"><a href="#cb224-3596" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3597"><a href="#cb224-3597" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>If the transformation on $Y$ doesn't fix the non-constant variance problem, weighted least squares can be used</span>
<span id="cb224-3598"><a href="#cb224-3598" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3599"><a href="#cb224-3599" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transformations of $X$ and $Y$ can be used together.</span>
<span id="cb224-3600"><a href="#cb224-3600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3601"><a href="#cb224-3601" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Any time you consider a transformation</span>
<span id="cb224-3602"><a href="#cb224-3602" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3603"><a href="#cb224-3603" aria-hidden="true" tabindex="-1"></a>    – Remember to recheck all the diagnostics.</span>
<span id="cb224-3604"><a href="#cb224-3604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3605"><a href="#cb224-3605" aria-hidden="true" tabindex="-1"></a>    – Consider whether you gain enough to justify losing interpretability.</span>
<span id="cb224-3606"><a href="#cb224-3606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3607"><a href="#cb224-3607" aria-hidden="true" tabindex="-1"></a>    – Reciprocal transformations make interpretation especially hard.</span>
<span id="cb224-3608"><a href="#cb224-3608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3609"><a href="#cb224-3609" aria-hidden="true" tabindex="-1"></a>    – Consider back-transforming the results of the final model for presentation.</span>
<span id="cb224-3610"><a href="#cb224-3610" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3611"><a href="#cb224-3611" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For very non-normal errors, especially those arising from discrete responses, generalized linear models are often a better option, but linear regression may be "good enough".</span>
<span id="cb224-3612"><a href="#cb224-3612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3613"><a href="#cb224-3613" aria-hidden="true" tabindex="-1"></a><span class="al">![](files/images/transformation-map.png)</span>{width=80%}</span>
<span id="cb224-3614"><a href="#cb224-3614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3615"><a href="#cb224-3615" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploration of shape regression function</span></span>
<span id="cb224-3616"><a href="#cb224-3616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3617"><a href="#cb224-3617" aria-hidden="true" tabindex="-1"></a>Motivation</span>
<span id="cb224-3618"><a href="#cb224-3618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3619"><a href="#cb224-3619" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scatter plots often indicate readily the nature of the regression function. But at other times however, the scatter plot is complex and it becomes difficult to see the nature of the regression relationship, if any, from the plot. In these cases, it is helpful to explore the nature of the regression relationship by fitting a smoothed curve without any constraints on the regression function.</span>
<span id="cb224-3620"><a href="#cb224-3620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3621"><a href="#cb224-3621" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These smoothed curves are also called *nonparametric regression curves*. They are useful not only for exploring regression relationships but also for confirming the nature of the regression function.</span>
<span id="cb224-3622"><a href="#cb224-3622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3623"><a href="#cb224-3623" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are lots of methods for time series, such as *moving averages* (or the same thing but with medians to reduce the influence of outlying observations). But these methods are for when the $X$ values (time points) are equally spaced out.</span>
<span id="cb224-3624"><a href="#cb224-3624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3625"><a href="#cb224-3625" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are also many smoothing methods for regression data, with a main one being lowess method.</span>
<span id="cb224-3626"><a href="#cb224-3626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3627"><a href="#cb224-3627" aria-hidden="true" tabindex="-1"></a><span class="fu">### Lowess method</span></span>
<span id="cb224-3628"><a href="#cb224-3628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3629"><a href="#cb224-3629" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-3630"><a href="#cb224-3630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3631"><a href="#cb224-3631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The *lowess method (locally weighted regression scatter plot smoothing)* obtains a smoothed curve by fitting successive linear regression functions in local neighborhoods and taking the fitted value at that particular $X$ as the smoothed value.</span>
<span id="cb224-3632"><a href="#cb224-3632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3633"><a href="#cb224-3633" aria-hidden="true" tabindex="-1"></a>Procedure</span>
<span id="cb224-3634"><a href="#cb224-3634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3635"><a href="#cb224-3635" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The lowess method uses a number of refinements in obtaining the final smoothed values to improve the smoothing and to make the procedure robust to outlying observations.</span>
<span id="cb224-3636"><a href="#cb224-3636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3637"><a href="#cb224-3637" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The linear regression is weighted to give cases further from the middle $X$ level in each neighborhood smaller weights.</span>
<span id="cb224-3638"><a href="#cb224-3638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3639"><a href="#cb224-3639" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>To make the procedure robust to outlying observations, the linear regression fitting is repeated, with the weights revised so that cases that had large residuals in the first fitting receive smaller weights in the second fitting.</span>
<span id="cb224-3640"><a href="#cb224-3640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3641"><a href="#cb224-3641" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>To improve the robustness of the procedure further, step 2 is repeated one or more times by revising the weights according to the size of the residuals in the latest fitting.</span>
<span id="cb224-3642"><a href="#cb224-3642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3643"><a href="#cb224-3643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To implement the lowess procedure, one must choose (→ in practice):</span>
<span id="cb224-3644"><a href="#cb224-3644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3645"><a href="#cb224-3645" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The size of the successive neighborhoods to be used when fitting each linear regression → This is the primary choice. </span>
<span id="cb224-3646"><a href="#cb224-3646" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3647"><a href="#cb224-3647" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The weight function that gives less weight to neighborhood cases with $X$ values far from each center $X$ level → Default weight functios suggested by the creator are adequate for many circumstances.</span>
<span id="cb224-3648"><a href="#cb224-3648" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3649"><a href="#cb224-3649" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Another weight function that gives less weight to cases with large residuals → Default.</span>
<span id="cb224-3650"><a href="#cb224-3650" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3651"><a href="#cb224-3651" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The number of iterations to make the procedure robust must be chosen → Two iterations appears to be sufficient.</span>
<span id="cb224-3652"><a href="#cb224-3652" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3653"><a href="#cb224-3653" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Choosing the neighborhood size</span>
<span id="cb224-3654"><a href="#cb224-3654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3655"><a href="#cb224-3655" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The larger the size, the smoother the function but the greater the danger that the smoothing will lose essential features of the regression relationship.</span>
<span id="cb224-3656"><a href="#cb224-3656" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3657"><a href="#cb224-3657" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>It may require some experimentation with different neighborhood sizes in order to find the size that best brings out the regression relationship.</span>
<span id="cb224-3658"><a href="#cb224-3658" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3659"><a href="#cb224-3659" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-3660"><a href="#cb224-3660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3663"><a href="#cb224-3663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3664"><a href="#cb224-3664" aria-hidden="true" tabindex="-1"></a><span class="co"># get dataset</span></span>
<span id="cb224-3665"><a href="#cb224-3665" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> ALSM<span class="sc">::</span>Plasma</span>
<span id="cb224-3666"><a href="#cb224-3666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3667"><a href="#cb224-3667" aria-hidden="true" tabindex="-1"></a><span class="co"># plot dataset with lowess smoother</span></span>
<span id="cb224-3668"><a href="#cb224-3668" aria-hidden="true" tabindex="-1"></a><span class="co"># arguments (with defaults)</span></span>
<span id="cb224-3669"><a href="#cb224-3669" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; f = the smoother span (proportion of points in the plot which influence the smooth at each value) ~ neighborood size</span></span>
<span id="cb224-3670"><a href="#cb224-3670" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plasma<span class="sc">$</span>x, plasma<span class="sc">$</span>y)</span>
<span id="cb224-3671"><a href="#cb224-3671" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">f =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">iter =</span> <span class="dv">3</span>))</span>
<span id="cb224-3672"><a href="#cb224-3672" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">f =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">3</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3673"><a href="#cb224-3673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3674"><a href="#cb224-3674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3675"><a href="#cb224-3675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3676"><a href="#cb224-3676" aria-hidden="true" tabindex="-1"></a>Notes</span>
<span id="cb224-3677"><a href="#cb224-3677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3678"><a href="#cb224-3678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Smoothed curves, such as the lowess curve, do not provide an analytical expression for the functional form of the regression relationship. They only suggest the shape of the regression curve.</span>
<span id="cb224-3679"><a href="#cb224-3679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3680"><a href="#cb224-3680" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The lowess procedure is not restricted to fitting linear regression functions in each neighborhood. Higher-degree polynomials can also be utilized with this method.</span>
<span id="cb224-3681"><a href="#cb224-3681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3682"><a href="#cb224-3682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Showed previously that lowess is used in residual plots to show their pattern</span>
<span id="cb224-3683"><a href="#cb224-3683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3684"><a href="#cb224-3684" aria-hidden="true" tabindex="-1"></a><span class="fu">### Use of smoothed curves to confirm the fitted regression function</span></span>
<span id="cb224-3685"><a href="#cb224-3685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3686"><a href="#cb224-3686" aria-hidden="true" tabindex="-1"></a>Overview</span>
<span id="cb224-3687"><a href="#cb224-3687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3688"><a href="#cb224-3688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Smoothed curves are useful not only in the exploratory a regression model is selected but they are also helpful in confirming the regression function chosen.</span>
<span id="cb224-3689"><a href="#cb224-3689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3690"><a href="#cb224-3690" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The procedure for confirmation is simple: The curve is plotted together with the confidence band for the fitted regression function. If the smoothed curve falls within the confidence band, we have supporting evidence of the appropriateness of the fitted regression function.</span>
<span id="cb224-3691"><a href="#cb224-3691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3692"><a href="#cb224-3692" aria-hidden="true" tabindex="-1"></a>Demo</span>
<span id="cb224-3693"><a href="#cb224-3693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3694"><a href="#cb224-3694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3697"><a href="#cb224-3697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3698"><a href="#cb224-3698" aria-hidden="true" tabindex="-1"></a><span class="co"># fit untransformed model</span></span>
<span id="cb224-3699"><a href="#cb224-3699" aria-hidden="true" tabindex="-1"></a>mod_plasma <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> plasma)</span>
<span id="cb224-3700"><a href="#cb224-3700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3701"><a href="#cb224-3701" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate confidence band using R functions</span></span>
<span id="cb224-3702"><a href="#cb224-3702" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; using textbook function (to confirm)</span></span>
<span id="cb224-3703"><a href="#cb224-3703" aria-hidden="true" tabindex="-1"></a>x_h <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(plasma<span class="sc">$</span>x), <span class="at">to =</span> <span class="fu">max</span>(plasma<span class="sc">$</span>x), <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb224-3704"><a href="#cb224-3704" aria-hidden="true" tabindex="-1"></a>conf_band1 <span class="ot">&lt;-</span> ALSM<span class="sc">::</span><span class="fu">ci.reg</span>(mod_plasma, <span class="at">newdata =</span> x_h, <span class="at">type =</span> <span class="st">"w"</span>)</span>
<span id="cb224-3705"><a href="#cb224-3705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3706"><a href="#cb224-3706" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; using predict() for in practice</span></span>
<span id="cb224-3707"><a href="#cb224-3707" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb224-3708"><a href="#cb224-3708" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">qf</span>(<span class="dv">1</span> <span class="sc">-</span> alpha, <span class="at">df1 =</span> <span class="fu">length</span>(<span class="fu">coef</span>(mod_plasma)), <span class="at">df2 =</span> <span class="fu">df.residual</span>(mod_plasma)))</span>
<span id="cb224-3709"><a href="#cb224-3709" aria-hidden="true" tabindex="-1"></a>conf_band2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_plasma, <span class="at">newdata =</span> x_h) <span class="sc">%&gt;%</span> </span>
<span id="cb224-3710"><a href="#cb224-3710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">fit =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb224-3711"><a href="#cb224-3711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> x_h<span class="sc">$</span>x,</span>
<span id="cb224-3712"><a href="#cb224-3712" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> <span class="fu">predict</span>(mod_plasma, <span class="at">newdata =</span> x_h, <span class="at">interval =</span> <span class="st">"pred"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>se.fit,</span>
<span id="cb224-3713"><a href="#cb224-3713" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwr =</span> fit <span class="sc">-</span> W <span class="sc">*</span> se,</span>
<span id="cb224-3714"><a href="#cb224-3714" aria-hidden="true" tabindex="-1"></a>         <span class="at">upr =</span> fit <span class="sc">+</span> W <span class="sc">*</span> se)</span>
<span id="cb224-3715"><a href="#cb224-3715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3716"><a href="#cb224-3716" aria-hidden="true" tabindex="-1"></a><span class="co"># plot smooth curve and actual confidence bands</span></span>
<span id="cb224-3717"><a href="#cb224-3717" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">main =</span> <span class="st">"Untransformed model"</span>)</span>
<span id="cb224-3718"><a href="#cb224-3718" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">f =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">iter =</span> <span class="dv">3</span>))</span>
<span id="cb224-3719"><a href="#cb224-3719" aria-hidden="true" tabindex="-1"></a>conf_band2 <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> lwr, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3720"><a href="#cb224-3720" aria-hidden="true" tabindex="-1"></a>conf_band2 <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> upr, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb224-3721"><a href="#cb224-3721" aria-hidden="true" tabindex="-1"></a>conf_band1 <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> Lower.Band, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb224-3722"><a href="#cb224-3722" aria-hidden="true" tabindex="-1"></a>conf_band1 <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> Upper.Band, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb224-3723"><a href="#cb224-3723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3724"><a href="#cb224-3724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb224-3725"><a href="#cb224-3725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3728"><a href="#cb224-3728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb224-3729"><a href="#cb224-3729" aria-hidden="true" tabindex="-1"></a><span class="co"># fit transformed model</span></span>
<span id="cb224-3730"><a href="#cb224-3730" aria-hidden="true" tabindex="-1"></a>mod_plasma_prime <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(y) <span class="sc">~</span> x, <span class="at">data =</span> plasma)</span>
<span id="cb224-3731"><a href="#cb224-3731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3732"><a href="#cb224-3732" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate confidence bands</span></span>
<span id="cb224-3733"><a href="#cb224-3733" aria-hidden="true" tabindex="-1"></a>conf_bands <span class="ot">&lt;-</span> ALSM<span class="sc">::</span><span class="fu">ci.reg</span>(mod_plasma_prime, <span class="at">newdata =</span> x_h, <span class="at">type =</span> <span class="st">"w"</span>)</span>
<span id="cb224-3734"><a href="#cb224-3734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3735"><a href="#cb224-3735" aria-hidden="true" tabindex="-1"></a><span class="co"># plot smooth curve and actual confidence bands after back transforming</span></span>
<span id="cb224-3736"><a href="#cb224-3736" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">main =</span> <span class="st">"Transformed model"</span>)</span>
<span id="cb224-3737"><a href="#cb224-3737" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x =</span> plasma<span class="sc">$</span>x, <span class="at">y =</span> plasma<span class="sc">$</span>y, <span class="at">f =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">iter =</span> <span class="dv">3</span>))</span>
<span id="cb224-3738"><a href="#cb224-3738" aria-hidden="true" tabindex="-1"></a>conf_bands <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> Lower.Band<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3739"><a href="#cb224-3739" aria-hidden="true" tabindex="-1"></a>conf_bands <span class="sc">%$%</span> <span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> Upper.Band<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb224-3740"><a href="#cb224-3740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3741"><a href="#cb224-3741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>